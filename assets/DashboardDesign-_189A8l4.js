import{_ as ce}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-gHuCPy-q.js";import{c as ve}from"./componentsSchema-LhIlCAWr.js";import{u as J}from"./dashboardDesign-DBSlarT8.js";import{s as K}from"./nodemodule-pinia@2.1.7_typescript@5.4.2_vue@3.4.21-DRg4DShQ.js";import{P as F,a4 as G}from"./nodemodule-@ant-design_icons-vue@7.0.1_vue@3.4.21-CO80cFpd.js";import{M as le,F as Y,h as H,I as oe,B as Q,Y as ne,U as _e,V as fe,G as be,e as se,W as ge,a as ye}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-DQ6gDd-0.js";import{c as he}from"./nodemodule-lodash-es@4.17.21-DcfALcKD.js";import{d as X,m as ie,b as z,K as b,M as r,c as e,F as P,O as T,G as $,aI as t,ar as re,aq as pe,L as u,a2 as W,N as xe,y as Ce,z as ke}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";import{r as g,u as y,t as Z,x as we}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";import{n as Se,O as te}from"./nodemodule-@vue_shared@3.4.21-Ctf17_ps.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as De}from"./ConfigForm.vue_vue_type_script_setup_true_lang-BjJXvCOp.js";import{S as Ue}from"./SchemaForm-CXG5_yWc.js";import{c as j}from"./iconfont-BCn86eVw.js";import"./nodemodule-js-cookie@3.0.5-Cz0CWeBA.js";import{u as Ne}from"./nodemodule-vue-router@4.3.0_vue@3.4.21-BC_007Jj.js";import"./nodemodule-@vue_runtime-dom@3.4.21-CDjXREoQ.js";import"./nodemodule-vue-codemirror@6.1.1_codemirror@6.0.1_vue@3.4.21-6erInkLC.js";import"./nodemodule-codemirror@6.0.1-CDdUixe0.js";import"./nodemodule-@codemirror_view@6.36.3-NX7sJwro.js";import"./nodemodule-@codemirror_state@6.5.2-CeTbMir1.js";import"./nodemodule-@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./nodemodule-style-mod@4.1.2-Bc2inJdb.js";import"./nodemodule-w3c-keyname@2.2.8-Vcq4gwWv.js";import"./nodemodule-@codemirror_language@6.10.8-mNL4GyJL.js";import"./nodemodule-@lezer_common@1.2.3-DJDOv6L0.js";import"./nodemodule-@lezer_highlight@1.2.1-GwqidMBt.js";import"./nodemodule-@codemirror_commands@6.8.0-CgqX80B-.js";import"./nodemodule-@codemirror_search@6.5.9-Bxz0SCc2.js";import"./nodemodule-crelt@1.0.6-C8TCjufn.js";import"./nodemodule-@codemirror_autocomplete@6.18.6-CgfM5yAM.js";import"./nodemodule-@codemirror_lint@6.8.4-B5u0_rJN.js";import"./nodemodule-@codemirror_lang-javascript@6.2.2-3v4eY2tQ.js";import"./nodemodule-@lezer_javascript@1.4.21-C1-eIBDX.js";import"./nodemodule-@lezer_lr@1.4.2-CXohaufN.js";import"./nodemodule-@uiw_codemirror-theme-vscode@4.23.6_@codemirror_language@6.10.8_@codemirror_state@6.5.2_@codemirror_view@6.36.3-BzpyluC0.js";import"./nodemodule-@babel_runtime@7.26.9-Bq4_u9L9.js";import"./nodemodule-@uiw_codemirror-themes@4.23.6_@codemirror_language@6.10.8_@codemirror_state@6.5.2_@codemirror_view@6.36.3-C3-fthFX.js";import"./dashboard-gUU17-Gf.js";import"./nodemodule-@ant-design_icons-svg@4.4.2-C9VH68wD.js";import"./nodemodule-@ant-design_colors@6.0.0-CBJ--Aym.js";import"./nodemodule-@ctrl_tinycolor@3.6.1-DOFZgDuz.js";import"./nodemodule-resize-observer-polyfill@1.5.1-B1PUzC5B.js";import"./nodemodule-dayjs@1.11.13-B6I98uus.js";import"./nodemodule-classnames@2.5.1-BK5ccKcQ.js";import"./nodemodule-throttle-debounce@5.0.2-CUWDS_la.js";import"./nodemodule-async-validator@4.2.5-9PlIezaS.js";import"./nodemodule-scroll-into-view-if-needed@2.2.31-CLVC0ehY.js";import"./nodemodule-compute-scroll-into-view@1.0.20-1gs_hJI2.js";import"./nodemodule-vue-types@3.0.2_vue@3.4.21-CF28atMM.js";import"./nodemodule-dom-align@1.12.4-CRCehRfe.js";import"./nodemodule-@emotion_hash@0.9.2-WldOFDRm.js";import"./nodemodule-@emotion_unitless@0.8.1-sScrWPmR.js";import"./nodemodule-stylis@4.3.6-D5iaQeiq.js";import"./nodemodule-uuid@9.0.1-CtRu48qb.js";import"./tools-BCD5ohFr.js";import"./nodemodule-gaius-utils@1.1.8_@types_node@20.11.28_typescript@5.4.2_vite@5.1.6-LqpbgJb2.js";/* empty css                   */import"./nodemodule-axios@1.6.8-BZ84_VUH.js";const ue=f=>(re("data-v-88293ef5"),f=f(),pe(),f),Ie={class:"material-area"},$e={class:"material-layout-area"},qe=ue(()=>r("div",{class:"title"},"内置组件",-1)),Me={class:"content"},Le=["data-material"],Ve={class:"material-label"},Oe={class:"material-data-area"},Pe=ue(()=>r("div",{class:"title"},"自定义组件",-1)),Be={class:"content"},Ee=["data-material"],Re={style:{height:"650px"}},Te={style:{height:"80px","overflow-y":"auto"}},We={style:{height:"200px","overflow-y":"auto"}},Fe=X({__name:"MaterialArea",setup(f){const D=J(),{customModules:h,customComps:U}=K(D),{onAddModules:m}=D,i=g({internalComp:ve,customComp:[]}),N=p=>{var s,a;const n=p.target;(s=p.dataTransfer)==null||s.setData("material",n.dataset.material),(a=p.dataTransfer)==null||a.setData("material-type",n.dataset.materialType)},w=g(!1),q=()=>{w.value=!0,o.value=he(L.value)},L=g({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElEmpty",exportName:"ElEmpty",id:"1",schema:`{
    "description": {
        "type": "input",
        "label": "描述"
    }

      }`}]}),o=g({}),I=()=>{w.value=!1},M=()=>{m(o.value),I()};ie(()=>h.value,()=>{i.value.customComp=i.value.customComp.concat(U.value),v==null||v.postMessage({type:"add-custom-comp",data:Z(o.value)})},{deep:!0});const B=()=>{o.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},E=p=>{const n=o.value.children.findIndex(s=>s.id==p.id);n!=-1&&o.value.children.splice(n,1)},c=()=>{o.value.urls.push("")},d=p=>{const n=o.value.urls.findIndex(s=>s==p);n!=-1&&o.value.urls.splice(n,1)};let v=null;return z(()=>{v=document.querySelector(".standalone-iframe").contentWindow}),(p,n)=>{const s=oe,a=H,C=Q,S=ne,k=ce,A=Y,V=le;return u(),b("div",Ie,[r("div",$e,[qe,r("div",Me,[(u(!0),b(P,null,T(i.value.internalComp,l=>(u(),b("div",{key:l.name,draggable:"true",onDragstart:N,"data-material":l.name,"data-material-type":"internal",class:"material-item"},[r("span",{class:Se(["iconfont material-icon",l.icon])},null,2),r("span",Ve,te(l.label),1)],40,Le))),128))])]),r("div",Oe,[Pe,r("div",Be,[(u(!0),b(P,null,T(i.value.customComp,l=>(u(),b("div",{type:"dashed",key:l.value,draggable:"true",onDragstart:N,"data-material":l.value,"data-material-type":"custom",class:"material-item"},te(l.label),41,Ee))),128)),r("div",{type:"dashed",onClick:q,class:"material-item"},[r("span",null,[e(y(F)),$(" 添加组件 ")])])])]),e(V,{title:"添加自定义组件",width:"800px",open:w.value,"onUpdate:open":n[4]||(n[4]=l=>w.value=l),onOk:M,onCancel:I},{default:t(()=>[r("div",Re,[e(A,{model:o.value,"label-col":{style:{width:"150px"}}},{default:t(()=>[e(a,{label:"名称"},{default:t(()=>[e(s,{value:o.value.title,"onUpdate:value":n[0]||(n[0]=l=>o.value.title=l)},null,8,["value"])]),_:1}),e(a,{label:"组件库名称"},{default:t(()=>[e(s,{value:o.value.package,"onUpdate:value":n[1]||(n[1]=l=>o.value.package=l)},null,8,["value"])]),_:1}),e(a,{label:"版本"},{default:t(()=>[e(s,{value:o.value.version,"onUpdate:value":n[2]||(n[2]=l=>o.value.version=l)},null,8,["value"])]),_:1}),e(a,{label:"导出名称"},{default:t(()=>[e(s,{value:o.value.exportName,"onUpdate:value":n[3]||(n[3]=l=>o.value.exportName=l)},null,8,["value"])]),_:1}),e(a,{label:"CDN地址"},{default:t(()=>[r("div",Te,[(u(!0),b(P,null,T(o.value.urls,(l,R)=>(u(),b("div",{key:l,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(s,{value:o.value.urls[R],"onUpdate:value":x=>o.value.urls[R]=x},null,8,["value","onUpdate:value"]),e(y(G),{onClick:x=>d(l),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(a,null,{default:t(()=>[e(C,{type:"dashed",block:"",onClick:c},{default:t(()=>[e(y(F)),$(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(a,{label:"子组件"},{default:t(()=>[r("div",We,[(u(!0),b(P,null,T(o.value.children,(l,R)=>(u(),b("div",{key:l.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(S,null,{default:t(()=>[r("div",null,[e(S,null,{default:t(()=>[e(a,{label:"组件名",rules:{required:!0}},{default:t(()=>[e(s,{value:l.componentName,"onUpdate:value":x=>l.componentName=x},null,8,["value","onUpdate:value"])]),_:2},1024),e(a,{label:"导出名称",rules:{required:!0}},{default:t(()=>[e(s,{value:l.exportName,"onUpdate:value":x=>l.exportName=x},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(a,{label:"配置Schema",rules:{required:!0}},{default:t(()=>[e(k,{value:l.schema,"onUpdate:value":x=>l.schema=x,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(y(G),{onClick:x=>E(l)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(a,null,{default:t(()=>[e(C,{type:"dashed",block:"",onClick:B},{default:t(()=>[e(y(F)),$(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),ze=ee(Fe,[["__scopeId","data-v-88293ef5"]]),Ae={text:{type:"input",label:"文本内容"}},je={src:{type:"input",label:"图片地址"}},Ge={src:{type:"input",label:"页面地址"}},Je=f=>({dataset:{type:"select",label:"数据集",options:f},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),Ke={"qb-text":Ae,"qb-image":je,"qb-iframe":Ge,"qb-chart":Je},Ye={title1:{type:"divider",label:"标题",component:{title:"标题"},formLayout:!1},"option.title.show":{type:"switch",label:"显示标题"},"option.title.text":{type:"string",label:"标题文本"},"option.title.link":{type:"string",label:"文本超链接"},title2:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},"option.grid.left":{type:"string",label:"左边距"},"option.grid.right":{type:"string",label:"右边距"},"option.grid.top":{type:"string",label:"上边距"},"option.grid.bottom":{type:"string",label:"下边距"},title3:{type:"divider",label:"图例",component:{title:"图例"},formLayout:!1},"option.legend.show":{type:"switch",label:"显示图例"},"option.legend.type":{type:"select",label:"图例类型",component:{dataSource:[{label:"普通图例",value:"plain"},{label:"翻页图例",value:"scroll"}]}},"option.legend.orient":{type:"select",label:"图例朝向",component:{dataSource:[{value:"horizontal",label:"横向"},{value:"vertical",label:"纵向"}]}},title4:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},ae={title1:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},paddingLeft:{type:"string",label:"左边距",tooltip:"请注明单位，一般为：px"},paddingTop:{type:"string",label:"上边距",tooltip:"请注明单位，一般为：px"},paddingRight:{type:"string",label:"右边距",tooltip:"请注明单位，一般为：px"},paddingBottom:{type:"string",label:"下边距",tooltip:"请注明单位，一般为：px"},title2:{type:"divider",label:"背景",component:{title:"背景"},formLayout:!1},backgroundColor:{type:"string",label:"背景色",component:{name:"color-picker"}},title3:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},He={class:"material-cfg"},Qe={class:"material-cfg-btn"},Xe=X({__name:"MaterialCfg",setup(f){const D=J(),{customCompSchema:h}=K(D),{getContentWindow:U}=D,m=g({}),i=g({}),N=g({}),w=g({}),q=g({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"100px"}}},properties:ae}),L=g([]);j.getDatasetDict().then(c=>{const{code:d,data:v,msg:p}=c;d==200&&(L.value=v)});const o=g([]),I=()=>{m.value.dimension=[],m.value.target=[],j.getFieldByDatasetId(m.value.dataset).then(c=>{const{code:d,data:v,msg:p}=c;d==200&&(o.value=v.map(n=>({value:n,label:n})))})};window.addEventListener("message",c=>{var d;(c.data.type==="select"||c.data.type==="update-item")&&(q.value.properties=ae,i.value=c.data.data,((d=i.value)==null?void 0:d.type)==="custom"?h.value&&(N.value=JSON.parse(h.value[i.value.component])):i.value.component=="qb-chart"?q.value.properties=Ye:N.value=Ke[i.value.component],m.value=i.value.props,i.value.component=="qb-chart"&&j.getFieldByDatasetId(m.value.dataset).then(v=>{const{code:p,data:n,msg:s}=v;p==200&&(o.value=n.map(a=>({value:a,label:a})))}),w.value=i.value.style)});let M=null;const B=c=>{if(M)M.postMessage({type:"refresh",data:c});else throw new Error("contentWindow is null")},E=()=>{B(Z(i.value))};return z(()=>{U().then(c=>{M=c})}),(c,d)=>{const v=be,p=se,n=H,s=Y,a=fe,C=_e,S=Q;return u(),b("div",He,[e(C,{size:"small"},{default:t(()=>[e(a,{key:"prop",tab:"属性"},{default:t(()=>[i.value.id?i.value.component!="qb-chart"?(u(),W(De,{class:"material-cfg-contain",key:i.value.id,data:m.value,schema:N.value},null,8,["data","schema"])):i.value.component=="qb-chart"?(u(),W(s,{key:2},{default:t(()=>[e(n,{label:"数据集"},{default:t(()=>[e(p,{value:m.value.dataset,"onUpdate:value":d[0]||(d[0]=k=>m.value.dataset=k),options:L.value,onChange:I},null,8,["value","options"])]),_:1}),e(n,{label:"维度"},{default:t(()=>[e(p,{value:m.value.dimension,"onUpdate:value":d[1]||(d[1]=k=>m.value.dimension=k),options:o.value,mode:"tags"},null,8,["value","options"])]),_:1}),e(n,{label:"指标"},{default:t(()=>[e(p,{value:m.value.target,"onUpdate:value":d[2]||(d[2]=k=>m.value.target=k),options:o.value,mode:"tags"},null,8,["value","options"])]),_:1})]),_:1})):xe("",!0):(u(),W(v,{key:0}))]),_:1}),e(a,{key:"style",tab:"样式"},{default:t(()=>[(u(),W(y(Ue),{schema:q.value,size:"small",formData:w.value,key:i.value.id},null,8,["schema","formData"]))]),_:1})]),_:1}),r("div",Qe,[e(S,{onClick:E,disabled:!i.value.id},{default:t(()=>[$("刷新")]),_:1},8,["disabled"])])])}}}),Ze=ee(Xe,[["__scopeId","data-v-c3e45bd1"]]),et=f=>(re("data-v-715b8aa8"),f=f(),pe(),f),tt={class:"dg-design"},at={class:"dg-design-container"},lt=et(()=>r("div",{class:"middle-part"},[r("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),ot={style:{height:"300px","overflow-y":"auto"}},nt=X({__name:"DashboardDesign",props:{id:{}},setup(f){const D=J(),{varPools:h,dgInfo:U,loading:m}=K(D);let i;const{getContentWindow:N,onSave:w,getDetail:q}=D;window.name="dg-design";const L=f,{id:o}=we(L);z(()=>{o.value&&q(o.value)});const I=g(!1),M=()=>{I.value=!0},B=()=>{i.postMessage({type:"get-dg"})};z(()=>{N().then(s=>{i=s})});const E=()=>{i.postMessage({type:"refresh-var",data:Z(h.value)})};ie(()=>h.value,()=>{E()},{deep:!0});const c=()=>{h.value.vars.push({name:"",type:"",defaultValue:""})},d=g([{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔",value:"boolean"},{label:"数组",value:"array"},{label:"对象",value:"object"}]),v=s=>{const a=h.value.vars.findIndex(C=>C.name===s.name);a!=-1&&h.value.vars.splice(a,1)},p=Ne(),n=()=>{U.value.id||ye.warning("请保存后再预览");const s=p.resolve({path:"/preview-dashboard",query:{id:U.value.id}});window.open(s.href,"_blank")};return window.addEventListener("message",s=>{s.data.type==="save"&&w(s.data.data)}),(s,a)=>{const C=oe,S=Q,k=ne,A=ge,V=H,l=se,R=Y,x=le,de=ke("loading");return u(),b(P,null,[Ce((u(),b("div",tt,[e(A,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:t(()=>[e(C,{bordered:!1,class:"form-name",value:y(U).name,"onUpdate:value":a[0]||(a[0]=_=>y(U).name=_)},null,8,["value"])]),extra:t(()=>[e(k,null,{default:t(()=>[e(S,{type:"primary",onClick:a[1]||(a[1]=_=>M())},{default:t(()=>[$("变量池")]),_:1}),e(S,{class:"preview-btn",onClick:a[2]||(a[2]=_=>n())},{default:t(()=>[$(" 预览 ")]),_:1}),e(S,{onClick:a[3]||(a[3]=_=>B()),type:"primary",class:"save-btn"},{default:t(()=>[$(" 保存 ")]),_:1})]),_:1})]),_:1}),r("div",at,[e(ze,{class:"left-part"}),lt,e(Ze,{class:"right-part"})])])),[[de,y(m),void 0,{fullscreen:!0}]]),e(x,{title:"变量池",open:I.value,"onUpdate:open":a[4]||(a[4]=_=>I.value=_),width:"800px",footer:null},{default:t(()=>[e(R,null,{default:t(()=>[r("div",ot,[(u(!0),b(P,null,T(y(h).vars,(_,me)=>(u(),W(k,{key:me,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[e(V,{label:"变量名",required:!0},{default:t(()=>[e(C,{value:_.name,"onUpdate:value":O=>_.name=O},null,8,["value","onUpdate:value"])]),_:2},1024),e(V,{label:"变量类型",required:!0},{default:t(()=>[e(l,{style:{width:"150px"},value:_.type,"onUpdate:value":O=>_.type=O,options:d.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(V,{label:"默认值",required:!0},{default:t(()=>[e(C,{value:_.defaultValue,"onUpdate:value":O=>_.defaultValue=O},null,8,["value","onUpdate:value"])]),_:2},1024),e(y(G),{onClick:O=>v(_)},null,8,["onClick"])]),_:2},1024))),128))]),e(V,null,{default:t(()=>[e(S,{type:"dashed",block:"",onClick:c},{default:t(()=>[e(y(F)),$(" 添加变量 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),da=ee(nt,[["__scopeId","data-v-715b8aa8"]]);export{da as default};
