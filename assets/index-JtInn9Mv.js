import{d as c}from"./api-D3ji7G46.js";import{g as le,ax as oe,r as u,E as ne,X as se,o as p,A as I,K as f,l as t,N as w,n as de,i as E,ah as ue,w as o,F as ie,e as T,ad as re,a4 as ce,ae as pe,Y as me,$ as K,a0 as ve,a1 as D,C as m,P as _e,h as x,ay as fe,az as be,aA as ye,aB as ge,a8 as ke,V as we,a3 as xe,a2 as Ce,ag as Ne,a5 as he}from"./.pnpm-Bqj5ZitX.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Dcam5Uk9.js";const Ue={class:"container"},qe={class:"search-tree"},Pe={class:"tree-top"},Ie={style:{width:"160px",display:"flex","justify-content":"space-between"}},De={key:0,class:"iconfont icon-Mysql"},Fe={class:"datasource"},Be={key:0},Me=le({__name:"index",setup(Oe){const L=oe(),F=u([]),B=u([]),$=u([{title:"表名称",key:"tableName",dataIndex:"tableName",width:"300px"},{title:"表注释",key:"tableComment",dataIndex:"tableComment",width:"300px"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),b=u(!1),j=u(0),U=u(""),C=()=>{c.getList(U.value).then(l=>{const{code:e,data:s}=l;b.value=!1,e==200&&(F.value=s.data,j.value=s.total)})},M=()=>{b.value=!0,c.getTableInfo(y.value[0]).then(l=>{b.value=!1;const{code:e,data:s,msg:d}=l;e==200&&(B.value=s)})},y=u([]),z=(l,e)=>{e=="view"||e=="edit"?q(e,l):e=="remove"&&K.confirm({title:"删除数据源",content:"确定要删除吗?",okText:"确认",cancelText:"取消",onOk:()=>{c.remove(l).then(s=>{const{code:d,data:i,msg:P}=s;d==200&&(T.success("删除成功"),M())})}})},_=u("add"),X=ne(()=>{let l="新增数据源";switch(_.value){case"add":l="新增数据源";break;case"edit":l="编辑数据源";break;case"view":l="查看数据源";break}return l}),v=u(!1),N=u(),n=u({datasourceName:"",dbHost:"",dbName:"",dbPort:3306,dbPwd:"",dbType:"mysql",dbUsername:"",sourceType:"db",status:"",remark:""}),O=()=>{var l;(l=N.value)==null||l.validate().then(()=>{_.value=="add"?c.add(n.value).then(e=>{const{code:s,data:d,msg:i}=e;s==200&&T.success("新增成功"),C(),v.value=!1}):_.value=="edit"?c.update(n.value).then(e=>{const{code:s,data:d,msg:i}=e;s==200&&T.success("编辑成功"),C(),v.value=!1}):v.value=!1})},S=()=>{var l;(l=N.value)==null||l.resetFields()},q=(l,e)=>{_.value=l,l==="add"?(n.value={datasourceName:"",dbHost:"",dbName:"",dbPort:3306,dbPwd:"",dbType:"mysql",dbUsername:"",sourceType:"db",status:"",remark:""},v.value=!0):c.getDetail(e).then(s=>{const{code:d,data:i}=s;d==200&&(n.value=i,v.value=!0)})},Y=()=>{var l;(l=N.value)==null||l.validate().then(()=>{c.connect(n.value).then(e=>{const{code:s,msg:d}=e;s==200&&T.success("连接成功")})})},G=u([{title:"字段名称",key:"columnName",dataIndex:"columnName",width:"300px"},{title:"字段类型",key:"columnType",dataIndex:"columnType",width:"300px"},{title:"字段注释",key:"columnComment",dataIndex:"columnComment",width:"300px"}]),J=(l,e)=>{l&&(e.loading=!0,c.getColumnInfo(y.value[0],e.tableName).then(s=>{e.loading=!1;const{code:d,data:i,msg:P}=s;d==200&&(e.fieldList=i)}))};se(()=>{C()});const Q=l=>{const e=L.resolve({path:"/design/dataset",query:{type:"add",datasourceId:y.value[0],tableName:l}});window.open(e.href,"_blank")};return(l,e)=>{const s=re,d=ce,i=be,P=ye,W=ge,Z=pe,V=ke,H=me,R=we,r=xe,g=Ce,ee=Ne,ae=he,te=K,k=ve("has-perm");return p(),I(ie,null,[f("div",Ue,[f("div",qe,[f("div",Pe,[t(s,{value:U.value,"onUpdate:value":e[0]||(e[0]=a=>U.value=a),style:{"margin-bottom":"8px",width:"170px"},placeholder:"请输入数据源名称",onSearch:C},null,8,["value"]),w(t(d,{icon:de(E(ue)),onClick:e[1]||(e[1]=a=>q("add"))},null,8,["icon"]),[[k,"lowcode:datasource:add"]])]),t(Z,{selectedKeys:y.value,"onUpdate:selectedKeys":e[2]||(e[2]=a=>y.value=a),"tree-data":F.value,selectable:"",fieldNames:{title:"datasourceName",key:"id",children:"children"},style:{height:"calc(100% - 30px)","overflow-y":"auto"},onSelect:M},{title:o(a=>[f("div",Ie,[f("span",null,[a.dbType==="mysql"?(p(),I("span",De)):D("",!0),m(" "+_e(a.datasourceName),1)]),t(W,{trigger:["click"]},{overlay:o(()=>[t(P,{onClick:({key:h})=>z(a.id,h)},{default:o(()=>[w((p(),x(i,{key:"view"},{default:o(()=>[m("查看")]),_:1})),[[k,"lowcode:datasource:detail"]]),w((p(),x(i,{key:"edit"},{default:o(()=>[m("编辑")]),_:1})),[[k,"lowcode:datasource:update"]]),w((p(),x(i,{key:"remove"},{default:o(()=>[m("删除")]),_:1})),[[k,"lowcode:datasource:remove"]])]),_:2},1032,["onClick"])]),default:o(()=>[t(E(fe),{style:{transform:"rotate(90deg)"}})]),_:2},1024)])]),_:1},8,["selectedKeys","tree-data"])]),f("div",Fe,[t(H,null,{default:o(()=>[t(V,{loading:b.value,columns:$.value,"data-source":B.value,scroll:{y:740},pagination:!1,rowKey:"tableName",class:"ant-table-striped",onExpand:J},{bodyCell:o(({column:a,record:h})=>[a.key=="action"?(p(),x(d,{key:0,type:"link",onClick:A=>Q(h.tableName)},{default:o(()=>[m("创建数据集")]),_:2},1032,["onClick"])):D("",!0)]),expandedRowRender:o(({record:a})=>[t(H,null,{default:o(()=>[t(V,{loading:a.loading,class:"ant-table-striped",columns:G.value,pagination:!1,"data-source":a.fieldList,"row-class-name":(h,A)=>A%2===1?"table-striped":null,style:{margin:"5px"}},null,8,["loading","columns","data-source","row-class-name"])]),_:2},1024)]),_:1},8,["loading","columns","data-source"])]),_:1})])]),t(te,{title:X.value,open:v.value,"onUpdate:open":e[11]||(e[11]=a=>v.value=a),onOk:O,onCancel:S},{footer:o(()=>[_.value!="view"?(p(),I("div",Be,[w((p(),x(d,{onClick:Y},{default:o(()=>[m("测试连接")]),_:1})),[[k,"lowcode:datasource:connection"]]),t(d,{onClick:S},{default:o(()=>[m("取消")]),_:1}),t(d,{type:"primary",loading:b.value,onClick:O},{default:o(()=>[m("确定")]),_:1},8,["loading"])])):D("",!0)]),default:o(()=>[t(ae,{model:n.value,"label-col":{span:8},ref_key:"modalFormRef",ref:N,disabled:_.value==="view"},{default:o(()=>[t(r,{label:"创建源类型",required:"",prop:"sourceType"},{default:o(()=>[t(R,{disabled:"",value:n.value.sourceType,"onUpdate:value":e[3]||(e[3]=a=>n.value.sourceType=a),options:[{label:"数据库",value:"db"}]},null,8,["value"])]),_:1}),t(r,{label:"数据库类型",required:"",prop:"dbType"},{default:o(()=>[t(R,{value:n.value.dbType,"onUpdate:value":e[4]||(e[4]=a=>n.value.dbType=a),options:[{label:"mysql",value:"mysql"}]},null,8,["value"])]),_:1}),t(r,{label:"数据源名称",required:"",prop:"datasourceName"},{default:o(()=>[t(g,{value:n.value.datasourceName,"onUpdate:value":e[5]||(e[5]=a=>n.value.datasourceName=a)},null,8,["value"])]),_:1}),t(r,{label:"数据库地址",required:"",prop:"dbHost"},{default:o(()=>[t(g,{value:n.value.dbHost,"onUpdate:value":e[6]||(e[6]=a=>n.value.dbHost=a)},null,8,["value"])]),_:1}),t(r,{label:"端口",required:"",prop:"dbPort"},{default:o(()=>[t(g,{value:n.value.dbPort,"onUpdate:value":e[7]||(e[7]=a=>n.value.dbPort=a)},null,8,["value"])]),_:1}),t(r,{label:"数据库名称",required:"",prop:"dbName"},{default:o(()=>[t(g,{value:n.value.dbName,"onUpdate:value":e[8]||(e[8]=a=>n.value.dbName=a)},null,8,["value"])]),_:1}),t(r,{label:"用户名",required:"",prop:"dbUsername"},{default:o(()=>[t(g,{value:n.value.dbUsername,"onUpdate:value":e[9]||(e[9]=a=>n.value.dbUsername=a)},null,8,["value"])]),_:1}),t(r,{label:"密码",required:"",prop:"dbPwd"},{default:o(()=>[t(ee,{value:n.value.dbPwd,"onUpdate:value":e[10]||(e[10]=a=>n.value.dbPwd=a)},null,8,["value"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["title","open"])],64)}}}),Ae=Te(Me,[["__scopeId","data-v-d1f7d87a"]]);export{Ae as default};
