import{ba as Se,f as De,r as p,aV as $e,g as A,s as z,v as K,o as c,B as y,l as t,i as e,aG as Re,E as C,F as O,w as a,aJ as Ne,I as Be,aO as ue,a9 as X,L as de,H as U,W as J,bb as Q,aj as Z,J as B,bc as Te,bd as Ae,a3 as G,h as T,ah as Fe,t as ae,x as Oe,be as Le,aE as Pe,P as Ve,C as Ue,b4 as se,b7 as ze,O as Ee,a2 as Me,ao as We,ap as He,bf as ie,b1 as je,bg as qe,bh as Ge,a4 as Je,Y as Qe,a5 as Ye,a6 as Ke,b9 as Xe,a$ as Ze,ab as et,ac as tt,a7 as ot}from"./.pnpm-DpKfdl5h.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as V}from"./index-BcrY2v3-.js";import{S as Y}from"./SchemaForm-D0oQow3i.js";const lt=new Se,E=lt,L=De("tableDesign",()=>{const b=p([]),u=p({name:"",description:"",status:1,columns:[],global:{bordered:!1},datasource:{tableName:"",sourceId:""},filter:{show:!0,widgetList:[]},action:[]}),s=p([]),n=p({}),h=()=>{const i=new Date().getTime().toString().slice(-4);u.value.columns,u.value.columns.push({id:$e(),dataIndex:"field"+i,title:"列"+i,width:200})},v=(i,r)=>{const D=r.findIndex(F=>F.id===i);D!=-1&&(n.value=r[D])},w=(i,r)=>{const D=r.findIndex(F=>F.id===i);D!=-1&&r.splice(D,1)},S=i=>{u.value.action.push({id:new Date().getTime().toString(),name:"测试",position:i,eventFlowId:""})},g=i=>{const r=u.value.action.findIndex(D=>D.id==i);r!=-1&&u.value.action.splice(r,1)},x=i=>{const r=u.value.filter.widgetList.findIndex(D=>D.id==i);r!=-1&&u.value.filter.widgetList.splice(r,1)},R=async i=>{},I=p(!1);return{tableCfg:u,currentColumn:n,onSelectColumn:v,onRemoveColumn:w,onAddColumn:h,tableData:b,onRefreshData:R,saveLoading:I,onSave:async()=>{I.value=!0,setTimeout(()=>{u.value,I.value=!1},2e3)},columnFields:s,onSetColumns:i=>{s.value=i},onAddBtn:S,onRemoveBtn:g,onRemoveWidget:x}}),nt={class:"custom-header-label",style:{flex:"1"}},at=A({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(b,{emit:u}){const s=L(),{currentColumn:n}=z(s),h=b,{params:v}=K(h),w=()=>{E.onPublish("removeEvent",v.value)};return(S,g)=>{const x=X;return c(),y("div",{class:Be(["custom-header-item",e(n).dataIndex==e(v).column.getColId()?"active":""]),style:ue([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:e(n).dataIndex==e(v).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[t(e(Re),{class:"move",style:{width:"20px",cursor:"move"}}),C("div",nt,O(e(v).displayName),1),t(x,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:g[0]||(g[0]=R=>w())},{default:a(()=>[t(e(Ne),{class:"remove",style:{width:"20px"}})]),_:1})],6)}}}),st={class:"custom-opt-cell"},it=["onClick"],ut=A({__name:"CustomOptCell",setup(b){const u=L(),{tableCfg:s}=z(u),n=de(()=>{var g;return(g=s.value.action)==null?void 0:g.filter(x=>x.position=="row")}),{onAddBtn:h,onRemoveBtn:v}=u,w=g=>{E.onPublish("open-btn-modal",g)},S=()=>{h("row")};return(g,x)=>{const R=X;return c(),y("div",st,[(c(!0),y(U,null,J(n.value,I=>(c(),y("div",{class:"btn",key:I.id},[C("a",{onClick:d=>w(I)},O(I.name),9,it),t(R,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:d=>e(v)(I.id)},{default:a(()=>[t(e(Q),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),t(e(Z),{style:{cursor:"pointer"},onClick:x[0]||(x[0]=I=>S())})])}}}),dt={class:"custom-header-label",style:{flex:"1"}},ct=A({__name:"CustomAddColumn",setup(b){const u=L(),{onAddColumn:s}=u;return(n,h)=>{const v=Ae;return c(),y("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:h[0]||(h[0]=w=>e(s)())},[C("div",dt,[t(e(Z)),B(" 新增列 "),t(v,null,{title:a(()=>[B("用于新增列配置")]),default:a(()=>[t(e(Te))]),_:1})])])}}}),rt={class:"cell"},mt={key:0},pt=["href"],vt=A({__name:"CustomCellRender",props:{params:{}},setup(b){const u=b,{params:s}=K(u);return(n,h)=>{const v=Fe;return c(),y("div",rt,[e(s).colDef.cellRendererParams.type=="text"?(c(),y("span",mt,O(e(s).value),1)):G("",!0),e(s).colDef.cellRendererParams.type=="image"?(c(),T(v,{key:1,src:e(s).value},null,8,["src"])):G("",!0),e(s).colDef.cellRendererParams.type=="link"?(c(),y("a",{key:2,href:e(s).value},O(e(s).value),9,pt)):G("",!0)])}}}),_t=A({__name:"AgTable",props:ae({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ae(["onRemove","onClick"],["update:columns"]),setup(b,{emit:u}){E.onSubscribe("removeEvent",d=>{let _=d.column.getColId(),i=s.value.find(r=>r.dataIndex==_);i&&R(i)});const s=Oe(b,"columns"),n=b,{columnId:h,tableData:v}=K(n),w=de(()=>{let d=s.value.map(_=>({field:_.dataIndex,colId:_.dataIndex,headerName:_.title,pinned:_.fixed=="none"?void 0:_.fixed,lockVisible:!0,headerComponent:at,cellRenderer:vt,cellRendererParams:{type:_.type}}));return d.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:ct}),d.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:ut}),d}),S=d=>{if(!d.finished)return;let _=d.api.getColumnState().map(i=>s.value.find(r=>r.dataIndex==i.colId));s.value=_},g=d=>{if(!d.finished)return;let _=d.column.getColId(),i=s.value.findIndex(r=>r.dataIndex==_);i!=-1&&(s.value[i].width=d.column.getActualWidth())},x=u,R=d=>{x("onRemove",d)},I=d=>{let _=d.column.getId(),i=s.value.find(r=>r.dataIndex==_);x("onClick",i)};return(d,_)=>(c(),T(e(Le),{rowData:e(v),columnDefs:w.value,style:ue({height:d.height+"px"}),class:"ag-theme-quartz",onColumnMoved:S,onColumnResized:g,onColumnHeaderClicked:I},null,8,["rowData","columnDefs","style"]))}}),ft=ce(_t,[["__scopeId","data-v-8ecc2aa5"]]),bt=A({__name:"TableCfg",setup(b){const u=L(),{tableCfg:s,columnFields:n,currentColumn:h}=z(u),v=p({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(S=>{setTimeout(()=>{S(n.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),w=p();return Pe(()=>h.value,()=>{w.value.refreshOption("dataIndex")}),(S,g)=>(c(),T(e(Y),{formData:e(h),schema:v.value,ref_key:"schemaRef",ref:w,size:"small"},null,8,["formData","schema"]))}}),gt=b=>(We("data-v-39979008"),b=b(),He(),b),ht={class:"table-design"},Ct={class:"table-design-container"},yt={class:"main-part"},wt={class:"filter-part"},xt={class:"filter-container"},It=["onClick"],kt={class:"add widget-item"},St={class:"tools-part"},Dt={class:"tools-container"},$t={class:"add button-item"},Rt={class:"table-part"},Nt={class:"right-part"},Bt=gt(()=>C("div",null,"全局配置",-1)),Tt=A({__name:"TableDesign",setup(b){E.onSubscribe("open-btn-modal",m=>{te(m)});const u=p([]);Ve(()=>{V.getDataSourceDict().then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(u.value=k)})});const s=L(),{tableCfg:n,columnFields:h,saveLoading:v}=z(s),{onSelectColumn:w,onRemoveBtn:S,onRemoveColumn:g,onSetColumns:x,onRemoveWidget:R,onAddBtn:I,onSave:d}=s;window.name="table-design";const _=()=>{var m;(m=n.value.filter.widgetList)==null||m.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},i=()=>{window.open("/lowcode/table","quick-build")},r=m=>{w(m.id,n.value.columns),H.value=!0},D=m=>{g(m.id,n.value.columns)};p([]);const F=p([]),re=()=>{V.getSourceData(n.value.datasource.sourceId,n.value.datasource.tableName).then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(F.value=k)})},ee=p([]),me=()=>{V.getTableInfo(n.value.datasource.sourceId).then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(ee.value=k)})},pe=()=>{V.getColumnInfo(n.value.datasource.sourceId,n.value.datasource.tableName).then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(n.value.columns=k.map(f=>({dataIndex:f.columnName,title:f.columnComment||f.columnName,id:f.columnName,width:200,type:"text",align:"left",fixed:"none"})),x(k.map(f=>({label:f.columnComment?`${f.columnComment}(${f.columnName})`:f.columnName,value:f.columnName}))))}),re()},ve=()=>{I("header")},$=p({id:"",name:"",eventFlowId:"",position:"header"}),M=p(!1),_e=p([{label:"默认新增事件流",value:"add"},{label:"默认编辑事件流",value:"edit"},{label:"默认批量编辑事件流",value:"batchEdit"}]),te=m=>{$.value=m,M.value=!0},fe=()=>{},oe=p({}),W=p(!1),be=p({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"string",label:"字段名称"},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",show:'"${formData.type}" == "select"'},defaultValue:{type:"string",label:"默认值"}}}),ge=p({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{bordered:{type:"switch",label:"边框"}}}),he=m=>{oe.value=m,W.value=!0},H=p(!1);return(m,o)=>{const k=Je,N=Qe,f=Ye,P=Ke,Ce=Xe,ye=ze,we=Ze,le=X,ne=et,xe=tt,Ie=ot,j=Ee,ke=Me("loading");return c(),y(U,null,[Ue((c(),y("div",ht,[t(ye,{onBack:i,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[t(k,{value:e(n).name,"onUpdate:value":o[0]||(o[0]=l=>e(n).name=l),bordered:!1,class:"table-name"},null,8,["value"])]),extra:a(()=>[t(Ce,{class:"extra"},{default:a(()=>[t(f,{label:"选择数据源"},{default:a(()=>[t(N,{value:e(n).datasource.sourceId,"onUpdate:value":o[1]||(o[1]=l=>e(n).datasource.sourceId=l),options:u.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:o[2]||(o[2]=l=>me())},null,8,["value","options"])]),_:1}),t(f,{label:"选择表名"},{default:a(()=>[t(N,{value:e(n).datasource.tableName,"onUpdate:value":o[3]||(o[3]=l=>e(n).datasource.tableName=l),options:ee.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:o[4]||(o[4]=l=>pe())},null,8,["value","options"])]),_:1}),t(P,{onClick:o[5]||(o[5]=l=>e(d)()),type:"primary",class:"save-btn"},{default:a(()=>[B(" 保存 ")]),_:1})]),_:1})]),_:1}),C("div",Ct,[C("div",yt,[C("div",wt,[C("div",xt,[t(e(se),{list:e(n).filter.widgetList,"onUpdate:list":o[7]||(o[7]=l=>e(n).filter.widgetList=l),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(c(!0),y(U,null,J(e(n).filter.widgetList,l=>(c(),y("div",{class:"widget-item",key:l.id,onClick:q=>he(l)},[t(e(ie),{class:"move-handle",style:{cursor:"pointer"}}),t(f,{label:l.label,name:l.field},{default:a(()=>[l.type=="input"?(c(),T(k,{key:0})):l.type=="select"?(c(),T(N,{key:1})):(c(),T(we,{key:2}))]),_:2},1032,["label","name"]),t(le,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:q=>e(R)(l.id)},{default:a(()=>[t(e(Q),{class:"remove-btn",onClick:je(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,It))),128)),C("div",kt,[t(P,{type:"primary",onClick:o[6]||(o[6]=l=>_())},{default:a(()=>[B(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),C("div",St,[C("div",Dt,[t(e(se),{list:e(n).action,"onUpdate:list":o[9]||(o[9]=l=>e(n).action=l),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(c(!0),y(U,null,J(e(n).action.filter(l=>l.position=="header"),l=>(c(),y("div",{class:"button-item",key:l.id},[t(e(ie),{class:"move-handle",style:{cursor:"pointer"}}),t(P,{onClick:q=>te(l)},{default:a(()=>[B(O(l.name),1)]),_:2},1032,["onClick"]),t(le,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:q=>e(S)(l.id)},{default:a(()=>[t(e(Q),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),C("div",$t,[t(P,{type:"primary",onClick:o[8]||(o[8]=l=>ve())},{default:a(()=>[B(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),C("div",Rt,[t(ft,{columns:e(n).columns,"onUpdate:columns":o[10]||(o[10]=l=>e(n).columns=l),tableData:F.value,height:600,onOnRemove:D,onOnClick:r},null,8,["columns","tableData"])])]),C("div",Nt,[Bt,t(e(Y),{schema:ge.value,formData:e(n).global},null,8,["schema","formData"])])])])),[[ke,e(v),void 0,{fullscreen:!0}]]),t(j,{title:"按钮配置",placement:"right",closable:!1,open:M.value,onClose:o[16]||(o[16]=l=>M.value=!1)},{default:a(()=>[t(Ie,{model:$.value},{default:a(()=>[t(f,{prop:"id",label:"按钮标识"},{default:a(()=>[t(k,{value:$.value.id,"onUpdate:value":o[11]||(o[11]=l=>$.value.id=l)},null,8,["value"])]),_:1}),t(f,{prop:"name",label:"按钮名称"},{default:a(()=>[t(k,{value:$.value.name,"onUpdate:value":o[12]||(o[12]=l=>$.value.name=l)},null,8,["value"])]),_:1}),t(f,{prop:"name",label:"按钮位置"},{default:a(()=>[t(xe,{value:$.value.position,"onUpdate:value":o[13]||(o[13]=l=>$.value.position=l),"button-style":"solid"},{default:a(()=>[t(ne,{value:"header"},{default:a(()=>[B("表头")]),_:1}),t(ne,{value:"row"},{default:a(()=>[B("行内")]),_:1})]),_:1},8,["value"])]),_:1}),t(f,{prop:"event",label:"事件流"},{default:a(()=>[t(N,{value:$.value.eventFlowId,"onUpdate:value":o[15]||(o[15]=l=>$.value.eventFlowId=l),options:_e.value},{suffixIcon:a(()=>[t(e(qe),{style:{color:"#000"},title:"刷新"}),$.value.eventFlowId?(c(),T(e(Ge),{key:0,onClick:o[14]||(o[14]=l=>fe()),style:{color:"#000"},title:"编辑事件流"})):(c(),T(e(Z),{key:1,style:{color:"#000"},title:"新增事件流"}))]),_:1},8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),t(j,{title:"筛选控件配置",placement:"right",closable:!1,open:W.value,onClose:o[17]||(o[17]=l=>W.value=!1)},{default:a(()=>[t(e(Y),{formData:oe.value,schema:be.value},null,8,["formData","schema"])]),_:1},8,["open"]),t(j,{title:"列配置",placement:"right",closable:!1,open:H.value,onClose:o[18]||(o[18]=l=>H.value=!1)},{default:a(()=>[t(bt)]),_:1},8,["open"])],64)}}}),Pt=ce(Tt,[["__scopeId","data-v-39979008"]]);export{Pt as default};
