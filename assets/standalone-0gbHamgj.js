import"./iconfont-RswF9Ywb.js";import{f as z,r as l,v as E,x as D,g as C,s as V,y as $,h as R,z as x,o as h,j,w as N,A as M,B as T,i as k,D as P,E as A,F as G,k as m,G as Q,H,I as q,J as O,K as W,L as J,n as F,q as K,$ as U}from"./.pnpm-CkPzpllQ.js";import{c as L}from"./componentsSchema-BilSLpq2.js";import{D as X,a as Y}from"./DynamicLoader-B79htLYw.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z=z("dgDesign",()=>{const n=l({}),o=l([]),i=l({}),d=t=>{o.value.push(t)},g=t=>{const{id:a}=t,e=o.value.findIndex(c=>c.id===a);e!==-1&&o.value.splice(e,1)},p=t=>{const a=L.findIndex(c=>c.name===t);if(a===-1)throw new Error("组件不存在");const e=E(L[a]);return e.id=new Date().getTime().toString(),e},r=t=>{i.value=t,window.parent.postMessage({type:"select",data:D(t)},window.location.origin)},_=t=>{const{id:a}=t,e=o.value.findIndex(c=>c.id===a);e!==-1&&o.value.splice(e,1,t)},w=t=>{window.parent.postMessage({type:"update-item",data:D(t)},window.location.origin)},I=t=>new X(y.value).processObject(t),v=l({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),f=t=>{v.value=t,s()},y=l({}),b=t=>{const a={},e=(c,u)=>{switch(c){case"string":return u;case"number":return Number(u);case"boolean":return!!u;case"array":case"object":return JSON.parse(u);default:return u}};return t.reduce((c,u)=>(c[u.name]=e(u.type,u.defaultValue),c),a),a},s=()=>{y.value=b(v.value.vars)};return{dashboardData:n,add:d,remove:g,dgList:o,initDgItem:p,selectItem:r,curComp:i,updateItem:_,transformProps:I,updateVariables:s,setVarPools:f,updateDgItem:w}}),tt=12,et=8,at=C({__name:"StandalonePage",setup(n){const o=Z(),{dgList:i}=V(o),{initDgItem:d,add:g,selectItem:p,updateItem:r,transformProps:_,setVarPools:w,updateDgItem:I}=o,v=l(),f=l(0),y=s=>{const t=s.dataTransfer.getData("material-type");let a;t=="custom"?a={name:s.dataTransfer.getData("material"),id:new Date().getTime().toString(),label:"自定义组件",icon:"",type:"custom",component:s.dataTransfer.getData("material"),props:{},style:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2}:a=d(s.dataTransfer.getData("material"));const e=s.x/(f.value/tt),c=s.y/et;a.colStart=Math.floor(e),a.rowStart=Math.floor(c),g(a)},b=l({});return window.addEventListener("message",s=>{s.data.type==="refresh"?r(s.data.data):s.data.type==="add-custom-comp"?new Y([s.data.data]).load().then(a=>{Object.keys(a).forEach(e=>{b.value[e]=a[e]})}):s.data.type==="refresh-var"&&w(s.data.data)}),$(()=>{f.value=v.value.clientWidth}),(s,t)=>{const a=R("grid-layout");return h(),x("div",{class:"container",ref_key:"container",ref:v,onDragover:t[0]||(t[0]=Q(()=>{},["prevent","stop"])),onDrop:Q(y,["stop"])},[j(a,{list:m(i),class:"layout","onItem:click":m(p),"onItem:change":m(I)},{"layout-item":N(({item:e})=>[M("div",{class:"comp-container",style:T(e.style)},[e.type&&e.type==="custom"?(h(),k(P(b.value[e.component]),A(G({key:0},m(_)(e.props))),null,16)):(h(),k(P(e.component),{key:1,attrs:m(_)(e.props)},null,8,["attrs"]))],4)]),_:1},8,["list","onItem:click","onItem:change"])],544)}}}),st=S(at,[["__scopeId","data-v-23a153bb"]]),ot=C({__name:"QBChart",props:{attrs:{default:()=>({dataset:"",dimension:[],target:[]})},styleConfig:{default:()=>({})}},setup(n){const o=n,{attrs:i,styleConfig:d}=o,g=l(!0),p=l();let r;const _=l(0),w=l(""),I=l(),v=async()=>{w.value=i.dataset,I.value=[{title:"title1",value:100},{title:"title2",value:200},{title:"title3",value:300}]},f=()=>{const{dimension:s,target:t}=i,a=D(d.option),e=D(d.series),c=[];return t.forEach(u=>{c.push(E(e))}),a.series=c,{...a,dataset:{source:D(I.value),dimensions:[...s,...t]}}},y=()=>{w.value!=i.dataset?v().then(()=>{r?(r.clear(),r.setOption(f())):p.value&&(r=q(p.value),r.setOption(f()))}):r?(r.clear(),r.setOption(f())):p.value&&(r=q(p.value),r.setOption(f())),g.value=!1},b=new ResizeObserver(s=>{_.value&&clearTimeout(_.value),_.value=window.setTimeout(()=>{try{r.resize()}catch(t){console.warn(`chart重新设置大小失败,失败原因：${t}`)}},50)});return $(()=>{y(),b.observe(p.value)}),H(()=>[o.attrs,o.styleConfig],()=>{y()},{deep:!0}),(s,t)=>(h(),x("div",{ref_key:"QBChart",ref:p,class:"qb-chart"},null,512))}}),nt=S(ot,[["__scopeId","data-v-996b3f25"]]),rt={class:"qb-iframe"},ct=["src"],it=C({__name:"QBIframe",props:{attrs:{default:()=>({src:""})},preview:{type:Boolean,default:!1}},setup(n){const o=n,{attrs:i,preview:d}=O(o);return(g,p)=>(h(),x("div",rt,[M("iframe",{class:W(m(d)?"":"no-effect"),src:m(i).src,style:{width:"100%",height:"100%",border:"none"}},null,10,ct)]))}}),lt=S(it,[["__scopeId","data-v-67323949"]]),dt=["src"],pt=C({__name:"QBImage",props:{attrs:{default:()=>({src:""})},styleConfig:{default:()=>({})}},setup(n){const o=n,{attrs:i,styleConfig:d}=O(o);return(g,p)=>(h(),x("img",{class:"qb-image",style:T([{width:"100%",height:"100%"},m(d)]),src:m(i).src},null,12,dt))}}),ut=S(pt,[["__scopeId","data-v-3b56b274"]]),mt=C({__name:"QBText",props:{attrs:{default:()=>({text:""})},styleConfig:{default:()=>({})}},setup(n){const o=n,{attrs:i}=O(o);return(d,g)=>(h(),x("div",{class:"qb-text",style:T(d.styleConfig)},J(m(i).text),5))}}),ft=S(mt,[["__scopeId","data-v-ad3a33fa"]]),gt=n=>{n.component("qb-chart",nt),n.component("qb-iframe",lt),n.component("qb-image",ut),n.component("qb-text",ft)},B=F(st);B.use(K());B.use(gt);B.component("GridLayout",U);B.mount("#standalone-app");
