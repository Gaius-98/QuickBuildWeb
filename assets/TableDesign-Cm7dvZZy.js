import{b7 as te,f as ne,r as I,aS as oe,g as B,s as F,v as W,o as v,y as w,l as n,i as o,aD as se,J as _,O as M,w as r,aG as ae,A as le,aL as j,a6 as G,D as Q,F as N,Q as V,b8 as ie,ag as J,B as $,b9 as de,ba as ce,t as q,x as ue,h as L,bb as re,W as me,b1 as E,b4 as pe,al as _e,am as ve,bc as H,a1 as fe,U as ge,a2 as be,a3 as he,b6 as Ce}from"./.pnpm-ChulSkD7.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as P}from"./index-DQD6bgnR.js";const xe=new te,T=xe,O=ne("tableDesign",()=>{const p=I([]),f=I({name:"",description:"",status:1,columns:[],global:{bordered:!1},datasetId:"",filter:{show:!0},action:[]}),i=I([]),s=I({}),b=()=>{const c=new Date().getTime().toString().slice(-4);f.value.columns.push({id:oe(),dataIndex:"field"+c,title:"列"+c,width:200})},m=(c,x)=>{const e=x.findIndex(l=>l.id===c);e!=-1&&(s.value=x[e])},d=(c,x)=>{const e=x.findIndex(l=>l.id===c);e!=-1&&x.splice(e,1)},g=async c=>{},h=I(!1);return{tableCfg:f,currentColumn:s,onSelectColumn:m,onRemoveColumn:d,onAddColumn:b,tableData:p,onRefreshData:g,saveLoading:h,onSave:async()=>{h.value=!0,h.value=!1},columnFields:i}}),ye={class:"custom-header-label",style:{flex:"1"}},Ie=B({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(p,{emit:f}){const i=O(),{currentColumn:s}=F(i),b=p,{params:m}=W(b),d=()=>{T.onPublish("removeEvent",m.value)};return(g,h)=>{const u=G;return v(),w("div",{class:le(["custom-header-item",o(s).dataIndex==o(m).column.getColId()?"active":""]),style:j([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:o(s).dataIndex==o(m).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[n(o(se),{class:"move",style:{width:"20px",cursor:"move"}}),_("div",ye,M(o(m).displayName),1),n(u,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:h[0]||(h[0]=c=>d())},{default:r(()=>[n(o(ae),{class:"remove",style:{width:"20px"}})]),_:1})],6)}}}),we={class:"custom-opt-cell"},ke=["onClick"],De=B({__name:"CustomOptCell",setup(p){const f=O(),{tableCfg:i}=F(f),s=Q(()=>{var d;return(d=i.value.action)==null?void 0:d.filter(g=>g.position=="row")}),b=(d,g)=>{T.onPublish("action",{position:d,data:g})},m=d=>{T.onPublish("remove-btn",d)};return(d,g)=>{const h=G;return v(),w("div",we,[(v(!0),w(N,null,V(s.value,u=>(v(),w("div",{class:"btn",key:u.id},[_("a",{onClick:c=>b("row",u)},M(u.name),9,ke),n(h,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:c=>m(u)},{default:r(()=>[n(o(ie),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),n(o(J),{style:{cursor:"pointer"},onClick:g[0]||(g[0]=u=>b("row"))})])}}}),Se={class:"custom-header-label",style:{flex:"1"}},$e=B({__name:"CustomAddColumn",setup(p){const f=O(),{onAddColumn:i}=f;return(s,b)=>{const m=ce;return v(),w("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:b[0]||(b[0]=d=>o(i)())},[_("div",Se,[n(o(J)),$(" 新增列 "),n(m,null,{title:r(()=>[$("用于新增列配置")]),default:r(()=>[n(o(de))]),_:1})])])}}}),Re=B({__name:"AgTable",props:q({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:q(["onRemove","onClick"],["update:columns"]),setup(p,{emit:f}){T.onSubscribe("removeEvent",e=>{let l=e.column.getColId(),C=i.value.find(k=>k.dataIndex==l);C&&c(C)});const i=ue(p,"columns"),s=p,{columnId:b,tableData:m}=W(s),d=Q(()=>{let e=i.value.map(l=>({field:l.dataIndex,colId:l.dataIndex,headerName:l.title,pinned:l.fixed,lockVisible:!0,headerComponent:Ie}));return e.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:$e}),e.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:De}),e}),g=e=>{if(!e.finished)return;let l=e.api.getColumnState().map(C=>i.value.find(k=>k.dataIndex==C.colId));i.value=l},h=e=>{if(!e.finished)return;let l=e.column.getColId(),C=i.value.findIndex(k=>k.dataIndex==l);C!=-1&&(i.value[C].width=e.column.getActualWidth())},u=f,c=e=>{u("onRemove",e)},x=e=>{let l=e.column.getId(),C=i.value.find(k=>k.dataIndex==l);u("onClick",C)};return(e,l)=>(v(),L(o(re),{rowData:o(m),columnDefs:d.value,style:j({height:e.height+"px"}),class:"ag-theme-quartz",onColumnMoved:g,onColumnResized:h,onColumnHeaderClicked:x},null,8,["rowData","columnDefs","style"]))}}),Be=K(Re,[["__scopeId","data-v-4a0d7147"]]),Ae=p=>(_e("data-v-3ec7e7b3"),p=p(),ve(),p),Te={class:"table-design"},Oe={class:"table-design-container"},Pe={class:"main-part"},Ne={class:"filter-part"},Ve={class:"filter-container"},Le={class:"add widget-item"},Fe={class:"tools-part"},Me={class:"tools-container"},Ue={class:"add button-item"},ze={class:"table-part"},qe=Ae(()=>_("div",{class:"right-part"},null,-1)),Ee=B({__name:"TableDesign",setup(p){const f=I([]);me(()=>{P.getDatasetDict().then(y=>{const{code:t,data:D,msg:R}=y;t==200&&(f.value=D)})});const i=O(),{tableCfg:s,columnFields:b}=F(i),{onSelectColumn:m,onRemoveColumn:d,onAddColumn:g,onRefreshData:h}=i;window.name="table-design";const u=I([{label:"测试1",prop:"test1",type:"input"},{label:"测试2",prop:"test2",type:"select"},{label:"测试3",prop:"test3",type:"input"},{label:"测试4",prop:"test4",type:"select"},{label:"测试5",prop:"tes5",type:"input"},{label:"测试6",prop:"test6",type:"select"}]),c=I([{name:"新增",type:"add"},{name:"批量编辑",type:"edit"}]),x=()=>{},e=()=>{},l=()=>{window.open("/lowcode/table","quick-build")},C=y=>{m(y.id,s.value.columns)},k=y=>{d(y.id,s.value.columns)},U=I([]),z=I([]),X=()=>{P.getPreviewByDatasetId(s.value.datasetId).then(y=>{const{code:t,data:D,msg:R}=y;t==200&&(z.value=D)})},Y=()=>{P.getFieldByDatasetId(s.value.datasetId).then(y=>{const{code:t,data:D,msg:R}=y;t==200&&(U.value=D,s.value.columns=U.value.map(S=>({dataIndex:S,id:S,title:S})))}),X()};return(y,t)=>{const D=fe,R=ge,S=be,A=he,Z=Ce,ee=pe;return v(),w("div",Te,[n(ee,{onBack:l,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:r(()=>[n(D,{value:o(s).name,"onUpdate:value":t[0]||(t[0]=a=>o(s).name=a),bordered:!1,class:"table-name"},null,8,["value"])]),extra:r(()=>[n(Z,{class:"extra"},{default:r(()=>[n(S,{label:"选择数据集"},{default:r(()=>[n(R,{value:o(s).datasetId,"onUpdate:value":t[1]||(t[1]=a=>o(s).datasetId=a),options:f.value,style:{width:"180px"},onChange:t[2]||(t[2]=a=>Y())},null,8,["value","options"])]),_:1}),n(A,{onClick:t[3]||(t[3]=a=>e()),type:"primary",class:"save-btn"},{default:r(()=>[$(" 保存 ")]),_:1})]),_:1})]),_:1}),_("div",Oe,[_("div",Pe,[_("div",Ne,[_("div",Ve,[n(o(E),{list:u.value,"onUpdate:list":t[5]||(t[5]=a=>u.value=a),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:r(()=>[(v(!0),w(N,null,V(u.value,a=>(v(),w("div",{class:"widget-item",key:a.prop},[n(o(H),{class:"move-handle",style:{cursor:"pointer"}}),n(S,{label:a.label,name:a.prop},{default:r(()=>[a.type=="text"?(v(),L(D,{key:0})):(v(),L(R,{key:1}))]),_:2},1032,["label","name"])]))),128)),_("div",Le,[n(A,{type:"primary",onClick:t[4]||(t[4]=a=>x())},{default:r(()=>[$(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),_("div",Fe,[_("div",Me,[n(o(E),{list:c.value,"onUpdate:list":t[7]||(t[7]=a=>c.value=a),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:r(()=>[(v(!0),w(N,null,V(c.value,a=>(v(),w("div",{class:"button-item",key:a.name},[n(A,null,{default:r(()=>[n(o(H),{class:"move-handle",style:{cursor:"pointer"}}),$(" "+M(a.name),1)]),_:2},1024)]))),128)),_("div",Ue,[n(A,{type:"primary",onClick:t[6]||(t[6]=a=>x())},{default:r(()=>[$(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),_("div",ze,[n(Be,{columns:o(s).columns,"onUpdate:columns":t[8]||(t[8]=a=>o(s).columns=a),tableData:z.value,height:300,onOnRemove:k,onOnClick:C},null,8,["columns","tableData"])])]),qe])])}}}),Ge=K(Ee,[["__scopeId","data-v-3ec7e7b3"]]);export{Ge as default};
