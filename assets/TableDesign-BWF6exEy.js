import{b3 as Fe,f as Ae,r as p,aO as Ee,g as F,s as L,v as Y,o as d,y as C,l,i as t,aw as Oe,J as $,L as U,w as a,az as Pe,aW as ce,A as Ue,aF as re,a1 as Z,D as me,F as M,K,b4 as Q,ab as ee,B,b5 as ze,b6 as Ve,V as P,h as N,a9 as Me,t as ue,x as Le,b7 as We,aM as qe,ar as He,P as je,U as Ge,aZ as ie,b0 as Je,H as Ke,T as Qe,b8 as de,b9 as Xe,ba as Ye,W as Ze,N as et,X as tt,Y as lt,b2 as ot,aU as nt,a3 as at,a4 as st,aS as ut,$ as it}from"./.pnpm-Cl1qeBT1.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as O}from"./index-D1mYOa1m.js";import{S as X}from"./SchemaForm-CPx4ku2v.js";/* empty css                   */const dt=new Fe,W=dt,z=Ae("tableDesign",()=>{const D=p([]),c=p({name:"",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},datasource:{tableName:"",sourceId:""},filter:[],action:[]}),s=p([]),g=p({}),n=()=>{const u=new Date().getTime().toString().slice(-4);c.value.columns.push({id:Ee(),dataIndex:"field"+u,title:"列"+u,width:200})},b=(u,m)=>{const I=m.findIndex(A=>A.id===u);I!=-1&&(g.value=m[I])},w=(u,m)=>{const I=m.findIndex(A=>A.id===u);I!=-1&&m.splice(I,1)},R=u=>{c.value.action.push({id:new Date().getTime().toString(),name:"测试",position:u,eventFlowId:"",customEvent:!1,builtInEvents:"add"})},h=u=>{const m=c.value.action.findIndex(I=>I.id==u);m!=-1&&c.value.action.splice(m,1)},x=u=>{const m=c.value.filter.findIndex(I=>I.id==u);m!=-1&&c.value.filter.splice(m,1)},T=async u=>{},k=p(!1);return{tableCfg:c,currentColumn:g,onSelectColumn:b,onRemoveColumn:w,onAddColumn:n,tableData:D,onRefreshData:T,saveLoading:k,onSave:async()=>{k.value=!0,setTimeout(()=>{c.value,k.value=!1},2e3)},columnFields:s,onSetColumns:u=>{s.value=u},onAddBtn:R,onRemoveBtn:h,onRemoveWidget:x}}),ct={class:"custom-header-label",style:{flex:"1"}},rt=F({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(D,{emit:c}){const s=z(),{currentColumn:g}=L(s),n=D,{params:b}=Y(n),w=()=>{W.onPublish("removeEvent",b.value)};return(R,h)=>{const x=Z;return d(),C("div",{class:Ue(["custom-header-item",t(g).dataIndex==t(b).column.getColId()?"active":""]),style:re([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:t(g).dataIndex==t(b).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[l(t(Oe),{class:"move",style:{width:"20px",cursor:"move"}}),$("div",ct,U(t(b).displayName),1),l(x,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:h[0]||(h[0]=T=>w())},{default:a(()=>[l(t(Pe),{class:"remove",style:{width:"20px"},onClick:ce(()=>{},["stop"])})]),_:1})],6)}}}),mt={class:"custom-opt-cell"},pt=["onClick"],vt=F({__name:"CustomOptCell",setup(D){const c=z(),{tableCfg:s}=L(c),g=me(()=>{var h;return(h=s.value.action)==null?void 0:h.filter(x=>x.position=="row")}),{onAddBtn:n,onRemoveBtn:b}=c,w=h=>{W.onPublish("open-btn-modal",h)},R=()=>{n("row")};return(h,x)=>{const T=Z;return d(),C("div",mt,[(d(!0),C(M,null,K(g.value,k=>(d(),C("div",{class:"btn",key:k.id},[$("a",{onClick:r=>w(k)},U(k.name),9,pt),l(T,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:r=>t(b)(k.id)},{default:a(()=>[l(t(Q),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),l(t(ee),{style:{cursor:"pointer"},onClick:x[0]||(x[0]=k=>R())})])}}}),ft={class:"custom-header-label",style:{flex:"1"}},_t=F({__name:"CustomAddColumn",setup(D){const c=z(),{onAddColumn:s}=c;return(g,n)=>{const b=Ve;return d(),C("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:n[0]||(n[0]=w=>t(s)())},[$("div",ft,[l(t(ee)),B(" 新增列 "),l(b,null,{title:a(()=>[B("用于新增列配置")]),default:a(()=>[l(t(ze))]),_:1})])])}}}),bt={class:"cell"},gt={key:0},ht=["href"],yt=F({__name:"CustomCellRender",props:{params:{}},setup(D){const c=D,{params:s}=Y(c);return(g,n)=>{const b=Me;return d(),C("div",bt,[t(s).colDef.cellRendererParams.type=="text"?(d(),C("span",gt,U(t(s).value),1)):P("",!0),t(s).colDef.cellRendererParams.type=="image"?(d(),N(b,{key:1,src:t(s).value},null,8,["src"])):P("",!0),t(s).colDef.cellRendererParams.type=="link"?(d(),C("a",{key:2,href:t(s).value},U(t(s).value),9,ht)):P("",!0)])}}}),Ct=F({__name:"AgTable",props:ue({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ue(["onRemove","onClick"],["update:columns"]),setup(D,{emit:c}){W.onSubscribe("removeEvent",r=>{let f=r.column.getColId(),u=s.value.find(m=>m.dataIndex==f);u&&T(u)});const s=Le(D,"columns"),g=D,{columnId:n,tableData:b}=Y(g),w=me(()=>{let r=s.value.map(f=>({field:f.dataIndex,colId:f.dataIndex,headerName:f.title,pinned:f.fixed=="none"?void 0:f.fixed,lockVisible:!0,headerComponent:rt,cellRenderer:yt,cellRendererParams:{type:f.type}}));return r.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:_t}),r.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:vt}),r}),R=r=>{if(!r.finished)return;let f=[];r.api.getColumnState().forEach(u=>{let m=s.value.find(I=>I.dataIndex==u.colId);m&&f.push(m)}),s.value=f},h=r=>{if(!r.finished)return;let f=r.column.getColId(),u=s.value.findIndex(m=>m.dataIndex==f);u!=-1&&(s.value[u].width=r.column.getActualWidth())},x=c,T=r=>{x("onRemove",r)},k=r=>{let f=r.column.getId(),u=s.value.find(m=>m.dataIndex==f);x("onClick",u)};return(r,f)=>(d(),N(t(We),{rowData:t(b),columnDefs:w.value,style:re({height:r.height+"px"}),class:"ag-theme-quartz",onColumnMoved:R,onColumnResized:h,onColumnHeaderClicked:k},null,8,["rowData","columnDefs","style"]))}}),wt=pe(Ct,[["__scopeId","data-v-5dd2184c"]]),xt=F({__name:"TableCfg",setup(D){const c=z(),{tableCfg:s,columnFields:g,currentColumn:n}=L(c),b=p({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(R=>{setTimeout(()=>{R(g.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),w=p();return qe(()=>n.value,()=>{w.value.refreshOption("dataIndex")}),(R,h)=>(d(),N(t(X),{formData:t(n),schema:b.value,ref_key:"schemaRef",ref:w,size:"small"},null,8,["formData","schema"]))}}),kt={class:"table-design"},It={class:"table-design-container"},Dt={class:"main-part"},St={class:"filter-part"},$t={class:"filter-container"},Rt=["onClick"],Nt={class:"add widget-item"},Bt={class:"tools-part"},Tt={class:"tools-container"},Ft={class:"add button-item"},At={class:"table-part"},Et=F({__name:"TableDesign",setup(D){const c=He();W.onSubscribe("open-btn-modal",i=>{oe(i)});const s=p([]);je(()=>{O.getDataSourceDict().then(i=>{const{code:e,data:y,msg:S}=i;e==200&&(s.value=y)})});const g=z(),{tableCfg:n,columnFields:b,saveLoading:w}=L(g),{onSelectColumn:R,onRemoveBtn:h,onRemoveColumn:x,onSetColumns:T,onRemoveWidget:k,onAddBtn:r,onSave:f}=g;window.name="table-design";const u=p([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),m=()=>{var i;(i=n.value.filter)==null||i.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},I=()=>{window.open("/lowcode/table","quick-build")},A=i=>{R(i.id,n.value.columns),j.value=!0},ve=i=>{x(i.id,n.value.columns)};p([]);const te=p([]),fe=()=>{O.getSourceData(n.value.datasource.sourceId,n.value.datasource.tableName).then(i=>{const{code:e,data:y,msg:S}=i;e==200&&(te.value=y)})},le=p([]),_e=()=>{O.getTableInfo(n.value.datasource.sourceId).then(i=>{const{code:e,data:y,msg:S}=i;e==200&&(le.value=y)})},be=()=>{O.getColumnInfo(n.value.datasource.sourceId,n.value.datasource.tableName).then(i=>{const{code:e,data:y,msg:S}=i;e==200&&(n.value.columns=y.map(v=>({dataIndex:v.columnName,title:v.columnComment||v.columnName,id:v.columnName,width:200,type:"text",align:"left",fixed:"none"})),T(y.map(v=>({label:v.columnComment?`${v.columnComment}(${v.columnName})`:v.columnName,value:v.columnName}))))}),fe()},ge=()=>{r("header")},_=p({id:"",name:"",eventFlowId:"",position:"header",customEvent:!1,builtInEvents:"add"}),q=p(!1),he=p([{label:"默认新增事件流",value:"add"},{label:"默认编辑事件流",value:"edit"},{label:"默认批量编辑事件流",value:"batchEdit"}]),oe=i=>{_.value=i,q.value=!0},ye=i=>{c.push({path:"/design/flow",query:{id:i}})},Ce=()=>{c.push({path:"/design/flow"})},ne=p({}),H=p(!1),we=p({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"string",label:"字段名称"},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",show:'"${formData.type}" == "select"',component:{asyncData:async()=>{const{code:i,data:e,msg:y}=await O.getDictTypeList();return i==200?e.map(S=>({label:S.dictTypeDesc,value:S.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),xe=i=>{ne.value=i,H.value=!0},j=p(!1),G=p(!1),ke=p({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"120px"}}},properties:{showFilter:{type:"switch",label:"显示筛选面板"},showPagination:{type:"switch",label:"显示分页器"},showBordered:{type:"switch",label:"显示边框"},size:{type:"radio",label:"表格尺寸",component:{dataSource:[{label:"紧凑",value:"small"},{label:"默认",value:"middle"},{label:"宽松",value:"large"}],buttonStyle:"solid"}}}}),Ie=()=>{G.value=!0};return(i,e)=>{const y=Ze,S=et,v=tt,E=lt,De=ot,Se=Je,$e=nt,ae=Z,se=at,Re=st,Ne=ut,Be=it,V=Ke,Te=Qe("loading");return d(),C(M,null,[Ge((d(),C("div",kt,[l(Se,{onBack:I,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[l(y,{value:t(n).name,"onUpdate:value":e[0]||(e[0]=o=>t(n).name=o),bordered:!1,class:"table-name"},null,8,["value"])]),extra:a(()=>[l(De,{class:"extra"},{default:a(()=>[l(v,{label:"选择数据源"},{default:a(()=>[l(S,{value:t(n).datasource.sourceId,"onUpdate:value":e[1]||(e[1]=o=>t(n).datasource.sourceId=o),options:s.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:e[2]||(e[2]=o=>_e())},null,8,["value","options"])]),_:1}),l(v,{label:"选择表名"},{default:a(()=>[l(S,{value:t(n).datasource.tableName,"onUpdate:value":e[3]||(e[3]=o=>t(n).datasource.tableName=o),options:le.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:e[4]||(e[4]=o=>be())},null,8,["value","options"])]),_:1}),l(E,{type:"primary",onClick:Ie},{default:a(()=>[B("全局配置")]),_:1}),l(E,{onClick:e[5]||(e[5]=o=>t(f)()),type:"primary",class:"save-btn"},{default:a(()=>[B(" 保存 ")]),_:1})]),_:1})]),_:1}),$("div",It,[$("div",Dt,[$("div",St,[$("div",$t,[l(t(ie),{list:t(n).filter,"onUpdate:list":e[7]||(e[7]=o=>t(n).filter=o),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(d(!0),C(M,null,K(t(n).filter,o=>(d(),C("div",{class:"widget-item",key:o.id,onClick:J=>xe(o)},[l(t(de),{class:"move-handle",style:{cursor:"pointer"}}),l(v,{label:o.label,name:o.field},{default:a(()=>[o.type=="input"?(d(),N(y,{key:0})):o.type=="select"?(d(),N(S,{key:1})):(d(),N($e,{key:2}))]),_:2},1032,["label","name"]),l(ae,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:J=>t(k)(o.id)},{default:a(()=>[l(t(Q),{class:"remove-btn",onClick:ce(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,Rt))),128)),$("div",Nt,[l(E,{type:"primary",onClick:e[6]||(e[6]=o=>m())},{default:a(()=>[B(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),$("div",Bt,[$("div",Tt,[l(t(ie),{list:t(n).action,"onUpdate:list":e[9]||(e[9]=o=>t(n).action=o),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(d(!0),C(M,null,K(t(n).action.filter(o=>o.position=="header"),o=>(d(),C("div",{class:"button-item",key:o.id},[l(t(de),{class:"move-handle",style:{cursor:"pointer"}}),l(E,{onClick:J=>oe(o)},{default:a(()=>[B(U(o.name),1)]),_:2},1032,["onClick"]),l(ae,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:J=>t(h)(o.id)},{default:a(()=>[l(t(Q),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),$("div",Ft,[l(E,{type:"primary",onClick:e[8]||(e[8]=o=>ge())},{default:a(()=>[B(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),$("div",At,[l(wt,{columns:t(n).columns,"onUpdate:columns":e[10]||(e[10]=o=>t(n).columns=o),tableData:te.value,height:550,onOnRemove:ve,onOnClick:A},null,8,["columns","tableData"])])])])])),[[Te,t(w),void 0,{fullscreen:!0}]]),l(V,{title:"按钮配置",placement:"right",closable:!1,open:q.value,onClose:e[19]||(e[19]=o=>q.value=!1)},{default:a(()=>[l(Be,{model:_.value},{default:a(()=>[l(v,{prop:"id",label:"按钮标识"},{default:a(()=>[l(y,{value:_.value.id,"onUpdate:value":e[11]||(e[11]=o=>_.value.id=o)},null,8,["value"])]),_:1}),l(v,{prop:"name",label:"按钮名称"},{default:a(()=>[l(y,{value:_.value.name,"onUpdate:value":e[12]||(e[12]=o=>_.value.name=o)},null,8,["value"])]),_:1}),l(v,{prop:"name",label:"按钮位置"},{default:a(()=>[l(Re,{value:_.value.position,"onUpdate:value":e[13]||(e[13]=o=>_.value.position=o),"button-style":"solid"},{default:a(()=>[l(se,{value:"header"},{default:a(()=>[B("表头")]),_:1}),l(se,{value:"row"},{default:a(()=>[B("行内")]),_:1})]),_:1},8,["value"])]),_:1}),l(v,{prop:"customEvent",label:"是否启用自定义"},{default:a(()=>[l(Ne,{checked:_.value.customEvent,"onUpdate:checked":e[14]||(e[14]=o=>_.value.customEvent=o)},null,8,["checked"])]),_:1}),_.value.customEvent?P("",!0):(d(),N(v,{key:0,prop:"builtInEvents",label:"内置事件"},{default:a(()=>[l(S,{value:_.value.builtInEvents,"onUpdate:value":e[15]||(e[15]=o=>_.value.builtInEvents=o),options:u.value,allowClear:""},null,8,["value","options"])]),_:1})),_.value.customEvent?(d(),N(v,{key:1,prop:"event",label:"自定义事件流"},{default:a(()=>[l(S,{value:_.value.eventFlowId,"onUpdate:value":e[18]||(e[18]=o=>_.value.eventFlowId=o),options:he.value,allowClear:""},{suffixIcon:a(()=>[l(t(Xe),{style:{color:"#000"},title:"刷新"}),_.value.eventFlowId?(d(),N(t(Ye),{key:0,onClick:e[16]||(e[16]=o=>ye(_.value.eventFlowId)),style:{color:"#000"},title:"编辑事件流"})):(d(),N(t(ee),{key:1,style:{color:"#000"},title:"新增事件流",onClick:e[17]||(e[17]=o=>Ce())}))]),_:1},8,["value","options"])]),_:1})):P("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),l(V,{title:"筛选控件配置",placement:"right",closable:!1,open:H.value,onClose:e[20]||(e[20]=o=>H.value=!1)},{default:a(()=>[l(t(X),{formData:ne.value,schema:we.value},null,8,["formData","schema"])]),_:1},8,["open"]),l(V,{title:"列配置",placement:"right",closable:!1,open:j.value,onClose:e[21]||(e[21]=o=>j.value=!1)},{default:a(()=>[l(xt)]),_:1},8,["open"]),l(V,{title:"全局配置",placement:"right",closable:!1,open:G.value,onClose:e[22]||(e[22]=o=>G.value=!1)},{default:a(()=>[l(t(X),{formData:t(n).global,schema:ke.value},null,8,["formData","schema"])]),_:1},8,["open"])],64)}}}),Mt=pe(Et,[["__scopeId","data-v-af7e64b9"]]);export{Mt as default};
