import{k as M,r as u,R as v,a as p,t as S}from"./.pnpm-DVFE1QU-.js";import{d as r}from"./dashboard-BefUS5vO.js";const W=M("dashboardDesign",()=>{const n=u([]),f=e=>{n.value.push(e)},h=v(()=>{const e={};return n.value.map(o=>{o.children.forEach(a=>{e[a.componentName]=a.schema})}),e}),g=v(()=>{let e=[];return n.value.forEach(o=>{const a=o.children.map(s=>({label:s.componentName,value:s.exportName}));e=e.concat(a)}),e}),c=u({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),d=async()=>{const e=document.querySelector(".standalone-iframe");return await new Promise((s,i)=>{e.addEventListener("load",()=>{s(e.contentWindow)})})},t=u({list:[],customModules:[],varPools:{datasets:[],vars:[]},img:"",name:"未命名仪表板",id:""}),l=u(!1);return{customModules:n,customCompSchema:h,onAddModules:f,customComps:g,varPools:c,getContentWindow:d,onSave:e=>{t.value.list=e.list,t.value.img=e.img,t.value.customModules=n.value,t.value.varPools=c.value;const o=t.value.id?r.update:r.add;t.value.id||delete t.value.id,l.value=!0,o(t.value).then(a=>{const{code:s,data:i,msg:m}=a;l.value=!1,s==200?p.success("保存成功"):p.error("保存失败")})},dgInfo:t,getDetail:e=>{l.value=!0,r.getDetail(e).then(o=>{const{code:a,data:s,msg:i}=o;if(a==200){t.value=s;const{customModules:m,varPools:w}=t.value;n.value=m,c.value=w,setTimeout(()=>{d().then(D=>{D.postMessage({type:"refresh-all",data:S(t.value.list)}),l.value=!1})})}})},loading:l}});export{W as u};
