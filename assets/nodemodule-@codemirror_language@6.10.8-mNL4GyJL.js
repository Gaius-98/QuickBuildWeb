import{N as y,T as C,I as Pe,b as M,P as De,c as Q}from"./nodemodule-@lezer_common@1.2.3-DJDOv6L0.js";import{F as w,l as O,P as Oe,b as X,m as ae,S as L,e as le,h as Ie,R as Be}from"./nodemodule-@codemirror_state@6.5.2-CeTbMir1.js";import{E as b,V as Y,b as Me,G as Ne,D as p,l as Ee,W as fe,a as _}from"./nodemodule-@codemirror_view@6.36.3-NX7sJwro.js";import{a as Fe,t as u,h as Le,s as He}from"./nodemodule-@lezer_highlight@1.2.1-GwqidMBt.js";import{S as ee}from"./nodemodule-style-mod@4.1.2-Bc2inJdb.js";var j;const A=new y;function We(n){return w.define({combine:n?e=>e.concat(n):void 0})}const Re=new y;class g{constructor(e,t,r=[],i=""){this.data=e,this.name=i,O.prototype.hasOwnProperty("tree")||Object.defineProperty(O.prototype,"tree",{get(){return k(this)}}),this.parser=t,this.extension=[v.of(this),O.languageData.of((s,o,l)=>{let a=te(s,o,l),f=a.type.prop(A);if(!f)return[];let c=s.facet(f),h=a.type.prop(Re);if(h){let m=a.resolve(o-a.from,l);for(let d of h)if(d.test(m,s)){let S=s.facet(d.facet);return d.type=="replace"?S:S.concat(c)}}return c})].concat(r)}isActiveAt(e,t,r=-1){return te(e,t,r).type.prop(A)==this.data}findRegions(e){let t=e.facet(v);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],i=(s,o)=>{if(s.prop(A)==this.data){r.push({from:o,to:o+s.length});return}let l=s.prop(y.mounted);if(l){if(l.tree.prop(A)==this.data){if(l.overlay)for(let a of l.overlay)r.push({from:a.from+o,to:a.to+o});else r.push({from:o,to:o+s.length});return}else if(l.overlay){let a=r.length;if(i(l.tree,l.overlay[0].from+o),r.length>a)return}}for(let a=0;a<s.children.length;a++){let f=s.children[a];f instanceof C&&i(f,s.positions[a]+o)}};return i(k(e),0),r}get allowsNesting(){return!0}}g.setState=L.define();function te(n,e,t){let r=n.facet(v),i=k(n).topNode;if(!r||r.allowsNesting)for(let s=i;s;s=s.enter(e,t,Pe.ExcludeBuffers))s.type.isTop&&(i=s);return i}class V extends g{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=We(e.languageData);return new V(t,e.parser.configure({props:[A.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new V(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function k(n){let e=n.field(g.state,!1);return e?e.tree:C.empty}class je{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let D=null;class N{constructor(e,t,r=[],i,s,o,l,a){this.parser=e,this.state=t,this.fragments=r,this.tree=i,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new N(e,t,[],C.empty,0,r,[],null)}startParse(){return this.parser.startParse(new je(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=C.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let i=Date.now()+e;e=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(M.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(M.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=D;D=this;try{return e()}finally{D=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=ne(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:i,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((f,c,h,m)=>a.push({fromA:f,toA:c,fromB:h,toB:m})),r=M.applyChanges(r,a),i=C.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let f of this.skipped){let c=e.mapPos(f.from,1),h=e.mapPos(f.to,-1);c<h&&l.push({from:c,to:h})}}}return new N(this.parser,t,r,i,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:i,to:s}=this.skipped[r];i<e.to&&s>e.from&&(this.fragments=ne(this.fragments,i,s),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends De{createParse(t,r,i){let s=i[0].from,o=i[i.length-1].to;return{parsedPos:s,advance(){let a=D;if(a){for(let f of i)a.tempSkipped.push(f);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new C(Q.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return D}}function ne(n,e,t){return M.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class P{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new P(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=N.create(e.facet(v).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new P(r)}}g.state=X.define({create:P.init,update(n,e){for(let t of e.effects)if(t.is(g.setState))return t.value;return e.startState.facet(v)!=e.state.facet(v)?P.init(e.state):n.apply(e)}});let ce=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(ce=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const U=typeof navigator<"u"&&(!((j=navigator.scheduling)===null||j===void 0)&&j.isInputPending)?()=>navigator.scheduling.isInputPending():null,Ue=Y.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(g.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(g.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=ce(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:i}}=this.view,s=r.field(g.state);if(s.tree==s.context.tree&&s.context.isDone(i+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!U?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<i&&r.doc.length>i+1e3,a=s.context.work(()=>U&&U()||Date.now()>o,i+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:g.setState.of(new P(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Ee(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),v=w.define({combine(n){return n.length?n[0]:null},enables:n=>[g.state,Ue,b.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class Nt{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const $e=w.define(),ue=w.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function qe(n){let e=n.facet(ue);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function Ge(n,e){let t="",r=n.tabSize,i=n.facet(ue)[0];if(i=="	"){for(;e>=r;)t+="	",e-=r;i=" "}for(let s=0;s<e;s++)t+=i;return t}function Ve(n,e){n instanceof O&&(n=new he(n));for(let r of n.state.facet($e)){let i=r(n,e);if(i!==void 0)return i}let t=k(n.state);return t.length>=e?Je(n,t,e):null}class he{constructor(e,t={}){this.state=e,this.options=t,this.unit=qe(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:i,simulateDoubleBreak:s}=this.options;return i!=null&&i>=r.from&&i<=r.to?s&&i==e?{text:"",from:e}:(t<0?i<e:i<=e)?{text:r.text.slice(i-r.from),from:i}:{text:r.text.slice(0,i-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:i}=this.lineAt(e,t);return r.slice(e-i,Math.min(r.length,e+100-i))}column(e,t=1){let{text:r,from:i}=this.lineAt(e,t),s=this.countColumn(r,e-i),o=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return o>-1&&(s+=o-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return Ie(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:i}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(i);if(o>-1)return o}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const ze=new y;function Je(n,e,t){let r=e.resolveStack(t),i=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(i!=r.node){let s=[];for(let o=i;o&&!(o.from==r.node.from&&o.type==r.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)r={node:s[o],next:r}}return de(r,n,t)}function de(n,e,t){for(let r=n;r;r=r.next){let i=Qe(r.node);if(i)return i(Z.create(e,t,r))}return 0}function Ke(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function Qe(n){let e=n.type.prop(ze);if(e)return e;let t=n.firstChild,r;if(t&&(r=t.type.prop(y.closedBy))){let i=n.lastChild,s=i&&r.indexOf(i.name)>-1;return o=>pe(o,!0,1,void 0,s&&!Ke(o)?i.from:void 0)}return n.parent==null?Xe:null}function Xe(){return 0}class Z extends he{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new Z(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(Ye(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return de(this.context.next,this.base,this.pos)}}function Ye(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function Ze(n){let e=n.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let i=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=i==null||i<=s.from?s.to:Math.min(s.to,i);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==r)return null;if(!a.type.isSkipped){if(a.from>=o)return null;let f=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+f}}l=a.to}}function Et({closing:n,align:e=!0,units:t=1}){return r=>pe(r,e,t,n)}function pe(n,e,t,r,i){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=r&&s.slice(o,o+r.length)==r||i==n.pos+o,a=e?Ze(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}const Ft=n=>n.baseIndent;function Lt({except:n,units:e=1}={}){return t=>{let r=n&&n.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}const _e=200;function Ht(){return O.transactionFilter.of(n=>{if(!n.docChanged||!n.isUserEvent("input.type")&&!n.isUserEvent("input.complete"))return n;let e=n.startState.languageDataAt("indentOnInput",n.startState.selection.main.head);if(!e.length)return n;let t=n.newDoc,{head:r}=n.newSelection.main,i=t.lineAt(r);if(r>i.from+_e)return n;let s=t.sliceString(i.from,r);if(!e.some(f=>f.test(s)))return n;let{state:o}=n,l=-1,a=[];for(let{head:f}of o.selection.ranges){let c=o.doc.lineAt(f);if(c.from==l)continue;l=c.from;let h=Ve(o,c.from);if(h==null)continue;let m=/^\s*/.exec(c.text)[0],d=Ge(o,h);m!=d&&a.push({from:c.from,to:c.from+m.length,insert:d})}return a.length?[n,{changes:a,sequential:!0}]:n})}const et=w.define(),tt=new y;function Wt(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function nt(n,e,t){let r=k(n);if(r.length<t)return null;let i=r.resolveStack(t,1),s=null;for(let o=i;o;o=o.next){let l=o.node;if(l.to<=t||l.from>t)continue;if(s&&l.from<e)break;let a=l.type.prop(tt);if(a&&(l.to<r.length-50||r.length==n.doc.length||!rt(l))){let f=a(l,n);f&&f.from<=t&&f.from>=e&&f.to>t&&(s=f)}}return s}function rt(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function E(n,e,t){for(let r of n.facet(et)){let i=r(n,e,t);if(i)return i}return nt(n,e,t)}function me(n,e){let t=e.mapPos(n.from,1),r=e.mapPos(n.to,-1);return t>=r?void 0:{from:t,to:r}}const H=L.define({map:me}),I=L.define({map:me});function ge(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(r=>r.from<=t&&r.to>=t)||e.push(n.lineBlockAt(t));return e}const x=X.define({create(){return p.none},update(n,e){n=n.map(e.changes);for(let t of e.effects)if(t.is(H)&&!it(n,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(ye),i=r?p.replace({widget:new ct(r(e.state,t.value))}):re;n=n.update({add:[i.range(t.value.from,t.value.to)]})}else t.is(I)&&(n=n.update({filter:(r,i)=>t.value.from!=r||t.value.to!=i,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:r}=e.selection.main;n.between(r,r,(i,s)=>{i<r&&s>r&&(t=!0)}),t&&(n=n.update({filterFrom:r,filterTo:r,filter:(i,s)=>s<=r||i>=r}))}return n},provide:n=>b.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(r,i)=>{t.push(r,i)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let r=n[t++],i=n[t++];if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid JSON for fold state");e.push(re.range(r,i))}return p.set(e,!0)}});function F(n,e,t){var r;let i=null;return(r=n.field(x,!1))===null||r===void 0||r.between(e,t,(s,o)=>{(!i||i.from>s)&&(i={from:s,to:o})}),i}function it(n,e,t){let r=!1;return n.between(e,e,(i,s)=>{i==e&&s==t&&(r=!0)}),r}function ke(n,e){return n.field(x,!1)?e:e.concat(L.appendConfig.of(we()))}const st=n=>{for(let e of ge(n)){let t=E(n.state,e.from,e.to);if(t)return n.dispatch({effects:ke(n.state,[H.of(t),be(n,t)])}),!0}return!1},ot=n=>{if(!n.state.field(x,!1))return!1;let e=[];for(let t of ge(n)){let r=F(n.state,t.from,t.to);r&&e.push(I.of(r),be(n,r,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function be(n,e,t=!0){let r=n.state.doc.lineAt(e.from).number,i=n.state.doc.lineAt(e.to).number;return b.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${r} ${n.state.phrase("to")} ${i}.`)}const at=n=>{let{state:e}=n,t=[];for(let r=0;r<e.doc.length;){let i=n.lineBlockAt(r),s=E(e,i.from,i.to);s&&t.push(H.of(s)),r=(s?n.lineBlockAt(s.to):i).to+1}return t.length&&n.dispatch({effects:ke(n.state,t)}),!!t.length},lt=n=>{let e=n.state.field(x,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(r,i)=>{t.push(I.of({from:r,to:i}))}),n.dispatch({effects:t}),!0},Rt=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:st},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:ot},{key:"Ctrl-Alt-[",run:at},{key:"Ctrl-Alt-]",run:lt}],ft={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},ye=w.define({combine(n){return le(n,ft)}});function we(n){return[x,ht]}function ve(n,e){let{state:t}=n,r=t.facet(ye),i=o=>{let l=n.lineBlockAt(n.posAtDOM(o.target)),a=F(n.state,l.from,l.to);a&&n.dispatch({effects:I.of(a)}),o.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(n,i,e);let s=document.createElement("span");return s.textContent=r.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=i,s}const re=p.replace({widget:new class extends fe{toDOM(n){return ve(n,null)}}});class ct extends fe{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return ve(e,this.value)}}const ut={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class $ extends Ne{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function jt(n={}){let e=Object.assign(Object.assign({},ut),n),t=new $(e,!0),r=new $(e,!1),i=Y.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(v)!=o.state.facet(v)||o.startState.field(x,!1)!=o.state.field(x,!1)||k(o.startState)!=k(o.state)||e.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new ae;for(let a of o.viewportLineBlocks){let f=F(o.state,a.from,a.to)?r:E(o.state,a.from,a.to)?t:null;f&&l.add(a.from,a.from,f)}return l.finish()}}),{domEventHandlers:s}=e;return[i,Me({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(i))===null||l===void 0?void 0:l.markers)||Be.empty},initialSpacer(){return new $(e,!1)},domEventHandlers:Object.assign(Object.assign({},s),{click:(o,l,a)=>{if(s.click&&s.click(o,l,a))return!0;let f=F(o.state,l.from,l.to);if(f)return o.dispatch({effects:I.of(f)}),!0;let c=E(o.state,l.from,l.to);return c?(o.dispatch({effects:H.of(c)}),!0):!1}})}),we()]}const ht=b.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class W{constructor(e,t){this.specs=e;let r;function i(l){let a=ee.newName();return(r||(r=Object.create(null)))["."+a]=l,a}const s=typeof t.all=="string"?t.all:t.all?i(t.all):void 0,o=t.scope;this.scope=o instanceof g?l=>l.prop(A)==o.data:o?l=>l==o:void 0,this.style=Fe(e.map(l=>({tag:l.tag,class:l.class||i(Object.assign({},l,{tag:null}))})),{all:s}).style,this.module=r?new ee(r):null,this.themeType=t.themeType}static define(e,t){return new W(e,t||{})}}const z=w.define(),xe=w.define({combine(n){return n.length?[n[0]]:null}});function q(n){let e=n.facet(z);return e.length?e:n.facet(xe)}function Ut(n,e){let t=[pt],r;return n instanceof W&&(n.module&&t.push(b.styleModule.of(n.module)),r=n.themeType),e!=null&&e.fallback?t.push(xe.of(n)):r?t.push(z.computeN([b.darkTheme],i=>i.facet(b.darkTheme)==(r=="dark")?[n]:[])):t.push(z.of(n)),t}class dt{constructor(e){this.markCache=Object.create(null),this.tree=k(e.state),this.decorations=this.buildDeco(e,q(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=k(e.state),r=q(e.state),i=r!=q(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!i&&t.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||i)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return p.none;let r=new ae;for(let{from:i,to:s}of e.visibleRanges)Le(this.tree,t,(o,l,a)=>{r.add(o,l,this.markCache[a]||(this.markCache[a]=p.mark({class:a})))},i,s);return r.finish()}}const pt=Oe.high(Y.fromClass(dt,{decorations:n=>n.decorations})),$t=W.define([{tag:u.meta,color:"#404740"},{tag:u.link,textDecoration:"underline"},{tag:u.heading,textDecoration:"underline",fontWeight:"bold"},{tag:u.emphasis,fontStyle:"italic"},{tag:u.strong,fontWeight:"bold"},{tag:u.strikethrough,textDecoration:"line-through"},{tag:u.keyword,color:"#708"},{tag:[u.atom,u.bool,u.url,u.contentSeparator,u.labelName],color:"#219"},{tag:[u.literal,u.inserted],color:"#164"},{tag:[u.string,u.deleted],color:"#a11"},{tag:[u.regexp,u.escape,u.special(u.string)],color:"#e40"},{tag:u.definition(u.variableName),color:"#00f"},{tag:u.local(u.variableName),color:"#30a"},{tag:[u.typeName,u.namespace],color:"#085"},{tag:u.className,color:"#167"},{tag:[u.special(u.variableName),u.macroName],color:"#256"},{tag:u.definition(u.propertyName),color:"#00c"},{tag:u.comment,color:"#940"},{tag:u.invalid,color:"#f00"}]),mt=b.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Se=1e4,Te="()[]{}",Ce=w.define({combine(n){return le(n,{afterCursor:!0,brackets:Te,maxScanDistance:Se,renderMatch:bt})}}),gt=p.mark({class:"cm-matchingBracket"}),kt=p.mark({class:"cm-nonmatchingBracket"});function bt(n){let e=[],t=n.matched?gt:kt;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const yt=X.define({create(){return p.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],r=e.state.facet(Ce);for(let i of e.state.selection.ranges){if(!i.empty)continue;let s=B(e.state,i.head,-1,r)||i.head>0&&B(e.state,i.head-1,1,r)||r.afterCursor&&(B(e.state,i.head,1,r)||i.head<e.state.doc.length&&B(e.state,i.head+1,-1,r));s&&(t=t.concat(r.renderMatch(s,e.state)))}return p.set(t,!0)},provide:n=>b.decorations.from(n)}),wt=[yt,mt];function qt(n={}){return[Ce.of(n),wt]}const vt=new y;function J(n,e,t){let r=n.prop(e<0?y.openedBy:y.closedBy);if(r)return r;if(n.name.length==1){let i=t.indexOf(n.name);if(i>-1&&i%2==(e<0?1:0))return[t[i+e]]}return null}function K(n){let e=n.type.prop(vt);return e?e(n.node):n}function B(n,e,t,r={}){let i=r.maxScanDistance||Se,s=r.brackets||Te,o=k(n),l=o.resolveInner(e,t);for(let a=l;a;a=a.parent){let f=J(a.type,t,s);if(f&&a.from<a.to){let c=K(a);if(c&&(t>0?e>=c.from&&e<c.to:e>c.from&&e<=c.to))return xt(n,e,t,a,c,f,s)}}return St(n,e,t,o,l.type,i,s)}function xt(n,e,t,r,i,s,o){let l=r.parent,a={from:i.from,to:i.to},f=0,c=l==null?void 0:l.cursor();if(c&&(t<0?c.childBefore(r.from):c.childAfter(r.to)))do if(t<0?c.to<=r.from:c.from>=r.to){if(f==0&&s.indexOf(c.type.name)>-1&&c.from<c.to){let h=K(c);return{start:a,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(J(c.type,t,o))f++;else if(J(c.type,-t,o)){if(f==0){let h=K(c);return{start:a,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}f--}}while(t<0?c.prevSibling():c.nextSibling());return{start:a,matched:!1}}function St(n,e,t,r,i,s,o){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=o.indexOf(l);if(a<0||a%2==0!=t>0)return null;let f={from:t<0?e-1:e,to:t>0?e+1:e},c=n.doc.iterRange(e,t>0?n.doc.length:0),h=0;for(let m=0;!c.next().done&&m<=s;){let d=c.value;t<0&&(m+=d.length);let S=e+m*t;for(let T=t>0?0:d.length-1,Ae=t>0?d.length:-1;T!=Ae;T+=t){let R=o.indexOf(d[T]);if(!(R<0||r.resolveInner(S+T,1).type!=i))if(R%2==0==t>0)h++;else{if(h==1)return{start:f,end:{from:S+T,to:S+T+1},matched:R>>1==a>>1};h--}}t>0&&(m+=d.length)}return c.done?{start:f,matched:!1}:null}const Tt=Object.create(null),ie=[Q.none],se=[],oe=Object.create(null),Ct=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Ct[n]=At(Tt,e);function G(n,e){se.indexOf(n)>-1||(se.push(n),console.warn(e))}function At(n,e){let t=[];for(let l of e.split(" ")){let a=[];for(let f of l.split(".")){let c=n[f]||u[f];c?typeof c=="function"?a.length?a=a.map(c):G(f,`Modifier ${f} used at start of tag`):a.length?G(f,`Tag ${f} used as modifier`):a=Array.isArray(c)?c:[c]:G(f,`Unknown highlighting tag ${f}`)}for(let f of a)t.push(f)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),i=r+" "+t.map(l=>l.id),s=oe[i];if(s)return s.id;let o=oe[i]=Q.define({id:ie.length,name:r,props:[He({[r]:t})]});return ie.push(o),o.id}_.RTL,_.LTR;export{W as H,he as I,Nt as L,Ge as a,qe as b,V as c,Re as d,We as e,ze as f,Ve as g,tt as h,ue as i,Lt as j,Et as k,Ft as l,B as m,Wt as n,Ut as o,jt as p,Ht as q,qt as r,k as s,$t as t,Rt as u};
