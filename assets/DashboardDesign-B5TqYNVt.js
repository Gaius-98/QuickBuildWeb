import{_ as ue}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-DRT2VLl_.js";import{c as re}from"./componentsSchema-gFhwa5FU.js";import{f as de,r as b,P as R,g as L,s as J,x as z,o as p,y as f,G as o,N as D,U as I,H as ce,J as Q,l as e,i as N,aj as T,M as U,w as a,t as ie,v as G,a1 as Y,ao as Z,ap as ee,bg as F,a5 as te,a6 as ae,T as H,b5 as le,a7 as ne,h as oe,F as pe,b3 as me,X as ve}from"./.pnpm-CEdUQ-90.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as _e}from"./ConfigForm.vue_vue_type_script_setup_true_lang-3XanGMxL.js";const K=de("dashboardDesign",()=>{const u=b([]),y=r=>{u.value.push(r)},h=R(()=>{const r={};return u.value.map(i=>{i.children.forEach(_=>{r[_.componentName]=_.schema})}),r}),w=R(()=>{let r=[];return u.value.forEach(i=>{const _=i.children.map(S=>({label:S.componentName,value:S.exportName}));r=r.concat(_)}),r}),k=b({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]});return{customModules:u,customCompSchema:h,onAddModules:y,customComps:w,varPools:k,getContentWindow:()=>document.querySelector(".standalone-iframe").contentWindow}}),se=u=>(Z("data-v-168494c5"),u=u(),ee(),u),fe={class:"material-area"},he={class:"material-layout-area"},ge=se(()=>o("div",{class:"title"},"内置组件",-1)),be={class:"content"},ye=["data-material"],Ce={class:"material-label"},xe={class:"material-data-area"},we=se(()=>o("div",{class:"title"},"自定义组件",-1)),ke={class:"content"},Se=["data-material"],Ne={style:{height:"650px"}},Ue={style:{height:"80px","overflow-y":"auto"}},De={style:{height:"200px","overflow-y":"auto"}},Me=L({__name:"MaterialArea",setup(u){const y=K(),{customModules:h,customComps:w}=J(y),{onAddModules:k}=y,d=b({internalComp:re,customComp:[]}),r=m=>{var c,s;const n=m.target;(c=m.dataTransfer)==null||c.setData("material",n.dataset.material),(s=m.dataTransfer)==null||s.setData("material-type",n.dataset.materialType)},i=b(!1),_=()=>{i.value=!0,l.value=ie(S.value)},S=b({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElButton",exportName:"ElButton",id:"1",schema:`{
    "type": {
        "type": "input",
        "label": "按钮类型"
    }

      }`}]}),l=b({}),M=()=>{i.value=!1},$=()=>{k(l.value),d.value.customComp=d.value.customComp.concat(w.value),C==null||C.postMessage({type:"add-custom-comp",data:G(l.value)}),M()},E=()=>{l.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},W=m=>{const n=l.value.children.findIndex(c=>c.id==m.id);n!=-1&&l.value.children.splice(n,1)},q=()=>{l.value.urls.push("")},g=m=>{const n=l.value.urls.findIndex(c=>c==m);n!=-1&&l.value.urls.splice(n,1)};let C=null;return z(()=>{C=document.querySelector(".standalone-iframe").contentWindow}),(m,n)=>{const c=te,s=ae,V=H,P=le,B=ue,v=ne,O=Y;return p(),f("div",fe,[o("div",he,[ge,o("div",be,[(p(!0),f(D,null,I(d.value.internalComp,t=>(p(),f("div",{key:t.name,draggable:"true",onDragstart:r,"data-material":t.name,"data-material-type":"internal",class:"material-item"},[o("span",{class:ce(["iconfont material-icon",t.icon])},null,2),o("span",Ce,Q(t.label),1)],40,ye))),128))])]),o("div",xe,[we,o("div",ke,[(p(!0),f(D,null,I(d.value.customComp,t=>(p(),f("div",{type:"dashed",key:t.value,draggable:"true",onDragstart:r,"data-material":t.value,"data-material-type":"custom",class:"material-item"},Q(t.label),41,Se))),128)),o("div",{type:"dashed",onClick:_,class:"material-item"},[o("span",null,[e(N(T)),U(" 添加组件 ")])])])]),e(O,{title:"添加自定义组件",width:"800px",open:i.value,"onUpdate:open":n[4]||(n[4]=t=>i.value=t),onOk:$,onCancel:M},{default:a(()=>[o("div",Ne,[e(v,{model:l.value,"label-col":{style:{width:"150px"}}},{default:a(()=>[e(s,{label:"名称"},{default:a(()=>[e(c,{value:l.value.title,"onUpdate:value":n[0]||(n[0]=t=>l.value.title=t)},null,8,["value"])]),_:1}),e(s,{label:"组件库名称"},{default:a(()=>[e(c,{value:l.value.package,"onUpdate:value":n[1]||(n[1]=t=>l.value.package=t)},null,8,["value"])]),_:1}),e(s,{label:"版本"},{default:a(()=>[e(c,{value:l.value.version,"onUpdate:value":n[2]||(n[2]=t=>l.value.version=t)},null,8,["value"])]),_:1}),e(s,{label:"导出名称"},{default:a(()=>[e(c,{value:l.value.exportName,"onUpdate:value":n[3]||(n[3]=t=>l.value.exportName=t)},null,8,["value"])]),_:1}),e(s,{label:"CDN地址"},{default:a(()=>[o("div",Ue,[(p(!0),f(D,null,I(l.value.urls,(t,j)=>(p(),f("div",{key:t,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(c,{value:l.value.urls[j],"onUpdate:value":x=>l.value.urls[j]=x},null,8,["value","onUpdate:value"]),e(N(F),{onClick:x=>g(t),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(s,null,{default:a(()=>[e(V,{type:"dashed",block:"",onClick:q},{default:a(()=>[e(N(T)),U(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(s,{label:"子组件"},{default:a(()=>[o("div",De,[(p(!0),f(D,null,I(l.value.children,(t,j)=>(p(),f("div",{key:t.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(P,null,{default:a(()=>[o("div",null,[e(P,null,{default:a(()=>[e(s,{label:"组件名",rules:{required:!0}},{default:a(()=>[e(c,{value:t.componentName,"onUpdate:value":x=>t.componentName=x},null,8,["value","onUpdate:value"])]),_:2},1024),e(s,{label:"导出名称",rules:{required:!0}},{default:a(()=>[e(c,{value:t.exportName,"onUpdate:value":x=>t.exportName=x},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(s,{label:"配置Schema",rules:{required:!0}},{default:a(()=>[e(B,{value:t.schema,"onUpdate:value":x=>t.schema=x,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(N(F),{onClick:x=>W(t)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(s,null,{default:a(()=>[e(V,{type:"dashed",block:"",onClick:E},{default:a(()=>[e(N(T)),U(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),$e=X(Me,[["__scopeId","data-v-168494c5"]]),Ie={text:{type:"input",label:"文本内容"}},qe={src:{type:"input",label:"图片地址"}},Ve={src:{type:"input",label:"页面地址"}},Pe=u=>({dataset:{type:"select",label:"数据集",options:u},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),A={"qb-text":Ie,"qb-image":qe,"qb-iframe":Ve,"qb-chart":Pe},Te={class:"material-cfg"},Ee={class:"material-cfg-btn"},We=L({__name:"MaterialCfg",setup(u){const y=K(),{customCompSchema:h}=J(y),{getContentWindow:w}=y,k=b({}),d=b({}),r=b({});window.addEventListener("message",l=>{l.data.type==="select"&&(d.value=l.data.data,d.value.type==="custom"?h.value&&(r.value=JSON.parse(h.value[d.value.component])):typeof A[d.value.component]=="function"?r.value=A[d.value.component]([]):r.value=A[d.value.component],k.value=l.data.data.props)});let i=null;const _=l=>{if(i)i.postMessage({type:"refresh",data:l});else throw new Error("contentWindow is null")},S=()=>{_(G(d.value))};return z(()=>{i=w()}),(l,M)=>{const $=H;return p(),f("div",Te,[(p(),oe(_e,{class:"material-cfg-contain",key:d.value.id,data:k.value,schema:r.value},null,8,["data","schema"])),o("div",Ee,[e($,{onClick:S},{default:a(()=>[U("刷新")]),_:1})])])}}}),Be=X(We,[["__scopeId","data-v-754b10b9"]]),Oe=u=>(Z("data-v-9747f432"),u=u(),ee(),u),je={class:"dg-design"},Ae={class:"dg-design-container"},Re=Oe(()=>o("div",{class:"middle-part"},[o("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),Fe={style:{height:"300px","overflow-y":"auto"}},Le=L({__name:"DashboardDesign",props:{id:{}},setup(u){const y=K(),{varPools:h}=J(y);let w;const{getContentWindow:k}=y;window.name="dg-design";const d=u,{id:r}=pe(d),i=R(()=>r.value),_=b(!1),S=()=>{_.value=!0},l=()=>{};z(()=>{w=k()});const M=()=>{w.postMessage({type:"refresh-var",data:G(h.value)})},$=()=>{h.value.vars.push({name:"",type:"",defaultValue:""})},E=b([{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔",value:"boolean"},{label:"数组",value:"array"},{label:"对象",value:"object"}]),W=q=>{const g=h.value.vars.findIndex(C=>C.name===q.name);g!=-1&&h.value.vars.splice(g,1)};return(q,g)=>{const C=te,m=le,n=H,c=me,s=ae,V=ve,P=ne,B=Y;return p(),f(D,null,[o("div",je,[e(c,{subTitle:i.value,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[e(C,{bordered:!1,class:"form-name"})]),extra:a(()=>[e(m),e(m),e(m,null,{default:a(()=>[e(n,{type:"primary",onClick:g[0]||(g[0]=v=>S())},{default:a(()=>[U("变量池")]),_:1}),e(n,{class:"preview-btn"},{default:a(()=>[U(" 预览 ")]),_:1}),e(n,{onClick:g[1]||(g[1]=v=>l()),type:"primary",class:"save-btn"},{default:a(()=>[U(" 保存 ")]),_:1})]),_:1})]),_:1},8,["subTitle"]),o("div",Ae,[e($e,{class:"left-part"}),Re,e(Be,{class:"right-part"})])]),e(B,{title:"变量池",open:_.value,"onUpdate:open":g[2]||(g[2]=v=>_.value=v),width:"800px",footer:null,onCancel:M},{default:a(()=>[e(P,null,{default:a(()=>[o("div",Fe,[(p(!0),f(D,null,I(N(h).vars,(v,O)=>(p(),oe(m,{key:O,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:a(()=>[e(s,{label:"变量名",required:!0},{default:a(()=>[e(C,{value:v.name,"onUpdate:value":t=>v.name=t},null,8,["value","onUpdate:value"])]),_:2},1024),e(s,{label:"变量类型",required:!0},{default:a(()=>[e(V,{style:{width:"150px"},value:v.type,"onUpdate:value":t=>v.type=t,options:E.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(s,{label:"默认值",required:!0},{default:a(()=>[e(C,{value:v.defaultValue,"onUpdate:value":t=>v.defaultValue=t},null,8,["value","onUpdate:value"])]),_:2},1024),e(N(F),{onClick:t=>W(v)},null,8,["onClick"])]),_:2},1024))),128))]),e(s,null,{default:a(()=>[e(n,{type:"dashed",block:"",onClick:$},{default:a(()=>[e(N(T)),U(" 添加变量 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),Ke=X(Le,[["__scopeId","data-v-9747f432"]]);export{Ke as default};
