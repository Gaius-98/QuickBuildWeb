import{g as h,s as g}from"./index-Dcam5Uk9.js";import{x as w,b6 as j,r as P,b7 as V,E as L,n as c,a5 as N,b8 as R,aQ as q,a3 as K,a2 as F,aV as Q,a9 as T,aa as U,ab as X,aX as A,ac as B,V as G,ao as H}from"./.pnpm-Bqj5ZitX.js";const J=n=>{const e=/\$\{([^}]+)\}/g,u=n.match(e);return u?u.map(a=>{const l=a.trim().replace(/formData./g,"");return l.substring(2,l.length-1)}):[]},M=(n,e)=>{const u=/\$\{([^}]+)\}/g;return n.replace(u,(l,o)=>{const s=o.trim();return h({formData:e},s)})},E=(n,e)=>{const u=M(n,e);return new Function(`return ${u}`)()},W=(n,e,u,a,l)=>{let o;switch(u){case"string":o=c(F,{size:a.size,...l,value:h(n,e),onChange:s=>{g(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}});break;case"textarea":o=c(H,{size:a.size,...l,value:h(n,e),onChange:s=>{g(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}});break;case"select":o=c(G,{size:a.size,...l,options:a.options[e]||[],value:h(n,e),onChange:s=>{g(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;case"number":o=c(B,{size:a.size,...l,value:h(n,e),onChange:s=>{g(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;case"date":o=c(A,{size:a.size,...l,value:h(n,e),onChange:s=>{g(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;case"tree":o=c(X,{size:a.size,...l,options:a.options[e]||[],value:h(n,e),onChange:s=>{g(n,e,s),a.onChange({formData:n,field:e,value:s})}});break;case"radio":o=c(U,{size:a.size,...l,value:h(n,e),onChange:s=>{g(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}},{default:()=>(a.options[e]||[]).map(s=>c(T,{value:s.value,key:s.value},{default:()=>s.label}))});break;case"switch":o=c(Q,{size:a.size,checked:h(n,e),onChange(s){g(n,e,s),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s})}});break;default:o=c(F,{size:a.size,...l,value:h(n,e),onChange:s=>{g(n,e,s.target.value),a.pubSub.onPublish(e),a.onChange({formData:n,field:e,value:s.target.value})}});break}return o},Y=(n,e,u,a)=>{const{type:l,label:o,component:s,rules:v,tooltip:z}=u;let p;if(s!=null&&s.name){const{name:d}=s,_=q(s);if(Reflect.deleteProperty(_,"onChange"),!a.sfProvideEL[d])throw new Error(`${d} is not registered,provide('sfProvideEL','${d}',Component)`);p=c(a.sfProvideEL[d],{size:a.size,..._,formData:n,value:h(n,e),onChange:C=>{if(n[e]=C,g(n,e,C),s.onChange)try{s.onChange(C,n,e)}catch(m){throw new Error(m)}}})}else p=W(n,e,l,a,s);return a.visibleInfo[e]&&c(K,{label:o,name:e,rules:v,tooltip:z},{default:()=>[p]})},Z={name:"SchemaForm",props:{schema:{type:Object},formData:{type:Object,required:!0},size:{type:String,default:"middle"}},setup(n){const{schema:e,formData:u,size:a}=w(n),{layout:l,properties:o}=w(e.value),s=j("sfProvideEL"),v=P({}),z=Object.entries(o.value).filter(([,i])=>{var r,t;return((r=i==null?void 0:i.component)==null?void 0:r.dataSource)||((t=i==null?void 0:i.component)==null?void 0:t.asyncData)}),p=async(i,r)=>{const{dataSource:t,asyncData:b}=r.component;t?v.value[i]=t:v.value[i]=await b(u.value,i)};z.map(async([i,r])=>{await p(i,r)});const d=i=>{const[r,t]=Object.entries(o.value).find(([b])=>i==b);t&&p(r,t)},_=new V,C=i=>{var b,f;const{field:r}=i,t=(f=(b=o.value[r])==null?void 0:b.component)==null?void 0:f.onChange;t&&t(i)},m=R(),O=()=>{Object.entries(o.value).map(([i,r])=>{if(typeof r.show>"u")S.value[i]=!0;else if(typeof r.show=="boolean")S.value[i]=r.show;else if(typeof r.show=="string"){const t=r.show;S.value[i]=E(t,u.value),J(t).map(f=>{_.onSubscribe(f,()=>{S.value[i]=E(t,u.value)})})}})},S=P({});O();const $=L(()=>{const i={"--schema-gap":"","--schema-height":""};switch(a.value){case"middle":i["--schema-gap"]="24px",i["--schema-height"]="32px";break;case"large":i["--schema-gap"]="36px",i["--schema-height"]="40px";break;case"small":i["--schema-gap"]="4px",i["--schema-height"]="25px";break}return i});return{layout:l,properties:o,refreshOption:d,formData:u,options:v,visibleInfo:S,pubSub:_,sfProvideEL:s,onChange:C,expose:m,size:a,formSize:$}},render:n=>c(N,{...n.layout,style:{...n.formSize},class:["schema-form"]},{default:()=>[...Object.entries(n.properties).map(([e,u])=>Y(n.formData,e,u,n))]})},x=Z;export{x as S};
