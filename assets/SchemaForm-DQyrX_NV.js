import{g as c,s as g}from"./main-DxNYfsaV.js";import{I as m,bx as j,r as F,b7 as L,Q as N,n as h,a8 as V,t as R,a7 as Y,by as q,a6 as E,P as K,aY as M,ac as Q,ad as T,ae as U,aM as A,af as B,Y as G,ar as H}from"./.pnpm-CNbA6tN1.js";/* empty css                   */const J=s=>{const e=/\$\{([^}]+)\}/g,r=s.match(e);return r?r.map(a=>{const l=a.trim().replace(/formData./g,"");return l.substring(2,l.length-1)}):[]},W=(s,e)=>{const r=/\$\{([^}]+)\}/g;return s.replace(r,(l,u)=>{const n=u.trim();return c({formData:e},n)})},O=(s,e)=>{const r=W(s,e);return new Function(`return ${r}`)()},X=(s,e,r,a,l)=>{let u;switch(r){case"string":u=h(E,{size:a.size,...l,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break;case"textarea":u=h(H,{size:a.size,...l,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break;case"select":u=h(G,{size:a.size,...l,options:a.options[e]||[],value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"number":u=h(B,{size:a.size,...l,value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"date":u=h(A,{size:a.size,...l,value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"tree":u=h(U,{size:a.size,...l,options:a.options[e]||[],value:c(s,e),onChange:n=>{g(s,e,n),a.onChange({formData:s,field:e,value:n})}});break;case"radio":u=h(T,{size:a.size,...l,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}},{default:()=>(a.options[e]||[]).map(n=>h(Q,{value:n.value,key:n.value},{default:()=>n.label}))});break;case"switch":u=h(M,{size:a.size,checked:c(s,e),onChange(n){g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"divider":u=h(K,{...l},{default:()=>l==null?void 0:l.title});break;default:u=h(E,{size:a.size,...l,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break}return u},Z=(s,e,r,a)=>{const{type:l,label:u,component:n,rules:v,tooltip:w,formLayout:C=!0}=r;let d;if(n!=null&&n.name){const{name:b}=n,S=R(n);if(Reflect.deleteProperty(S,"onChange"),!a.sfProvideEL[b])throw new Error(`${b} is not registered,provide('sfProvideEL','${b}',Component)`);d=h(a.sfProvideEL[b],{size:a.size,...S,formData:s,value:c(s,e),onChange:_=>{if(s[e]=_,g(s,e,_),n.onChange)try{n.onChange(_,s,e)}catch(P){throw new Error(P)}}})}else d=X(s,e,l,a,n);return C?a.visibleInfo[e]&&h(Y,{label:u,name:e,rules:v,tooltip:w},{default:()=>[d]}):d},y={name:"SchemaForm",props:{schema:{type:Object},formData:{type:Object,required:!0},size:{type:String,default:"middle"}},setup(s){const{schema:e,formData:r,size:a}=m(s),{layout:l,properties:u}=m(e.value),n=j("sfProvideEL"),v=F({}),w=Object.entries(u.value).filter(([,i])=>{var o,t;return((o=i==null?void 0:i.component)==null?void 0:o.dataSource)||((t=i==null?void 0:i.component)==null?void 0:t.asyncData)}),C=async(i,o)=>{const{dataSource:t,asyncData:p}=o.component;t?v.value[i]=t:v.value[i]=await p(r.value,i)};w.map(async([i,o])=>{await C(i,o)});const d=i=>{const[o,t]=Object.entries(u.value).find(([p])=>i==p);t&&C(o,t)},b=new L,S=i=>{var p,z;const{field:o}=i,t=(z=(p=u.value[o])==null?void 0:p.component)==null?void 0:z.onChange;t&&t(i)},_=q(),P=()=>{Object.entries(u.value).map(([i,o])=>{if(typeof o.show>"u")f.value[i]=!0;else if(typeof o.show=="boolean")f.value[i]=o.show;else if(typeof o.show=="string"){const t=o.show;f.value[i]=O(t,r.value),J(t).map(z=>{b.onSubscribe(z,()=>{f.value[i]=O(t,r.value)})})}})},f=F({});P();const $=N(()=>{const i={"--schema-gap":"","--schema-height":""};switch(a.value){case"middle":i["--schema-gap"]="24px",i["--schema-height"]="32px";break;case"large":i["--schema-gap"]="36px",i["--schema-height"]="40px";break;case"small":i["--schema-gap"]="4px",i["--schema-height"]="25px";break}return i});return{layout:l,properties:u,refreshOption:d,formData:r,options:v,visibleInfo:f,pubSub:b,sfProvideEL:n,onChange:S,expose:_,size:a,formSize:$}},render:s=>h(V,{...s.layout,style:{...s.formSize},class:["schema-form"]},{default:()=>[...Object.entries(s.properties).map(([e,r])=>Z(s.formData,e,r,s))]})};export{y as S};
