import{g as c,s as g}from"./tools-BCD5ohFr.js";import{d as $}from"./utils-B6a3RfBT.js";/* empty css                   */import{F as L,_ as N}from"./index-3zxQoAaC.js";import{h,G as P,aQ as V,r as F,F as R,ay as q}from"./iconfont-DlnTACa0.js";import{c as G}from"./cloneDeep-eMWwQ7HD.js";import{I as E,b as K}from"./index-DstlK8U5.js";import{_ as Q}from"./index-5aalWurl.js";import{_ as T}from"./index-ib-wLQfr.js";import{_ as U,b as A,S as B}from"./RadioButton-CjVxn_Oc.js";import"./index-C6qv0Jk3.js";import{_ as H}from"./index-DAYOQQPc.js";import{D as J}from"./dayjs-78fL9Suk.js";import{I as M}from"./index-8jXZgUEG.js";const W=s=>{const e=/\$\{([^}]+)\}/g,u=s.match(e);return u?u.map(a=>{const o=a.trim().replace(/formData./g,"");return o.substring(2,o.length-1)}):[]},X=(s,e)=>{const u=/\$\{([^}]+)\}/g;return s.replace(u,(o,r)=>{const n=r.trim();return c({formData:e},n)})},O=(s,e)=>{const u=X(s,e);return new Function(`return ${u}`)()},Y=(s,e,u,a,o)=>{let r;switch(u){case"string":r=h(E,{size:a.size,...o,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break;case"textarea":r=h(K,{size:a.size,...o,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break;case"select":r=h(B,{size:a.size,...o,options:a.options[e]||[],value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"number":r=h(M,{size:a.size,...o,value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"date":r=h(J,{size:a.size,...o,value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"tree":r=h(H,{size:a.size,...o,options:a.options[e]||[],value:c(s,e),onChange:n=>{g(s,e,n),a.onChange({formData:s,field:e,value:n})}});break;case"radio":r=h(U,{size:a.size,...o,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}},{default:()=>(a.options[e]||[]).map(n=>h(A,{value:n.value,key:n.value},{default:()=>n.label}))});break;case"switch":r=h(T,{size:a.size,checked:c(s,e),onChange(n){g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"divider":r=h(Q,{...o},{default:()=>o==null?void 0:o.title});break;default:r=h(E,{size:a.size,...o,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break}return r},Z=(s,e,u,a)=>{const{type:o,label:r,component:n,rules:v,tooltip:z,formLayout:m=!0}=u;let d;if(n!=null&&n.name){const{name:p}=n,C=G(n);if(Reflect.deleteProperty(C,"onChange"),!a.sfProvideEL[p])throw new Error(`${p} is not registered,provide('sfProvideEL','${p}',Component)`);d=h(a.sfProvideEL[p],{size:a.size,...C,formData:s,value:c(s,e),onChange:f=>{if(s[e]=f,g(s,e,f),n.onChange)try{n.onChange(f,s,e)}catch(w){throw new Error(w)}}})}else d=Y(s,e,o,a,n);return m?a.visibleInfo[e]&&h(N,{label:r,name:e,rules:v,tooltip:z},{default:()=>[d]}):d},le={name:"SchemaForm",props:{schema:{type:Object},formData:{type:Object,required:!0},size:{type:String,default:"middle"}},setup(s){const{schema:e,formData:u,size:a}=P(s),{layout:o,properties:r}=P(e.value),n=V("sfProvideEL"),v=F({}),z=Object.entries(r.value).filter(([,i])=>{var t,l;return((t=i==null?void 0:i.component)==null?void 0:t.dataSource)||((l=i==null?void 0:i.component)==null?void 0:l.asyncData)}),m=async(i,t)=>{const{dataSource:l,asyncData:b}=t.component;l?v.value[i]=l:v.value[i]=await b(u.value,i)};z.map(async([i,t])=>{await m(i,t)});const d=i=>{const[t,l]=Object.entries(r.value).find(([b])=>i==b);l&&m(t,l)},p=new $,C=i=>{var b,S;const{field:t}=i,l=(S=(b=r.value[t])==null?void 0:b.component)==null?void 0:S.onChange;l&&l(i)},f=q(),w=()=>{Object.entries(r.value).map(([i,t])=>{if(typeof t.show>"u")_.value[i]=!0;else if(typeof t.show=="boolean")_.value[i]=t.show;else if(typeof t.show=="string"){const l=t.show;_.value[i]=O(l,u.value),W(l).map(S=>{p.onSubscribe(S,()=>{_.value[i]=O(l,u.value)})})}})},_=F({});w();const j=R(()=>{const i={"--schema-gap":"","--schema-height":""};switch(a.value){case"middle":i["--schema-gap"]="24px",i["--schema-height"]="32px";break;case"large":i["--schema-gap"]="36px",i["--schema-height"]="40px";break;case"small":i["--schema-gap"]="4px",i["--schema-height"]="25px";break}return i});return{layout:o,properties:r,refreshOption:d,formData:u,options:v,visibleInfo:_,pubSub:p,sfProvideEL:n,onChange:C,expose:f,size:a,formSize:j}},render:s=>h(L,{...s.layout,style:{...s.formSize},class:["schema-form"]},{default:()=>[...Object.entries(s.properties).map(([e,u])=>Z(s.formData,e,u,s))]})};export{le as S};
