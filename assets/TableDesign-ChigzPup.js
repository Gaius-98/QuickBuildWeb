import{b7 as ae,f as le,r as C,aS as se,g as N,s as F,v as M,o as r,y,l,i as e,aD as ue,J as h,O as T,w as m,aG as ce,A as ie,aL as G,a6 as Q,D as J,F as z,Q as U,b8 as re,ag as K,B as R,b9 as de,ba as me,a0 as L,h as P,ae as pe,t as H,x as _e,bb as ve,aB as fe,W as be,b1 as W,b4 as ge,bc as j,a1 as he,U as Ce,a2 as ye,a3 as xe,b6 as we}from"./.pnpm-ChulSkD7.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as O}from"./index-DgIxvXwz.js";import{S as Ie}from"./SchemaForm-C6I6V-HE.js";const ke=new ae,V=ke,A=le("tableDesign",()=>{const x=C([]),d=C({name:"",description:"",status:1,columns:[],global:{bordered:!1},datasource:{tableName:"",sourceId:""},filter:{show:!0},action:[]}),o=C([]),t=C({}),p=()=>{const v=new Date().getTime().toString().slice(-4);d.value.columns,d.value.columns.push({id:se(),dataIndex:"field"+v,title:"列"+v,width:200})},i=(v,a)=>{const u=a.findIndex(f=>f.id===v);u!=-1&&(t.value=a[u])},c=(v,a)=>{const u=a.findIndex(f=>f.id===v);u!=-1&&a.splice(u,1)},_=async v=>{},w=C(!1);return{tableCfg:d,currentColumn:t,onSelectColumn:i,onRemoveColumn:c,onAddColumn:p,tableData:x,onRefreshData:_,saveLoading:w,onSave:async()=>{w.value=!0,w.value=!1},columnFields:o,onSetColumns:v=>{o.value=v}}}),De={class:"custom-header-label",style:{flex:"1"}},Se=N({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(x,{emit:d}){const o=A(),{currentColumn:t}=F(o),p=x,{params:i}=M(p),c=()=>{V.onPublish("removeEvent",i.value)};return(_,w)=>{const g=Q;return r(),y("div",{class:ie(["custom-header-item",e(t).dataIndex==e(i).column.getColId()?"active":""]),style:G([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:e(t).dataIndex==e(i).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[l(e(ue),{class:"move",style:{width:"20px",cursor:"move"}}),h("div",De,T(e(i).displayName),1),l(g,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:w[0]||(w[0]=D=>c())},{default:m(()=>[l(e(ce),{class:"remove",style:{width:"20px"}})]),_:1})],6)}}}),$e={class:"custom-opt-cell"},Ne=["onClick"],Re=N({__name:"CustomOptCell",setup(x){const d=A(),{tableCfg:o}=F(d),t=J(()=>{var c;return(c=o.value.action)==null?void 0:c.filter(_=>_.position=="row")}),p=(c,_)=>{V.onPublish("action",{position:c,data:_})},i=c=>{V.onPublish("remove-btn",c)};return(c,_)=>{const w=Q;return r(),y("div",$e,[(r(!0),y(z,null,U(t.value,g=>(r(),y("div",{class:"btn",key:g.id},[h("a",{onClick:D=>p("row",g)},T(g.name),9,Ne),l(w,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:D=>i(g)},{default:m(()=>[l(e(re),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),l(e(K),{style:{cursor:"pointer"},onClick:_[0]||(_[0]=g=>p("row"))})])}}}),Te={class:"custom-header-label",style:{flex:"1"}},Pe=N({__name:"CustomAddColumn",setup(x){const d=A(),{onAddColumn:o}=d;return(t,p)=>{const i=me;return r(),y("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:p[0]||(p[0]=c=>e(o)())},[h("div",Te,[l(e(K)),R(" 新增列 "),l(i,null,{title:m(()=>[R("用于新增列配置")]),default:m(()=>[l(e(de))]),_:1})])])}}}),Ae={class:"cell"},Be={key:0},Oe=["href"],Ve=N({__name:"CustomCellRender",props:{params:{}},setup(x){const d=x,{params:o}=M(d);return(t,p)=>{const i=pe;return r(),y("div",Ae,[e(o).colDef.cellRendererParams.type=="text"?(r(),y("span",Be,T(e(o).value),1)):L("",!0),e(o).colDef.cellRendererParams.type=="image"?(r(),P(i,{key:1,src:e(o).value},null,8,["src"])):L("",!0),e(o).colDef.cellRendererParams.type=="link"?(r(),y("a",{key:2,href:e(o).value},T(e(o).value),9,Oe)):L("",!0)])}}}),Fe=N({__name:"AgTable",props:H({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:H(["onRemove","onClick"],["update:columns"]),setup(x,{emit:d}){V.onSubscribe("removeEvent",a=>{let u=a.column.getColId(),f=o.value.find(S=>S.dataIndex==u);f&&D(f)});const o=_e(x,"columns"),t=x,{columnId:p,tableData:i}=M(t),c=J(()=>{let a=o.value.map(u=>({field:u.dataIndex,colId:u.dataIndex,headerName:u.title,pinned:u.fixed=="none"?void 0:u.fixed,lockVisible:!0,headerComponent:Se,cellRenderer:Ve,cellRendererParams:{type:u.type}}));return a.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:Pe}),a.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:Re}),a}),_=a=>{if(!a.finished)return;let u=a.api.getColumnState().map(f=>o.value.find(S=>S.dataIndex==f.colId));o.value=u},w=a=>{if(!a.finished)return;let u=a.column.getColId(),f=o.value.findIndex(S=>S.dataIndex==u);f!=-1&&(o.value[f].width=a.column.getActualWidth())},g=d,D=a=>{g("onRemove",a)},v=a=>{let u=a.column.getId(),f=o.value.find(S=>S.dataIndex==u);g("onClick",f)};return(a,u)=>(r(),P(e(ve),{rowData:e(i),columnDefs:c.value,style:G({height:a.height+"px"}),class:"ag-theme-quartz",onColumnMoved:_,onColumnResized:w,onColumnHeaderClicked:v},null,8,["rowData","columnDefs","style"]))}}),Le=X(Fe,[["__scopeId","data-v-8ecc2aa5"]]),ze=N({__name:"TableCfg",setup(x){const d=A(),{tableCfg:o,columnFields:t,currentColumn:p}=F(d),i=C({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(_=>{setTimeout(()=>{_(t.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),c=C();return fe(()=>p.value,()=>{c.value.refreshOption("dataIndex")}),(_,w)=>(r(),P(e(Ie),{formData:e(p),schema:i.value,ref_key:"schemaRef",ref:c,size:"small"},null,8,["formData","schema"]))}}),Ue={class:"table-design"},Me={class:"table-design-container"},qe={class:"main-part"},Ee={class:"filter-part"},He={class:"filter-container"},We={class:"add widget-item"},je={class:"tools-part"},Ge={class:"tools-container"},Qe={class:"add button-item"},Je={class:"table-part"},Ke={class:"right-part"},Xe=N({__name:"TableDesign",setup(x){const d=C([]);be(()=>{O.getDataSourceDict().then(I=>{const{code:n,data:k,msg:$}=I;n==200&&(d.value=k)})});const o=A(),{tableCfg:t,columnFields:p}=F(o),{onSelectColumn:i,onRemoveColumn:c,onAddColumn:_,onRefreshData:w,onSetColumns:g}=o;window.name="table-design";const D=C([{label:"测试1",prop:"test1",type:"input"},{label:"测试2",prop:"test2",type:"select"},{label:"测试3",prop:"test3",type:"input"},{label:"测试4",prop:"test4",type:"select"},{label:"测试5",prop:"tes5",type:"input"},{label:"测试6",prop:"test6",type:"select"}]),v=C([{name:"新增",type:"add"},{name:"批量编辑",type:"edit"}]),a=()=>{},u=()=>{},f=()=>{window.open("/lowcode/table","quick-build")},S=I=>{i(I.id,t.value.columns)},Y=I=>{c(I.id,t.value.columns)};C([]);const q=C([]),Z=()=>{O.getSourceData(t.value.datasource.sourceId,t.value.datasource.tableName).then(I=>{const{code:n,data:k,msg:$}=I;n==200&&(q.value=k)})},E=C([]),ee=()=>{O.getTableInfo(t.value.datasource.sourceId).then(I=>{const{code:n,data:k,msg:$}=I;n==200&&(E.value=k)})},te=()=>{O.getColumnInfo(t.value.datasource.sourceId,t.value.datasource.tableName).then(I=>{const{code:n,data:k,msg:$}=I;n==200&&(t.value.columns=k.map(b=>({dataIndex:b.columnName,title:b.columnComment||b.columnName,id:b.columnName,width:200,type:"text",align:"left",fixed:"none"})),g(k.map(b=>({label:b.columnComment?`${b.columnComment}(${b.columnName})`:b.columnName,value:b.columnName}))))}),Z()};return(I,n)=>{const k=he,$=Ce,b=ye,B=xe,ne=we,oe=ge;return r(),y("div",Ue,[l(oe,{onBack:f,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:m(()=>[l(k,{value:e(t).name,"onUpdate:value":n[0]||(n[0]=s=>e(t).name=s),bordered:!1,class:"table-name"},null,8,["value"])]),extra:m(()=>[l(ne,{class:"extra"},{default:m(()=>[l(b,{label:"选择数据源"},{default:m(()=>[l($,{value:e(t).datasource.sourceId,"onUpdate:value":n[1]||(n[1]=s=>e(t).datasource.sourceId=s),options:d.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:n[2]||(n[2]=s=>ee())},null,8,["value","options"])]),_:1}),l(b,{label:"选择表名"},{default:m(()=>[l($,{value:e(t).datasource.tableName,"onUpdate:value":n[3]||(n[3]=s=>e(t).datasource.tableName=s),options:E.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:n[4]||(n[4]=s=>te())},null,8,["value","options"])]),_:1}),l(B,{onClick:n[5]||(n[5]=s=>u()),type:"primary",class:"save-btn"},{default:m(()=>[R(" 保存 ")]),_:1})]),_:1})]),_:1}),h("div",Me,[h("div",qe,[h("div",Ee,[h("div",He,[l(e(W),{list:D.value,"onUpdate:list":n[7]||(n[7]=s=>D.value=s),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:m(()=>[(r(!0),y(z,null,U(D.value,s=>(r(),y("div",{class:"widget-item",key:s.prop},[l(e(j),{class:"move-handle",style:{cursor:"pointer"}}),l(b,{label:s.label,name:s.prop},{default:m(()=>[s.type=="text"?(r(),P(k,{key:0})):(r(),P($,{key:1}))]),_:2},1032,["label","name"])]))),128)),h("div",We,[l(B,{type:"primary",onClick:n[6]||(n[6]=s=>a())},{default:m(()=>[R(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),h("div",je,[h("div",Ge,[l(e(W),{list:v.value,"onUpdate:list":n[9]||(n[9]=s=>v.value=s),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:m(()=>[(r(!0),y(z,null,U(v.value,s=>(r(),y("div",{class:"button-item",key:s.name},[l(B,null,{default:m(()=>[l(e(j),{class:"move-handle",style:{cursor:"pointer"}}),R(" "+T(s.name),1)]),_:2},1024)]))),128)),h("div",Qe,[l(B,{type:"primary",onClick:n[8]||(n[8]=s=>a())},{default:m(()=>[R(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),h("div",Je,[l(Le,{columns:e(t).columns,"onUpdate:columns":n[10]||(n[10]=s=>e(t).columns=s),tableData:q.value,height:300,onOnRemove:Y,onOnClick:S},null,8,["columns","tableData"])])]),h("div",Ke,[l(ze)])])])}}}),nt=X(Xe,[["__scopeId","data-v-dfd00ca2"]]);export{nt as default};
