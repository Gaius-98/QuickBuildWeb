import{d as k}from"./api-D3ji7G46.js";import{g as Ce,r as s,x as Ie,E as Ne,X as we,o as p,A as Q,l,w as u,K as c,n as C,i as v,b9 as Se,ba as Te,bb as qe,T as De,bc as $e,bd as Ve,be as Ue,a4 as ze,b3 as Oe,V as Le,D as Pe,ad as Be,ae as Ke,b1 as Me,$ as Ae,a0 as W,C as r,P as Re,N as Y,ap as je,bf as Ee,h as m,F as Fe,a1 as I,ah as Ge,e as Z,v as He,a2 as Xe,b5 as Je,a8 as Qe,aG as We,b2 as Ye,a6 as Ze,a7 as ea,am as aa,an as ta}from"./.pnpm-Bqj5ZitX.js";import{a as y}from"./api-CiGUpLO4.js";import{_ as la}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Dcam5Uk9.js";const na=g=>(aa("data-v-2346f626"),g=g(),ta(),g),oa={class:"dataset-design"},sa={class:"container"},ua={class:"left-part"},ia={class:"search-tree"},da=["title"],ca={style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},pa=na(()=>c("span",{class:"iconfont icon-table"},null,-1)),ra={style:{width:"36px"}},ma={class:"right-part"},va={class:"tools-area"},_a={class:"sql-area"},fa={class:"result"},ga=Ce({__name:"index",props:{type:{default:"add"},id:{},datasourceId:{},tableName:{}},setup(g){const U=s([]),z=s({}),O=s([]),ee=()=>{n.value.execSql=$e(n.value.execSql,{language:"mysql"})},n=s({datasetName:"",datasourceId:"",execSql:"",status:"1",paramsConfig:[]}),ae=g,N=s(!1),{type:w,id:L,datasourceId:P,tableName:B}=Ie(ae),S=()=>{k.getTableInfo(n.value.datasourceId).then(t=>{const{code:e,data:o,msg:i}=t;e==200&&(U.value=o)}),k.getSchema(n.value.datasourceId).then(t=>{const{code:e,data:o,msg:i}=t;e==200&&(z.value=o,O.value=[Ve({schema:z.value}),Ue])})};n.value.datasetName=n.value.datasetName||"未命名",P.value&&(n.value.datasourceId=P.value,S(),B.value&&(n.value.execSql=`select * from ${B.value}`)),w.value==="edit"&&L.value&&y.getDetail(L.value).then(t=>{const{code:e,data:o,msg:i}=t;e==200&&(n.value=o,S())});const te=Ne(()=>U.value.filter(t=>t.tableName.includes(T.value))),K=s([]),le=()=>{let t;w.value=="add"?t=y.add:w.value=="edit"&&(t=y.update),t(n.value).then(e=>{const{code:o,data:i,msg:f}=e;o==200&&Z.success("保存成功")})},T=s("");we(()=>{k.getList("").then(t=>{const{code:e,data:o}=t;e==200&&(K.value=o.data)})});const q=s(!1),M=s([]),D=s(!1),ne=s([{title:"字段名称",key:"columnName",dataIndex:"columnName",width:"200px"},{title:"字段类型",key:"columnType",dataIndex:"columnType",width:"200px"},{title:"字段注释",key:"columnComment",dataIndex:"columnComment",width:"200px"}]),A=s(""),oe=t=>{D.value=!0,A.value=t,k.getColumnInfo(n.value.datasourceId,t).then(e=>{const{code:o,data:i}=e;D.value=!1,o==200&&(M.value=i)}),q.value=!0},se=()=>{Z.success("复制成功")},x=s([]),R=s([]),ue=()=>{$.value="result",y.run(n.value).then(t=>{const{code:e,data:o,msg:i}=t;e==200&&(x.value=o,R.value=Object.keys(o[0]).map(f=>({title:f,key:f,dataIndex:f,ellipsis:!0,width:200})))})},ie=t=>{const{current:e,pageSize:o}=t;_.value.pageNumber=e,_.value.pageSize=o,F()},de=t=>{t==="history"&&F()},_=s({keyword:n.value.datasourceId,pageSize:10,pageNumber:1}),j=s([]),E=s(0),ce=s([{title:"执行sql",key:"execSql",dataIndex:"execSql",ellipsis:!0},{title:"耗时",key:"executionTime",dataIndex:"executionTime"},{title:"执行结果",key:"status",dataIndex:"status"}]),F=()=>{_.value.keyword=n.value.datasourceId,y.getLogList(_.value).then(t=>{const{code:e,data:o,msg:i}=t;e==200&&(j.value=o.data,E.value=o.total)})},$=s("result"),pe=()=>{N.value=!0},re=s([{title:"参数名",key:"paramsName",dataIndex:"paramsName"},{title:"参数类型",key:"paramsType",dataIndex:"paramsType"},{title:"参数默认值",key:"paramsDefaultValue",dataIndex:"paramsDefaultValue"},{title:"操作",key:"action",dataIndex:"action"}]),me=()=>{let t=He();n.value.paramsConfig.push({id:t,paramsDefaultValue:"",paramsType:"string",paramsName:""})},ve=t=>{let e=n.value.paramsConfig.findIndex(o=>o.id==t.id);n.value.paramsConfig.splice(e,1)};return(t,e)=>{const o=Xe,i=ze,f=Je,_e=Oe,G=Le,V=Pe,fe=Be,ge=Ke,b=Qe,ye=We,H=Ye,X=Ze,xe=Me,J=Ae,be=ea,he=W("copy"),ke=W("has-perm");return p(),Q("div",oa,[l(_e,{style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"},onBack:()=>null},{title:u(()=>[l(o,{value:n.value.datasetName,"onUpdate:value":e[0]||(e[0]=a=>n.value.datasetName=a),bordered:!1,class:"dataset-name"},null,8,["value"])]),extra:u(()=>[l(f,null,{default:u(()=>[l(i,{onClick:e[1]||(e[1]=a=>le()),type:"primary",class:"save-btn"},{default:u(()=>[r(" 保存 ")]),_:1})]),_:1})]),_:1}),c("div",sa,[c("div",ua,[c("div",ia,[l(G,{value:n.value.datasourceId,"onUpdate:value":e[2]||(e[2]=a=>n.value.datasourceId=a),options:K.value,fieldNames:{label:"datasourceName",value:"id"},style:{width:"100%"},onChange:e[3]||(e[3]=a=>S())},null,8,["value","options"]),l(V,{style:{margin:"8px 0"}}),l(fe,{value:T.value,"onUpdate:value":e[4]||(e[4]=a=>T.value=a),style:{"margin-bottom":"8px"},placeholder:"请输入表名称",allowClear:""},null,8,["value"]),l(ge,{"tree-data":te.value,selectable:"",fieldNames:{title:"tableName",key:"tableName",children:"children"},style:{height:"calc(100%)","overflow-y":"auto"}},{title:u(a=>[c("div",{style:{width:"200px",display:"flex","justify-content":"space-between"},title:a.tableName},[c("span",ca,[pa,r(" "+Re(a.tableName),1)]),c("span",ra,[Y(l(v(je),{title:"复制表名",style:{cursor:"pointer","margin-right":"5px"},onClick:e[5]||(e[5]=d=>se())},null,512),[[he,a.tableName]]),l(v(Ee),{title:"查看字段信息",style:{cursor:"pointer"},onClick:d=>oe(a.tableName)},null,8,["onClick"])])],8,da)]),_:1},8,["tree-data"])])]),c("div",ma,[c("div",va,[l(i,{onClick:e[6]||(e[6]=a=>ue()),type:"text",icon:C(v(Se))},{default:u(()=>[r("运行")]),_:1},8,["icon"]),l(V,{type:"vertical"}),l(i,{onClick:e[7]||(e[7]=a=>ee()),type:"text",icon:C(v(Te))},{default:u(()=>[r("美化")]),_:1},8,["icon"]),l(V,{type:"vertical"}),l(i,{onClick:e[8]||(e[8]=a=>pe()),type:"text",icon:C(v(qe))},{default:u(()=>[r("参数")]),_:1},8,["icon"])]),c("div",_a,[l(v(De),{style:{height:"350px"},"indent-with-tab":!0,"tab-size":2,extensions:O.value,modelValue:n.value.execSql,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.execSql=a)},null,8,["extensions","modelValue"])]),c("div",fa,[l(xe,{activeKey:$.value,"onUpdate:activeKey":e[10]||(e[10]=a=>$.value=a),onChange:de},{default:u(()=>[l(H,{key:"result",tab:"执行结果"},{default:u(()=>[x.value&&x.value.length>0?(p(),m(b,{key:0,style:{width:"100%"},size:"small",scroll:{x:"max-content",y:"280px"},"data-source":x.value,columns:R.value},null,8,["data-source","columns"])):(p(),m(ye,{key:1}))]),_:1}),l(H,{key:"history",tab:"历史记录"},{default:u(()=>[l(b,{scroll:{y:"280px"},size:"small","data-source":j.value,columns:ce.value,onChange:ie,pagination:{current:_.value.pageNumber,total:E.value,showSizeChanger:!1,pageSize:_.value.pageSize}},{bodyCell:u(({column:a,record:d})=>[a.key=="status"?(p(),Q(Fe,{key:0},[d.status=="1"?(p(),m(X,{key:0,color:"#87d068"},{default:u(()=>[r("成功")]),_:1})):(p(),m(X,{key:1,color:"#f50"},{default:u(()=>[r("失败")]),_:1}))],64)):I("",!0)]),_:1},8,["data-source","columns","pagination"])]),_:1})]),_:1},8,["activeKey"])])])]),l(J,{width:"600px",title:`${A.value}字段明细`,footer:null,open:q.value,"onUpdate:open":e[11]||(e[11]=a=>q.value=a)},{default:u(()=>[l(b,{size:"small",class:"ant-table-striped","data-source":M.value,columns:ne.value,loading:D.value,"row-class-name":(a,d)=>d%2===1?"table-striped":null,pagination:!1,scroll:{x:"auto",y:"500px"}},null,8,["data-source","columns","loading","row-class-name"])]),_:1},8,["title","open"]),l(J,{title:"参数配置",open:N.value,"onUpdate:open":e[13]||(e[13]=a=>N.value=a),width:"800px",height:"400px",footer:null},{default:u(()=>[l(i,{type:"primary",style:{"margin-bottom":"5px"},onClick:e[12]||(e[12]=a=>me()),icon:C(v(Ge))},{default:u(()=>[r("新增")]),_:1},8,["icon"]),l(b,{columns:re.value,"data-source":n.value.paramsConfig,scroll:{y:"300px"},pagination:!1},{bodyCell:u(({column:a,record:d})=>[["paramsName","paramsDefaultValue"].includes(a.key)?(p(),m(o,{key:0,value:d[a.dataIndex],"onUpdate:value":h=>d[a.dataIndex]=h},null,8,["value","onUpdate:value"])):I("",!0),a.key=="paramsType"?(p(),m(G,{key:1,style:{width:"100%"},value:d[a.dataIndex],"onUpdate:value":h=>d[a.dataIndex]=h,options:[{label:"字符串",value:"string"}]},null,8,["value","onUpdate:value"])):I("",!0),a.key=="action"?(p(),m(be,{key:2,title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:h=>ve(d)},{default:u(()=>[Y((p(),m(i,{type:"link",danger:""},{default:u(()=>[r("删除")]),_:1})),[[ke,"system:user:remove"]])]),_:2},1032,["onConfirm"])):I("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open"])])}}}),Ca=la(ga,[["__scopeId","data-v-2346f626"]]);export{Ca as default};
