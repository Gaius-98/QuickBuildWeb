import{a as ue}from"./table-D5kn2S4T.js";import{g as de,v as xe,r as s,D as G,e as V,P as _e,o,y as g,h as _,w as a,l as t,F as P,K as Z,B as y,V as I,L as ee,aD as Ie,R as ce,n as re,az as pe,W as me,N as $e,aE as Ne,X as ve,ap as fe,Y as ye,aq as ge,$ as ke,Q as he,a9 as Ce,a2 as be,ar as De,O as Se,H as Te,T as Fe,J as Le,i as H,aw as ze,ax as Oe,ay as Ee,U as Ue,aj as Ve,aA as Pe,a1 as Be,aB as Re,a0 as Ae,C as qe,aC as Me}from"./.pnpm-BrZBTk42.js";import{c as U}from"./index-Fwjej_wc.js";import{_ as We}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BjbKCXT0.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-DKbmLR5J.js";const je={class:"low-code-table"},He={key:0,class:"tools"},Je=["href"],Ke=de({__name:"LowCodeTable",props:{id:{default:""}},setup(le){const J=le,{id:K}=xe(J);s();const m=s(),C=s(),$=s(),B=s(),b=s(),te=G(()=>{var n;return(n=C.value)==null?void 0:n.showPagination}),ae=G(()=>{var n;return((n=C.value)==null?void 0:n.showFilter)&&m.value&&m.value.length>0}),L=G(()=>{var l;const n=(l=$.value)==null?void 0:l.filter(e=>e.position=="header");return n&&n.length>0}),ne=G(()=>{var l;const n=(l=$.value)==null?void 0:l.filter(e=>e.position=="row");return n&&n.length>0});if(K.value)U.getLowCodeTableDetail(K.value).then(n=>{const{code:l,data:e,msg:p}=n;l==200?(m.value=e.filter,A(m.value),d(m.value),C.value=e.global,$.value=e.action,B.value=r(e.columns),b.value=e.dataSource,v()):V.error(p)});else throw new Error("id is required");const x=s(!1),Q=s([]),c=s({pageNumber:1,pageSize:10}),R=s(),z=s(0),A=n=>{n.forEach(l=>{l.defaultValue&&(c.value[l.field]=l.defaultValue)})},q=s({}),d=n=>{const l=n.filter(e=>{if(e.type=="select")return e}).map(e=>e.dict);l.length>0&&U.getDict(l).then(e=>{const{code:p,data:T,msg:N}=e;p==200?q.value=T:V.error(N)})},r=n=>{const l=n.map(e=>({title:e.title,key:e.id,dataIndex:e.dataIndex,width:e.width,align:e.align,fixed:e.fixed,type:e.type}));return ne.value&&l.push({title:"操作",key:"_action_",dataIndex:"_action_",width:250,fixed:"right"}),l},v=()=>{x.value=!0,U.getLowCodeTableList({sourceId:b.value.sourceId,tableName:b.value.tableName,pageNumber:c.value.pageNumber,pageSize:c.value.pageSize,paramsData:c.value}).then(n=>{const{code:l,data:e,msg:p}=n;x.value=!1,l==200?(Q.value=e.data,z.value=e.total):V.error(p)})},oe=()=>{var n;(n=R.value)==null||n.resetFields(),v()},X=n=>{const{current:l,pageSize:e}=n;c.value.pageNumber=l,c.value.pageSize=e,v()},f=s({}),M=()=>{f.value={}},Y=(n,l)=>{const{customEvent:e,builtInEvents:p,eventFlowId:T,formId:N}=n;if(l&&(f.value=Ie(l)),!e){if(["add","edit"].includes(p)){let D=p=="add"?U.insertLowCodeTable:U.updateLowCodeTable;ce.confirm({title:p=="add"?"新增":"编辑",content:re(We,{id:N,formData:f.value}),onOk(){D({sourceId:b.value.sourceId,tableName:b.value.tableName,data:f.value}).then(w=>{const{code:F,data:O,msg:W}=w;M(),F==200&&(V.success(O),v())})},onCancel(){M()}})}p=="delete"&&ce.confirm({title:"您确定要删除该数据吗?",icon:re(pe),content:"该操作无法还原！",onOk(){U.removeLowCodeTable({sourceId:b.value.sourceId,tableName:b.value.tableName,data:f.value}).then(D=>{const{code:w,data:F,msg:O}=D;M(),w==200&&(V.success(F),v())})},onCancel(){}})}};return _e(()=>{}),(n,l)=>{const e=me,p=$e,T=Ne,N=ve,D=fe,w=ye,F=ge,O=ke,W=he,i=Ce,k=be;return o(),g("div",je,[ae.value?(o(),_(W,{key:0,class:"search-area"},{default:a(()=>[t(O,{ref_key:"searchFormRef",ref:R,model:c.value,onFinish:v},{default:a(()=>[t(F,{gutter:24},{default:a(()=>[(o(!0),g(P,null,Z(m.value,u=>(o(),_(D,{span:6,key:u.id},{default:a(()=>[t(N,{label:u.label,name:u.field},{default:a(()=>[u.type=="input"?(o(),_(e,{key:0,allowClear:!0,value:c.value[u.field],"onUpdate:value":S=>c.value[u.field]=S},null,8,["value","onUpdate:value"])):u.type=="select"?(o(),_(p,{key:1,value:c.value[u.field],"onUpdate:value":S=>c.value[u.field]=S,options:q.value[u.dict],allowClear:!0},null,8,["value","onUpdate:value","options"])):(o(),_(T,{key:2,value:c.value[u.field],"onUpdate:value":S=>c.value[u.field]=S},null,8,["value","onUpdate:value"]))]),_:2},1032,["label","name"])]),_:2},1024))),128)),t(D,{span:6,style:{"text-align":"right"}},{default:a(()=>[t(w,{type:"primary","html-type":"submit"},{default:a(()=>[y("搜索")]),_:1}),t(w,{style:{margin:"0 8px"},onClick:oe},{default:a(()=>[y(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})):I("",!0),t(W,null,{default:a(()=>{var u,S,se;return[L.value?(o(),g("div",He,[(o(!0),g(P,null,Z((u=$.value)==null?void 0:u.filter(h=>h.position=="header"),h=>(o(),_(w,{key:h.id,onClick:j=>Y(h)},{default:a(()=>[y(ee(h.name),1)]),_:2},1032,["onClick"]))),128))])):I("",!0),t(k,{loading:x.value,columns:B.value,"data-source":Q.value,scroll:{y:500},onChange:X,pagination:te.value&&{current:c.value.pageNumber,total:z.value,showSizeChanger:!0,pageSize:c.value.pageSize},bordered:(S=C.value)==null?void 0:S.showBordered,size:(se=C.value)==null?void 0:se.size},{bodyCell:a(({column:h,record:j})=>{var ie;return[h.type==="image"?(o(),_(i,{key:0,src:j[h.dataIndex]},null,8,["src"])):I("",!0),h.type==="link"?(o(),g("a",{key:1,href:j[h.dataIndex]},ee(j[h.dataIndex]),9,Je)):I("",!0),h.key=="_action_"?(o(!0),g(P,{key:2},Z((ie=$.value)==null?void 0:ie.filter(E=>E.position=="row"),E=>(o(),_(w,{type:"link",key:E.id,onClick:at=>Y(E,j),danger:E.builtInEvents==="delete"},{default:a(()=>[y(ee(E.name),1)]),_:2},1032,["onClick","danger"]))),128)):I("",!0)]}),_:1},8,["loading","columns","data-source","pagination","bordered","size"])]}),_:1})])}}}),Qe=we(Ke,[["__scopeId","data-v-884ebc0f"]]),Xe={class:"lowcode-table"},Ye={class:"tools"},Ge={key:1},Ze={key:0,class:"contain"},et={key:0},tt=de({__name:"TableList",setup(le){const J=De(),K=s([{title:"列表id",key:"id",dataIndex:"id",ellipsis:!0},{title:"列表名称",key:"name",dataIndex:"name"},{title:"状态",key:"status",dataIndex:"status",width:100},{title:"备注",key:"remark",dataIndex:"remark",ellipsis:!0},{title:"创建时间",key:"createTime",dataIndex:"createTime"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),m=Se({keyword:"",pageNumber:1,pageSize:10}),C=s([]),$=s(0),B=s(!1),b=s(),te=()=>{var d;(d=b.value)==null||d.resetFields(),x()},ae=()=>{V.success("复制成功！")},L=s("table"),ne=()=>{L.value=="table"?L.value="visual":L.value="table"},x=()=>{B.value=!0,ue.getList(m).then(d=>{const{code:r,data:v}=d;r==200&&(C.value=v.data,$.value=v.total),B.value=!1})},Q=()=>{const d=J.resolve({path:"/design/table"});window.open(d.href,"_blank")},c=d=>{const r=J.resolve({path:"/design/table",query:{id:d}});window.open(r.href,"_blank")},R=d=>{ue.remove(d).then(r=>{const{code:v}=r;v==200&&x()})},z=s(!1);s({});const A=s(""),q=d=>{z.value=!0,A.value=d};return _e(()=>{x()}),(d,r)=>{const v=me,oe=ve,X=fe,f=ye,M=ge,Y=ke,n=he,l=Pe,e=Be,p=Re,T=Ae,N=qe,D=Ce,w=be,F=Me,O=Te,W=Fe("copy");return o(),g("div",Xe,[t(n,{class:"search-area"},{default:a(()=>[t(Y,{ref_key:"searchFormRef",ref:b,model:m,onFinish:x},{default:a(()=>[t(M,{gutter:24},{default:a(()=>[t(X,{span:4},{default:a(()=>[t(oe,{label:"列表名称",name:"keyword"},{default:a(()=>[t(v,{value:m.keyword,"onUpdate:value":r[0]||(r[0]=i=>m.keyword=i)},null,8,["value"])]),_:1})]),_:1}),t(X,{span:4,style:{"text-align":"right"}},{default:a(()=>[t(f,{type:"primary","html-type":"submit"},{default:a(()=>[y("搜索")]),_:1}),t(f,{style:{margin:"0 8px"},onClick:te},{default:a(()=>[y(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(n,null,{default:a(()=>[Le("div",Ye,[t(f,{type:"primary",onClick:Q},{default:a(()=>[y("新增")]),_:1}),t(f,{onClick:ne,type:"link",style:{float:"right"}},{default:a(()=>[t(H(ze))]),_:1})]),C.value.length===0?(o(),_(l,{key:0})):(o(),g("div",Ge,[L.value=="visual"?(o(),g("div",Ze,[(o(!0),g(P,null,Z(C.value,i=>(o(),_(n,{hoverable:!0,key:i.id},{actions:a(()=>[t(H(Oe),{key:"view",title:"预览",onClick:k=>q(i.id)},null,8,["onClick"]),t(H(Ee),{key:"edit",title:"编辑",onClick:k=>c(i.id)},null,8,["onClick"]),t(e,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:k=>R(i.id)},{default:a(()=>[t(H(pe),{key:"delete",title:"删除"})]),_:2},1032,["onConfirm"])]),default:a(()=>[t(p,{title:i.name,description:i.description},null,8,["title","description"])]),_:2},1024))),128))])):(o(),_(w,{key:1,columns:K.value,"data-source":C.value,pagination:!1,scroll:{y:470}},{bodyCell:a(({column:i,record:k})=>[i.key=="id"?Ue((o(),g("span",et,[y(ee(k.id)+" ",1),t(H(Ve),{style:{cursor:"pointer"},onClick:r[1]||(r[1]=u=>ae())})])),[[W,k.id]]):I("",!0),i.key=="status"?(o(),g(P,{key:1},[k.status?(o(),_(T,{key:0,color:"#87d068"},{default:a(()=>[y("启用")]),_:1})):(o(),_(T,{key:1,color:"#f50"},{default:a(()=>[y("停用")]),_:1}))],64)):I("",!0),i.key=="action"?(o(),g(P,{key:2},[t(f,{type:"link",onClick:u=>q(k.id)},{default:a(()=>[y("预览")]),_:2},1032,["onClick"]),t(N,{type:"vertical"}),t(f,{type:"link",onClick:u=>c(k.id)},{default:a(()=>[y("编辑")]),_:2},1032,["onClick"]),t(N,{type:"vertical"}),t(e,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:u=>R(k.id)},{default:a(()=>[t(f,{type:"link",danger:""},{default:a(()=>[y("删除")]),_:1})]),_:2},1032,["onConfirm"])],64)):I("",!0),i.key=="img"?(o(),_(D,{key:3,src:k.img,height:"100px",width:"100%"},null,8,["src"])):I("",!0)]),_:1},8,["columns","data-source"]))])),t(F,{style:{display:"flex","justify-content":"flex-end"},current:m.pageNumber,"onUpdate:current":r[2]||(r[2]=i=>m.pageNumber=i),total:$.value,"show-less-items":"",onChange:r[3]||(r[3]=i=>x())},null,8,["current","total"])]),_:1}),t(O,{open:z.value,"onUpdate:open":r[4]||(r[4]=i=>z.value=i),placement:"right",title:"预览",width:"1920px",height:"900px",footer:null},{default:a(()=>[(o(),_(Qe,{id:A.value,key:A.value},null,8,["id"]))]),_:1},8,["open"])])}}}),ct=we(tt,[["__scopeId","data-v-2643fd94"]]);export{ct as default};
