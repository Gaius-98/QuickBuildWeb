import{_ as ve}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-Byu1D2xN.js";import{c as _e}from"./componentsSchema-LhIlCAWr.js";import{k as fe,r as y,Q as te,a as ae,t as A,d as J,s as Q,E as ne,p as R,q as w,v as _,e,P as V,X as O,O as I,u as D,ak as B,a2 as se,w as l,m as ge,G as be,H as le,a3 as X,a4 as K,a5 as ie,bh as H,U as Y,b5 as ue,ap as de,aq as re,o as f,b1 as ye,b2 as he,c as T,a8 as Ce,aG as xe,W as pe,D as Se,a6 as we,ae as ke,b3 as De}from"./.pnpm-CaFG0eUE.js";import{d as F}from"./dashboard-WQxXkRuf.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ue}from"./ConfigForm.vue_vue_type_script_setup_true_lang-CQPMAqMG.js";import{S as Ne}from"./SchemaForm-BF6fa91O.js";import{c as G}from"./iconfont-5d80JBh_.js";import"./tools-BCD5ohFr.js";/* empty css                   */const ee=fe("dashboardDesign",()=>{const p=y([]),U=t=>{p.value.push(t)},S=te(()=>{const t={};return p.value.map(g=>{g.children.forEach(b=>{t[b.componentName]=b.schema})}),t}),N=te(()=>{let t=[];return p.value.forEach(g=>{const b=g.children.map(x=>({label:x.componentName,value:x.exportName}));t=t.concat(b)}),t}),c=y({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),n=async()=>{const t=document.querySelector(".standalone-iframe");return await new Promise((x,q)=>{t.addEventListener("load",()=>{x(t.contentWindow)})})},r=y({list:[],customModules:[],varPools:{datasets:[],vars:[]},img:"",name:"未命名仪表板",id:""}),C=y(!1);return{customModules:p,customCompSchema:S,onAddModules:U,customComps:N,varPools:c,getContentWindow:n,onSave:t=>{r.value.list=t.list,r.value.img=t.img,r.value.customModules=p.value,r.value.varPools=c.value;const g=r.value.id?F.update:F.add;r.value.id||delete r.value.id,C.value=!0,g(r.value).then(b=>{const{code:x,data:q,msg:m}=b;C.value=!1,x==200?ae.success("保存成功"):ae.error("保存失败")})},dgInfo:r,getDetail:t=>{C.value=!0,F.getDetail(t).then(g=>{const{code:b,data:x,msg:q}=g;if(b==200){r.value=x;const{customModules:m,varPools:v}=r.value;p.value=m,c.value=v,setTimeout(()=>{n().then(h=>{h.postMessage({type:"refresh-all",data:A(r.value.list)}),C.value=!1})})}})},loading:C}}),ce=p=>(de("data-v-88293ef5"),p=p(),re(),p),Me={class:"material-area"},qe={class:"material-layout-area"},Ie=ce(()=>_("div",{class:"title"},"内置组件",-1)),$e={class:"content"},Pe=["data-material"],Ee={class:"material-label"},Le={class:"material-data-area"},Ve=ce(()=>_("div",{class:"title"},"自定义组件",-1)),We={class:"content"},Oe=["data-material"],Te={style:{height:"650px"}},Be={style:{height:"80px","overflow-y":"auto"}},Re={style:{height:"200px","overflow-y":"auto"}},Ae=J({__name:"MaterialArea",setup(p){const U=ee(),{customModules:S,customComps:N}=Q(U),{onAddModules:c}=U,n=y({internalComp:_e,customComp:[]}),r=i=>{var u,s;const a=i.target;(u=i.dataTransfer)==null||u.setData("material",a.dataset.material),(s=i.dataTransfer)==null||s.setData("material-type",a.dataset.materialType)},C=y(!1),M=()=>{C.value=!0,t.value=ge($.value)},$=y({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElEmpty",exportName:"ElEmpty",id:"1",schema:`{
    "description": {
        "type": "input",
        "label": "描述"
    }

      }`}]}),t=y({}),g=()=>{C.value=!1},b=()=>{c(t.value),g()};ne(()=>S.value,()=>{n.value.customComp=n.value.customComp.concat(N.value),h==null||h.postMessage({type:"add-custom-comp",data:A(t.value)})},{deep:!0});const x=()=>{t.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},q=i=>{const a=t.value.children.findIndex(u=>u.id==i.id);a!=-1&&t.value.children.splice(a,1)},m=()=>{t.value.urls.push("")},v=i=>{const a=t.value.urls.findIndex(u=>u==i);a!=-1&&t.value.urls.splice(a,1)};let h=null;return R(()=>{h=document.querySelector(".standalone-iframe").contentWindow}),(i,a)=>{const u=ie,s=K,P=Y,E=ue,k=ve,j=X,z=se;return f(),w("div",Me,[_("div",qe,[Ie,_("div",$e,[(f(!0),w(V,null,O(n.value.internalComp,o=>(f(),w("div",{key:o.name,draggable:"true",onDragstart:r,"data-material":o.name,"data-material-type":"internal",class:"material-item"},[_("span",{class:be(["iconfont material-icon",o.icon])},null,2),_("span",Ee,le(o.label),1)],40,Pe))),128))])]),_("div",Le,[Ve,_("div",We,[(f(!0),w(V,null,O(n.value.customComp,o=>(f(),w("div",{type:"dashed",key:o.value,draggable:"true",onDragstart:r,"data-material":o.value,"data-material-type":"custom",class:"material-item"},le(o.label),41,Oe))),128)),_("div",{type:"dashed",onClick:M,class:"material-item"},[_("span",null,[e(D(B)),I(" 添加组件 ")])])])]),e(z,{title:"添加自定义组件",width:"800px",open:C.value,"onUpdate:open":a[4]||(a[4]=o=>C.value=o),onOk:b,onCancel:g},{default:l(()=>[_("div",Te,[e(j,{model:t.value,"label-col":{style:{width:"150px"}}},{default:l(()=>[e(s,{label:"名称"},{default:l(()=>[e(u,{value:t.value.title,"onUpdate:value":a[0]||(a[0]=o=>t.value.title=o)},null,8,["value"])]),_:1}),e(s,{label:"组件库名称"},{default:l(()=>[e(u,{value:t.value.package,"onUpdate:value":a[1]||(a[1]=o=>t.value.package=o)},null,8,["value"])]),_:1}),e(s,{label:"版本"},{default:l(()=>[e(u,{value:t.value.version,"onUpdate:value":a[2]||(a[2]=o=>t.value.version=o)},null,8,["value"])]),_:1}),e(s,{label:"导出名称"},{default:l(()=>[e(u,{value:t.value.exportName,"onUpdate:value":a[3]||(a[3]=o=>t.value.exportName=o)},null,8,["value"])]),_:1}),e(s,{label:"CDN地址"},{default:l(()=>[_("div",Be,[(f(!0),w(V,null,O(t.value.urls,(o,W)=>(f(),w("div",{key:o,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(u,{value:t.value.urls[W],"onUpdate:value":d=>t.value.urls[W]=d},null,8,["value","onUpdate:value"]),e(D(H),{onClick:d=>v(o),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(s,null,{default:l(()=>[e(P,{type:"dashed",block:"",onClick:m},{default:l(()=>[e(D(B)),I(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(s,{label:"子组件"},{default:l(()=>[_("div",Re,[(f(!0),w(V,null,O(t.value.children,(o,W)=>(f(),w("div",{key:o.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(E,null,{default:l(()=>[_("div",null,[e(E,null,{default:l(()=>[e(s,{label:"组件名",rules:{required:!0}},{default:l(()=>[e(u,{value:o.componentName,"onUpdate:value":d=>o.componentName=d},null,8,["value","onUpdate:value"])]),_:2},1024),e(s,{label:"导出名称",rules:{required:!0}},{default:l(()=>[e(u,{value:o.exportName,"onUpdate:value":d=>o.exportName=d},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(s,{label:"配置Schema",rules:{required:!0}},{default:l(()=>[e(k,{value:o.schema,"onUpdate:value":d=>o.schema=d,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(D(H),{onClick:d=>q(o)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(s,null,{default:l(()=>[e(P,{type:"dashed",block:"",onClick:x},{default:l(()=>[e(D(B)),I(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),je=Z(Ae,[["__scopeId","data-v-88293ef5"]]),ze={text:{type:"input",label:"文本内容"}},Fe={src:{type:"input",label:"图片地址"}},Ge={src:{type:"input",label:"页面地址"}},He=p=>({dataset:{type:"select",label:"数据集",options:p},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),Je={"qb-text":ze,"qb-image":Fe,"qb-iframe":Ge,"qb-chart":He},Qe={title1:{type:"divider",label:"标题",component:{title:"标题"},formLayout:!1},"option.title.show":{type:"switch",label:"显示标题"},"option.title.text":{type:"string",label:"标题文本"},"option.title.link":{type:"string",label:"文本超链接"},title2:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},"option.grid.left":{type:"string",label:"左边距"},"option.grid.right":{type:"string",label:"右边距"},"option.grid.top":{type:"string",label:"上边距"},"option.grid.bottom":{type:"string",label:"下边距"},title3:{type:"divider",label:"图例",component:{title:"图例"},formLayout:!1},"option.legend.show":{type:"switch",label:"显示图例"},"option.legend.type":{type:"select",label:"图例类型",component:{dataSource:[{label:"普通图例",value:"plain"},{label:"翻页图例",value:"scroll"}]}},"option.legend.orient":{type:"select",label:"图例朝向",component:{dataSource:[{value:"horizontal",label:"横向"},{value:"vertical",label:"纵向"}]}},title4:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},oe={title1:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},paddingLeft:{type:"string",label:"左边距",tooltip:"请注明单位，一般为：px"},paddingTop:{type:"string",label:"上边距",tooltip:"请注明单位，一般为：px"},paddingRight:{type:"string",label:"右边距",tooltip:"请注明单位，一般为：px"},paddingBottom:{type:"string",label:"下边距",tooltip:"请注明单位，一般为：px"},title2:{type:"divider",label:"背景",component:{title:"背景"},formLayout:!1},backgroundColor:{type:"string",label:"背景色",component:{name:"color-picker"}},title3:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},Xe={class:"material-cfg"},Ke={class:"material-cfg-btn"},Ye=J({__name:"MaterialCfg",setup(p){const U=ee(),{customCompSchema:S}=Q(U),{getContentWindow:N}=U,c=y({}),n=y({}),r=y({}),C=y({}),M=y({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"100px"}}},properties:oe}),$=y([]);G.getDatasetDict().then(m=>{const{code:v,data:h,msg:i}=m;v==200&&($.value=h)});const t=y([]),g=()=>{c.value.dimension=[],c.value.target=[],G.getFieldByDatasetId(c.value.dataset).then(m=>{const{code:v,data:h,msg:i}=m;v==200&&(t.value=h.map(a=>({value:a,label:a})))})};window.addEventListener("message",m=>{var v;(m.data.type==="select"||m.data.type==="update-item")&&(M.value.properties=oe,n.value=m.data.data,((v=n.value)==null?void 0:v.type)==="custom"?S.value&&(r.value=JSON.parse(S.value[n.value.component])):n.value.component=="qb-chart"?M.value.properties=Qe:r.value=Je[n.value.component],c.value=n.value.props,n.value.component=="qb-chart"&&G.getFieldByDatasetId(c.value.dataset).then(h=>{const{code:i,data:a,msg:u}=h;i==200&&(t.value=a.map(s=>({value:s,label:s})))}),C.value=n.value.style)});let b=null;const x=m=>{if(b)b.postMessage({type:"refresh",data:m});else throw new Error("contentWindow is null")},q=()=>{x(A(n.value))};return R(()=>{N().then(m=>{b=m})}),(m,v)=>{const h=xe,i=pe,a=K,u=X,s=he,P=ye,E=Y;return f(),w("div",Xe,[e(P,{size:"small"},{default:l(()=>[e(s,{key:"prop",tab:"属性"},{default:l(()=>[n.value.id?n.value.component!="qb-chart"?(f(),T(Ue,{class:"material-cfg-contain",key:n.value.id,data:c.value,schema:r.value},null,8,["data","schema"])):n.value.component=="qb-chart"?(f(),T(u,{key:2},{default:l(()=>[e(a,{label:"数据集"},{default:l(()=>[e(i,{value:c.value.dataset,"onUpdate:value":v[0]||(v[0]=k=>c.value.dataset=k),options:$.value,onChange:g},null,8,["value","options"])]),_:1}),e(a,{label:"维度"},{default:l(()=>[e(i,{value:c.value.dimension,"onUpdate:value":v[1]||(v[1]=k=>c.value.dimension=k),options:t.value,mode:"tags"},null,8,["value","options"])]),_:1}),e(a,{label:"指标"},{default:l(()=>[e(i,{value:c.value.target,"onUpdate:value":v[2]||(v[2]=k=>c.value.target=k),options:t.value,mode:"tags"},null,8,["value","options"])]),_:1})]),_:1})):Ce("",!0):(f(),T(h,{key:0}))]),_:1}),e(s,{key:"style",tab:"样式"},{default:l(()=>[(f(),T(D(Ne),{schema:M.value,size:"small",formData:C.value,key:n.value.id},null,8,["schema","formData"]))]),_:1})]),_:1}),_("div",Ke,[e(E,{onClick:q,disabled:!n.value.id},{default:l(()=>[I("刷新")]),_:1},8,["disabled"])])])}}}),Ze=Z(Ye,[["__scopeId","data-v-c3e45bd1"]]),et=p=>(de("data-v-54d79889"),p=p(),re(),p),tt={class:"dg-design"},at={class:"dg-design-container"},lt=et(()=>_("div",{class:"middle-part"},[_("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),ot={style:{height:"300px","overflow-y":"auto"}},nt=J({__name:"DashboardDesign",props:{id:{}},setup(p){const U=ee(),{varPools:S,dgInfo:N,loading:c}=Q(U);let n;const{getContentWindow:r,onSave:C,getDetail:M}=U;window.name="dg-design";const $=p,{id:t}=Se($);R(()=>{t.value&&M(t.value)});const g=y(!1),b=()=>{g.value=!0},x=()=>{n.postMessage({type:"get-dg"})};R(()=>{r().then(i=>{n=i})});const q=()=>{n.postMessage({type:"refresh-var",data:A(S.value)})};ne(()=>S.value,()=>{q()},{deep:!0});const m=()=>{S.value.vars.push({name:"",type:"",defaultValue:""})},v=y([{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔",value:"boolean"},{label:"数组",value:"array"},{label:"对象",value:"object"}]),h=i=>{const a=S.value.vars.findIndex(u=>u.name===i.name);a!=-1&&S.value.vars.splice(a,1)};return window.addEventListener("message",i=>{i.data.type==="save"&&C(i.data.data)}),(i,a)=>{const u=ie,s=Y,P=ue,E=De,k=K,j=pe,z=X,o=se,W=ke("loading");return f(),w(V,null,[we((f(),w("div",tt,[e(E,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:l(()=>[e(u,{bordered:!1,class:"form-name",value:D(N).name,"onUpdate:value":a[0]||(a[0]=d=>D(N).name=d)},null,8,["value"])]),extra:l(()=>[e(P,null,{default:l(()=>[e(s,{type:"primary",onClick:a[1]||(a[1]=d=>b())},{default:l(()=>[I("变量池")]),_:1}),e(s,{class:"preview-btn"},{default:l(()=>[I(" 预览 ")]),_:1}),e(s,{onClick:a[2]||(a[2]=d=>x()),type:"primary",class:"save-btn"},{default:l(()=>[I(" 保存 ")]),_:1})]),_:1})]),_:1}),_("div",at,[e(je,{class:"left-part"}),lt,e(Ze,{class:"right-part"})])])),[[W,D(c),void 0,{fullscreen:!0}]]),e(o,{title:"变量池",open:g.value,"onUpdate:open":a[3]||(a[3]=d=>g.value=d),width:"800px",footer:null},{default:l(()=>[e(z,null,{default:l(()=>[_("div",ot,[(f(!0),w(V,null,O(D(S).vars,(d,me)=>(f(),T(P,{key:me,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:l(()=>[e(k,{label:"变量名",required:!0},{default:l(()=>[e(u,{value:d.name,"onUpdate:value":L=>d.name=L},null,8,["value","onUpdate:value"])]),_:2},1024),e(k,{label:"变量类型",required:!0},{default:l(()=>[e(j,{style:{width:"150px"},value:d.type,"onUpdate:value":L=>d.type=L,options:v.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(k,{label:"默认值",required:!0},{default:l(()=>[e(u,{value:d.defaultValue,"onUpdate:value":L=>d.defaultValue=L},null,8,["value","onUpdate:value"])]),_:2},1024),e(D(H),{onClick:L=>h(d)},null,8,["onClick"])]),_:2},1024))),128))]),e(k,null,{default:l(()=>[e(s,{type:"dashed",block:"",onClick:m},{default:l(()=>[e(D(B)),I(" 添加变量 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),ft=Z(nt,[["__scopeId","data-v-54d79889"]]);export{ft as default};
