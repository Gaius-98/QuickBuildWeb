import{b3 as Oe,f as Ue,r as _,aO as ze,g as A,s as M,v as W,o as d,y as w,l as t,i as l,aw as Ve,J as D,L as O,w as s,az as Me,aW as ce,A as We,aF as re,a1 as Z,D as me,F as V,K as Q,b4 as X,ab as ee,B as N,b5 as Le,b6 as qe,V as P,h as R,a9 as He,t as ue,x as je,b7 as Ge,aM as Je,ar as Ke,P as Qe,U as Xe,aZ as ie,b0 as Ye,H as Ze,T as et,b8 as de,b9 as tt,ba as lt,e as ot,W as nt,N as at,X as st,Y as ut,b2 as it,aU as dt,a3 as ct,a4 as rt,aS as mt,$ as pt}from"./.pnpm-Cl1qeBT1.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as E}from"./index-BkKhSLZi.js";import{S as Y}from"./SchemaForm-CNjsec4J.js";import{a as K}from"./table-6vNK_eCF.js";/* empty css                   */const vt=new Oe,L=vt,U=Ue("tableDesign",()=>{const x=_([]),c=_({name:"",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),u=_([]),C=_({});return{tableCfg:c,setTableCfg:n=>{c.value=n},currentColumn:C,onSelectColumn:(n,m)=>{const v=m.findIndex(T=>T.id===n);v!=-1&&(C.value=m[v])},onRemoveColumn:(n,m)=>{const v=m.findIndex(T=>T.id===n);v!=-1&&m.splice(v,1)},onAddColumn:()=>{const n=new Date().getTime().toString().slice(-4);c.value.columns.push({id:ze(),dataIndex:"field"+n,title:"列"+n,width:200})},tableData:x,onRefreshData:async n=>{},columnFields:u,onSetColumns:n=>{u.value=n},onAddBtn:n=>{c.value.action.push({id:new Date().getTime().toString(),name:"测试",position:n,eventFlowId:"",customEvent:!1,builtInEvents:"add"})},onRemoveBtn:n=>{const m=c.value.action.findIndex(v=>v.id==n);m!=-1&&c.value.action.splice(m,1)},onRemoveWidget:n=>{const m=c.value.filter.findIndex(v=>v.id==n);m!=-1&&c.value.filter.splice(m,1)}}}),ft={class:"custom-header-label",style:{flex:"1"}},_t=A({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(x,{emit:c}){const u=U(),{currentColumn:C}=M(u),h=x,{params:p}=W(h),k=()=>{L.onPublish("removeEvent",p.value)};return(a,I)=>{const S=Z;return d(),w("div",{class:We(["custom-header-item",l(C).dataIndex==l(p).column.getColId()?"active":""]),style:re([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:l(C).dataIndex==l(p).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[t(l(Ve),{class:"move",style:{width:"20px",cursor:"move"}}),D("div",ft,O(l(p).displayName),1),t(S,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:I[0]||(I[0]=B=>k())},{default:s(()=>[t(l(Me),{class:"remove",style:{width:"20px"},onClick:ce(()=>{},["stop"])})]),_:1})],6)}}}),bt={class:"custom-opt-cell"},gt=["onClick"],ht=A({__name:"CustomOptCell",setup(x){const c=U(),{tableCfg:u}=M(c),C=me(()=>{var I;return(I=u.value.action)==null?void 0:I.filter(S=>S.position=="row")}),{onAddBtn:h,onRemoveBtn:p}=c,k=I=>{L.onPublish("open-btn-modal",I)},a=()=>{h("row")};return(I,S)=>{const B=Z;return d(),w("div",bt,[(d(!0),w(V,null,Q(C.value,$=>(d(),w("div",{class:"btn",key:$.id},[D("a",{onClick:r=>k($)},O($.name),9,gt),t(B,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:r=>l(p)($.id)},{default:s(()=>[t(l(X),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),t(l(ee),{style:{cursor:"pointer"},onClick:S[0]||(S[0]=$=>a())})])}}}),Ct={class:"custom-header-label",style:{flex:"1"}},yt=A({__name:"CustomAddColumn",setup(x){const c=U(),{onAddColumn:u}=c;return(C,h)=>{const p=qe;return d(),w("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:h[0]||(h[0]=k=>l(u)())},[D("div",Ct,[t(l(ee)),N(" 新增列 "),t(p,null,{title:s(()=>[N("用于新增列配置")]),default:s(()=>[t(l(Le))]),_:1})])])}}}),wt={class:"cell"},xt={key:0},kt=["href"],It=A({__name:"CustomCellRender",props:{params:{}},setup(x){const c=x,{params:u}=W(c);return(C,h)=>{const p=He;return d(),w("div",wt,[l(u).colDef.cellRendererParams.type=="text"?(d(),w("span",xt,O(l(u).value),1)):P("",!0),l(u).colDef.cellRendererParams.type=="image"?(d(),R(p,{key:1,src:l(u).value},null,8,["src"])):P("",!0),l(u).colDef.cellRendererParams.type=="link"?(d(),w("a",{key:2,href:l(u).value},O(l(u).value),9,kt)):P("",!0)])}}}),St=A({__name:"AgTable",props:ue({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ue(["onRemove","onClick"],["update:columns"]),setup(x,{emit:c}){L.onSubscribe("removeEvent",r=>{let n=r.column.getColId(),m=u.value.find(v=>v.dataIndex==n);m&&B(m)});const u=je(x,"columns"),C=x,{columnId:h,tableData:p}=W(C),k=me(()=>{let r=u.value.map(n=>({field:n.dataIndex,colId:n.dataIndex,headerName:n.title,pinned:n.fixed=="none"?void 0:n.fixed,lockVisible:!0,headerComponent:_t,cellRenderer:It,cellRendererParams:{type:n.type}}));return r.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:yt}),r.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:ht}),r}),a=r=>{if(!r.finished)return;let n=[];r.api.getColumnState().forEach(m=>{let v=u.value.find(T=>T.dataIndex==m.colId);v&&n.push(v)}),u.value=n},I=r=>{if(!r.finished)return;let n=r.column.getColId(),m=u.value.findIndex(v=>v.dataIndex==n);m!=-1&&(u.value[m].width=r.column.getActualWidth())},S=c,B=r=>{S("onRemove",r)},$=r=>{let n=r.column.getId(),m=u.value.find(v=>v.dataIndex==n);S("onClick",m)};return(r,n)=>(d(),R(l(Ge),{rowData:l(p),columnDefs:k.value,style:re({height:r.height+"px"}),class:"ag-theme-quartz",onColumnMoved:a,onColumnResized:I,onColumnHeaderClicked:$},null,8,["rowData","columnDefs","style"]))}}),Dt=pe(St,[["__scopeId","data-v-5dd2184c"]]),$t=A({__name:"TableCfg",setup(x){const c=U(),{tableCfg:u,columnFields:C,currentColumn:h}=M(c),p=_({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(a=>{setTimeout(()=>{a(C.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),k=_();return Je(()=>h.value,()=>{k.value.refreshOption("dataIndex")}),(a,I)=>(d(),R(l(Y),{formData:l(h),schema:p.value,ref_key:"schemaRef",ref:k,size:"small"},null,8,["formData","schema"]))}}),Rt={class:"table-design"},Nt={class:"table-design-container"},Bt={class:"main-part"},Tt={class:"filter-part"},At={class:"filter-container"},Ft=["onClick"],Et={class:"add widget-item"},Pt={class:"tools-part"},Ot={class:"tools-container"},Ut={class:"add button-item"},zt={class:"table-part"},Vt=A({__name:"TableDesign",props:{id:{}},setup(x){const c=Ke();L.onSubscribe("open-btn-modal",i=>{oe(i)});const u=_([]);Qe(()=>{E.getDataSourceDict().then(i=>{const{code:e,data:g,msg:y}=i;e==200&&(u.value=g)})});const C=x,{id:h}=W(C),p=_(!1),k=U(),{tableCfg:a,columnFields:I}=M(k),{onSelectColumn:S,onRemoveBtn:B,onRemoveColumn:$,onSetColumns:r,onRemoveWidget:n,onAddBtn:m,setTableCfg:v}=k;h.value?(p.value=!0,K.getDetail(h.value).then(i=>{const{code:e,data:g,msg:y}=i;e==200&&(v(g),p.value=!1)})):v({name:"未命名列表",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),window.name="table-design";const T=_([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),ve=()=>{var i;(i=a.value.filter)==null||i.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},fe=()=>{window.open("/lowcode/table","quick-build")},_e=i=>{S(i.id,a.value.columns),j.value=!0},be=i=>{$(i.id,a.value.columns)};_([]);const te=_([]),ge=()=>{E.getSourceData(a.value.dataSource.sourceId,a.value.dataSource.tableName).then(i=>{const{code:e,data:g,msg:y}=i;e==200&&(te.value=g)})},le=_([]),he=()=>{E.getTableInfo(a.value.dataSource.sourceId).then(i=>{const{code:e,data:g,msg:y}=i;e==200&&(le.value=g)})},Ce=()=>{E.getColumnInfo(a.value.dataSource.sourceId,a.value.dataSource.tableName).then(i=>{const{code:e,data:g,msg:y}=i;e==200&&(a.value.columns=g.map(f=>({dataIndex:f.columnName,title:f.columnComment||f.columnName,id:f.columnName,width:200,type:"text",align:"left",fixed:"none"})),r(g.map(f=>({label:f.columnComment?`${f.columnComment}(${f.columnName})`:f.columnName,value:f.columnName}))))}),ge()},ye=()=>{m("header")},b=_({id:"",name:"",eventFlowId:"",position:"header",customEvent:!1,builtInEvents:"add"}),q=_(!1),we=_([{label:"默认新增事件流",value:"add"},{label:"默认编辑事件流",value:"edit"},{label:"默认批量编辑事件流",value:"batchEdit"}]),oe=i=>{b.value=i,q.value=!0},xe=i=>{c.push({path:"/design/flow",query:{id:i}})},ke=()=>{c.push({path:"/design/flow"})},ne=_({}),H=_(!1),Ie=_({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"string",label:"字段名称"},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",show:'"${formData.type}" == "select"',component:{asyncData:async()=>{const{code:i,data:e,msg:g}=await E.getDictTypeList();return i==200?e.map(y=>({label:y.dictTypeDesc,value:y.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),Se=i=>{ne.value=i,H.value=!0},j=_(!1),G=_(!1),De=_({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"120px"}}},properties:{showFilter:{type:"switch",label:"显示筛选面板"},showPagination:{type:"switch",label:"显示分页器"},showBordered:{type:"switch",label:"显示边框"},size:{type:"radio",label:"表格尺寸",component:{dataSource:[{label:"紧凑",value:"small"},{label:"默认",value:"middle"},{label:"宽松",value:"large"}],buttonStyle:"solid"}}}}),$e=()=>{G.value=!0},Re=()=>{p.value=!0,(h.value?K.update:K.add)(a.value).then(e=>{const{code:g,data:y,msg:f}=e;g==200&&ot.success("保存成功"),p.value=!1})};return(i,e)=>{const g=nt,y=at,f=st,F=ut,Ne=it,Be=Ye,Te=dt,ae=Z,se=ct,Ae=rt,Fe=mt,Ee=pt,z=Ze,Pe=et("loading");return d(),w(V,null,[Xe((d(),w("div",Rt,[t(Be,{onBack:fe,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:s(()=>[t(g,{value:l(a).name,"onUpdate:value":e[0]||(e[0]=o=>l(a).name=o),bordered:!1,class:"table-name"},null,8,["value"])]),extra:s(()=>[t(Ne,{class:"extra"},{default:s(()=>[t(f,{label:"选择数据源"},{default:s(()=>[t(y,{value:l(a).dataSource.sourceId,"onUpdate:value":e[1]||(e[1]=o=>l(a).dataSource.sourceId=o),options:u.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:e[2]||(e[2]=o=>he())},null,8,["value","options"])]),_:1}),t(f,{label:"选择表名"},{default:s(()=>[t(y,{value:l(a).dataSource.tableName,"onUpdate:value":e[3]||(e[3]=o=>l(a).dataSource.tableName=o),options:le.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:e[4]||(e[4]=o=>Ce())},null,8,["value","options"])]),_:1}),t(F,{type:"primary",onClick:$e},{default:s(()=>[N("全局配置")]),_:1}),t(F,{onClick:e[5]||(e[5]=o=>Re()),type:"primary",class:"save-btn"},{default:s(()=>[N(" 保存 ")]),_:1})]),_:1})]),_:1}),D("div",Nt,[D("div",Bt,[D("div",Tt,[D("div",At,[t(l(ie),{list:l(a).filter,"onUpdate:list":e[7]||(e[7]=o=>l(a).filter=o),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:s(()=>[(d(!0),w(V,null,Q(l(a).filter,o=>(d(),w("div",{class:"widget-item",key:o.id,onClick:J=>Se(o)},[t(l(de),{class:"move-handle",style:{cursor:"pointer"}}),t(f,{label:o.label,name:o.field},{default:s(()=>[o.type=="input"?(d(),R(g,{key:0})):o.type=="select"?(d(),R(y,{key:1})):(d(),R(Te,{key:2}))]),_:2},1032,["label","name"]),t(ae,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:J=>l(n)(o.id)},{default:s(()=>[t(l(X),{class:"remove-btn",onClick:ce(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,Ft))),128)),D("div",Et,[t(F,{type:"primary",onClick:e[6]||(e[6]=o=>ve())},{default:s(()=>[N(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),D("div",Pt,[D("div",Ot,[t(l(ie),{list:l(a).action,"onUpdate:list":e[9]||(e[9]=o=>l(a).action=o),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:s(()=>[(d(!0),w(V,null,Q(l(a).action.filter(o=>o.position=="header"),o=>(d(),w("div",{class:"button-item",key:o.id},[t(l(de),{class:"move-handle",style:{cursor:"pointer"}}),t(F,{onClick:J=>oe(o)},{default:s(()=>[N(O(o.name),1)]),_:2},1032,["onClick"]),t(ae,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:J=>l(B)(o.id)},{default:s(()=>[t(l(X),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),D("div",Ut,[t(F,{type:"primary",onClick:e[8]||(e[8]=o=>ye())},{default:s(()=>[N(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),D("div",zt,[t(Dt,{columns:l(a).columns,"onUpdate:columns":e[10]||(e[10]=o=>l(a).columns=o),tableData:te.value,height:550,onOnRemove:be,onOnClick:_e},null,8,["columns","tableData"])])])])])),[[Pe,p.value,void 0,{fullscreen:!0}]]),t(z,{title:"按钮配置",placement:"right",closable:!1,open:q.value,onClose:e[19]||(e[19]=o=>q.value=!1)},{default:s(()=>[t(Ee,{model:b.value},{default:s(()=>[t(f,{prop:"id",label:"按钮标识"},{default:s(()=>[t(g,{value:b.value.id,"onUpdate:value":e[11]||(e[11]=o=>b.value.id=o)},null,8,["value"])]),_:1}),t(f,{prop:"name",label:"按钮名称"},{default:s(()=>[t(g,{value:b.value.name,"onUpdate:value":e[12]||(e[12]=o=>b.value.name=o)},null,8,["value"])]),_:1}),t(f,{prop:"name",label:"按钮位置"},{default:s(()=>[t(Ae,{value:b.value.position,"onUpdate:value":e[13]||(e[13]=o=>b.value.position=o),"button-style":"solid"},{default:s(()=>[t(se,{value:"header"},{default:s(()=>[N("表头")]),_:1}),t(se,{value:"row"},{default:s(()=>[N("行内")]),_:1})]),_:1},8,["value"])]),_:1}),t(f,{prop:"customEvent",label:"是否启用自定义"},{default:s(()=>[t(Fe,{checked:b.value.customEvent,"onUpdate:checked":e[14]||(e[14]=o=>b.value.customEvent=o)},null,8,["checked"])]),_:1}),b.value.customEvent?P("",!0):(d(),R(f,{key:0,prop:"builtInEvents",label:"内置事件"},{default:s(()=>[t(y,{value:b.value.builtInEvents,"onUpdate:value":e[15]||(e[15]=o=>b.value.builtInEvents=o),options:T.value,allowClear:""},null,8,["value","options"])]),_:1})),b.value.customEvent?(d(),R(f,{key:1,prop:"event",label:"自定义事件流"},{default:s(()=>[t(y,{value:b.value.eventFlowId,"onUpdate:value":e[18]||(e[18]=o=>b.value.eventFlowId=o),options:we.value,allowClear:""},{suffixIcon:s(()=>[t(l(tt),{style:{color:"#000"},title:"刷新"}),b.value.eventFlowId?(d(),R(l(lt),{key:0,onClick:e[16]||(e[16]=o=>xe(b.value.eventFlowId)),style:{color:"#000"},title:"编辑事件流"})):(d(),R(l(ee),{key:1,style:{color:"#000"},title:"新增事件流",onClick:e[17]||(e[17]=o=>ke())}))]),_:1},8,["value","options"])]),_:1})):P("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),t(z,{title:"筛选控件配置",placement:"right",closable:!1,open:H.value,onClose:e[20]||(e[20]=o=>H.value=!1)},{default:s(()=>[t(l(Y),{formData:ne.value,schema:Ie.value},null,8,["formData","schema"])]),_:1},8,["open"]),t(z,{title:"列配置",placement:"right",closable:!1,open:j.value,onClose:e[21]||(e[21]=o=>j.value=!1)},{default:s(()=>[t($t)]),_:1},8,["open"]),t(z,{title:"全局配置",placement:"right",closable:!1,open:G.value,onClose:e[22]||(e[22]=o=>G.value=!1)},{default:s(()=>[t(l(Y),{formData:l(a).global,schema:De.value},null,8,["formData","schema"])]),_:1},8,["open"])],64)}}}),Gt=pe(Vt,[["__scopeId","data-v-a582f07c"]]);export{Gt as default};
