import{r as A,c as J}from"./index-DCYTyw5R.js";import{g as j,$ as G,r as i,P as K,o as d,B as D,l as a,w as e,a0 as Q,a1 as W,J as t,h as f,F as o,a3 as x,H as X,a4 as Z,a5 as ee,as as ae,a6 as te,a7 as le,a8 as oe,aa as ne,at as se,au as ue}from"./.pnpm-DpKfdl5h.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={getList:C=>A({method:"get",url:"operationlog/list",params:C})},ie={class:"optLog"},ce=j({__name:"OptLog",setup(C){const s=G({keyword:"",startTime:"",endTime:"",pageNumber:1,pageSize:20}),v=i(""),w=i([]),P=i([{title:"操作用户",key:"username",dataIndex:"username"},{title:"ip地址",key:"ip",dataIndex:"ip"},{title:"地址",key:"location",dataIndex:"location"},{title:"操作模块",key:"optModule",dataIndex:"optModule"},{title:"操作类型",key:"optType",dataIndex:"optType"},{title:"操作结果",key:"resStatus",dataIndex:"resStatus"},{title:"响应时间",key:"resTime",dataIndex:"resTime"},{title:"操作时间",key:"createTime",dataIndex:"createTime"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),h=i(!1),M=i(),B=()=>{var p;(p=M.value)==null||p.resetFields(),k()},F=i(0),q=()=>{s.pageNumber=1,s.pageSize=20,k()},U=()=>{v.value?(s.startTime=v.value[0],s.endTime=v.value[1]):(s.startTime="",s.endTime="")},V=p=>{const{current:u,pageSize:_}=p;s.pageNumber=u,s.pageSize=_,k()},k=()=>{h.value=!0,pe.getList(s).then(p=>{const{code:u,data:_}=p;u==200&&(w.value=_.data,F.value=_.total),h.value=!1})},l=i({}),I=i(!1),Y=p=>{l.value=p,I.value=!0},L=i([]),g=i(new Map),H=["green","cyan","red","pink","orange","blue","purple"];return K(()=>{k(),J.getDict(["optType"]).then(p=>{const{code:u,data:_,msg:b}=p;u==200&&(L.value=_.optType,L.value.forEach((T,y)=>{g.value.set(T.value,{label:T.label,color:H[y]})}))})}),(p,u)=>{const _=Z,b=ee,T=ae,y=te,O=le,N=Q,m=oe,R=ne,n=se,$=ue,E=W;return d(),D("div",ie,[a(N,{class:"search-area"},{default:e(()=>[a(O,{ref_key:"searchFormRef",ref:M,model:s,layout:"inline",onFinish:q},{default:e(()=>[a(b,{label:"用户名",name:"keyword"},{default:e(()=>[a(_,{value:s.keyword,"onUpdate:value":u[0]||(u[0]=r=>s.keyword=r)},null,8,["value"])]),_:1}),a(b,{label:"操作日期"},{default:e(()=>[a(T,{value:v.value,"onUpdate:value":u[1]||(u[1]=r=>v.value=r),showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",onChange:u[2]||(u[2]=r=>U())},null,8,["value"])]),_:1}),a(b,null,{default:e(()=>[a(y,{type:"primary","html-type":"submit"},{default:e(()=>[t("搜索")]),_:1}),a(y,{style:{margin:"0 8px"},onClick:B},{default:e(()=>[t(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(N,null,{default:e(()=>[a(R,{loading:h.value,columns:P.value,"data-source":w.value,scroll:{y:600},onChange:V,pagination:{current:s.pageNumber,total:F.value,showSizeChanger:!0,pageSize:s.pageSize}},{bodyCell:e(({column:r,record:c})=>{var z;return[r.key=="optType"?(d(),f(m,{key:0,color:(z=g.value.get(c.optType))==null?void 0:z.color},{default:e(()=>{var S;return[t(o((S=g.value.get(c.optType))==null?void 0:S.label),1)]}),_:2},1032,["color"])):x("",!0),r.key=="resTime"?(d(),f(m,{key:1,color:parseInt(c.resTime)<500?"#87d068":"#f50"},{default:e(()=>[t(o(c.resTime),1)]),_:2},1032,["color"])):x("",!0),r.key=="resStatus"?(d(),D(X,{key:2},[c.resStatus=="1"?(d(),f(m,{key:0,color:"#87d068"},{default:e(()=>[t("成功")]),_:1})):(d(),f(m,{key:1,color:"#f50"},{default:e(()=>[t("失败")]),_:1}))],64)):x("",!0),r.key=="action"?(d(),f(y,{key:3,type:"link",onClick:S=>Y(c)},{default:e(()=>[t("查看")]),_:2},1032,["onClick"])):x("",!0)]}),_:1},8,["loading","columns","data-source","pagination"])]),_:1}),a(E,{open:I.value,"onUpdate:open":u[3]||(u[3]=r=>I.value=r),title:"查看详情",footer:null,width:"1000px"},{default:e(()=>[a($,{column:2},{default:e(()=>[a(n,{label:"操作用户"},{default:e(()=>[t(o(l.value.username),1)]),_:1}),a(n,{label:"操作IP"},{default:e(()=>[t(o(l.value.ip),1)]),_:1}),a(n,{label:"操作地点"},{default:e(()=>[t(o(l.value.location),1)]),_:1}),a(n,{label:"操作时间"},{default:e(()=>[t(o(l.value.createTime),1)]),_:1}),a(n,{label:"请求类型"},{default:e(()=>[t(o(l.value.reqType),1)]),_:1}),a(n,{label:"请求地址"},{default:e(()=>[t(o(l.value.reqUrl),1)]),_:1}),a(n,{label:"请求参数"},{default:e(()=>[t(o(l.value.reqParam),1)]),_:1}),a(n,{label:"模块名称"},{default:e(()=>[t(o(l.value.moduleName),1)]),_:1}),a(n,{label:"方法名称"},{default:e(()=>[t(o(l.value.funcName),1)]),_:1}),a(n,{label:"操作模块"},{default:e(()=>[t(o(l.value.optModule),1)]),_:1}),a(n,{label:"操作类型"},{default:e(()=>{var r;return[a(m,{color:(r=g.value.get(l.value.optType))==null?void 0:r.color},{default:e(()=>{var c;return[t(o((c=g.value.get(l.value.optType))==null?void 0:c.label),1)]}),_:1},8,["color"])]}),_:1}),a(n,{label:"操作结果"},{default:e(()=>[l.value.resStatus=="1"?(d(),f(m,{key:0,color:"#87d068"},{default:e(()=>[t("成功")]),_:1})):(d(),f(m,{key:1,color:"#f50"},{default:e(()=>[t("失败")]),_:1}))]),_:1}),a(n,{label:"响应时间"},{default:e(()=>[a(m,{color:parseInt(l.value.resTime)<500?"#87d068":"#f50"},{default:e(()=>[t(o(l.value.resTime),1)]),_:1},8,["color"])]),_:1}),a(n,{label:"请求结果",span:4},{default:e(()=>[t(o(l.value.res),1)]),_:1}),a(n,{label:"异常信息",span:4},{default:e(()=>[t(o(l.value.errMsg),1)]),_:1})]),_:1})]),_:1},8,["open"])])}}}),fe=re(ce,[["__scopeId","data-v-f0f56045"]]);export{fe as default};
