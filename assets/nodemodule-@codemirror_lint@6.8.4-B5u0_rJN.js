import{c as $,d as z,E as P,D as k,h as H,W}from"./nodemodule-@codemirror_view@6.36.3-NX7sJwro.js";import{b as _,S as R,F as q,e as V,m as j}from"./nodemodule-@codemirror_state@6.5.2-CeTbMir1.js";import{c as p}from"./nodemodule-crelt@1.0.6-C8TCjufn.js";class L{constructor(e,s,i){this.from=e,this.to=s,this.diagnostic=i}}class w{constructor(e,s,i){this.diagnostics=e,this.panel=s,this.selected=i}static init(e,s,i){let o=e,n=i.facet(C).markerFilter;n&&(o=n(o,i));let r=e.slice().sort((m,c)=>m.from-c.from||m.to-c.to),d=new j,l=[],f=0;for(let m=0;;){let c=m==r.length?null:r[m];if(!c&&!l.length)break;let h,b;for(l.length?(h=f,b=l.reduce((a,x)=>Math.min(a,x.to),c&&c.from>h?c.from:1e8)):(h=c.from,b=c.to,l.push(c),m++);m<r.length;){let a=r[m];if(a.from==h&&(a.to>a.from||a.to==h))l.push(a),m++,b=Math.min(a.to,b);else{b=Math.min(a.from,b);break}}let D=ie(l);if(l.some(a=>a.from==a.to||a.from==a.to-1&&i.doc.lineAt(a.from).to==a.from))d.add(h,h,k.widget({widget:new Q(D),diagnostics:l.slice()}));else{let a=l.reduce((x,A)=>A.markClass?x+" "+A.markClass:x,"");d.add(h,b,k.mark({class:"cm-lintRange cm-lintRange-"+D+a,diagnostics:l.slice(),inclusiveEnd:l.some(x=>x.to>b)}))}f=b;for(let a=0;a<l.length;a++)l[a].to<=f&&l.splice(a--,1)}let g=d.finish();return new w(g,s,y(g))}}function y(t,e=null,s=0){let i=null;return t.between(s,1e9,(o,n,{spec:r})=>{if(!(e&&r.diagnostics.indexOf(e)<0))if(!i)i=new L(o,n,e||r.diagnostics[0]);else{if(r.diagnostics.indexOf(i.diagnostic)<0)return!1;i=new L(i.from,n,i.diagnostic)}}),i}function K(t,e){let s=e.pos,i=e.end||s,o=t.state.facet(C).hideOn(t,s,i);if(o!=null)return o;let n=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(r=>r.is(B))||t.changes.touchesRange(n.from,Math.max(n.to,i)))}function N(t,e){return t.field(u,!1)?e:e.concat(R.appendConfig.of(se))}const B=R.define(),I=R.define(),F=R.define(),u=_.define({create(){return new w(k.none,null,null)},update(t,e){if(e.docChanged&&t.diagnostics.size){let s=t.diagnostics.map(e.changes),i=null,o=t.panel;if(t.selected){let n=e.changes.mapPos(t.selected.from,1);i=y(s,t.selected.diagnostic,n)||y(s,null,n)}!s.size&&o&&e.state.facet(C).autoPanel&&(o=null),t=new w(s,o,i)}for(let s of e.effects)if(s.is(B)){let i=e.state.facet(C).autoPanel?s.value.length?v.open:null:t.panel;t=w.init(s.value,i,e.state)}else s.is(I)?t=new w(t.diagnostics,s.value?v.open:null,t.selected):s.is(F)&&(t=new w(t.diagnostics,t.panel,s.value));return t},provide:t=>[z.from(t,e=>e.panel),P.decorations.from(t,e=>e.diagnostics)]}),U=k.mark({class:"cm-lintRange cm-lintRange-active"});function Y(t,e,s){let{diagnostics:i}=t.state.field(u),o,n=-1,r=-1;i.between(e-(s<0?1:0),e+(s>0?1:0),(l,f,{spec:g})=>{if(e>=l&&e<=f&&(l==f||(e>l||s>0)&&(e<f||s<0)))return o=g.diagnostics,n=l,r=f,!1});let d=t.state.facet(C).tooltipFilter;return o&&d&&(o=d(o,t.state)),o?{pos:n,end:r,above:t.state.doc.lineAt(n).to<r,create(){return{dom:Z(t,o)}}}:null}function Z(t,e){return p("ul",{class:"cm-tooltip-lint"},e.map(s=>O(t,s,!1)))}const G=t=>{let e=t.state.field(u,!1);(!e||!e.panel)&&t.dispatch({effects:N(t.state,[I.of(!0)])});let s=$(t,v.open);return s&&s.dom.querySelector(".cm-panel-lint ul").focus(),!0},M=t=>{let e=t.state.field(u,!1);return!e||!e.panel?!1:(t.dispatch({effects:I.of(!1)}),!0)},J=t=>{let e=t.state.field(u,!1);if(!e)return!1;let s=t.state.selection.main,i=e.diagnostics.iter(s.to+1);return!i.value&&(i=e.diagnostics.iter(0),!i.value||i.from==s.from&&i.to==s.to)?!1:(t.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},re=[{key:"Mod-Shift-m",run:G,preventDefault:!0},{key:"F8",run:J}],C=q.define({combine(t){return Object.assign({sources:t.map(e=>e.source).filter(e=>e!=null)},V(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,s)=>e?s?i=>e(i)||s(i):e:s}))}});function E(t){let e=[];if(t)e:for(let{name:s}of t){for(let i=0;i<s.length;i++){let o=s[i];if(/[a-zA-Z]/.test(o)&&!e.some(n=>n.toLowerCase()==o.toLowerCase())){e.push(o);continue e}}e.push("")}return e}function O(t,e,s){var i;let o=s?E(e.actions):[];return p("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},p("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(t):e.message),(i=e.actions)===null||i===void 0?void 0:i.map((n,r)=>{let d=!1,l=c=>{if(c.preventDefault(),d)return;d=!0;let h=y(t.state.field(u).diagnostics,e);h&&n.apply(t,h.from,h.to)},{name:f}=n,g=o[r]?f.indexOf(o[r]):-1,m=g<0?f:[f.slice(0,g),p("u",f.slice(g,g+1)),f.slice(g+1)];return p("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${f}${g<0?"":` (access key "${o[r]})"`}.`},m)}),e.source&&p("div",{class:"cm-diagnosticSource"},e.source))}class Q extends W{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return p("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class T{constructor(e,s){this.diagnostic=s,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=O(e,s,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class v{constructor(e){this.view=e,this.items=[];let s=o=>{if(o.keyCode==27)M(this.view),this.view.focus();else if(o.keyCode==38||o.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(o.keyCode==40||o.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(o.keyCode==36)this.moveSelection(0);else if(o.keyCode==35)this.moveSelection(this.items.length-1);else if(o.keyCode==13)this.view.focus();else if(o.keyCode>=65&&o.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:n}=this.items[this.selectedIndex],r=E(n.actions);for(let d=0;d<r.length;d++)if(r[d].toUpperCase().charCodeAt(0)==o.keyCode){let l=y(this.view.state.field(u).diagnostics,n);l&&n.actions[d].apply(e,l.from,l.to)}}else return;o.preventDefault()},i=o=>{for(let n=0;n<this.items.length;n++)this.items[n].dom.contains(o.target)&&this.moveSelection(n)};this.list=p("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:s,onclick:i}),this.dom=p("div",{class:"cm-panel-lint"},this.list,p("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>M(this.view)},"Ã—")),this.update()}get selectedIndex(){let e=this.view.state.field(u).selected;if(!e)return-1;for(let s=0;s<this.items.length;s++)if(this.items[s].diagnostic==e.diagnostic)return s;return-1}update(){let{diagnostics:e,selected:s}=this.view.state.field(u),i=0,o=!1,n=null,r=new Set;for(e.between(0,this.view.state.doc.length,(d,l,{spec:f})=>{for(let g of f.diagnostics){if(r.has(g))continue;r.add(g);let m=-1,c;for(let h=i;h<this.items.length;h++)if(this.items[h].diagnostic==g){m=h;break}m<0?(c=new T(this.view,g),this.items.splice(i,0,c),o=!0):(c=this.items[m],m>i&&(this.items.splice(i,m-i),o=!0)),s&&c.diagnostic==s.diagnostic?c.dom.hasAttribute("aria-selected")||(c.dom.setAttribute("aria-selected","true"),n=c):c.dom.hasAttribute("aria-selected")&&c.dom.removeAttribute("aria-selected"),i++}});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)o=!0,this.items.pop();this.items.length==0&&(this.items.push(new T(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),o=!0),n?(this.list.setAttribute("aria-activedescendant",n.id),this.view.requestMeasure({key:this,read:()=>({sel:n.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:d,panel:l})=>{let f=l.height/this.list.offsetHeight;d.top<l.top?this.list.scrollTop-=(l.top-d.top)/f:d.bottom>l.bottom&&(this.list.scrollTop+=(d.bottom-l.bottom)/f)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),o&&this.sync()}sync(){let e=this.list.firstChild;function s(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)s();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)s()}moveSelection(e){if(this.selectedIndex<0)return;let s=this.view.state.field(u),i=y(s.diagnostics,this.items[e].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:F.of(i)})}static open(e){return new v(e)}}function X(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function S(t){return X(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const ee=P.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:S("#d11")},".cm-lintRange-warning":{backgroundImage:S("orange")},".cm-lintRange-info":{backgroundImage:S("#999")},".cm-lintRange-hint":{backgroundImage:S("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function te(t){return t=="error"?4:t=="warning"?3:t=="info"?2:1}function ie(t){let e="hint",s=1;for(let i of t){let o=te(i.severity);o>s&&(s=o,e=i.severity)}return e}const se=[u,P.decorations.compute([u],t=>{let{selected:e,panel:s}=t.field(u);return!e||!s||e.from==e.to?k.none:k.set([U.range(e.from,e.to)])}),H(Y,{hideOn:K}),ee];export{re as l};
