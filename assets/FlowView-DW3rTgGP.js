import{_ as oe}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-BDDN2zUy.js";import{g as S,r as d,x as P,a5 as ne,bm as R,bn as le,bo as se,bp as ue,o as p,z as A,v as re,y as de,D as M,h as k,w as l,aa as g,m as t,i as G,bq as W,br as pe,B as v,p as ie,N as H,Y as Z,O as X,ad as ce,Q as me,F,_ as ve,H as _e,M as fe,a1 as ye,R as ge,U as xe,ap as Ae,K as be,T as we,aH as De,a0 as Ce}from"./.pnpm-0Rj9Ahsw.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ke}from"./index-DM3yB3WX.js";import{F as Ve}from"./FlowExecutor-BL-IqirC.js";import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BSNcIuNO.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-DEwyur3G.js";const Ue=S({__name:"EventFlow",props:{dndList:{default:()=>[{type:"circle",text:"开始",label:"开始节点",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAAnBJREFUOBGdVL1rU1EcPfdGBddmaZLiEhdx1MHZQXApraCzQ7GKLgoRBxMfcRELuihWKcXFRcEWF8HBf0DdDCKYRZpnl7p0svLe9Zzbd29eQhTbC8nv+9zf130AT63jvooOGS8Vf9Nt5zxba7sXQwODfkWpkbjTQfCGUd9gIp3uuPP8bZ946g56dYQvnBg+b1HB8VIQmMFrazKcKSvFW2dQTxJnJdQ77urmXWOMBCmXM2Rke4S7UAW+/8ywwFoewmBps2tu7mbTdp8VMOkIRAkKfrVawalJTtIliclFbaOBqa0M2xImHeVIfd/nKAfVq/LGnPss5Kh00VEdSzfwnBXPUpmykNss4lUI9C1ga+8PNrBD5YeqRY2Zz8PhjooIbfJXjowvQJBqkmEkVnktWhwu2SM7SMx7Cj0N9IC0oQXRo8xwAGzQms+xrB/nNSUWVveI48ayrFGyC2+E2C+aWrZHXvOuz+CiV6iycWe1Rd1Q6+QUG07nb5SbPrL4426d+9E1axKjY3AoRrlEeSQo2Eu0T6BWAAr6COhTcWjRaYfKG5csnvytvUr/WY4rrPMB53Uo7jZRjXaG6/CFfNMaXEu75nG47X+oepU7PKJvvzGDY1YLSKHJrK7vFUwXKkaxwhCW3u+sDFMVrIju54RYYbFKpALZAo7sB6wcKyyrd+aBMryMT2gPyD6GsQoRFkGHr14TthZni9ck0z+Pnmee460mHXbRAypKNy3nuMdrWgVKj8YVV8E7PSzp1BZ9SJnJAsXdryw/h5ctboUVi4AFiCd+lQaYMw5z3LGTBKjLQOeUF35k89f58Vv/tGh+l+PE/wG0rgfIUbZK5AAAAABJRU5ErkJggg=="},{type:"rect",label:"用户任务",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAEFVwZaAAAABGdBTUEAALGPC/xhBQAAAqlJREFUOBF9VM9rE0EUfrMJNUKLihGbpLGtaCOIR8VjQMGDePCgCCIiCNqzCAp2MyYUCXhUtF5E0D+g1t48qAd7CCLqQUQKEWkStcEfVGlLdp/fm3aW2QQdyLzf33zz5m2IsAZ9XhDpyaaIZkTS4ASzK41TFao88GuJ3hsr2pAbipHxuSYyKRugagICGANkfFnNh3HeE2N0b3nN2cgnpcictw5veJIzxmDamSlxxQZicq/mflxhbaH8BLRbuRwNtZp0JAhoplVRUdzmCe/vO27wFuuA3S5qXruGdboy5/PRGFsbFGKo/haRtQHIrM83bVeTrOgNhZReWaYGnE4aUQgTJNvijJFF4jQ8BxJE5xfKatZWmZcTQ+BVgh7s8SgPlCkcec4mGTmieTP4xd7PcpIEg1TX6gdeLW8rTVMVLVvb7ctXoH0Cydl2QOPJBG21STE5OsnbweVYzAnD3A7PVILuY0yiiyDwSm2g441r6rMSgp6iK42yqroI2QoXeJVeA+YeZSa47gZdXaZWQKTrG93rukk/l2Al6Kzh5AZEl7dDQy+JjgFahQjRopSxPbrbvK7GRe9ePWBo1wcU7sYrFZtavXALwGw/7Dnc50urrHJuTPSoO2IMV3gUQGNg87IbSOIY9BpiT9HV7FCZ94nPXb3MSnwHn/FFFE1vG6DTby+r31KAkUktB3Qf6ikUPWxW1BkXSPQeMHHiW0+HAd2GelJsZz1OJegCxqzl+CLVHa/IibuHeJ1HAKzhuDR+ymNaRFM+4jU6UWKXorRmbyqkq/D76FffevwdCp+jN3UAN/C9JRVTDuOxC/oh+EdMnqIOrlYteKSfadVRGLJFJPSB/ti/6K8f0CNymg/iH2gO/f0DwE0yjAFO6l8JaR5j0VPwPwfaYHqOqrCI319WzwhwzNW/aQAAAABJRU5ErkJggg==",className:"important-node"}]},data:{}},emits:["onClickEle"],setup(b,{expose:x,emit:V}){const m=V,r=d(),_=d(),a=b,{dndList:f,data:w}=P(a),D=o=>{m("onClickEle",o)};return ne(()=>{R.use(le),R.use(se),R.use(ue),r.value=new R({container:_.value,grid:!0}),r.value.extension.dndPanel.setPatternItems(f.value),r.value.extension.menu.setMenuConfig({nodeMenu:[{text:"删除",callback(o){r.value.deleteNode(o.id)}}],edgeMenu:[{text:"删除",callback(o){r.value.deleteEdge(o.id)}}],graphMenu:!1}),r.value.render(w.value),r.value.on("node:click",D)}),x({getRawData:()=>{var o;return(o=r.value)==null?void 0:o.getGraphRawData()},updateNodeData:o=>{var s,y;(y=(s=r.value)==null?void 0:s.getNodeModelById(o.id))==null||y.setProperties({extraData:o.properties.extraData})}}),(o,s)=>(p(),A("div",{class:"flow-container",ref_key:"container",ref:_},null,512))}}),Ie=N(Ue,[["__scopeId","data-v-e2280916"]]),Be={key:2,style:{display:"flex"}},Te=S({__name:"EditTable",props:re({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const x=de(b,"modelValue");let V=b;const{columns:m,action:r}=P(V),_=M(()=>D("input")),a=M(()=>D("select")),f=M(()=>r.value?[...m.value,{title:"操作",dataIndex:"_action_"}]:m.value),w=o=>{var s;return((s=m.value.find(y=>y.dataIndex==o))==null?void 0:s.options)||[]},D=o=>m.value.filter(s=>s.type==o).map(s=>s.dataIndex),C=()=>{let o={};m.value.map(s=>{Reflect.set(o,s.dataIndex,"")}),x.value.push(o)},E=o=>{x.value.splice(o,1)};return(o,s)=>{const y=H,U=Z,I=X,h=ce;return p(),k(h,{columns:f.value,"data-source":x.value,pagination:!1,rowKey:(i,u)=>u,size:"small",scroll:{y:o.height}},{bodyCell:l(({column:i,record:u,index:e})=>[_.value.includes(i.dataIndex)?(p(),k(y,{key:0,value:u[i.dataIndex],"onUpdate:value":c=>u[i.dataIndex]=c},null,8,["value","onUpdate:value"])):g("",!0),a.value.includes(i.dataIndex)?(p(),k(U,{key:1,value:u[i.dataIndex],"onUpdate:value":c=>u[i.dataIndex]=c,options:w(i.dataIndex)},null,8,["value","onUpdate:value","options"])):g("",!0),i.dataIndex=="_action_"?(p(),A("div",Be,[t(G(W),{class:"icon",onClick:s[0]||(s[0]=c=>C())}),t(G(pe),{class:"icon",onClick:c=>E(e)},null,8,["onClick"])])):g("",!0)]),emptyText:l(()=>[t(I,{type:"text",onClick:C,icon:ie(G(W))},{default:l(()=>[v(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),Q=N(Te,[["__scopeId","data-v-5b9e8dbe"]]),Ee={key:0,style:{color:"red"}},Re=S({__name:"FlowView",props:{data:{default:()=>({nodes:[],edges:[]})}},setup(b,{expose:x}){const V=b,{data:m}=P(V),r=d([{type:"circle",text:"开始",label:"开始节点",icon:"/src/assets/images/flow/开始.png",properties:{nodeType:"start-node",extraData:{}}},{type:"circle",text:"结束",label:"结束节点",icon:"/src/assets/images/flow/结束.png",properties:{nodeType:"end-node",extraData:{}}},{type:"rect",text:"处理函数",label:"处理函数",icon:"/src/assets/images/flow/js函数.png",properties:{nodeType:"func-node",extraData:{code:""}}},{type:"rect",text:"打开弹窗",label:"弹窗",icon:"/src/assets/images/flow/弹窗.png",properties:{nodeType:"modal-node",extraData:{size:"small",formId:""}}},{type:"rect",text:"跳转外部链接",label:"链接",icon:"/src/assets/images/flow/链接.png",properties:{nodeType:"link-node",extraData:{url:"",openType:"_blank"}}},{type:"diamond",text:"请求数据",label:"请求数据",icon:"/src/assets/images/flow/发起请求.png",properties:{nodeType:"request-node",extraData:{url:"",method:"get",params:[],headers:[],body:[]}}}]),_=d(!1),a=d({}),f=d(),w=d([]),D=d([{value:"get",label:"GET"},{value:"post",label:"POST"}]),C=d([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),E=d([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),o=d(""),s=u=>{_.value=!0,a.value=u.data};ke.getFormDict().then(u=>{const{code:e,data:c,msg:O}=u;e==200&&(w.value=c)});const y=()=>{f.value.updateNodeData(a.value)},U=d(!1),I=d("");x({getData:()=>f.value.getRawData()});const i=async()=>{U.value=!1,I.value="";try{const u=f.value.getRawData(),e=new Ve(u);await e.run(),o.value=JSON.stringify(e.getState(),null,4)}catch(u){U.value=!0,I.value=u}};return(u,e)=>{const c=ve,O=Ie,Y=X,J=oe,B=ye,T=ge,z=xe,L=Z,j=Ae,q=H,K=be,$=we,ee=De,ae=Ce,te=_e;return p(),A(F,null,[t(c,null,{default:l(()=>[v("配置区")]),_:1}),t(O,{ref_key:"eventFlowRef",ref:f,data:G(m),dndList:r.value,style:{height:"450px"},onOnClickEle:s},null,8,["data","dndList"]),t(Y,{onClick:e[0]||(e[0]=n=>i()),type:"primary",style:{"margin-top":"10px"}},{default:l(()=>[v("执行")]),_:1}),t(c,null,{default:l(()=>[v("运行结果")]),_:1}),U.value?(p(),A("div",Ee,"错误日志: "+me(I.value),1)):(p(),k(J,{key:1,value:o.value,"onUpdate:value":e[1]||(e[1]=n=>o.value=n),height:"200",readOnly:""},null,8,["value"])),t(te,{open:_.value,"onUpdate:open":e[12]||(e[12]=n=>_.value=n),title:"节点配置",placement:"right",onClose:e[13]||(e[13]=n=>y()),width:"400px"},{default:l(()=>[t(ae,{model:a.value.properties.extraData},{default:l(()=>[a.value.properties.nodeType=="func-node"?(p(),k(B,{key:0,label:"函数"},{default:l(()=>[t(J,{value:a.value.properties.extraData.code,"onUpdate:value":e[2]||(e[2]=n=>a.value.properties.extraData.code=n),prepend:"()=>{",append:"}",theme:"light"},null,8,["value"])]),_:1})):g("",!0),a.value.properties.nodeType=="modal-node"?(p(),A(F,{key:1},[t(B,{label:"弹窗大小"},{default:l(()=>[t(z,{value:a.value.properties.extraData.size,"onUpdate:value":e[3]||(e[3]=n=>a.value.properties.extraData.size=n),"button-style":"solid"},{default:l(()=>[t(T,{value:"small"},{default:l(()=>[v("小")]),_:1}),t(T,{value:"middle"},{default:l(()=>[v("中")]),_:1}),t(T,{value:"large"},{default:l(()=>[v("大")]),_:1})]),_:1},8,["value"])]),_:1}),t(B,{label:"表单"},{default:l(()=>[t(L,{value:a.value.properties.extraData.formId,"onUpdate:value":e[4]||(e[4]=n=>a.value.properties.extraData.formId=n),options:w.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})],64)):g("",!0),a.value.properties.nodeType=="link-node"?(p(),A(F,{key:2},[t(B,{label:"链接地址"},{default:l(()=>[t(j,{value:a.value.properties.extraData.url,"onUpdate:value":e[5]||(e[5]=n=>a.value.properties.extraData.url=n)},null,8,["value"])]),_:1}),t(B,{label:"打开方式"},{default:l(()=>[t(z,{value:a.value.properties.extraData.openType,"onUpdate:value":e[6]||(e[6]=n=>a.value.properties.extraData.openType=n),"button-style":"solid"},{default:l(()=>[t(T,{value:"_selef"},{default:l(()=>[v("当前页")]),_:1}),t(T,{value:"_blank"},{default:l(()=>[v("新窗口")]),_:1})]),_:1},8,["value"])]),_:1})],64)):g("",!0),a.value.properties.nodeType=="request-node"?(p(),A(F,{key:3},[t(q,{value:a.value.properties.extraData.url,"onUpdate:value":e[8]||(e[8]=n=>a.value.properties.extraData.url=n)},{addonBefore:l(()=>[t(L,{value:a.value.properties.extraData.method,"onUpdate:value":e[7]||(e[7]=n=>a.value.properties.extraData.method=n),options:D.value},null,8,["value","options"])]),_:1},8,["value"]),fe("div",null,[t($,null,{default:l(()=>[t(K,{key:"params",tab:"params"},{default:l(()=>[t(Q,{columns:C.value,modelValue:a.value.properties.extraData.params,"onUpdate:modelValue":e[9]||(e[9]=n=>a.value.properties.extraData.params=n)},null,8,["columns","modelValue"])]),_:1}),t(K,{key:"headers",tab:"headers"},{default:l(()=>[t(Q,{columns:E.value,modelValue:a.value.properties.extraData.headers,"onUpdate:modelValue":e[10]||(e[10]=n=>a.value.properties.extraData.headers=n)},null,8,["columns","modelValue"])]),_:1}),t(K,{key:"body",tab:"body"},{default:l(()=>[t(Q,{columns:C.value,modelValue:a.value.properties.extraData.body,"onUpdate:modelValue":e[11]||(e[11]=n=>a.value.properties.extraData.body=n)},null,8,["columns","modelValue"])]),_:1})]),_:1})])],64)):g("",!0),["start-node","end-node"].includes(a.value.properties.nodeType)?(p(),k(ee,{key:4,description:"起止节点暂无配置项"})):g("",!0)]),_:1},8,["model"])]),_:1},8,["open"])],64)}}}),Ne=N(Re,[["__scopeId","data-v-c53bf77f"]]);export{Ne as default};
