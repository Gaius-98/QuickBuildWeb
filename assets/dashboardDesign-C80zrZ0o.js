import{d as _,s as C}from"./nodemodule-pinia@2.1.7_typescript@5.4.2_vue@3.4.21-DRg4DShQ.js";import{d as b}from"./dashboard-BdQ0fc9B.js";import{D as A}from"./DynamicConfig-Bvc-VGnT.js";import{h as E}from"./nodemodule-html2canvas@1.4.1-Cc_bx5YD.js";import{c as D}from"./nodemodule-lodash-es@4.17.21-DcfALcKD.js";import{r as n,t as M}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";import{a as q}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-D4V-KPiA.js";import{q as I}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";const P=[{name:"qb-text",id:"1",label:"文本",icon:"icon-text",component:"qb-text",props:{text:{_value:"文本内容",_mode:"static",_dynExp:""}},style:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2},{name:"qb-image",id:"2",label:"图片",icon:"icon-image1",props:{src:{_value:"https://avatars.githubusercontent.com/u/59641156?v=4",_mode:"static",_dynExp:""}},style:{},rowStart:1,colStart:1,rowSpan:10,colSpan:2,component:"qb-image"},{name:"qb-bar-chart",id:"3",label:"柱状图",icon:"icon-barchart",component:"qb-chart",style:{option:{xAxis:{type:"category"},yAxis:{type:"value"}},series:{type:"bar"}},props:{dataset:null,dimension:["title"],target:["value"]},rowStart:1,colStart:1,rowSpan:10,colSpan:2},{name:"qb-line-chart",id:"4",label:"折线图",icon:"icon-linechart",component:"qb-chart",style:{option:{xAxis:{type:"category"},yAxis:{type:"value"}},series:{type:"line"}},props:{dataset:null,dimension:["title"],target:["value"]},rowStart:1,colStart:1,rowSpan:10,colSpan:2},{name:"qb-pie-chart",id:"5",label:"扇形图",icon:"icon-piechart",component:"qb-chart",style:{option:{tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"}},series:{type:"pie"}},props:{dataset:null,dimension:["title"],target:["value"]},rowStart:1,colStart:1,rowSpan:10,colSpan:2},{name:"qb-iframe",id:"6",label:"嵌入页",icon:"icon-creditcard",component:"qb-iframe",props:{src:{_value:"https://gaius-98.github.io/gaius-blog/",_mode:"static",_dynExp:""}},style:{},rowStart:1,colStart:1,rowSpan:30,colSpan:3}],V=_("dgDesign",()=>{const c=n({}),o=n([]),p=n({});n("");const f=t=>{o.value.push(t)},m=t=>{const{id:l}=t,d=o.value.findIndex(g=>g.id===l);d!==-1&&o.value.splice(d,1)},h=t=>{o.value=t},e=t=>{const l=P.findIndex(g=>g.name===t);if(l===-1)throw new Error("组件不存在");const d=D(P[l]);return d.id=new Date().getTime().toString(),d},u=t=>{p.value.id!==t.id&&(p.value=t)},w=t=>{const{id:l}=t,d=o.value.findIndex(g=>g.id===l);d!==-1&&o.value.splice(d,1,t)},x=t=>new A(i.value).processObject(D(t)),a=()=>{v().then(t=>{window.parent.postMessage({type:"save",data:{list:M(o.value),img:t}},window.location.origin)})},r=n({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),s=t=>{r.value=t},i=n({}),S=()=>{},v=async()=>{const t=document.querySelector(".dg-design-container");return(await E(t)).toDataURL("image/png")};return{dashboardData:c,add:f,remove:m,dgList:o,initDgItem:e,selectItem:u,curComp:p,updateItem:w,transformProps:x,updateVariables:S,setVarPools:s,sendDgList:a,createPreviewImg:v,init:h}}),y=V(),{dgList:L}=C(y),{createPreviewImg:N}=y,B=_("dashboardDesign",()=>{const c=n([]),o=a=>{c.value.push(a)},p=I(()=>{const a={};return c.value.map(r=>{r.children.forEach(s=>{a[s.componentName]=s.schema})}),a}),f=I(()=>{let a=[];return c.value.forEach(r=>{const s=r.children.map(i=>({label:i.componentName,value:i.exportName}));a=a.concat(s)}),a}),m=n({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),h=async()=>{},e=n({list:[],customModules:[],varPools:{datasets:[],vars:[]},img:"",name:"未命名仪表板",id:""}),u=n(!1);return{customModules:c,customCompSchema:p,onAddModules:o,customComps:f,varPools:m,getContentWindow:h,onSave:()=>{u.value=!0,N().then(a=>{e.value.list=L.value,e.value.img=a,e.value.customModules=c.value,e.value.varPools=m.value;const r=e.value.id?b.update:b.add;e.value.id||delete e.value.id,r(e.value).then(s=>{const{code:i,data:S,msg:v}=s;u.value=!1,i==200?q.success("保存成功"):q.error("保存失败")})})},dgInfo:e,getDetail:a=>{u.value=!0,b.getDetail(a).then(r=>{const{code:s,data:i,msg:S}=r;if(s==200){e.value=i;const{customModules:v,varPools:t}=e.value;c.value=v,m.value=t,y.init(e.value.list),u.value=!1}})},loading:u}});export{V as a,P as c,B as u};
