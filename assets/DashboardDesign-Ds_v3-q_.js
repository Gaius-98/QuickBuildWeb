import{_ as oe}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-DuD6YwsR.js";import{c as le}from"./componentsSchema-gFhwa5FU.js";import{f as ne,r as b,P as T,g as E,s as J,x as R,o as m,y as v,G as u,N as D,U,H as se,J as A,l as e,i as w,aj as I,M as S,w as l,t as ue,v as V,a1 as ce,ao as W,ap as L,bg as F,a5 as z,a6 as re,T as O,b5 as G,a7 as de,h as ie,F as pe,b3 as me}from"./.pnpm-CQCJb2bg.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as _e,D as ve}from"./ConfigForm.vue_vue_type_script_setup_true_lang-BplcICa5.js";const H=ne("dashboardDesign",()=>{const s=b([]),h=o=>{s.value.push(o)},y=T(()=>{const o={};return s.value.map(c=>{c.children.forEach(i=>{o[i.componentName]=i.schema})}),o}),_=T(()=>{let o=[];return s.value.forEach(c=>{const i=c.children.map(p=>({label:p.componentName,value:p.exportName}));o=o.concat(i)}),o});return{customModules:s,customCompSchema:y,onAddModules:h,customComps:_}}),K=s=>(W("data-v-168494c5"),s=s(),L(),s),fe={class:"material-area"},he={class:"material-layout-area"},ge=K(()=>u("div",{class:"title"},"内置组件",-1)),be={class:"content"},ye=["data-material"],Ce={class:"material-label"},xe={class:"material-data-area"},Se=K(()=>u("div",{class:"title"},"自定义组件",-1)),we={class:"content"},Ne=["data-material"],ke={style:{height:"650px"}},De={style:{height:"80px","overflow-y":"auto"}},Ue={style:{height:"200px","overflow-y":"auto"}},Me=E({__name:"MaterialArea",setup(s){const h=H(),{customModules:y,customComps:_}=J(h),{onAddModules:o}=h,c=b({internalComp:le,customComp:[]}),i=g=>{var r,d;const n=g.target;(r=g.dataTransfer)==null||r.setData("material",n.dataset.material),(d=g.dataTransfer)==null||d.setData("material-type",n.dataset.materialType)},p=b(!1),C=()=>{p.value=!0,a.value=ue(x.value)},x=b({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElButton",exportName:"ElButton",id:"1",schema:`{
    "type": {
        "type": "input",
        "label": "按钮类型"
    }

      }`}]}),a=b({}),N=()=>{p.value=!1},M=()=>{o(a.value),c.value.customComp=c.value.customComp.concat(_.value),k==null||k.postMessage({type:"add-custom-comp",data:V(a.value)}),N()},Q=()=>{a.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},X=g=>{const n=a.value.children.findIndex(r=>r.id==g.id);n!=-1&&a.value.children.splice(n,1)},Y=()=>{a.value.urls.push("")},Z=g=>{const n=a.value.urls.findIndex(r=>r==g);n!=-1&&a.value.urls.splice(n,1)};let k=null;return R(()=>{k=document.querySelector(".standalone-iframe").contentWindow}),(g,n)=>{const r=z,d=re,P=O,j=G,ee=oe,ae=de,te=ce;return m(),v("div",fe,[u("div",he,[ge,u("div",be,[(m(!0),v(D,null,U(c.value.internalComp,t=>(m(),v("div",{key:t.name,draggable:"true",onDragstart:i,"data-material":t.name,"data-material-type":"internal",class:"material-item"},[u("span",{class:se(["iconfont material-icon",t.icon])},null,2),u("span",Ce,A(t.label),1)],40,ye))),128))])]),u("div",xe,[Se,u("div",we,[(m(!0),v(D,null,U(c.value.customComp,t=>(m(),v("div",{type:"dashed",key:t.value,draggable:"true",onDragstart:i,"data-material":t.value,"data-material-type":"custom",class:"material-item"},A(t.label),41,Ne))),128)),u("div",{type:"dashed",onClick:C,class:"material-item"},[u("span",null,[e(w(I)),S(" 添加组件 ")])])])]),e(te,{title:"添加自定义组件",width:"800px",open:p.value,"onUpdate:open":n[4]||(n[4]=t=>p.value=t),onOk:M,onCancel:N},{default:l(()=>[u("div",ke,[e(ae,{model:a.value,"label-col":{style:{width:"150px"}}},{default:l(()=>[e(d,{label:"名称"},{default:l(()=>[e(r,{value:a.value.title,"onUpdate:value":n[0]||(n[0]=t=>a.value.title=t)},null,8,["value"])]),_:1}),e(d,{label:"组件库名称"},{default:l(()=>[e(r,{value:a.value.package,"onUpdate:value":n[1]||(n[1]=t=>a.value.package=t)},null,8,["value"])]),_:1}),e(d,{label:"版本"},{default:l(()=>[e(r,{value:a.value.version,"onUpdate:value":n[2]||(n[2]=t=>a.value.version=t)},null,8,["value"])]),_:1}),e(d,{label:"导出名称"},{default:l(()=>[e(r,{value:a.value.exportName,"onUpdate:value":n[3]||(n[3]=t=>a.value.exportName=t)},null,8,["value"])]),_:1}),e(d,{label:"CDN地址"},{default:l(()=>[u("div",De,[(m(!0),v(D,null,U(a.value.urls,(t,$)=>(m(),v("div",{key:t,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(r,{value:a.value.urls[$],"onUpdate:value":f=>a.value.urls[$]=f},null,8,["value","onUpdate:value"]),e(w(F),{onClick:f=>Z(t),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(d,null,{default:l(()=>[e(P,{type:"dashed",block:"",onClick:Y},{default:l(()=>[e(w(I)),S(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(d,{label:"子组件"},{default:l(()=>[u("div",Ue,[(m(!0),v(D,null,U(a.value.children,(t,$)=>(m(),v("div",{key:t.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(j,null,{default:l(()=>[u("div",null,[e(j,null,{default:l(()=>[e(d,{label:"组件名",rules:{required:!0}},{default:l(()=>[e(r,{value:t.componentName,"onUpdate:value":f=>t.componentName=f},null,8,["value","onUpdate:value"])]),_:2},1024),e(d,{label:"导出名称",rules:{required:!0}},{default:l(()=>[e(r,{value:t.exportName,"onUpdate:value":f=>t.exportName=f},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(d,{label:"配置Schema",rules:{required:!0}},{default:l(()=>[e(ee,{value:t.schema,"onUpdate:value":f=>t.schema=f,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(w(F),{onClick:f=>X(t)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(d,null,{default:l(()=>[e(P,{type:"dashed",block:"",onClick:Q},{default:l(()=>[e(w(I)),S(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),$e=B(Me,[["__scopeId","data-v-168494c5"]]),Ie={text:{type:"input",label:"文本内容"}},qe={src:{type:"input",label:"图片地址"}},Te={src:{type:"input",label:"页面地址"}},Ee=s=>({dataset:{type:"select",label:"数据集",options:s},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),q={"qb-text":Ie,"qb-image":qe,"qb-iframe":Te,"qb-chart":Ee},Oe={class:"material-cfg"},Be={class:"material-cfg-btn"},Pe=E({__name:"MaterialCfg",setup(s){const h=H(),{customCompSchema:y}=J(h),_=b({}),o=b({}),c=b({}),i=new ve;window.addEventListener("message",a=>{a.data.type==="select"&&(o.value=a.data.data,o.value.type==="custom"?y.value&&(c.value=JSON.parse(y.value[o.value.component])):typeof q[o.value.component]=="function"?c.value=q[o.value.component]([]):c.value=q[o.value.component],_.value=a.data.data.props)});let p=null;const C=a=>{if(p)p.postMessage({type:"refresh",data:a});else throw new Error("contentWindow is null")},x=()=>{o.value.props=i.processObject(_.value),localStorage.setItem(`dg-raw-config-${o.value.id}`,JSON.stringify(_.value)),o.value.props=i.processObject(_.value),C(V(o.value))};return R(()=>{p=document.querySelector(".standalone-iframe").contentWindow}),(a,N)=>{const M=O;return m(),v("div",Oe,[(m(),ie(_e,{class:"material-cfg-contain",key:o.value.id,data:_.value,schema:c.value},null,8,["data","schema"])),u("div",Be,[e(M,{onClick:x},{default:l(()=>[S("刷新")]),_:1})])])}}}),je=B(Pe,[["__scopeId","data-v-b898bd80"]]),Ae=s=>(W("data-v-a0127664"),s=s(),L(),s),Fe={class:"dg-design"},Je={class:"dg-design-container"},Re=Ae(()=>u("div",{class:"middle-part"},[u("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),Ve=E({__name:"DashboardDesign",props:{id:{}},setup(s){window.name="dg-design";const h=s,{id:y}=pe(h),_=T(()=>y.value),o=()=>{};return(c,i)=>{const p=z,C=G,x=O,a=me;return m(),v("div",Fe,[e(a,{subTitle:_.value,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:l(()=>[e(p,{bordered:!1,class:"form-name"})]),extra:l(()=>[e(C),e(C),e(C,null,{default:l(()=>[e(x,{type:"primary"},{default:l(()=>[S("变量池")]),_:1}),e(x,{class:"preview-btn"},{default:l(()=>[S(" 预览 ")]),_:1}),e(x,{onClick:i[0]||(i[0]=N=>o()),type:"primary",class:"save-btn"},{default:l(()=>[S(" 保存 ")]),_:1})]),_:1})]),_:1},8,["subTitle"]),u("div",Je,[e($e,{class:"left-part"}),Re,e(je,{class:"right-part"})])])}}}),Ke=B(Ve,[["__scopeId","data-v-a0127664"]]);export{Ke as default};
