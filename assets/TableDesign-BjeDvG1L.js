import{b7 as ct,f as pt,r as c,aU as mt,g as M,s as he,I as K,o as m,y as R,l as e,i as l,aF as vt,B as r,K as J,w as a,aI as ft,A as Ne,J as Ve,F as $e,aa as De,Q as Z,O as z,W as ye,b8 as xe,ak as Pe,N as p,b9 as _t,ba as Me,a5 as N,h as E,ai as bt,L as Ce,M as Oe,bb as gt,x as we,bc as de,bd as yt,be as xt,bf as Ct,G as wt,bg as Fe,bh as ht,n as Dt,a6 as Ie,Y as ke,U as Ae,ab as It,P as kt,a7 as Ge,ac as Qe,ad as ze,ar as At,b3 as St,b2 as Rt,aJ as Tt,a8 as Ke,T as Le,aA as Bt,a4 as Ft,b1 as Ue,b4 as Ut,a2 as Et,b5 as Nt,a3 as Vt,bi as Ee,bj as $t,e as Pt,b6 as Mt,aM as Ot,aY as Gt,ap as Qt,aq as zt}from"./.pnpm-CNbA6tN1.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as Q}from"./main-BmbtOdKc.js";import{S as _e}from"./SchemaForm-CCK807lg.js";import{F as Kt,a as be}from"./FlowExecutor-BzgfmZhb.js";import{_ as Lt}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-af-FBJ48.js";import{u as Jt}from"./useReminder-DNKrrD2d.js";import"./iconfont-RswF9Ywb.js";/* empty css                   */import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-DSLBU7St.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-DYMxbBMO.js";const Wt=new ct,re=Wt,ie=pt("tableDesign",()=>{const w=c([]),b=c({name:"",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),v=c([]),h=c({});return{tableCfg:b,setTableCfg:o=>{b.value=o},currentColumn:h,onSelectColumn:(o,f)=>{const x=f.findIndex(V=>V.id===o);x!=-1&&(h.value=f[x])},onRemoveColumn:(o,f)=>{const x=f.findIndex(V=>V.id===o);x!=-1&&f.splice(x,1)},onAddColumn:()=>{const o=new Date().getTime().toString().slice(-4);b.value.columns.push({id:mt(),dataIndex:"field"+o,title:"列"+o,width:200})},tableData:w,onRefreshData:async o=>{},columnFields:v,onSetColumns:o=>{v.value=o},onAddBtn:o=>{b.value.action.push({id:new Date().getTime().toString(),name:"测试",position:o,eventFlow:{nodes:[],edges:[]},customEvent:!1,builtInEvents:"add",formId:""})},onRemoveBtn:o=>{const f=b.value.action.findIndex(x=>x.id==o);f!=-1&&b.value.action.splice(f,1)},onRemoveWidget:o=>{const f=b.value.filter.findIndex(x=>x.id==o);f!=-1&&b.value.filter.splice(f,1)}}}),qt={class:"custom-header-label",style:{flex:"1"}},Ht=M({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(w,{emit:b}){const v=ie(),{currentColumn:h}=he(v),y=w,{params:C}=K(y),d=()=>{re.onPublish("removeEvent",C.value)};return(T,D)=>{const u=De;return m(),R("div",{class:Ve(["custom-header-item",l(h).dataIndex==l(C).column.getColId()?"active":""]),style:$e([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:l(h).dataIndex==l(C).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[e(l(vt),{class:"move",style:{width:"20px",cursor:"move"}}),r("div",qt,J(l(C).displayName),1),e(u,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:D[0]||(D[0]=U=>d())},{default:a(()=>[e(l(ft),{class:"remove",style:{width:"20px"},onClick:Ne(()=>{},["stop"])})]),_:1})],6)}}}),jt={class:"custom-opt-cell"},Yt=["onClick"],Zt=M({__name:"CustomOptCell",setup(w){const b=ie(),{tableCfg:v}=he(b),h=Z(()=>{var D;return(D=v.value.action)==null?void 0:D.filter(u=>u.position=="row")}),{onAddBtn:y,onRemoveBtn:C}=b,d=D=>{re.onPublish("open-btn-modal",D)},T=()=>{y("row")};return(D,u)=>{const U=De;return m(),R("div",jt,[(m(!0),R(z,null,ye(h.value,F=>(m(),R("div",{class:"btn",key:F.id},[r("a",{onClick:s=>d(F)},J(F.name),9,Yt),e(U,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:s=>l(C)(F.id)},{default:a(()=>[e(l(xe),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),e(l(Pe),{style:{cursor:"pointer"},onClick:u[0]||(u[0]=F=>T())})])}}}),Xt={class:"custom-header-label",style:{flex:"1"}},ea=M({__name:"CustomAddColumn",setup(w){const b=ie(),{onAddColumn:v}=b;return(h,y)=>{const C=Me;return m(),R("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:y[0]||(y[0]=d=>l(v)())},[r("div",Xt,[e(l(Pe)),p(" 新增列 "),e(C,null,{title:a(()=>[p("用于新增列配置")]),default:a(()=>[e(l(_t))]),_:1})])])}}}),ta={class:"cell"},aa={key:0},la=["href"],oa=M({__name:"CustomCellRender",props:{params:{}},setup(w){const b=w,{params:v}=K(b);return(h,y)=>{const C=bt;return m(),R("div",ta,[l(v).colDef.cellRendererParams.type=="text"?(m(),R("span",aa,J(l(v).value),1)):N("",!0),l(v).colDef.cellRendererParams.type=="image"?(m(),E(C,{key:1,src:l(v).value},null,8,["src"])):N("",!0),l(v).colDef.cellRendererParams.type=="link"?(m(),R("a",{key:2,href:l(v).value},J(l(v).value),9,la)):N("",!0)])}}}),na=M({__name:"AgTable",props:Ce({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:Ce(["onRemove","onClick"],["update:columns"]),setup(w,{emit:b}){re.onSubscribe("removeEvent",s=>{let o=s.column.getColId(),f=v.value.find(x=>x.dataIndex==o);f&&U(f)});const v=Oe(w,"columns"),h=w,{columnId:y,tableData:C}=K(h),d=Z(()=>{let s=v.value.map(o=>({field:o.dataIndex,colId:o.dataIndex,headerName:o.title,pinned:o.fixed=="none"?void 0:o.fixed,lockVisible:!0,headerComponent:Ht,cellRenderer:oa,cellRendererParams:{type:o.type}}));return s.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:ea}),s.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:Zt}),s}),T=s=>{if(!s.finished)return;let o=[];s.api.getColumnState().forEach(f=>{let x=v.value.find(V=>V.dataIndex==f.colId);x&&o.push(x)}),v.value=o},D=s=>{if(!s.finished)return;let o=s.column.getColId(),f=v.value.findIndex(x=>x.dataIndex==o);f!=-1&&(v.value[f].width=s.column.getActualWidth())},u=b,U=s=>{u("onRemove",s)},F=s=>{let o=s.column.getId(),f=v.value.find(x=>x.dataIndex==o);u("onClick",f)};return(s,o)=>(m(),E(l(gt),{rowData:l(C),columnDefs:d.value,style:$e({height:s.height+"px"}),class:"ag-theme-quartz",onColumnMoved:T,onColumnResized:D,onColumnHeaderClicked:F},null,8,["rowData","columnDefs","style"]))}}),sa=X(na,[["__scopeId","data-v-5dd2184c"]]),ua=M({__name:"EventFlow",props:{dndList:{default:()=>[{type:"circle",text:"开始",label:"开始节点",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAAnBJREFUOBGdVL1rU1EcPfdGBddmaZLiEhdx1MHZQXApraCzQ7GKLgoRBxMfcRELuihWKcXFRcEWF8HBf0DdDCKYRZpnl7p0svLe9Zzbd29eQhTbC8nv+9zf130AT63jvooOGS8Vf9Nt5zxba7sXQwODfkWpkbjTQfCGUd9gIp3uuPP8bZ946g56dYQvnBg+b1HB8VIQmMFrazKcKSvFW2dQTxJnJdQ77urmXWOMBCmXM2Rke4S7UAW+/8ywwFoewmBps2tu7mbTdp8VMOkIRAkKfrVawalJTtIliclFbaOBqa0M2xImHeVIfd/nKAfVq/LGnPss5Kh00VEdSzfwnBXPUpmykNss4lUI9C1ga+8PNrBD5YeqRY2Zz8PhjooIbfJXjowvQJBqkmEkVnktWhwu2SM7SMx7Cj0N9IC0oQXRo8xwAGzQms+xrB/nNSUWVveI48ayrFGyC2+E2C+aWrZHXvOuz+CiV6iycWe1Rd1Q6+QUG07nb5SbPrL4426d+9E1axKjY3AoRrlEeSQo2Eu0T6BWAAr6COhTcWjRaYfKG5csnvytvUr/WY4rrPMB53Uo7jZRjXaG6/CFfNMaXEu75nG47X+oepU7PKJvvzGDY1YLSKHJrK7vFUwXKkaxwhCW3u+sDFMVrIju54RYYbFKpALZAo7sB6wcKyyrd+aBMryMT2gPyD6GsQoRFkGHr14TthZni9ck0z+Pnmee460mHXbRAypKNy3nuMdrWgVKj8YVV8E7PSzp1BZ9SJnJAsXdryw/h5ctboUVi4AFiCd+lQaYMw5z3LGTBKjLQOeUF35k89f58Vv/tGh+l+PE/wG0rgfIUbZK5AAAAABJRU5ErkJggg=="},{type:"rect",label:"用户任务",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAEFVwZaAAAABGdBTUEAALGPC/xhBQAAAqlJREFUOBF9VM9rE0EUfrMJNUKLihGbpLGtaCOIR8VjQMGDePCgCCIiCNqzCAp2MyYUCXhUtF5E0D+g1t48qAd7CCLqQUQKEWkStcEfVGlLdp/fm3aW2QQdyLzf33zz5m2IsAZ9XhDpyaaIZkTS4ASzK41TFao88GuJ3hsr2pAbipHxuSYyKRugagICGANkfFnNh3HeE2N0b3nN2cgnpcictw5veJIzxmDamSlxxQZicq/mflxhbaH8BLRbuRwNtZp0JAhoplVRUdzmCe/vO27wFuuA3S5qXruGdboy5/PRGFsbFGKo/haRtQHIrM83bVeTrOgNhZReWaYGnE4aUQgTJNvijJFF4jQ8BxJE5xfKatZWmZcTQ+BVgh7s8SgPlCkcec4mGTmieTP4xd7PcpIEg1TX6gdeLW8rTVMVLVvb7ctXoH0Cydl2QOPJBG21STE5OsnbweVYzAnD3A7PVILuY0yiiyDwSm2g441r6rMSgp6iK42yqroI2QoXeJVeA+YeZSa47gZdXaZWQKTrG93rukk/l2Al6Kzh5AZEl7dDQy+JjgFahQjRopSxPbrbvK7GRe9ePWBo1wcU7sYrFZtavXALwGw/7Dnc50urrHJuTPSoO2IMV3gUQGNg87IbSOIY9BpiT9HV7FCZ94nPXb3MSnwHn/FFFE1vG6DTby+r31KAkUktB3Qf6ikUPWxW1BkXSPQeMHHiW0+HAd2GelJsZz1OJegCxqzl+CLVHa/IibuHeJ1HAKzhuDR+ymNaRFM+4jU6UWKXorRmbyqkq/D76FffevwdCp+jN3UAN/C9JRVTDuOxC/oh+EdMnqIOrlYteKSfadVRGLJFJPSB/ti/6K8f0CNymg/iH2gO/f0DwE0yjAFO6l8JaR5j0VPwPwfaYHqOqrCI319WzwhwzNW/aQAAAABJRU5ErkJggg==",className:"important-node"}]},data:{}},emits:["onClickEle"],setup(w,{expose:b,emit:v}){const h=v,y=c(),C=c(),d=w,{dndList:T,data:D}=K(d),u=s=>{h("onClickEle",s)};return we(()=>{de.use(yt),de.use(xt),de.use(Ct),y.value=new de({container:C.value,grid:!0}),y.value.extension.dndPanel.setPatternItems(T.value),y.value.extension.menu.setMenuConfig({nodeMenu:[{text:"删除",callback(s){y.value.deleteNode(s.id)}}],edgeMenu:[{text:"删除",callback(s){y.value.deleteEdge(s.id)}}],graphMenu:!1}),y.value.render(D.value),y.value.on("node:click",u)}),wt(()=>D.value,()=>{y.value.render(D.value)}),b({getRawData:()=>{var s;return(s=y.value)==null?void 0:s.getGraphRawData()},updateNodeData:s=>{var o,f;(f=(o=y.value)==null?void 0:o.getNodeModelById(s.id))==null||f.setProperties({extraData:s.properties.extraData})}}),(s,o)=>(m(),R("div",{class:"flow-container",ref_key:"container",ref:C},null,512))}}),da=X(ua,[["__scopeId","data-v-c088af38"]]),ra={key:2,style:{display:"flex"}},ia=M({__name:"EditTable",props:Ce({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(w){const b=Oe(w,"modelValue");let v=w;const{columns:h,action:y}=K(v),C=Z(()=>u("input")),d=Z(()=>u("select")),T=Z(()=>y.value?[...h.value,{title:"操作",dataIndex:"_action_"}]:h.value),D=s=>{var o;return((o=h.value.find(f=>f.dataIndex==s))==null?void 0:o.options)||[]},u=s=>h.value.filter(o=>o.type==s).map(o=>o.dataIndex),U=()=>{let s={};h.value.map(o=>{Reflect.set(s,o.dataIndex,"")}),b.value.push(s)},F=s=>{b.value.splice(s,1)};return(s,o)=>{const f=Ie,x=ke,V=Ae,W=It;return m(),E(W,{columns:T.value,"data-source":b.value,pagination:!1,rowKey:($,B)=>B,size:"small",scroll:{y:s.height}},{bodyCell:a(({column:$,record:B,index:i})=>[C.value.includes($.dataIndex)?(m(),E(f,{key:0,value:B[$.dataIndex],"onUpdate:value":P=>B[$.dataIndex]=P},null,8,["value","onUpdate:value"])):N("",!0),d.value.includes($.dataIndex)?(m(),E(x,{key:1,value:B[$.dataIndex],"onUpdate:value":P=>B[$.dataIndex]=P,options:D($.dataIndex)},null,8,["value","onUpdate:value","options"])):N("",!0),$.dataIndex=="_action_"?(m(),R("div",ra,[e(l(Fe),{class:"icon",onClick:o[0]||(o[0]=P=>U())}),e(l(ht),{class:"icon",onClick:P=>F(i)},null,8,["onClick"])])):N("",!0)]),emptyText:a(()=>[e(V,{type:"text",onClick:U,icon:Dt(l(Fe))},{default:a(()=>[p(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),ge=X(ia,[["__scopeId","data-v-5b9e8dbe"]]),ca={key:0,style:{color:"red"}},pa=M({__name:"FlowView",props:{data:{default:()=>({nodes:[],edges:[]})}},setup(w,{expose:b}){const v=w,{data:h}=K(v),y=c([{type:"circle",text:"开始",label:"开始节点",icon:"/src/assets/images/flow/开始.png",properties:{nodeType:"start-node",extraData:{}}},{type:"circle",text:"结束",label:"结束节点",icon:"/src/assets/images/flow/结束.png",properties:{nodeType:"end-node",extraData:{}}},{type:"rect",text:"处理函数",label:"处理函数",icon:"/src/assets/images/flow/js函数.png",properties:{nodeType:"func-node",extraData:{code:""}}},{type:"rect",text:"打开弹窗",label:"弹窗",icon:"/src/assets/images/flow/弹窗.png",properties:{nodeType:"modal-node",extraData:{size:"small",formId:""}}},{type:"rect",text:"跳转外部链接",label:"链接",icon:"/src/assets/images/flow/链接.png",properties:{nodeType:"link-node",extraData:{url:"",openType:"_blank"}}},{type:"diamond",text:"请求数据",label:"请求数据",icon:"/src/assets/images/flow/发起请求.png",properties:{nodeType:"request-node",extraData:{url:"",method:"get",params:[],headers:[],body:[]}}}]),C=c(!1),d=c({}),T=c(),D=c([]),u=c([{value:"get",label:"GET"},{value:"post",label:"POST"}]),U=c([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),F=c([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),s=c(""),o=B=>{C.value=!0,d.value=B.data};Q.getFormDict().then(B=>{const{code:i,data:P,msg:ee}=B;i==200&&(D.value=P)});const f=()=>{T.value.updateNodeData(d.value)},x=c(!1),V=c("");b({getData:()=>T.value.getRawData()});const $=async()=>{x.value=!1,V.value="";try{const B=T.value.getRawData(),i=new Kt(B);await i.run(),s.value=JSON.stringify(i.getState(),null,4)}catch(B){x.value=!0,V.value=B}};return(B,i)=>{const P=kt,ee=da,te=Ae,q=Lt,O=Ge,G=Qe,H=ze,ae=ke,ce=At,le=Ie,j=St,I=Rt,Y=Tt,oe=Ke,ne=Le;return m(),R(z,null,[e(P,null,{default:a(()=>[p("配置区")]),_:1}),e(ee,{ref_key:"eventFlowRef",ref:T,data:l(h),dndList:y.value,style:{height:"450px"},onOnClickEle:o},null,8,["data","dndList"]),e(te,{onClick:i[0]||(i[0]=g=>$()),type:"primary",style:{"margin-top":"10px"}},{default:a(()=>[p("执行")]),_:1}),e(P,null,{default:a(()=>[p("运行结果")]),_:1}),x.value?(m(),R("div",ca,"错误日志: "+J(V.value),1)):(m(),E(q,{key:1,value:s.value,"onUpdate:value":i[1]||(i[1]=g=>s.value=g),height:"200",readOnly:""},null,8,["value"])),e(ne,{open:C.value,"onUpdate:open":i[12]||(i[12]=g=>C.value=g),title:"节点配置",placement:"right",onClose:i[13]||(i[13]=g=>f()),width:"400px"},{default:a(()=>[e(oe,{model:d.value.properties.extraData},{default:a(()=>[d.value.properties.nodeType=="func-node"?(m(),E(O,{key:0,label:"函数"},{default:a(()=>[e(q,{value:d.value.properties.extraData.code,"onUpdate:value":i[2]||(i[2]=g=>d.value.properties.extraData.code=g),prepend:"()=>{",append:"}",theme:"light"},null,8,["value"])]),_:1})):N("",!0),d.value.properties.nodeType=="modal-node"?(m(),R(z,{key:1},[e(O,{label:"弹窗大小"},{default:a(()=>[e(H,{value:d.value.properties.extraData.size,"onUpdate:value":i[3]||(i[3]=g=>d.value.properties.extraData.size=g),"button-style":"solid"},{default:a(()=>[e(G,{value:"small"},{default:a(()=>[p("小")]),_:1}),e(G,{value:"middle"},{default:a(()=>[p("中")]),_:1}),e(G,{value:"large"},{default:a(()=>[p("大")]),_:1})]),_:1},8,["value"])]),_:1}),e(O,{label:"表单"},{default:a(()=>[e(ae,{value:d.value.properties.extraData.formId,"onUpdate:value":i[4]||(i[4]=g=>d.value.properties.extraData.formId=g),options:D.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})],64)):N("",!0),d.value.properties.nodeType=="link-node"?(m(),R(z,{key:2},[e(O,{label:"链接地址"},{default:a(()=>[e(ce,{value:d.value.properties.extraData.url,"onUpdate:value":i[5]||(i[5]=g=>d.value.properties.extraData.url=g)},null,8,["value"])]),_:1}),e(O,{label:"打开方式"},{default:a(()=>[e(H,{value:d.value.properties.extraData.openType,"onUpdate:value":i[6]||(i[6]=g=>d.value.properties.extraData.openType=g),"button-style":"solid"},{default:a(()=>[e(G,{value:"_selef"},{default:a(()=>[p("当前页")]),_:1}),e(G,{value:"_blank"},{default:a(()=>[p("新窗口")]),_:1})]),_:1},8,["value"])]),_:1})],64)):N("",!0),d.value.properties.nodeType=="request-node"?(m(),R(z,{key:3},[e(le,{value:d.value.properties.extraData.url,"onUpdate:value":i[8]||(i[8]=g=>d.value.properties.extraData.url=g)},{addonBefore:a(()=>[e(ae,{value:d.value.properties.extraData.method,"onUpdate:value":i[7]||(i[7]=g=>d.value.properties.extraData.method=g),options:u.value},null,8,["value","options"])]),_:1},8,["value"]),r("div",null,[e(I,null,{default:a(()=>[e(j,{key:"params",tab:"params"},{default:a(()=>[e(ge,{columns:U.value,modelValue:d.value.properties.extraData.params,"onUpdate:modelValue":i[9]||(i[9]=g=>d.value.properties.extraData.params=g)},null,8,["columns","modelValue"])]),_:1}),e(j,{key:"headers",tab:"headers"},{default:a(()=>[e(ge,{columns:F.value,modelValue:d.value.properties.extraData.headers,"onUpdate:modelValue":i[10]||(i[10]=g=>d.value.properties.extraData.headers=g)},null,8,["columns","modelValue"])]),_:1}),e(j,{key:"body",tab:"body"},{default:a(()=>[e(ge,{columns:U.value,modelValue:d.value.properties.extraData.body,"onUpdate:modelValue":i[11]||(i[11]=g=>d.value.properties.extraData.body=g)},null,8,["columns","modelValue"])]),_:1})]),_:1})])],64)):N("",!0),["start-node","end-node"].includes(d.value.properties.nodeType)?(m(),E(Y,{key:4,description:"起止节点暂无配置项"})):N("",!0)]),_:1},8,["model"])]),_:1},8,["open"])],64)}}}),ma=X(pa,[["__scopeId","data-v-9c234d0a"]]),Je=w=>(Qt("data-v-29c13469"),w=w(),zt(),w),va={class:"table-design"},fa={class:"table-design-container"},_a={class:"main-part"},ba={class:"filter-container"},ga=["onClick"],ya={class:"add widget-item"},xa={class:"tools-part"},Ca={class:"tools-container"},wa={class:"add button-item"},ha={class:"table-part"},Da=Je(()=>r("h3",null,[p(" 工作流配置注意事项"),r("strong",{style:{color:"red"}},"(目前只支持线性工作流,没有条件判断或并行执行的能力)")],-1)),Ia=Je(()=>r("ul",null,[r("li",null,[r("strong",null,"工作流节点不能为空："),p(" 每个工作流"),r("strong",null,"必须"),p("包含有效的节点配置。 ")]),r("li",null,[r("strong",null,"包含开始与结束节点："),p(" 每个工作流"),r("strong",null,"必须"),p("包含一个“开始节点”和一个“结束节点”。 ")]),r("li",null,[r("strong",{style:{color:"red"}},"重要参数："),r("code",null,"this.state.modalFormData"),p("为弹窗表单数据， "),r("code",null,"this.state.requestData"),p("为请求数据， 两者既可以作为输入也可以作为输出，搭配"),r("strong",null,"处理函数"),p("节点使用，可以实现数据的填充或者数据的保存。 ")]),r("li",null,[r("strong",null,"节点内变量引用："),p(" 在"),r("strong",null,"处理函数"),p("节点中，可以通过 "),r("code",null,"this.state.xxx"),p(" 的方式引用当前工作流中的变量。 在"),r("strong",null,"请求配置"),p("节点中，在"),r("strong",null,"引用变量"),p("列中可以通过"),r("code",null,"state.xxx"),p("引用变量数据，也可以配置"),r("strong",null,"Value"),p("列使用静态数据。 ")]),r("li",null,[r("strong",null,"预览结果："),p(" 执行后，预览结果仅显示当前工作流的 "),r("code",null,"state"),p(" 属性，其他信息不可见。 ")])],-1)),ka=M({__name:"TableDesign",props:{id:{}},setup(w){Bt();const{shouldShowReminder:b}=Jt("low-code-table-design"),v=c(0),h=[{title:"数据源",description:"选择你在系统内已配置好的数据源",target:()=>document.querySelector(".extra"),placement:"bottom"},{title:"列配置区域",description:"对已配置数据源的表格的列进行配置，可以拖拽调整列的顺序，点击列进行详细配置",target:()=>document.querySelector(".table-part"),placement:"top"},{title:"筛选条件区域",description:"添加当前表格的筛选条件，可以拖拽调整筛选条件的顺序，点击筛选条件进行详细配置",target:()=>document.querySelector(".filter-container"),placement:"bottom"},{title:"按钮操作配置区域",description:"添加当前表格的操作按钮，可以拖拽调整按钮的顺序，点击按钮进行详细配置",target:()=>document.querySelector(".tools-container"),placement:"bottom"},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn"),placement:"left"}];re.onSubscribe("open-btn-modal",_=>{oe(_)});const y=c([]);we(()=>{Q.getDataSourceDict().then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(y.value=A)})});const C=w,{id:d}=K(C),T=c(!1),D=ie(),{tableCfg:u,currentColumn:U}=he(D),{onSelectColumn:F,onRemoveBtn:s,onRemoveColumn:o,onSetColumns:f,onRemoveWidget:x,onAddBtn:V,setTableCfg:W}=D;d.value?(T.value=!0,be.getDetail(d.value).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(W(A),G(),q(),T.value=!1)})):W({name:"未命名列表",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),window.name="table-design";const $=c([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),B=()=>{var _;(_=u.value.filter)==null||_.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},i=()=>{window.open("/lowcode/table","quick-build")},P=_=>{F(_.id,u.value.columns),pe.value=!0},ee=_=>{o(_.id,u.value.columns)};c([]);const te=c([]),q=()=>{Q.getSourceData(u.value.dataSource.sourceId,u.value.dataSource.tableName).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(te.value=A)})},O=c([]),G=()=>{Q.getTableInfo(u.value.dataSource.sourceId).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(O.value=A)})},H=async()=>{if(!u.value.dataSource.sourceId||!u.value.dataSource.tableName)return[];const{code:_,data:t,msg:A}=await Q.getColumnInfo(u.value.dataSource.sourceId,u.value.dataSource.tableName);return _==200?t.map(S=>({label:S.columnComment?`${S.columnComment}(${S.columnName})`:S.columnName,value:S.columnName})):[]},ae=()=>{Q.getColumnInfo(u.value.dataSource.sourceId,u.value.dataSource.tableName).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(u.value.columns=A.map(k=>({dataIndex:k.columnName,title:k.columnComment||k.columnName,id:k.columnName,width:200,type:"text",align:"left",fixed:"none"})),f(A.map(k=>({label:k.columnComment?`${k.columnComment}(${k.columnName})`:k.columnName,value:k.columnName}))))}),q()},ce=()=>{V("header")},le=c([]),j=()=>{Q.getFormDict().then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(le.value=A)})};we(()=>{j()});const I=c({id:"",name:"",eventFlow:{nodes:[],edges:[]},position:"header",customEvent:!1,builtInEvents:"add",formId:""}),Y=c(!1),oe=_=>{I.value=_,Y.value=!0},ne=c({}),g=c(!1),We=c({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"select",label:"字段名称",component:{asyncData:H}},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dictType:{type:"radio",label:"字典类型",show:'"${formData.type}" == "select"',tooltip:"字典为系统的字典配置数据，列数据为当前配置字段的列数据",component:{dataSource:[{label:"字典",value:"dict"},{label:"列数据",value:"col"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",tooltip:"可以在系统配置自定义字典",show:'"${formData.type}" == "select" && "${formData.dictType}" == "dict"',component:{asyncData:async()=>{const{code:_,data:t,msg:A}=await Q.getDictTypeList();return _==200?t.map(S=>({label:S.dictTypeDesc,value:S.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),qe=c({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:H}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),He=_=>{ne.value=_,g.value=!0},pe=c(!1),me=c(!1),je=c({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"120px"}}},properties:{showFilter:{type:"switch",label:"显示筛选面板"},showPagination:{type:"switch",label:"显示分页器"},showBordered:{type:"switch",label:"显示边框"},size:{type:"radio",label:"表格尺寸",component:{dataSource:[{label:"紧凑",value:"small"},{label:"默认",value:"middle"},{label:"宽松",value:"large"}],buttonStyle:"solid"}}}}),Ye=()=>{me.value=!0},Ze=()=>{T.value=!0,(d.value?be.update:be.add)(u.value).then(t=>{const{code:A,data:S,msg:k}=t;A==200&&Pt.success("保存成功"),T.value=!1})},se=c(!1),ve=c({nodes:[],edges:[]}),Xe=_=>{ve.value=_.eventFlow,se.value=!0},Se=c(),et=()=>{I.value.eventFlow=Se.value.getData(),Re()},Re=()=>{ve.value={nodes:[],edges:[]},se.value=!1};return(_,t)=>{const A=Ie,S=ke,k=Ge,L=Ae,tt=Mt,at=Ut,lt=Ot,Te=De,Be=Qe,ot=ze,nt=Gt,st=Ke,ue=Le,ut=Me,dt=Et,rt=Nt,it=Vt("loading");return m(),R(z,null,[Ft((m(),R("div",va,[e(at,{onBack:i,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[e(A,{value:l(u).name,"onUpdate:value":t[0]||(t[0]=n=>l(u).name=n),bordered:!1,class:"table-name"},null,8,["value"])]),extra:a(()=>[e(tt,{class:"extra"},{default:a(()=>[e(k,{label:"选择数据源"},{default:a(()=>[e(S,{value:l(u).dataSource.sourceId,"onUpdate:value":t[1]||(t[1]=n=>l(u).dataSource.sourceId=n),options:y.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:t[2]||(t[2]=n=>G())},null,8,["value","options"])]),_:1}),e(k,{label:"选择表名"},{default:a(()=>[e(S,{value:l(u).dataSource.tableName,"onUpdate:value":t[3]||(t[3]=n=>l(u).dataSource.tableName=n),options:O.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:t[4]||(t[4]=n=>ae())},null,8,["value","options"])]),_:1}),e(L,{type:"primary",onClick:Ye,class:"global-btn"},{default:a(()=>[p("全局配置")]),_:1}),e(L,{onClick:t[5]||(t[5]=n=>Ze()),type:"primary",class:"save-btn"},{default:a(()=>[p(" 保存 ")]),_:1})]),_:1})]),_:1}),r("div",fa,[r("div",_a,[r("div",{class:Ve(["filter-part",{disabled:!l(u).global.showFilter}])},[r("div",ba,[e(l(Ue),{list:l(u).filter,"onUpdate:list":t[7]||(t[7]=n=>l(u).filter=n),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(m(!0),R(z,null,ye(l(u).filter,n=>(m(),R("div",{class:"widget-item",key:n.id,onClick:fe=>He(n)},[e(l(Ee),{class:"move-handle",style:{cursor:"pointer"}}),e(k,{label:n.label,name:n.field},{default:a(()=>[n.type=="input"?(m(),E(A,{key:0})):n.type=="select"?(m(),E(S,{key:1})):(m(),E(lt,{key:2}))]),_:2},1032,["label","name"]),e(Te,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:fe=>l(x)(n.id)},{default:a(()=>[e(l(xe),{class:"remove-btn",onClick:Ne(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,ga))),128)),r("div",ya,[e(L,{type:"primary",onClick:t[6]||(t[6]=n=>B())},{default:a(()=>[p(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])],2),r("div",xa,[r("div",Ca,[e(l(Ue),{list:l(u).action,"onUpdate:list":t[9]||(t[9]=n=>l(u).action=n),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(m(!0),R(z,null,ye(l(u).action.filter(n=>n.position=="header"),n=>(m(),R("div",{class:"button-item",key:n.id},[e(l(Ee),{class:"move-handle",style:{cursor:"pointer"}}),e(L,{onClick:fe=>oe(n)},{default:a(()=>[p(J(n.name),1)]),_:2},1032,["onClick"]),e(Te,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:fe=>l(s)(n.id)},{default:a(()=>[e(l(xe),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),r("div",wa,[e(L,{type:"primary",onClick:t[8]||(t[8]=n=>ce())},{default:a(()=>[p(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),r("div",ha,[e(sa,{columns:l(u).columns,"onUpdate:columns":t[10]||(t[10]=n=>l(u).columns=n),tableData:te.value,height:550,onOnRemove:ee,onOnClick:P},null,8,["columns","tableData"])])])])])),[[it,T.value,void 0,{fullscreen:!0}]]),e(ue,{title:"按钮配置",placement:"right",closable:!1,open:Y.value,onClose:t[18]||(t[18]=n=>Y.value=!1)},{default:a(()=>[e(st,{model:I.value},{default:a(()=>[e(k,{prop:"id",label:"按钮标识"},{default:a(()=>[e(A,{value:I.value.id,"onUpdate:value":t[11]||(t[11]=n=>I.value.id=n)},null,8,["value"])]),_:1}),e(k,{prop:"name",label:"按钮名称"},{default:a(()=>[e(A,{value:I.value.name,"onUpdate:value":t[12]||(t[12]=n=>I.value.name=n)},null,8,["value"])]),_:1}),e(k,{prop:"name",label:"按钮位置"},{default:a(()=>[e(ot,{value:I.value.position,"onUpdate:value":t[13]||(t[13]=n=>I.value.position=n),"button-style":"solid"},{default:a(()=>[e(Be,{value:"header"},{default:a(()=>[p("表头")]),_:1}),e(Be,{value:"row"},{default:a(()=>[p("行内")]),_:1})]),_:1},8,["value"])]),_:1}),e(k,{prop:"customEvent",label:"是否启用自定义"},{default:a(()=>[e(nt,{checked:I.value.customEvent,"onUpdate:checked":t[14]||(t[14]=n=>I.value.customEvent=n)},null,8,["checked"])]),_:1}),I.value.customEvent?N("",!0):(m(),E(k,{key:0,prop:"builtInEvents",label:"内置事件"},{default:a(()=>[e(S,{value:I.value.builtInEvents,"onUpdate:value":t[15]||(t[15]=n=>I.value.builtInEvents=n),options:$.value,allowClear:""},null,8,["value","options"])]),_:1})),["add","edit"].includes(I.value.builtInEvents)&&!I.value.customEvent?(m(),E(k,{key:1,prop:"formId",label:"关联表单"},{default:a(()=>[e(S,{value:I.value.formId,"onUpdate:value":t[16]||(t[16]=n=>I.value.formId=n),options:le.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})):N("",!0),I.value.customEvent?(m(),E(k,{key:2,prop:"event",label:"自定义工作流"},{default:a(()=>[e(L,{onClick:t[17]||(t[17]=n=>Xe(I.value))},{default:a(()=>[p(" 自定义工作流 ")]),_:1})]),_:1})):N("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),e(ue,{title:"筛选控件配置",placement:"right",closable:!1,open:g.value,onClose:t[19]||(t[19]=n=>g.value=!1)},{default:a(()=>[e(l(_e),{formData:ne.value,schema:We.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(ue,{title:"列配置",placement:"right",closable:!1,open:pe.value,onClose:t[20]||(t[20]=n=>pe.value=!1)},{default:a(()=>[e(l(_e),{formData:l(U),schema:qe.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(ue,{title:"全局配置",placement:"right",closable:!1,open:me.value,onClose:t[21]||(t[21]=n=>me.value=!1)},{default:a(()=>[e(l(_e),{formData:l(u).global,schema:je.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(dt,{width:"100%","wrap-class-name":"full-modal",open:se.value,"onUpdate:open":t[22]||(t[22]=n=>se.value=n),onOk:et,onCancel:Re},{title:a(()=>[p(" 工作流配置 "),e(ut,{overlayInnerStyle:{width:"600px",color:"#000"},color:"#ffffff",arrow:!1,placement:"rightBottom"},{title:a(()=>[Da,Ia]),default:a(()=>[e(l($t))]),_:1})]),default:a(()=>[e(ma,{data:ve.value,ref_key:"flowRef",ref:Se},null,8,["data"])]),_:1},8,["open"]),e(rt,{current:v.value,"onUpdate:current":t[23]||(t[23]=n=>v.value=n),open:l(b),steps:h,onClose:t[24]||(t[24]=n=>b.value=!1)},null,8,["current","open"])],64)}}}),Pa=X(ka,[["__scopeId","data-v-29c13469"]]);export{Pa as default};
