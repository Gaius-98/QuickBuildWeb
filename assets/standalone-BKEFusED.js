import"./iconfont-RswF9Ywb.js";import{f as M,r as l,t as E,v as x,g as D,s as V,x as L,o as h,y as I,l as z,w as R,i as f,A as O,k as N,B as $,h as k,C as j,D as A,E as P,F as B,G,H as Q,I as T,J as H,K as W,m as J,p as F,$ as K}from"./.pnpm-Tz7u9Cxq.js";import{c as q}from"./componentsSchema-CXBH1gc0.js";import{D as U,a as X}from"./DynamicLoader-BG-pDqNI.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y=M("dgDesign",()=>{const n=l({}),s=l([]),c=l({}),d=t=>{s.value.push(t)},_=t=>{const{id:e}=t,a=s.value.findIndex(i=>i.id===e);a!==-1&&s.value.splice(a,1)},p=t=>{const e=q.findIndex(i=>i.name===t);if(e===-1)throw new Error("组件不存在");const a=E(q[e]);return a.id=new Date().getTime().toString(),a},r=t=>{c.value=t,window.parent.postMessage({type:"select",data:x(t)},window.location.origin)},g=t=>{const{id:e}=t,a=s.value.findIndex(i=>i.id===e);a!==-1&&s.value.splice(a,1,t)},w=t=>new U(m.value).processObject(t),v=l({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),b=t=>{v.value=t,o()},m=l({}),y=t=>{const e={},a=(i,u)=>{switch(i){case"string":return u;case"number":return Number(u);case"boolean":return!!u;case"array":case"object":return JSON.parse(u);default:return u}};return t.reduce((i,u)=>(i[u.name]=a(u.type,u.defaultValue),i),e),e},o=()=>{m.value=y(v.value.vars)};return{dashboardData:n,add:d,remove:_,dgList:s,initDgItem:p,selectItem:r,curComp:c,updateItem:g,transformProps:w,updateVariables:o,setVarPools:b}}),Z=12,tt=8,et=D({__name:"StandalonePage",setup(n){const s=Y(),{dgList:c}=V(s),{initDgItem:d,add:_,selectItem:p,updateItem:r,transformProps:g,setVarPools:w}=s,v=l(),b=l(0),m=o=>{const t=o.dataTransfer.getData("material-type");let e;t=="custom"?e={name:o.dataTransfer.getData("material"),id:new Date().getTime().toString(),label:"自定义组件",icon:"",type:"custom",component:o.dataTransfer.getData("material"),props:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2}:e=d(o.dataTransfer.getData("material"));const a=o.x/(b.value/Z),i=o.y/tt;e.colStart=Math.floor(a),e.rowStart=Math.floor(i),_(e)},y=l({});return window.addEventListener("message",o=>{o.data.type==="refresh"?r(o.data.data):o.data.type==="add-custom-comp"?new X([o.data.data]).load().then(e=>{Object.keys(e).forEach(a=>{y.value[a]=e[a]})}):o.data.type==="refresh-var"&&w(o.data.data)}),L(()=>{b.value=v.value.clientWidth}),(o,t)=>{const e=N("grid-layout");return h(),I("div",{class:"container",ref_key:"container",ref:v,onDragover:t[0]||(t[0]=O(()=>{},["prevent","stop"])),onDrop:O(m,["stop"])},[z(e,{list:f(c),class:"layout","onItem:click":f(p)},{"layout-item":R(({item:a})=>[$("div",{class:"comp-container",style:B(a.style)},[a.type&&a.type==="custom"?(h(),k(P(y.value[a.component]),j(A({key:0},f(g)(a.props))),null,16)):(h(),k(P(a.component),{key:1,attrs:f(g)(a.props)},null,8,["attrs"]))],4)]),_:1},8,["list","onItem:click"])],544)}}}),at=C(et,[["__scopeId","data-v-0627169b"]]),st=D({__name:"QBChart",props:{attrs:{default:()=>({dataset:"",dimension:[],target:[]})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:c,styleConfig:d}=s,_=l(!0),p=l();let r;const g=l(0),w=l(""),v=l(),b=async()=>{w.value=c.dataset,v.value=[{title:"title1",value:100},{title:"title2",value:200},{title:"title3",value:300}]},m=()=>{const{dimension:t,target:e}=c,a=x(d.option),i=x(d.series),u=[];return e.forEach(_t=>{u.push(E(i))}),a.series=u,{...a,dataset:{source:x(v.value),dimensions:[...t,...e]}}},y=()=>{w.value!=c.dataset?b().then(()=>{r?(r.clear(),r.setOption(m())):p.value&&(r=Q(p.value),r.setOption(m()))}):r?(r.clear(),r.setOption(m())):p.value&&(r=Q(p.value),r.setOption(m())),_.value=!1},o=new ResizeObserver(t=>{g.value&&clearTimeout(g.value),g.value=window.setTimeout(()=>{try{r.resize()}catch(e){console.warn(`chart重新设置大小失败,失败原因：${e}`)}},50)});return L(()=>{y(),o.observe(p.value)}),G(()=>[s.attrs,s.styleConfig],()=>{y()},{deep:!0}),(t,e)=>(h(),I("div",{ref_key:"QBChart",ref:p,class:"qb-chart"},null,512))}}),ot=C(st,[["__scopeId","data-v-996b3f25"]]),nt={class:"qb-iframe"},rt=["src"],ct=D({__name:"QBIframe",props:{attrs:{default:()=>({src:""})},preview:{type:Boolean,default:!1}},setup(n){const s=n,{attrs:c,preview:d}=T(s);return(_,p)=>(h(),I("div",nt,[$("iframe",{class:H(f(d)?"":"no-effect"),src:f(c).src,style:{width:"100%",height:"100%",border:"none"}},null,10,rt)]))}}),it=C(ct,[["__scopeId","data-v-67323949"]]),lt=["src"],dt=D({__name:"QBImage",props:{attrs:{default:()=>({src:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:c,styleConfig:d}=T(s);return(_,p)=>(h(),I("img",{class:"qb-image",style:B([{width:"100%",height:"100%"},f(d)]),src:f(c).src},null,12,lt))}}),pt=C(dt,[["__scopeId","data-v-3b56b274"]]),ut=D({__name:"QBText",props:{attrs:{default:()=>({text:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:c}=T(s);return(d,_)=>(h(),I("div",{class:"qb-text",style:B(d.styleConfig)},W(f(c).text),5))}}),mt=C(ut,[["__scopeId","data-v-ad3a33fa"]]),ft=n=>{n.component("qb-chart",ot),n.component("qb-iframe",it),n.component("qb-image",pt),n.component("qb-text",mt)},S=J(at);S.use(F());S.use(ft);S.component("GridLayout",K);S.mount("#standalone-app");
