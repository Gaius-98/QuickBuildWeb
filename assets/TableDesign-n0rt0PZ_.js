import{w as Ve}from"./nodemodule-@vue_runtime-dom@3.4.21-CDjXREoQ.js";/* empty css                                            */import{A as pt}from"./nodemodule-ag-grid-vue3@32.2.2_typescript@5.4.2-5HZqaiKv.js";import{d as ct}from"./nodemodule-gaius-utils@1.1.8_@types_node@20.11.28_typescript@5.4.2_vite@5.1.6-LqpbgJb2.js";import{d as mt,s as he}from"./nodemodule-pinia@2.1.7_typescript@5.4.2_vue@3.4.21-DRg4DShQ.js";import{v as vt}from"./nodemodule-uuid@9.0.1-CtRu48qb.js";import{r as p,x as K,u as a}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";import{n as ft,J as _t,P as Ne,f as ye,a2 as gt,a3 as Fe,a4 as bt,a5 as Ue,Q as yt}from"./nodemodule-@ant-design_icons-vue@7.0.1_vue@3.4.21-CO80cFpd.js";import{d as M,K as R,c as e,M as i,aI as o,L as m,q as X,F as z,O as xe,G as c,N as V,a2 as E,Q as Ce,R as Pe,b as we,m as xt,h as Ct,y as wt,z as ht,ar as Dt,aq as It}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";import{l as $e,n as Me,O as W}from"./nodemodule-@vue_shared@3.4.21-Ctf17_ps.js";import{j as De,Z as Oe,r as kt,B as Ie,I as ke,e as Ae,i as At,_ as St,d as Ge,F as Qe,h as ze,k as Ke,o as Le,u as Rt,U as Tt,V as Bt,G as Ft,W as Ut,M as Et,X as Vt,Y as Nt,K as Pt,Q as $t,a as Mt}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-DQ6gDd-0.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Ee}from"./nodemodule-vue-draggable-next@2.2.1_sortablejs@1.15.6_vue@3.4.21-C6j_8m-S.js";import{c as Q}from"./iconfont-BCn86eVw.js";import{S as _e}from"./SchemaForm-CXG5_yWc.js";import{u as Ot}from"./nodemodule-vue-router@4.3.0_vue@3.4.21-BC_007Jj.js";import{F as Gt,a as ge}from"./FlowExecutor-Dv34dlM1.js";import{_ as Qt}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-gHuCPy-q.js";import"./nodemodule-mobx-preact@3.0.0_mobx@5.15.7_preact@10.26.1-BAdAl0TJ.js";import"./nodemodule-preact@10.26.1-VQRbO-O1.js";import{L as re}from"./nodemodule-@logicflow_core@2.0.7-D9adiHqZ.js";import{D as zt,S as Kt,M as Lt}from"./nodemodule-@logicflow_extension@2.0.11_@logicflow_core@2.0.7-CJrrUuUj.js";import"./nodemodule-js-cookie@3.0.5-Cz0CWeBA.js";import{u as Wt}from"./useReminder-BW3mqQbW.js";import"./nodemodule-ag-grid-community@32.2.2-D7LQ-C3g.js";import"./nodemodule-@ant-design_icons-svg@4.4.2-C9VH68wD.js";import"./nodemodule-@ant-design_colors@6.0.0-CBJ--Aym.js";import"./nodemodule-@ctrl_tinycolor@3.6.1-DOFZgDuz.js";import"./nodemodule-@babel_runtime@7.26.9-Bq4_u9L9.js";import"./nodemodule-lodash-es@4.17.21-DcfALcKD.js";import"./nodemodule-resize-observer-polyfill@1.5.1-B1PUzC5B.js";import"./nodemodule-dayjs@1.11.13-B6I98uus.js";import"./nodemodule-classnames@2.5.1-BK5ccKcQ.js";import"./nodemodule-throttle-debounce@5.0.2-CUWDS_la.js";import"./nodemodule-async-validator@4.2.5-9PlIezaS.js";import"./nodemodule-scroll-into-view-if-needed@2.2.31-CLVC0ehY.js";import"./nodemodule-compute-scroll-into-view@1.0.20-1gs_hJI2.js";import"./nodemodule-vue-types@3.0.2_vue@3.4.21-CF28atMM.js";import"./nodemodule-dom-align@1.12.4-CRCehRfe.js";import"./nodemodule-@emotion_hash@0.9.2-WldOFDRm.js";import"./nodemodule-@emotion_unitless@0.8.1-sScrWPmR.js";import"./nodemodule-stylis@4.3.6-D5iaQeiq.js";import"./nodemodule-axios@1.6.8-BZ84_VUH.js";import"./tools-BCD5ohFr.js";/* empty css                   */import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BwF7fNrp.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-Drafqv_n.js";import"./nodemodule-vue-codemirror@6.1.1_codemirror@6.0.1_vue@3.4.21-6erInkLC.js";import"./nodemodule-codemirror@6.0.1-CDdUixe0.js";import"./nodemodule-@codemirror_view@6.36.3-NX7sJwro.js";import"./nodemodule-@codemirror_state@6.5.2-CeTbMir1.js";import"./nodemodule-@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./nodemodule-style-mod@4.1.2-Bc2inJdb.js";import"./nodemodule-w3c-keyname@2.2.8-Vcq4gwWv.js";import"./nodemodule-@codemirror_language@6.10.8-mNL4GyJL.js";import"./nodemodule-@lezer_common@1.2.3-DJDOv6L0.js";import"./nodemodule-@lezer_highlight@1.2.1-GwqidMBt.js";import"./nodemodule-@codemirror_commands@6.8.0-CgqX80B-.js";import"./nodemodule-@codemirror_search@6.5.9-Bxz0SCc2.js";import"./nodemodule-crelt@1.0.6-C8TCjufn.js";import"./nodemodule-@codemirror_autocomplete@6.18.6-CgfM5yAM.js";import"./nodemodule-@codemirror_lint@6.8.4-B5u0_rJN.js";import"./nodemodule-@codemirror_lang-javascript@6.2.2-3v4eY2tQ.js";import"./nodemodule-@lezer_javascript@1.4.21-C1-eIBDX.js";import"./nodemodule-@lezer_lr@1.4.2-CXohaufN.js";import"./nodemodule-@uiw_codemirror-theme-vscode@4.23.6_@codemirror_language@6.10.8_@codemirror_state@6.5.2_@codemirror_view@6.36.3-BzpyluC0.js";import"./nodemodule-@uiw_codemirror-themes@4.23.6_@codemirror_language@6.10.8_@codemirror_state@6.5.2_@codemirror_view@6.36.3-C3-fthFX.js";import"./nodemodule-mobx@5.15.7-BNbkWaZx.js";import"./nodemodule-mousetrap@1.6.5-cmieWgRK.js";import"./nodemodule-mobx-utils@5.6.2_mobx@5.15.7-D6gdqtlc.js";import"./nodemodule-medium-editor@5.23.3-D6uvSLuC.js";import"./nodemodule-vanilla-picker@2.12.3-D-dNiDpH.js";import"./nodemodule-rangy@1.3.2-DE1SPTYs.js";import"./nodemodule-@vueuse_core@10.9.0_vue@3.4.21-CS6n5tIH.js";import"./nodemodule-@vueuse_shared@10.9.0_vue@3.4.21-IMP1eStj.js";const ie=new ct,de=mt("tableDesign",()=>{const w=p([]),g=p({name:"",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),v=p([]),h=p({});return{tableCfg:g,setTableCfg:l=>{g.value=l},currentColumn:h,onSelectColumn:(l,f)=>{const x=f.findIndex(N=>N.id===l);x!=-1&&(h.value=f[x])},onRemoveColumn:(l,f)=>{const x=f.findIndex(N=>N.id===l);x!=-1&&f.splice(x,1)},onAddColumn:()=>{const l=new Date().getTime().toString().slice(-4);g.value.columns.push({id:vt(),dataIndex:"field"+l,title:"列"+l,width:200})},tableData:w,onRefreshData:async l=>{},columnFields:v,onSetColumns:l=>{v.value=l},onAddBtn:l=>{g.value.action.push({id:new Date().getTime().toString(),name:"测试",position:l,eventFlow:{nodes:[],edges:[]},customEvent:!1,builtInEvents:"add",formId:""})},onRemoveBtn:l=>{const f=g.value.action.findIndex(x=>x.id==l);f!=-1&&g.value.action.splice(f,1)},onRemoveWidget:l=>{const f=g.value.filter.findIndex(x=>x.id==l);f!=-1&&g.value.filter.splice(f,1)}}}),Jt={class:"custom-header-label",style:{flex:"1"}},qt=M({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(w,{emit:g}){const v=de(),{currentColumn:h}=he(v),y=w,{params:C}=K(y),r=()=>{ie.onPublish("removeEvent",C.value)};return(T,D)=>{const u=De;return m(),R("div",{class:Me(["custom-header-item",a(h).dataIndex==a(C).column.getColId()?"active":""]),style:$e([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:a(h).dataIndex==a(C).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[e(a(ft),{class:"move",style:{width:"20px",cursor:"move"}}),i("div",Jt,W(a(C).displayName),1),e(u,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:D[0]||(D[0]=U=>r())},{default:o(()=>[e(a(_t),{class:"remove",style:{width:"20px"},onClick:Ve(()=>{},["stop"])})]),_:1})],6)}}}),Ht={class:"custom-opt-cell"},Zt=["onClick"],jt=M({__name:"CustomOptCell",setup(w){const g=de(),{tableCfg:v}=he(g),h=X(()=>{var D;return(D=v.value.action)==null?void 0:D.filter(u=>u.position=="row")}),{onAddBtn:y,onRemoveBtn:C}=g,r=D=>{ie.onPublish("open-btn-modal",D)},T=()=>{y("row")};return(D,u)=>{const U=De;return m(),R("div",Ht,[(m(!0),R(z,null,xe(h.value,F=>(m(),R("div",{class:"btn",key:F.id},[i("a",{onClick:s=>r(F)},W(F.name),9,Zt),e(U,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:s=>a(C)(F.id)},{default:o(()=>[e(a(ye),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),e(a(Ne),{style:{cursor:"pointer"},onClick:u[0]||(u[0]=F=>T())})])}}}),Xt={class:"custom-header-label",style:{flex:"1"}},Yt=M({__name:"CustomAddColumn",setup(w){const g=de(),{onAddColumn:v}=g;return(h,y)=>{const C=Oe;return m(),R("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:y[0]||(y[0]=r=>a(v)())},[i("div",Xt,[e(a(Ne)),c(" 新增列 "),e(C,null,{title:o(()=>[c("用于新增列配置")]),default:o(()=>[e(a(gt))]),_:1})])])}}}),eo={class:"cell"},to={key:0},oo=["href"],ao=M({__name:"CustomCellRender",props:{params:{}},setup(w){const g=w,{params:v}=K(g);return(h,y)=>{const C=kt;return m(),R("div",eo,[a(v).colDef.cellRendererParams.type=="text"?(m(),R("span",to,W(a(v).value),1)):V("",!0),a(v).colDef.cellRendererParams.type=="image"?(m(),E(C,{key:1,src:a(v).value},null,8,["src"])):V("",!0),a(v).colDef.cellRendererParams.type=="link"?(m(),R("a",{key:2,href:a(v).value},W(a(v).value),9,oo)):V("",!0)])}}}),lo=M({__name:"AgTable",props:Ce({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:Ce(["onRemove","onClick"],["update:columns"]),setup(w,{emit:g}){ie.onSubscribe("removeEvent",s=>{let l=s.column.getColId(),f=v.value.find(x=>x.dataIndex==l);f&&U(f)});const v=Pe(w,"columns"),h=w,{columnId:y,tableData:C}=K(h),r=X(()=>{let s=v.value.map(l=>({field:l.dataIndex,colId:l.dataIndex,headerName:l.title,pinned:l.fixed=="none"?void 0:l.fixed,lockVisible:!0,headerComponent:qt,cellRenderer:ao,cellRendererParams:{type:l.type}}));return s.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:Yt}),s.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:jt}),s}),T=s=>{if(!s.finished)return;let l=[];s.api.getColumnState().forEach(f=>{let x=v.value.find(N=>N.dataIndex==f.colId);x&&l.push(x)}),v.value=l},D=s=>{if(!s.finished)return;let l=s.column.getColId(),f=v.value.findIndex(x=>x.dataIndex==l);f!=-1&&(v.value[f].width=s.column.getActualWidth())},u=g,U=s=>{u("onRemove",s)},F=s=>{let l=s.column.getId(),f=v.value.find(x=>x.dataIndex==l);u("onClick",f)};return(s,l)=>(m(),E(a(pt),{rowData:a(C),columnDefs:r.value,style:$e({height:s.height+"px"}),class:"ag-theme-quartz",onColumnMoved:T,onColumnResized:D,onColumnHeaderClicked:F},null,8,["rowData","columnDefs","style"]))}}),no=Y(lo,[["__scopeId","data-v-5dd2184c"]]),so=M({__name:"EventFlow",props:{dndList:{default:()=>[{type:"circle",text:"开始",label:"开始节点",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAAnBJREFUOBGdVL1rU1EcPfdGBddmaZLiEhdx1MHZQXApraCzQ7GKLgoRBxMfcRELuihWKcXFRcEWF8HBf0DdDCKYRZpnl7p0svLe9Zzbd29eQhTbC8nv+9zf130AT63jvooOGS8Vf9Nt5zxba7sXQwODfkWpkbjTQfCGUd9gIp3uuPP8bZ946g56dYQvnBg+b1HB8VIQmMFrazKcKSvFW2dQTxJnJdQ77urmXWOMBCmXM2Rke4S7UAW+/8ywwFoewmBps2tu7mbTdp8VMOkIRAkKfrVawalJTtIliclFbaOBqa0M2xImHeVIfd/nKAfVq/LGnPss5Kh00VEdSzfwnBXPUpmykNss4lUI9C1ga+8PNrBD5YeqRY2Zz8PhjooIbfJXjowvQJBqkmEkVnktWhwu2SM7SMx7Cj0N9IC0oQXRo8xwAGzQms+xrB/nNSUWVveI48ayrFGyC2+E2C+aWrZHXvOuz+CiV6iycWe1Rd1Q6+QUG07nb5SbPrL4426d+9E1axKjY3AoRrlEeSQo2Eu0T6BWAAr6COhTcWjRaYfKG5csnvytvUr/WY4rrPMB53Uo7jZRjXaG6/CFfNMaXEu75nG47X+oepU7PKJvvzGDY1YLSKHJrK7vFUwXKkaxwhCW3u+sDFMVrIju54RYYbFKpALZAo7sB6wcKyyrd+aBMryMT2gPyD6GsQoRFkGHr14TthZni9ck0z+Pnmee460mHXbRAypKNy3nuMdrWgVKj8YVV8E7PSzp1BZ9SJnJAsXdryw/h5ctboUVi4AFiCd+lQaYMw5z3LGTBKjLQOeUF35k89f58Vv/tGh+l+PE/wG0rgfIUbZK5AAAAABJRU5ErkJggg=="},{type:"rect",label:"用户任务",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAEFVwZaAAAABGdBTUEAALGPC/xhBQAAAqlJREFUOBF9VM9rE0EUfrMJNUKLihGbpLGtaCOIR8VjQMGDePCgCCIiCNqzCAp2MyYUCXhUtF5E0D+g1t48qAd7CCLqQUQKEWkStcEfVGlLdp/fm3aW2QQdyLzf33zz5m2IsAZ9XhDpyaaIZkTS4ASzK41TFao88GuJ3hsr2pAbipHxuSYyKRugagICGANkfFnNh3HeE2N0b3nN2cgnpcictw5veJIzxmDamSlxxQZicq/mflxhbaH8BLRbuRwNtZp0JAhoplVRUdzmCe/vO27wFuuA3S5qXruGdboy5/PRGFsbFGKo/haRtQHIrM83bVeTrOgNhZReWaYGnE4aUQgTJNvijJFF4jQ8BxJE5xfKatZWmZcTQ+BVgh7s8SgPlCkcec4mGTmieTP4xd7PcpIEg1TX6gdeLW8rTVMVLVvb7ctXoH0Cydl2QOPJBG21STE5OsnbweVYzAnD3A7PVILuY0yiiyDwSm2g441r6rMSgp6iK42yqroI2QoXeJVeA+YeZSa47gZdXaZWQKTrG93rukk/l2Al6Kzh5AZEl7dDQy+JjgFahQjRopSxPbrbvK7GRe9ePWBo1wcU7sYrFZtavXALwGw/7Dnc50urrHJuTPSoO2IMV3gUQGNg87IbSOIY9BpiT9HV7FCZ94nPXb3MSnwHn/FFFE1vG6DTby+r31KAkUktB3Qf6ikUPWxW1BkXSPQeMHHiW0+HAd2GelJsZz1OJegCxqzl+CLVHa/IibuHeJ1HAKzhuDR+ymNaRFM+4jU6UWKXorRmbyqkq/D76FffevwdCp+jN3UAN/C9JRVTDuOxC/oh+EdMnqIOrlYteKSfadVRGLJFJPSB/ti/6K8f0CNymg/iH2gO/f0DwE0yjAFO6l8JaR5j0VPwPwfaYHqOqrCI319WzwhwzNW/aQAAAABJRU5ErkJggg==",className:"important-node"}]},data:{}},emits:["onClickEle"],setup(w,{expose:g,emit:v}){const h=v,y=p(),C=p(),r=w,{dndList:T,data:D}=K(r),u=s=>{h("onClickEle",s)};return we(()=>{re.use(zt),re.use(Kt),re.use(Lt),y.value=new re({container:C.value,grid:!0}),y.value.extension.dndPanel.setPatternItems(T.value),y.value.extension.menu.setMenuConfig({nodeMenu:[{text:"删除",callback(s){y.value.deleteNode(s.id)}}],edgeMenu:[{text:"删除",callback(s){y.value.deleteEdge(s.id)}}],graphMenu:!1}),y.value.render(D.value),y.value.on("node:click",u)}),xt(()=>D.value,()=>{y.value.render(D.value)}),g({getRawData:()=>{var s;return(s=y.value)==null?void 0:s.getGraphRawData()},updateNodeData:s=>{var l,f;(f=(l=y.value)==null?void 0:l.getNodeModelById(s.id))==null||f.setProperties({extraData:s.properties.extraData})}}),(s,l)=>(m(),R("div",{class:"flow-container",ref_key:"container",ref:C},null,512))}}),uo=Y(so,[["__scopeId","data-v-c088af38"]]),ro={key:2,style:{display:"flex"}},io=M({__name:"EditTable",props:Ce({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(w){const g=Pe(w,"modelValue");let v=w;const{columns:h,action:y}=K(v),C=X(()=>u("input")),r=X(()=>u("select")),T=X(()=>y.value?[...h.value,{title:"操作",dataIndex:"_action_"}]:h.value),D=s=>{var l;return((l=h.value.find(f=>f.dataIndex==s))==null?void 0:l.options)||[]},u=s=>h.value.filter(l=>l.type==s).map(l=>l.dataIndex),U=()=>{let s={};h.value.map(l=>{Reflect.set(s,l.dataIndex,"")}),g.value.push(s)},F=s=>{g.value.splice(s,1)};return(s,l)=>{const f=ke,x=Ae,N=Ie,J=At;return m(),E(J,{columns:T.value,"data-source":g.value,pagination:!1,rowKey:(P,B)=>B,size:"small",scroll:{y:s.height}},{bodyCell:o(({column:P,record:B,index:d})=>[C.value.includes(P.dataIndex)?(m(),E(f,{key:0,value:B[P.dataIndex],"onUpdate:value":$=>B[P.dataIndex]=$},null,8,["value","onUpdate:value"])):V("",!0),r.value.includes(P.dataIndex)?(m(),E(x,{key:1,value:B[P.dataIndex],"onUpdate:value":$=>B[P.dataIndex]=$,options:D(P.dataIndex)},null,8,["value","onUpdate:value","options"])):V("",!0),P.dataIndex=="_action_"?(m(),R("div",ro,[e(a(Fe),{class:"icon",onClick:l[0]||(l[0]=$=>U())}),e(a(bt),{class:"icon",onClick:$=>F(d)},null,8,["onClick"])])):V("",!0)]),emptyText:o(()=>[e(N,{type:"text",onClick:U,icon:Ct(a(Fe))},{default:o(()=>[c(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),be=Y(io,[["__scopeId","data-v-a685975f"]]),po={key:0,style:{color:"red"}},co=M({__name:"FlowView",props:{data:{default:()=>({nodes:[],edges:[]})}},setup(w,{expose:g}){const v=w,{data:h}=K(v),y=p([{type:"circle",text:"开始",label:"开始节点",icon:"/src/assets/images/flow/开始.png",properties:{nodeType:"start-node",extraData:{}}},{type:"circle",text:"结束",label:"结束节点",icon:"/src/assets/images/flow/结束.png",properties:{nodeType:"end-node",extraData:{}}},{type:"rect",text:"处理函数",label:"处理函数",icon:"/src/assets/images/flow/js函数.png",properties:{nodeType:"func-node",extraData:{code:""}}},{type:"rect",text:"打开弹窗",label:"弹窗",icon:"/src/assets/images/flow/弹窗.png",properties:{nodeType:"modal-node",extraData:{size:"small",formId:""}}},{type:"rect",text:"跳转外部链接",label:"链接",icon:"/src/assets/images/flow/链接.png",properties:{nodeType:"link-node",extraData:{url:"",openType:"_blank"}}},{type:"diamond",text:"请求数据",label:"请求数据",icon:"/src/assets/images/flow/发起请求.png",properties:{nodeType:"request-node",extraData:{url:"",method:"get",params:[],headers:[],body:[]}}}]),C=p(!1),r=p({}),T=p(),D=p([]),u=p([{value:"get",label:"GET"},{value:"post",label:"POST"}]),U=p([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),F=p([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),s=p(""),l=B=>{C.value=!0,r.value=B.data};Q.getFormDict().then(B=>{const{code:d,data:$,msg:ee}=B;d==200&&(D.value=$)});const f=()=>{T.value.updateNodeData(r.value)},x=p(!1),N=p("");g({getData:()=>T.value.getRawData()});const P=async()=>{x.value=!1,N.value="";try{const B=T.value.getRawData(),d=new Gt(B);await d.run(),s.value=JSON.stringify(d.getState(),null,4)}catch(B){x.value=!0,N.value=B}};return(B,d)=>{const $=St,ee=uo,te=Ie,q=Qt,O=ze,G=Le,H=Ke,oe=Ae,pe=Rt,ae=ke,Z=Bt,I=Tt,j=Ft,le=Qe,ne=Ge;return m(),R(z,null,[e($,null,{default:o(()=>[c("配置区")]),_:1}),e(ee,{ref_key:"eventFlowRef",ref:T,data:a(h),dndList:y.value,style:{height:"450px"},onOnClickEle:l},null,8,["data","dndList"]),e(te,{onClick:d[0]||(d[0]=b=>P()),type:"primary",style:{"margin-top":"10px"}},{default:o(()=>[c("执行")]),_:1}),e($,null,{default:o(()=>[c("运行结果")]),_:1}),x.value?(m(),R("div",po,"错误日志: "+W(N.value),1)):(m(),E(q,{key:1,value:s.value,"onUpdate:value":d[1]||(d[1]=b=>s.value=b),height:"200",readOnly:""},null,8,["value"])),e(ne,{open:C.value,"onUpdate:open":d[12]||(d[12]=b=>C.value=b),title:"节点配置",placement:"right",onClose:d[13]||(d[13]=b=>f()),width:"400px"},{default:o(()=>[e(le,{model:r.value.properties.extraData},{default:o(()=>[r.value.properties.nodeType=="func-node"?(m(),E(O,{key:0,label:"函数"},{default:o(()=>[e(q,{value:r.value.properties.extraData.code,"onUpdate:value":d[2]||(d[2]=b=>r.value.properties.extraData.code=b),prepend:"()=>{",append:"}",theme:"light"},null,8,["value"])]),_:1})):V("",!0),r.value.properties.nodeType=="modal-node"?(m(),R(z,{key:1},[e(O,{label:"弹窗大小"},{default:o(()=>[e(H,{value:r.value.properties.extraData.size,"onUpdate:value":d[3]||(d[3]=b=>r.value.properties.extraData.size=b),"button-style":"solid"},{default:o(()=>[e(G,{value:"small"},{default:o(()=>[c("小")]),_:1}),e(G,{value:"middle"},{default:o(()=>[c("中")]),_:1}),e(G,{value:"large"},{default:o(()=>[c("大")]),_:1})]),_:1},8,["value"])]),_:1}),e(O,{label:"表单"},{default:o(()=>[e(oe,{value:r.value.properties.extraData.formId,"onUpdate:value":d[4]||(d[4]=b=>r.value.properties.extraData.formId=b),options:D.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})],64)):V("",!0),r.value.properties.nodeType=="link-node"?(m(),R(z,{key:2},[e(O,{label:"链接地址"},{default:o(()=>[e(pe,{value:r.value.properties.extraData.url,"onUpdate:value":d[5]||(d[5]=b=>r.value.properties.extraData.url=b)},null,8,["value"])]),_:1}),e(O,{label:"打开方式"},{default:o(()=>[e(H,{value:r.value.properties.extraData.openType,"onUpdate:value":d[6]||(d[6]=b=>r.value.properties.extraData.openType=b),"button-style":"solid"},{default:o(()=>[e(G,{value:"_selef"},{default:o(()=>[c("当前页")]),_:1}),e(G,{value:"_blank"},{default:o(()=>[c("新窗口")]),_:1})]),_:1},8,["value"])]),_:1})],64)):V("",!0),r.value.properties.nodeType=="request-node"?(m(),R(z,{key:3},[e(ae,{value:r.value.properties.extraData.url,"onUpdate:value":d[8]||(d[8]=b=>r.value.properties.extraData.url=b)},{addonBefore:o(()=>[e(oe,{value:r.value.properties.extraData.method,"onUpdate:value":d[7]||(d[7]=b=>r.value.properties.extraData.method=b),options:u.value},null,8,["value","options"])]),_:1},8,["value"]),i("div",null,[e(I,null,{default:o(()=>[e(Z,{key:"params",tab:"params"},{default:o(()=>[e(be,{columns:U.value,modelValue:r.value.properties.extraData.params,"onUpdate:modelValue":d[9]||(d[9]=b=>r.value.properties.extraData.params=b)},null,8,["columns","modelValue"])]),_:1}),e(Z,{key:"headers",tab:"headers"},{default:o(()=>[e(be,{columns:F.value,modelValue:r.value.properties.extraData.headers,"onUpdate:modelValue":d[10]||(d[10]=b=>r.value.properties.extraData.headers=b)},null,8,["columns","modelValue"])]),_:1}),e(Z,{key:"body",tab:"body"},{default:o(()=>[e(be,{columns:U.value,modelValue:r.value.properties.extraData.body,"onUpdate:modelValue":d[11]||(d[11]=b=>r.value.properties.extraData.body=b)},null,8,["columns","modelValue"])]),_:1})]),_:1})])],64)):V("",!0),["start-node","end-node"].includes(r.value.properties.nodeType)?(m(),E(j,{key:4,description:"起止节点暂无配置项"})):V("",!0)]),_:1},8,["model"])]),_:1},8,["open"])],64)}}}),mo=Y(co,[["__scopeId","data-v-9c234d0a"]]),We=w=>(Dt("data-v-d13d18b6"),w=w(),It(),w),vo={class:"table-design"},fo={class:"table-design-container"},_o={class:"main-part"},go={class:"filter-container"},bo=["onClick"],yo={class:"add widget-item"},xo={class:"tools-part"},Co={class:"tools-container"},wo={class:"add button-item"},ho={class:"table-part"},Do=We(()=>i("h3",null,[c(" 工作流配置注意事项"),i("strong",{style:{color:"red"}},"(目前只支持线性工作流,没有条件判断或并行执行的能力)")],-1)),Io=We(()=>i("ul",null,[i("li",null,[i("strong",null,"工作流节点不能为空："),c(" 每个工作流"),i("strong",null,"必须"),c("包含有效的节点配置。 ")]),i("li",null,[i("strong",null,"包含开始与结束节点："),c(" 每个工作流"),i("strong",null,"必须"),c("包含一个“开始节点”和一个“结束节点”。 ")]),i("li",null,[i("strong",{style:{color:"red"}},"重要参数："),i("code",null,"this.state.modalFormData"),c("为弹窗表单数据， "),i("code",null,"this.state.requestData"),c("为请求数据， 两者既可以作为输入也可以作为输出，搭配"),i("strong",null,"处理函数"),c("节点使用，可以实现数据的填充或者数据的保存。 ")]),i("li",null,[i("strong",null,"节点内变量引用："),c(" 在"),i("strong",null,"处理函数"),c("节点中，可以通过 "),i("code",null,"this.state.xxx"),c(" 的方式引用当前工作流中的变量。 在"),i("strong",null,"请求配置"),c("节点中，在"),i("strong",null,"引用变量"),c("列中可以通过"),i("code",null,"state.xxx"),c("引用变量数据，也可以配置"),i("strong",null,"Value"),c("列使用静态数据。 ")]),i("li",null,[i("strong",null,"预览结果："),c(" 执行后，预览结果仅显示当前工作流的 "),i("code",null,"state"),c(" 属性，其他信息不可见。 ")])],-1)),ko=M({__name:"TableDesign",props:{id:{}},setup(w){Ot();const{shouldShowReminder:g}=Wt("low-code-table-design"),v=p(0),h=[{title:"数据源",description:"选择你在系统内已配置好的数据源",target:()=>document.querySelector(".extra"),placement:"bottom"},{title:"列配置区域",description:"对已配置数据源的表格的列进行配置，可以拖拽调整列的顺序，点击列进行详细配置",target:()=>document.querySelector(".table-part"),placement:"top"},{title:"筛选条件区域",description:"添加当前表格的筛选条件，可以拖拽调整筛选条件的顺序，点击筛选条件进行详细配置",target:()=>document.querySelector(".filter-container"),placement:"bottom"},{title:"按钮操作配置区域",description:"添加当前表格的操作按钮，可以拖拽调整按钮的顺序，点击按钮进行详细配置",target:()=>document.querySelector(".tools-container"),placement:"bottom"},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn"),placement:"left"}];ie.onSubscribe("open-btn-modal",_=>{le(_)});const y=p([]);we(()=>{Q.getDataSourceDict().then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(y.value=A)})});const C=w,{id:r}=K(C),T=p(!1),D=de(),{tableCfg:u,currentColumn:U}=he(D),{onSelectColumn:F,onRemoveBtn:s,onRemoveColumn:l,onSetColumns:f,onRemoveWidget:x,onAddBtn:N,setTableCfg:J}=D;r.value?(T.value=!0,ge.getDetail(r.value).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(J(A),G(),q(),T.value=!1)})):J({name:"未命名列表",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),window.name="table-design";const P=p([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),B=()=>{var _;(_=u.value.filter)==null||_.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},d=()=>{window.open("/lowcode/table","quick-build")},$=_=>{F(_.id,u.value.columns),ce.value=!0},ee=_=>{l(_.id,u.value.columns)};p([]);const te=p([]),q=()=>{Q.getSourceData(u.value.dataSource.sourceId,u.value.dataSource.tableName).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(te.value=A)})},O=p([]),G=()=>{Q.getTableInfo(u.value.dataSource.sourceId).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(O.value=A)})},H=async()=>{if(!u.value.dataSource.sourceId||!u.value.dataSource.tableName)return[];const{code:_,data:t,msg:A}=await Q.getColumnInfo(u.value.dataSource.sourceId,u.value.dataSource.tableName);return _==200?t.map(S=>({label:S.columnComment?`${S.columnComment}(${S.columnName})`:S.columnName,value:S.columnName})):[]},oe=()=>{Q.getColumnInfo(u.value.dataSource.sourceId,u.value.dataSource.tableName).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(u.value.columns=A.map(k=>({dataIndex:k.columnName,title:k.columnComment||k.columnName,id:k.columnName,width:200,type:"text",align:"left",fixed:"none"})),f(A.map(k=>({label:k.columnComment?`${k.columnComment}(${k.columnName})`:k.columnName,value:k.columnName}))))}),q()},pe=()=>{N("header")},ae=p([]),Z=()=>{Q.getFormDict().then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(ae.value=A)})};we(()=>{Z()});const I=p({id:"",name:"",eventFlow:{nodes:[],edges:[]},position:"header",customEvent:!1,builtInEvents:"add",formId:""}),j=p(!1),le=_=>{I.value=_,j.value=!0},ne=p({}),b=p(!1),Je=p({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"select",label:"字段名称",component:{asyncData:H}},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dictType:{type:"radio",label:"字典类型",show:'"${formData.type}" == "select"',tooltip:"字典为系统的字典配置数据，列数据为当前配置字段的列数据",component:{dataSource:[{label:"字典",value:"dict"},{label:"列数据",value:"col"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",tooltip:"可以在系统配置自定义字典",show:'"${formData.type}" == "select" && "${formData.dictType}" == "dict"',component:{asyncData:async()=>{const{code:_,data:t,msg:A}=await Q.getDictTypeList();return _==200?t.map(S=>({label:S.dictTypeDesc,value:S.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),qe=p({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:H}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),He=_=>{ne.value=_,b.value=!0},ce=p(!1),me=p(!1),Ze=p({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"120px"}}},properties:{showFilter:{type:"switch",label:"显示筛选面板"},showPagination:{type:"switch",label:"显示分页器"},showBordered:{type:"switch",label:"显示边框"},size:{type:"radio",label:"表格尺寸",component:{dataSource:[{label:"紧凑",value:"small"},{label:"默认",value:"middle"},{label:"宽松",value:"large"}],buttonStyle:"solid"}}}}),je=()=>{me.value=!0},Xe=()=>{T.value=!0,(r.value?ge.update:ge.add)(u.value).then(t=>{const{code:A,data:S,msg:k}=t;A==200&&Mt.success("保存成功"),T.value=!1})},se=p(!1),ve=p({nodes:[],edges:[]}),Ye=_=>{ve.value=_.eventFlow,se.value=!0},Se=p(),et=()=>{I.value.eventFlow=Se.value.getData(),Re()},Re=()=>{ve.value={nodes:[],edges:[]},se.value=!1};return(_,t)=>{const A=ke,S=Ae,k=ze,L=Ie,tt=Nt,ot=Ut,at=Pt,Te=De,Be=Le,lt=Ke,nt=$t,st=Qe,ue=Ge,ut=Oe,rt=Et,it=Vt,dt=ht("loading");return m(),R(z,null,[wt((m(),R("div",vo,[e(ot,{onBack:d,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:o(()=>[e(A,{value:a(u).name,"onUpdate:value":t[0]||(t[0]=n=>a(u).name=n),bordered:!1,class:"table-name"},null,8,["value"])]),extra:o(()=>[e(tt,{class:"extra"},{default:o(()=>[e(k,{label:"选择数据源"},{default:o(()=>[e(S,{value:a(u).dataSource.sourceId,"onUpdate:value":t[1]||(t[1]=n=>a(u).dataSource.sourceId=n),options:y.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:t[2]||(t[2]=n=>G())},null,8,["value","options"])]),_:1}),e(k,{label:"选择表名"},{default:o(()=>[e(S,{value:a(u).dataSource.tableName,"onUpdate:value":t[3]||(t[3]=n=>a(u).dataSource.tableName=n),options:O.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:t[4]||(t[4]=n=>oe())},null,8,["value","options"])]),_:1}),e(L,{type:"primary",onClick:je,class:"global-btn"},{default:o(()=>[c("全局配置")]),_:1}),e(L,{onClick:t[5]||(t[5]=n=>Xe()),type:"primary",class:"save-btn"},{default:o(()=>[c(" 保存 ")]),_:1})]),_:1})]),_:1}),i("div",fo,[i("div",_o,[i("div",{class:Me(["filter-part",{disabled:!a(u).global.showFilter}])},[i("div",go,[e(a(Ee),{list:a(u).filter,"onUpdate:list":t[7]||(t[7]=n=>a(u).filter=n),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:o(()=>[(m(!0),R(z,null,xe(a(u).filter,n=>(m(),R("div",{class:"widget-item",key:n.id,onClick:fe=>He(n)},[e(a(Ue),{class:"move-handle",style:{cursor:"pointer"}}),e(k,{label:n.label,name:n.field},{default:o(()=>[n.type=="input"?(m(),E(A,{key:0})):n.type=="select"?(m(),E(S,{key:1})):(m(),E(at,{key:2}))]),_:2},1032,["label","name"]),e(Te,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:fe=>a(x)(n.id)},{default:o(()=>[e(a(ye),{class:"remove-btn",onClick:Ve(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,bo))),128)),i("div",yo,[e(L,{type:"primary",onClick:t[6]||(t[6]=n=>B())},{default:o(()=>[c(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])],2),i("div",xo,[i("div",Co,[e(a(Ee),{list:a(u).action,"onUpdate:list":t[9]||(t[9]=n=>a(u).action=n),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:o(()=>[(m(!0),R(z,null,xe(a(u).action.filter(n=>n.position=="header"),n=>(m(),R("div",{class:"button-item",key:n.id},[e(a(Ue),{class:"move-handle",style:{cursor:"pointer"}}),e(L,{onClick:fe=>le(n)},{default:o(()=>[c(W(n.name),1)]),_:2},1032,["onClick"]),e(Te,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:fe=>a(s)(n.id)},{default:o(()=>[e(a(ye),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),i("div",wo,[e(L,{type:"primary",onClick:t[8]||(t[8]=n=>pe())},{default:o(()=>[c(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),i("div",ho,[e(no,{columns:a(u).columns,"onUpdate:columns":t[10]||(t[10]=n=>a(u).columns=n),tableData:te.value,height:550,onOnRemove:ee,onOnClick:$},null,8,["columns","tableData"])])])])])),[[dt,T.value,void 0,{fullscreen:!0}]]),e(ue,{title:"按钮配置",placement:"right",closable:!1,open:j.value,onClose:t[18]||(t[18]=n=>j.value=!1)},{default:o(()=>[e(st,{model:I.value},{default:o(()=>[e(k,{prop:"id",label:"按钮标识"},{default:o(()=>[e(A,{value:I.value.id,"onUpdate:value":t[11]||(t[11]=n=>I.value.id=n)},null,8,["value"])]),_:1}),e(k,{prop:"name",label:"按钮名称"},{default:o(()=>[e(A,{value:I.value.name,"onUpdate:value":t[12]||(t[12]=n=>I.value.name=n)},null,8,["value"])]),_:1}),e(k,{prop:"name",label:"按钮位置"},{default:o(()=>[e(lt,{value:I.value.position,"onUpdate:value":t[13]||(t[13]=n=>I.value.position=n),"button-style":"solid"},{default:o(()=>[e(Be,{value:"header"},{default:o(()=>[c("表头")]),_:1}),e(Be,{value:"row"},{default:o(()=>[c("行内")]),_:1})]),_:1},8,["value"])]),_:1}),e(k,{prop:"customEvent",label:"是否启用自定义"},{default:o(()=>[e(nt,{checked:I.value.customEvent,"onUpdate:checked":t[14]||(t[14]=n=>I.value.customEvent=n)},null,8,["checked"])]),_:1}),I.value.customEvent?V("",!0):(m(),E(k,{key:0,prop:"builtInEvents",label:"内置事件"},{default:o(()=>[e(S,{value:I.value.builtInEvents,"onUpdate:value":t[15]||(t[15]=n=>I.value.builtInEvents=n),options:P.value,allowClear:""},null,8,["value","options"])]),_:1})),["add","edit"].includes(I.value.builtInEvents)&&!I.value.customEvent?(m(),E(k,{key:1,prop:"formId",label:"关联表单"},{default:o(()=>[e(S,{value:I.value.formId,"onUpdate:value":t[16]||(t[16]=n=>I.value.formId=n),options:ae.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})):V("",!0),I.value.customEvent?(m(),E(k,{key:2,prop:"event",label:"自定义工作流"},{default:o(()=>[e(L,{onClick:t[17]||(t[17]=n=>Ye(I.value))},{default:o(()=>[c(" 自定义工作流 ")]),_:1})]),_:1})):V("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),e(ue,{title:"筛选控件配置",placement:"right",closable:!1,open:b.value,onClose:t[19]||(t[19]=n=>b.value=!1)},{default:o(()=>[e(a(_e),{formData:ne.value,schema:Je.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(ue,{title:"列配置",placement:"right",closable:!1,open:ce.value,onClose:t[20]||(t[20]=n=>ce.value=!1)},{default:o(()=>[e(a(_e),{formData:a(U),schema:qe.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(ue,{title:"全局配置",placement:"right",closable:!1,open:me.value,onClose:t[21]||(t[21]=n=>me.value=!1)},{default:o(()=>[e(a(_e),{formData:a(u).global,schema:Ze.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(rt,{width:"100%","wrap-class-name":"full-modal",open:se.value,"onUpdate:open":t[22]||(t[22]=n=>se.value=n),onOk:et,onCancel:Re},{title:o(()=>[c(" 工作流配置 "),e(ut,{overlayInnerStyle:{width:"600px",color:"#000"},color:"#ffffff",arrow:!1,placement:"rightBottom"},{title:o(()=>[Do,Io]),default:o(()=>[e(a(yt))]),_:1})]),default:o(()=>[e(mo,{data:ve.value,ref_key:"flowRef",ref:Se},null,8,["data"])]),_:1},8,["open"]),e(it,{current:v.value,"onUpdate:current":t[23]||(t[23]=n=>v.value=n),open:a(g),steps:h,onClose:t[24]||(t[24]=n=>g.value=!1)},null,8,["current","open"])],64)}}}),qa=Y(ko,[["__scopeId","data-v-d13d18b6"]]);export{qa as default};
