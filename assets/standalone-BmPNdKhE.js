import"./iconfont-RswF9Ywb.js";import{f as M,r as u,t as q,v as D,g as h,s as R,x as E,o as v,y as w,l as z,w as P,i as y,A as B,k as G,h as T,B as H,C as k,D as W,E as O,F as b,G as A,H as N,I as L,J as V,m as j,p as F,$ as J}from"./.pnpm-CQCJb2bg.js";import{c as Q}from"./componentsSchema-gFhwa5FU.js";import{D as U}from"./DynamicLoader-UgX9ZwQr.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K=M("dgDesign",()=>{const o=u({}),e=u([]),n=u({});return{dashboardData:o,add:a=>{e.value.push(a)},remove:a=>{const{id:p}=a,c=e.value.findIndex(t=>t.id===p);c!==-1&&e.value.splice(c,1)},dgList:e,initDgItem:a=>{const p=Q.findIndex(t=>t.name===a);if(p===-1)throw new Error("组件不存在");const c=q(Q[p]);return c.id=new Date().getTime().toString(),c},selectItem:a=>{n.value=a,window.parent.postMessage({type:"select",data:D(a)},window.location.origin)},curComp:n,updateItem:a=>{const{id:p}=a,c=e.value.findIndex(t=>t.id===p);c!==-1&&e.value.splice(c,1,a)}}}),X=12,Y=8,Z=h({__name:"StandalonePage",setup(o){const e=K(),{dgList:n}=R(e),{initDgItem:l,add:f,selectItem:d,updateItem:r}=e,_=u(),a=u(0),p=t=>{const m=t.dataTransfer.getData("material-type");let i;m=="custom"?i={name:t.dataTransfer.getData("material"),id:new Date().getTime().toString(),label:"自定义组件",icon:"",type:"custom",component:t.dataTransfer.getData("material"),props:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2}:i=l(t.dataTransfer.getData("material"));const s=t.x/(a.value/X),g=t.y/Y;i.colStart=Math.floor(s),i.rowStart=Math.floor(g),f(i)},c=u({});return window.addEventListener("message",t=>{t.data.type==="refresh"?r(t.data.data):t.data.type==="add-custom-comp"&&new U([t.data.data]).load().then(i=>{Object.keys(i).forEach(s=>{c.value[s]=i[s]})})}),E(()=>{a.value=_.value.clientWidth}),(t,m)=>{const i=G("grid-layout");return v(),w("div",{class:"container",ref_key:"container",ref:_,onDragover:m[0]||(m[0]=B(()=>{},["prevent","stop"])),onDrop:B(p,["stop"])},[z(i,{list:y(n),class:"layout","onItem:click":y(d)},{"layout-item":P(({item:s})=>[s.type&&s.type==="custom"?(v(),T(k(c.value[s.component]),H({key:0},s.props,{style:s.style}),null,16,["style"])):(v(),T(k(s.component),{key:1,attrs:s.props,"style-config":s.style},null,8,["attrs","style-config"]))]),_:1},8,["list","onItem:click"])],544)}}}),tt=I(Z,[["__scopeId","data-v-ceeb3ab6"]]),et=h({__name:"QBChart",props:{attrs:{default:()=>({dataset:"",dimension:[],target:[]})},styleConfig:{default:()=>({})}},setup(o){const e=o,{attrs:n,styleConfig:l}=e,f=u(!0),d=u();let r;const _=u(0),a=u(""),p=u(),c=async()=>{a.value=n.dataset,p.value=[{title:"title1",value:100},{title:"title2",value:200},{title:"title3",value:300}]},t=()=>{const{dimension:s,target:g}=n,x=D(l.option),$=D(l.series),S=[];return g.forEach(mt=>{S.push(q($))}),x.series=S,{...x,dataset:{source:D(p.value),dimensions:[...s,...g]}}},m=()=>{a.value!=n.dataset?c().then(()=>{r?(r.clear(),r.setOption(t())):d.value&&(r=O(d.value),r.setOption(t()))}):r?(r.clear(),r.setOption(t())):d.value&&(r=O(d.value),r.setOption(t())),f.value=!1},i=new ResizeObserver(s=>{_.value&&clearTimeout(_.value),_.value=window.setTimeout(()=>{try{r.resize()}catch(g){console.warn(`chart重新设置大小失败,失败原因：${g}`)}},50)});return E(()=>{m(),i.observe(d.value)}),W(()=>[e.attrs,e.styleConfig],()=>{m()},{deep:!0}),(s,g)=>(v(),w("div",{ref_key:"QBChart",ref:d,class:"qb-chart"},null,512))}}),at=I(et,[["__scopeId","data-v-996b3f25"]]),st={class:"qb-iframe"},ot=["src"],nt=h({__name:"QBIframe",props:{attrs:{default:()=>({src:""})},preview:{type:Boolean,default:!1}},setup(o){const e=o,{attrs:n,preview:l}=b(e);return(f,d)=>(v(),w("div",st,[A("iframe",{class:N(y(l)?"":"no-effect"),src:y(n).src,style:{width:"100%",height:"100%",border:"none"}},null,10,ot)]))}}),rt=I(nt,[["__scopeId","data-v-67323949"]]),ct=["src"],it=h({__name:"QBImage",props:{attrs:{default:()=>({src:""})},styleConfig:{default:()=>({})}},setup(o){const e=o,{attrs:n,styleConfig:l}=b(e);return(f,d)=>(v(),w("img",{class:"qb-image",style:L([{width:"100%",height:"100%"},y(l)]),src:y(n).src},null,12,ct))}}),lt=I(it,[["__scopeId","data-v-3b56b274"]]),dt=h({__name:"QBText",props:{attrs:{default:()=>({text:""})},styleConfig:{default:()=>({})}},setup(o){const e=o,{attrs:n}=b(e);return(l,f)=>(v(),w("div",{class:"qb-text",style:L(l.styleConfig)},V(y(n).text),5))}}),pt=I(dt,[["__scopeId","data-v-ad3a33fa"]]),ut=o=>{o.component("qb-chart",at),o.component("qb-iframe",rt),o.component("qb-image",lt),o.component("qb-text",pt)},C=j(tt);C.use(F());C.use(ut);C.component("GridLayout",J);C.mount("#standalone-app");
