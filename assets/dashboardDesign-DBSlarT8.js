import{d as M}from"./nodemodule-pinia@2.1.7_typescript@5.4.2_vue@3.4.21-DRg4DShQ.js";import{d as c}from"./dashboard-gUU17-Gf.js";import{a as v}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-DQ6gDd-0.js";import{r,t as S}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";import{q as p}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";const q=M("dashboardDesign",()=>{const n=r([]),f=e=>{n.value.push(e)},h=p(()=>{const e={};return n.value.map(o=>{o.children.forEach(a=>{e[a.componentName]=a.schema})}),e}),g=p(()=>{let e=[];return n.value.forEach(o=>{const a=o.children.map(s=>({label:s.componentName,value:s.exportName}));e=e.concat(a)}),e}),u=r({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),d=async()=>{const e=document.querySelector(".standalone-iframe");return await new Promise((s,m)=>{e.addEventListener("load",()=>{s(e.contentWindow)})})},t=r({list:[],customModules:[],varPools:{datasets:[],vars:[]},img:"",name:"未命名仪表板",id:""}),l=r(!1);return{customModules:n,customCompSchema:h,onAddModules:f,customComps:g,varPools:u,getContentWindow:d,onSave:e=>{t.value.list=e.list,t.value.img=e.img,t.value.customModules=n.value,t.value.varPools=u.value;const o=t.value.id?c.update:c.add;t.value.id||delete t.value.id,l.value=!0,o(t.value).then(a=>{const{code:s,data:m,msg:i}=a;l.value=!1,s==200?v.success("保存成功"):v.error("保存失败")})},dgInfo:t,getDetail:e=>{l.value=!0,c.getDetail(e).then(o=>{const{code:a,data:s,msg:m}=o;if(a==200){t.value=s;const{customModules:i,varPools:w}=t.value;n.value=i,u.value=w,setTimeout(()=>{d().then(D=>{D.postMessage({type:"refresh-all",data:S(t.value.list)}),l.value=!1})})}})},loading:l}});export{q as u};
