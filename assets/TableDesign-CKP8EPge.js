import{b3 as Ne,f as Te,r as f,aO as Be,g as F,s as z,v as Q,o as c,y as h,l as n,i as t,aw as Fe,J as $,L as O,w as a,az as Ae,aW as ue,A as Ee,aF as de,a1 as X,D as ce,F as V,K as J,b4 as K,ab as Y,B,b5 as Le,b6 as Oe,V as L,h as N,a9 as Pe,t as ae,x as Ue,b7 as Ve,aM as ze,ar as Me,P as We,U as qe,aZ as se,b0 as He,H as je,T as Ge,b8 as ie,b9 as Je,ba as Ke,W as Qe,N as Xe,X as Ye,Y as Ze,b2 as et,aU as tt,a3 as nt,a4 as lt,aS as ot,$ as at}from"./.pnpm-Cl1qeBT1.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as E}from"./index-BxTPw72O.js";import{S as me}from"./SchemaForm-BMfcCn21.js";/* empty css                   */const st=new Ne,M=st,P=Te("tableDesign",()=>{const D=f([]),d=f({name:"",description:"",status:1,columns:[],global:{bordered:!1},datasource:{tableName:"",sourceId:""},filter:{show:!0,widgetList:[]},action:[]}),s=f([]),g=f({}),o=()=>{const i=new Date().getTime().toString().slice(-4);d.value.columns,d.value.columns.push({id:Be(),dataIndex:"field"+i,title:"列"+i,width:200})},b=(i,m)=>{const I=m.findIndex(A=>A.id===i);I!=-1&&(g.value=m[I])},w=(i,m)=>{const I=m.findIndex(A=>A.id===i);I!=-1&&m.splice(I,1)},R=i=>{d.value.action.push({id:new Date().getTime().toString(),name:"测试",position:i,eventFlowId:""})},C=i=>{const m=d.value.action.findIndex(I=>I.id==i);m!=-1&&d.value.action.splice(m,1)},x=i=>{const m=d.value.filter.widgetList.findIndex(I=>I.id==i);m!=-1&&d.value.filter.widgetList.splice(m,1)},T=async i=>{},k=f(!1);return{tableCfg:d,currentColumn:g,onSelectColumn:b,onRemoveColumn:w,onAddColumn:o,tableData:D,onRefreshData:T,saveLoading:k,onSave:async()=>{k.value=!0,setTimeout(()=>{d.value,k.value=!1},2e3)},columnFields:s,onSetColumns:i=>{s.value=i},onAddBtn:R,onRemoveBtn:C,onRemoveWidget:x}}),it={class:"custom-header-label",style:{flex:"1"}},ut=F({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(D,{emit:d}){const s=P(),{currentColumn:g}=z(s),o=D,{params:b}=Q(o),w=()=>{M.onPublish("removeEvent",b.value)};return(R,C)=>{const x=X;return c(),h("div",{class:Ee(["custom-header-item",t(g).dataIndex==t(b).column.getColId()?"active":""]),style:de([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:t(g).dataIndex==t(b).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[n(t(Fe),{class:"move",style:{width:"20px",cursor:"move"}}),$("div",it,O(t(b).displayName),1),n(x,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:C[0]||(C[0]=T=>w())},{default:a(()=>[n(t(Ae),{class:"remove",style:{width:"20px"},onClick:ue(()=>{},["stop"])})]),_:1})],6)}}}),dt={class:"custom-opt-cell"},ct=["onClick"],rt=F({__name:"CustomOptCell",setup(D){const d=P(),{tableCfg:s}=z(d),g=ce(()=>{var C;return(C=s.value.action)==null?void 0:C.filter(x=>x.position=="row")}),{onAddBtn:o,onRemoveBtn:b}=d,w=C=>{M.onPublish("open-btn-modal",C)},R=()=>{o("row")};return(C,x)=>{const T=X;return c(),h("div",dt,[(c(!0),h(V,null,J(g.value,k=>(c(),h("div",{class:"btn",key:k.id},[$("a",{onClick:r=>w(k)},O(k.name),9,ct),n(T,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:r=>t(b)(k.id)},{default:a(()=>[n(t(K),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),n(t(Y),{style:{cursor:"pointer"},onClick:x[0]||(x[0]=k=>R())})])}}}),mt={class:"custom-header-label",style:{flex:"1"}},pt=F({__name:"CustomAddColumn",setup(D){const d=P(),{onAddColumn:s}=d;return(g,o)=>{const b=Oe;return c(),h("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:o[0]||(o[0]=w=>t(s)())},[$("div",mt,[n(t(Y)),B(" 新增列 "),n(b,null,{title:a(()=>[B("用于新增列配置")]),default:a(()=>[n(t(Le))]),_:1})])])}}}),vt={class:"cell"},ft={key:0},_t=["href"],bt=F({__name:"CustomCellRender",props:{params:{}},setup(D){const d=D,{params:s}=Q(d);return(g,o)=>{const b=Pe;return c(),h("div",vt,[t(s).colDef.cellRendererParams.type=="text"?(c(),h("span",ft,O(t(s).value),1)):L("",!0),t(s).colDef.cellRendererParams.type=="image"?(c(),N(b,{key:1,src:t(s).value},null,8,["src"])):L("",!0),t(s).colDef.cellRendererParams.type=="link"?(c(),h("a",{key:2,href:t(s).value},O(t(s).value),9,_t)):L("",!0)])}}}),gt=F({__name:"AgTable",props:ae({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ae(["onRemove","onClick"],["update:columns"]),setup(D,{emit:d}){M.onSubscribe("removeEvent",r=>{let v=r.column.getColId(),i=s.value.find(m=>m.dataIndex==v);i&&T(i)});const s=Ue(D,"columns"),g=D,{columnId:o,tableData:b}=Q(g),w=ce(()=>{let r=s.value.map(v=>({field:v.dataIndex,colId:v.dataIndex,headerName:v.title,pinned:v.fixed=="none"?void 0:v.fixed,lockVisible:!0,headerComponent:ut,cellRenderer:bt,cellRendererParams:{type:v.type}}));return r.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:pt}),r.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:rt}),r}),R=r=>{if(!r.finished)return;let v=[];r.api.getColumnState().forEach(i=>{let m=s.value.find(I=>I.dataIndex==i.colId);m&&v.push(m)}),s.value=v},C=r=>{if(!r.finished)return;let v=r.column.getColId(),i=s.value.findIndex(m=>m.dataIndex==v);i!=-1&&(s.value[i].width=r.column.getActualWidth())},x=d,T=r=>{x("onRemove",r)},k=r=>{let v=r.column.getId(),i=s.value.find(m=>m.dataIndex==v);x("onClick",i)};return(r,v)=>(c(),N(t(Ve),{rowData:t(b),columnDefs:w.value,style:de({height:r.height+"px"}),class:"ag-theme-quartz",onColumnMoved:R,onColumnResized:C,onColumnHeaderClicked:k},null,8,["rowData","columnDefs","style"]))}}),Ct=re(gt,[["__scopeId","data-v-5dd2184c"]]),yt=F({__name:"TableCfg",setup(D){const d=P(),{tableCfg:s,columnFields:g,currentColumn:o}=z(d),b=f({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(R=>{setTimeout(()=>{R(g.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),w=f();return ze(()=>o.value,()=>{w.value.refreshOption("dataIndex")}),(R,C)=>(c(),N(t(me),{formData:t(o),schema:b.value,ref_key:"schemaRef",ref:w,size:"small"},null,8,["formData","schema"]))}}),ht={class:"table-design"},wt={class:"table-design-container"},xt={class:"main-part"},kt={class:"filter-part"},It={class:"filter-container"},Dt=["onClick"],St={class:"add widget-item"},$t={class:"tools-part"},Rt={class:"tools-container"},Nt={class:"add button-item"},Tt={class:"table-part"},Bt=F({__name:"TableDesign",setup(D){const d=Me();M.onSubscribe("open-btn-modal",u=>{te(u)});const s=f([]);We(()=>{E.getDataSourceDict().then(u=>{const{code:e,data:y,msg:S}=u;e==200&&(s.value=y)})});const g=P(),{tableCfg:o,columnFields:b,saveLoading:w}=z(g),{onSelectColumn:R,onRemoveBtn:C,onRemoveColumn:x,onSetColumns:T,onRemoveWidget:k,onAddBtn:r,onSave:v}=g;window.name="table-design";const i=f([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),m=()=>{var u;(u=o.value.filter.widgetList)==null||u.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},I=()=>{window.open("/lowcode/table","quick-build")},A=u=>{R(u.id,o.value.columns),H.value=!0},pe=u=>{x(u.id,o.value.columns)};f([]);const Z=f([]),ve=()=>{E.getSourceData(o.value.datasource.sourceId,o.value.datasource.tableName).then(u=>{const{code:e,data:y,msg:S}=u;e==200&&(Z.value=y)})},ee=f([]),fe=()=>{E.getTableInfo(o.value.datasource.sourceId).then(u=>{const{code:e,data:y,msg:S}=u;e==200&&(ee.value=y)})},_e=()=>{E.getColumnInfo(o.value.datasource.sourceId,o.value.datasource.tableName).then(u=>{const{code:e,data:y,msg:S}=u;e==200&&(o.value.columns=y.map(p=>({dataIndex:p.columnName,title:p.columnComment||p.columnName,id:p.columnName,width:200,type:"text",align:"left",fixed:"none"})),T(y.map(p=>({label:p.columnComment?`${p.columnComment}(${p.columnName})`:p.columnName,value:p.columnName}))))}),ve()},be=()=>{r("header")},_=f({id:"",name:"",eventFlowId:"",position:"header",customEvent:!1,builtInEvents:"add"}),W=f(!1),ge=f([{label:"默认新增事件流",value:"add"},{label:"默认编辑事件流",value:"edit"},{label:"默认批量编辑事件流",value:"batchEdit"}]),te=u=>{_.value=u,W.value=!0},Ce=u=>{d.push({path:"/design/flow",query:{id:u}})},ye=()=>{d.push({path:"/design/flow"})},ne=f({}),q=f(!1),he=f({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"string",label:"字段名称"},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",show:'"${formData.type}" == "select"',component:{asyncData:async()=>{const{code:u,data:e,msg:y}=await E.getDictTypeList();return u==200?e.map(S=>({label:S.dictTypeDesc,value:S.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),we=u=>{ne.value=u,q.value=!0},H=f(!1);return(u,e)=>{const y=Qe,S=Xe,p=Ye,U=Ze,xe=et,ke=He,Ie=tt,le=X,oe=nt,De=lt,Se=ot,$e=at,j=je,Re=Ge("loading");return c(),h(V,null,[qe((c(),h("div",ht,[n(ke,{onBack:I,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[n(y,{value:t(o).name,"onUpdate:value":e[0]||(e[0]=l=>t(o).name=l),bordered:!1,class:"table-name"},null,8,["value"])]),extra:a(()=>[n(xe,{class:"extra"},{default:a(()=>[n(p,{label:"选择数据源"},{default:a(()=>[n(S,{value:t(o).datasource.sourceId,"onUpdate:value":e[1]||(e[1]=l=>t(o).datasource.sourceId=l),options:s.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:e[2]||(e[2]=l=>fe())},null,8,["value","options"])]),_:1}),n(p,{label:"选择表名"},{default:a(()=>[n(S,{value:t(o).datasource.tableName,"onUpdate:value":e[3]||(e[3]=l=>t(o).datasource.tableName=l),options:ee.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:e[4]||(e[4]=l=>_e())},null,8,["value","options"])]),_:1}),n(U,{onClick:e[5]||(e[5]=l=>t(v)()),type:"primary",class:"save-btn"},{default:a(()=>[B(" 保存 ")]),_:1})]),_:1})]),_:1}),$("div",wt,[$("div",xt,[$("div",kt,[$("div",It,[n(t(se),{list:t(o).filter.widgetList,"onUpdate:list":e[7]||(e[7]=l=>t(o).filter.widgetList=l),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(c(!0),h(V,null,J(t(o).filter.widgetList,l=>(c(),h("div",{class:"widget-item",key:l.id,onClick:G=>we(l)},[n(t(ie),{class:"move-handle",style:{cursor:"pointer"}}),n(p,{label:l.label,name:l.field},{default:a(()=>[l.type=="input"?(c(),N(y,{key:0})):l.type=="select"?(c(),N(S,{key:1})):(c(),N(Ie,{key:2}))]),_:2},1032,["label","name"]),n(le,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:G=>t(k)(l.id)},{default:a(()=>[n(t(K),{class:"remove-btn",onClick:ue(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,Dt))),128)),$("div",St,[n(U,{type:"primary",onClick:e[6]||(e[6]=l=>m())},{default:a(()=>[B(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),$("div",$t,[$("div",Rt,[n(t(se),{list:t(o).action,"onUpdate:list":e[9]||(e[9]=l=>t(o).action=l),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(c(!0),h(V,null,J(t(o).action.filter(l=>l.position=="header"),l=>(c(),h("div",{class:"button-item",key:l.id},[n(t(ie),{class:"move-handle",style:{cursor:"pointer"}}),n(U,{onClick:G=>te(l)},{default:a(()=>[B(O(l.name),1)]),_:2},1032,["onClick"]),n(le,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:G=>t(C)(l.id)},{default:a(()=>[n(t(K),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),$("div",Nt,[n(U,{type:"primary",onClick:e[8]||(e[8]=l=>be())},{default:a(()=>[B(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),$("div",Tt,[n(Ct,{columns:t(o).columns,"onUpdate:columns":e[10]||(e[10]=l=>t(o).columns=l),tableData:Z.value,height:550,onOnRemove:pe,onOnClick:A},null,8,["columns","tableData"])])])])])),[[Re,t(w),void 0,{fullscreen:!0}]]),n(j,{title:"按钮配置",placement:"right",closable:!1,open:W.value,onClose:e[19]||(e[19]=l=>W.value=!1)},{default:a(()=>[n($e,{model:_.value},{default:a(()=>[n(p,{prop:"id",label:"按钮标识"},{default:a(()=>[n(y,{value:_.value.id,"onUpdate:value":e[11]||(e[11]=l=>_.value.id=l)},null,8,["value"])]),_:1}),n(p,{prop:"name",label:"按钮名称"},{default:a(()=>[n(y,{value:_.value.name,"onUpdate:value":e[12]||(e[12]=l=>_.value.name=l)},null,8,["value"])]),_:1}),n(p,{prop:"name",label:"按钮位置"},{default:a(()=>[n(De,{value:_.value.position,"onUpdate:value":e[13]||(e[13]=l=>_.value.position=l),"button-style":"solid"},{default:a(()=>[n(oe,{value:"header"},{default:a(()=>[B("表头")]),_:1}),n(oe,{value:"row"},{default:a(()=>[B("行内")]),_:1})]),_:1},8,["value"])]),_:1}),n(p,{prop:"customEvent",label:"是否启用自定义"},{default:a(()=>[n(Se,{checked:_.value.customEvent,"onUpdate:checked":e[14]||(e[14]=l=>_.value.customEvent=l)},null,8,["checked"])]),_:1}),_.value.customEvent?L("",!0):(c(),N(p,{key:0,prop:"builtInEvents",label:"内置事件"},{default:a(()=>[n(S,{value:_.value.builtInEvents,"onUpdate:value":e[15]||(e[15]=l=>_.value.builtInEvents=l),options:i.value,allowClear:""},null,8,["value","options"])]),_:1})),_.value.customEvent?(c(),N(p,{key:1,prop:"event",label:"自定义事件流"},{default:a(()=>[n(S,{value:_.value.eventFlowId,"onUpdate:value":e[18]||(e[18]=l=>_.value.eventFlowId=l),options:ge.value,allowClear:""},{suffixIcon:a(()=>[n(t(Je),{style:{color:"#000"},title:"刷新"}),_.value.eventFlowId?(c(),N(t(Ke),{key:0,onClick:e[16]||(e[16]=l=>Ce(_.value.eventFlowId)),style:{color:"#000"},title:"编辑事件流"})):(c(),N(t(Y),{key:1,style:{color:"#000"},title:"新增事件流",onClick:e[17]||(e[17]=l=>ye())}))]),_:1},8,["value","options"])]),_:1})):L("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),n(j,{title:"筛选控件配置",placement:"right",closable:!1,open:q.value,onClose:e[20]||(e[20]=l=>q.value=!1)},{default:a(()=>[n(t(me),{formData:ne.value,schema:he.value},null,8,["formData","schema"])]),_:1},8,["open"]),n(j,{title:"列配置",placement:"right",closable:!1,open:H.value,onClose:e[21]||(e[21]=l=>H.value=!1)},{default:a(()=>[n(yt)]),_:1},8,["open"])],64)}}}),Pt=re(Bt,[["__scopeId","data-v-dbb80773"]]);export{Pt as default};
