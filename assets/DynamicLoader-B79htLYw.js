var a=Object.defineProperty;var c=(o,t,e)=>t in o?a(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var r=(o,t,e)=>(c(o,typeof t!="symbol"?t+"":t,e),e);import{v as l,V as m}from"./.pnpm-CkPzpllQ.js";class u{constructor(t){r(this,"state",{});t&&(this.state=t)}getValue(t){const{_value:e,_mode:s,_dynExp:n}=t;return s==="static"?e:this.resolveDynamicValue(n)}createDynamicConfigData(t){return{_value:t||"",_mode:"static",_dynExp:""}}resolveDynamicValue(t){try{return new Function("state",`return ${t}`)(this.state)}catch(e){return console.error("评估动态表达式时出错:",e),null}}isDynamicConfigData(t){return typeof t=="object"&&t!==null&&["static","dynamic"].includes(t._mode)}processObject(t){const e=l(t);if(Array.isArray(e))return e.map(s=>this.processObject(s));if(typeof e=="object"&&e!==null){const s={};for(const n in e){const i=e[n];this.isDynamicConfigData(i)?s[n]=this.getValue(i):typeof i=="object"&&i!==null?s[n]=this.processObject(i):s[n]=i}return s}else return e}}class d{constructor(t){r(this,"libs");r(this,"scripts",[]);r(this,"styles",[]);r(this,"componentsMap",new Map);r(this,"components",{});this.libs=t,this.init()}init(){window.Vue||(window.Vue=m),this.handleLibs(),this.handleUrls()}handleUrls(){this.libs.map(e=>e.urls).flat().forEach(e=>{e.endsWith("js")?this.scripts.push(e):e.endsWith("css")&&this.styles.push(e)})}load(){return new Promise((t,e)=>{Promise.allSettled([...this.styles.map(s=>this.loadStyle(s)),...this.scripts.map(s=>this.loadScript(s))]).then(()=>{this.registerComponents(),t(this.components)}).catch(s=>{e(s)})})}registerComponents(){for(const[t,e]of this.componentsMap)Array.isArray(e)?e.forEach(s=>{this.components[s.componentName]=window[t][s.exportName]}):this.components[e.componentName]=window[e.exportName]}handleLibChildren(t){const e=t.children.map(s=>({exportName:s.exportName,componentName:s.componentName}));this.componentsMap.set(t.exportName,e)}handleLibs(t=this.libs){t.forEach(e=>{this.isLibTree(e)?this.handleLibChildren(e):this.componentsMap.set(e.exportName,{exportName:e.exportName,componentName:e.componentName})})}isLibTree(t){return"children"in t}loadScript(t){return new Promise((e,s)=>{const n=document.createElement("script");n.src=t,n.async=!1,n.onload=e,n.onerror=s,document.body.appendChild(n)})}loadStyle(t){return new Promise((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=t,n.onload=e,n.onerror=s,document.head.appendChild(n)})}}export{u as D,d as a};
