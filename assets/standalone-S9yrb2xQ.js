import{c as N}from"./iconfont-5d80JBh_.js";import{k as j,r as c,m as z,t as S,n as A,d as B,s as G,p as R,b as H,q as T,o as b,e as W,w as U,v as V,x as L,c as q,y as Q,z as F,A as J,u as g,B as E,D as P,E as K,F as M,G as X,H as Y,g as Z,i as tt,$ as et}from"./.pnpm-CaFG0eUE.js";import{c as $}from"./componentsSchema-LhIlCAWr.js";import{D as at,a as st}from"./DynamicLoader-Cswt9x1g.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ot=j("dgDesign",()=>{const n=c({}),s=c([]),o=c({});c("");const i=t=>{s.value.push(t)},y=t=>{const{id:a}=t,p=s.value.findIndex(f=>f.id===a);p!==-1&&s.value.splice(p,1)},l=t=>{s.value=t},r=t=>{const a=$.findIndex(f=>f.name===t);if(a===-1)throw new Error("组件不存在");const p=z($[a]);return p.id=new Date().getTime().toString(),p},_=t=>{o.value.id!==t.id&&(o.value=t,window.parent.postMessage({type:"select",data:S(t)},window.location.origin))},D=t=>{const{id:a}=t,p=s.value.findIndex(f=>f.id===a);p!==-1&&s.value.splice(p,1,t)},I=t=>{window.parent.postMessage({type:"update-item",data:S(t)},window.location.origin)},x=t=>new at(u.value).processObject(t),h=()=>{m().then(t=>{window.parent.postMessage({type:"save",data:{list:S(s.value),img:t}},window.location.origin)})},w=c({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),C=t=>{w.value=t,e()},u=c({}),d=t=>{const a={},p=(f,v)=>{switch(f){case"string":return v;case"number":return Number(v);case"boolean":return!!v;case"array":case"object":return JSON.parse(v);default:return v}};return t.reduce((f,v)=>(f[v.name]=p(v.type,v.defaultValue),f),a),a},e=()=>{u.value=d(w.value.vars)},m=async()=>{const t=document.querySelector(".dg-design-container");return(await A(t)).toDataURL("image/png")};return{dashboardData:n,add:i,remove:y,dgList:s,initDgItem:r,selectItem:_,curComp:o,updateItem:D,transformProps:x,updateVariables:e,setVarPools:C,updateDgItem:I,sendDgList:h,createPreviewImg:m,init:l}}),nt=12,rt=8,ct=B({__name:"StandalonePage",setup(n){const s=ot(),{dgList:o}=G(s),{initDgItem:i,add:y,selectItem:l,updateItem:r,transformProps:_,setVarPools:D,updateDgItem:I,sendDgList:x,init:h}=s,w=c(),C=c(0),u=e=>{const m=e.dataTransfer.getData("material-type");let t;m=="custom"?t={name:e.dataTransfer.getData("material"),id:new Date().getTime().toString(),label:"自定义组件",icon:"",type:"custom",component:e.dataTransfer.getData("material"),props:{},style:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2}:t=i(e.dataTransfer.getData("material"));const a=e.x/(C.value/nt),p=e.y/rt;t.colStart=Math.floor(a),t.rowStart=Math.floor(p),y(t)},d=c({});return window.addEventListener("message",e=>{e.data.type,e.data.type==="refresh"?r(e.data.data):e.data.type==="add-custom-comp"?new st([e.data.data]).load().then(t=>{Object.keys(t).forEach(a=>{d.value[a]=t[a]})}):e.data.type==="refresh-var"?D(e.data.data):e.data.type==="get-dg"?x():e.data.type==="refresh-all"&&(e.data.data,h(e.data.data))}),R(()=>{C.value=w.value.clientWidth}),(e,m)=>{const t=H("grid-layout");return b(),T("div",{class:"container dg-design-container",ref_key:"container",ref:w,onDragover:m[0]||(m[0]=E(()=>{},["prevent","stop"])),onDrop:E(u,["stop"])},[W(t,{list:g(o),class:"layout","onItem:click":g(l),"onItem:change":g(I)},{"layout-item":U(({item:a})=>[V("div",{class:"comp-container",style:L(a.style)},[a.type&&a.type==="custom"?(b(),q(Q(d.value[a.component]),F(J({key:0},g(_)(a.props))),null,16)):(b(),q(Q(a.component),{key:1,"style-config":a.style,attrs:g(_)(a.props)},null,8,["style-config","attrs"]))],4)]),_:1},8,["list","onItem:click","onItem:change"])],544)}}}),it=O(ct,[["__scopeId","data-v-34b7c7c3"]]),lt=B({__name:"QBChart",props:{attrs:{default:()=>({dataset:"",dimension:[],target:[]})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:o,styleConfig:i}=P(s),y=c(!0),l=c();let r;const _=c(0),D=c(""),I=c([{title:"title1",value:100},{title:"title2",value:200},{title:"title3",value:300}]),x=async()=>{D.value=o.value.dataset;const{data:u,code:d,msg:e}=await N.getPreviewByDatasetId(D.value);d==200?I.value=u:I.value=[]},h=()=>{const{dimension:u,target:d}=o.value,e=S(i.value.option),m=S(i.value.series),t=[];return d.forEach(a=>{t.push(z(m))}),e.series=t,{...e,dataset:{source:S(I.value)||[],dimensions:[...u,...d]}}},w=()=>{o.value.dataset&&D.value!=o.value.dataset?x().then(()=>{r?(r.clear(),r.setOption(h())):l.value&&(r=M(l.value),r.setOption(h()))}):r?(r.clear(),r.setOption(h())):l.value&&(r=M(l.value),r.setOption(h())),y.value=!1},C=new ResizeObserver(u=>{_.value&&clearTimeout(_.value),_.value=window.setTimeout(()=>{try{r.resize()}catch(d){console.warn(`chart重新设置大小失败,失败原因：${d}`)}},100)});return R(()=>{w(),setTimeout(()=>{C.observe(l.value)},100)}),K(()=>[s.styleConfig],()=>{w()},{deep:!0}),(u,d)=>(b(),T("div",{ref_key:"QBChart",ref:l,class:"qb-chart"},null,512))}}),dt=O(lt,[["__scopeId","data-v-dd5ee5c9"]]),pt={class:"qb-iframe"},ut=["src"],mt=B({__name:"QBIframe",props:{attrs:{default:()=>({src:""})},preview:{type:Boolean,default:!1}},setup(n){const s=n,{attrs:o,preview:i}=P(s);return(y,l)=>(b(),T("div",pt,[V("iframe",{class:X(g(i)?"":"no-effect"),src:g(o).src,style:{width:"100%",height:"100%",border:"none"}},null,10,ut)]))}}),ft=O(mt,[["__scopeId","data-v-67323949"]]),gt=["src"],vt=B({__name:"QBImage",props:{attrs:{default:()=>({src:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:o,styleConfig:i}=P(s);return(y,l)=>(b(),T("img",{class:"qb-image",style:L([{width:"100%",height:"100%"},g(i)]),src:g(o).src},null,12,gt))}}),yt=O(vt,[["__scopeId","data-v-3b56b274"]]),_t=B({__name:"QBText",props:{attrs:{default:()=>({text:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:o}=P(s);return(i,y)=>(b(),T("div",{class:"qb-text",style:L(i.styleConfig)},Y(g(o).text),5))}}),ht=O(_t,[["__scopeId","data-v-ad3a33fa"]]),wt=n=>{n.component("qb-chart",dt),n.component("qb-iframe",ft),n.component("qb-image",yt),n.component("qb-text",ht)},k=Z(it);k.use(tt());k.use(wt);k.component("GridLayout",et);k.mount("#standalone-app");
