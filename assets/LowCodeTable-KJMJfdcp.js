import{c as g}from"./iconfont-DbxD-LdR.js";import{_ as ie}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-DEM9RlQ5.js";import{F as de}from"./FlowExecutor-Bak0qDVj.js";import{d as pe,D as _e,r as u,Q as L,a as I,p as fe,q as x,c as f,a8 as w,e as v,a1 as ve,w as i,a3 as me,az as he,P as U,X as V,ax as ge,U as be,O as E,a7 as ye,ai as Ce,H as B,o as c,a4 as ke,a5 as Ie,W as xe,aM as De,m as Ne,a2 as J,h as K,aL as Se}from"./.pnpm-CfU0UuIO.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"low-code-table"},Te={key:0,class:"tools"},we=["href"],Le=pe({__name:"LowCodeTable",props:{id:{default:""}},setup(Y){const Z=Y,{id:M}=_e(Z);u();const b=u(),D=u(),N=u(),R=u(),d=u(),ee=L(()=>{var e;return(e=D.value)==null?void 0:e.showPagination}),ae=L(()=>{var e;return((e=D.value)==null?void 0:e.showFilter)&&b.value&&b.value.length>0}),te=L(()=>{var o;const e=(o=N.value)==null?void 0:o.filter(a=>a.position=="header");return e&&e.length>0}),oe=L(()=>{var o;const e=(o=N.value)==null?void 0:o.filter(a=>a.position=="row");return e&&e.length>0});if(M.value)g.getLowCodeTableDetail(M.value).then(e=>{const{code:o,data:a,msg:t}=e;o==200?(b.value=a.filter,D.value=a.global,N.value=a.action,d.value=a.dataSource,le(b.value),ne(b.value),R.value=se(a.columns),y()):I.error(t)});else throw new Error("id is required");const O=u(!1),W=u([]),n=u({pageNumber:1,pageSize:10}),$=u(),q=u(0),le=e=>{e.forEach(o=>{o.defaultValue&&(n.value[o.field]=o.defaultValue)})},H=u({}),A=u({}),ne=e=>{const o=e.filter(t=>{if(t.type=="select"&&t.dictType=="dict")return t}).map(t=>t.dict),a=e.filter(t=>{if(t.type=="select"&&t.dictType=="col")return t}).map(t=>t.field);o.length>0&&g.getDict(o).then(t=>{const{code:p,data:m,msg:h}=t;p==200?H.value=m:I.error(h)}),a.length>0&&a.forEach(t=>{g.getLowCodeColData({sourceId:d.value.sourceId,tableName:d.value.tableName,field:t}).then(p=>{const{code:m,data:h,msg:s}=p;m==200?A.value[t]=h:I.error(s)})})},se=e=>{const o=e.map(a=>({title:a.title,key:a.id,dataIndex:a.dataIndex,width:a.width,align:a.align,fixed:a.fixed,type:a.type}));return oe.value&&o.push({title:"操作",key:"_action_",dataIndex:"_action_",width:250,fixed:"right"}),o},y=()=>{O.value=!0,g.getLowCodeTableList({sourceId:d.value.sourceId,tableName:d.value.tableName,pageNumber:n.value.pageNumber,pageSize:n.value.pageSize,paramsData:n.value}).then(e=>{const{code:o,data:a,msg:t}=e;O.value=!1,o==200?(W.value=a.data,q.value=a.total):I.error(t)})},ue=()=>{var e;(e=$.value)==null||e.resetFields(),y()},ce=e=>{const{current:o,pageSize:a}=e;n.value.pageNumber=o,n.value.pageSize=a,y()},C=u({}),P=()=>{C.value={}},Q=(e,o)=>{const{customEvent:a,builtInEvents:t,eventFlow:p,formId:m,position:h}=e;if(o&&(C.value=Ne(o)),a)try{if(!p)return console.log("未配置工作流");const s=new de(p);o&&s.setModalFormData(C.value),s.run()}catch{}else{if(["add","edit"].includes(t)){let s=t=="add"?g.insertLowCodeTable:g.updateLowCodeTable;J.confirm({title:t=="add"?"新增":"编辑",content:K(ie,{id:m,formData:C.value}),onOk(){s({sourceId:d.value.sourceId,tableName:d.value.tableName,data:C.value}).then(S=>{const{code:z,data:F,msg:X}=S;P(),z==200&&(I.success(F),y())})},onCancel(){P()}})}t=="delete"&&J.confirm({title:"您确定要删除该数据吗?",icon:K(Se),content:"该操作无法还原！",onOk(){g.removeLowCodeTable({sourceId:d.value.sourceId,tableName:d.value.tableName,data:C.value}).then(s=>{const{code:S,data:z,msg:F}=s;P(),S==200&&(I.success(z),y())})},onCancel(){}})}};return fe(()=>{}),(e,o)=>{const a=Ie,t=xe,p=De,m=ke,h=ge,s=be,S=he,z=me,F=ve,X=Ce,re=ye;return c(),x("div",Fe,[ae.value?(c(),f(F,{key:0,class:"search-area"},{default:i(()=>[v(z,{ref_key:"searchFormRef",ref:$,model:n.value,onFinish:y},{default:i(()=>[v(S,{gutter:24},{default:i(()=>[(c(!0),x(U,null,V(b.value,l=>(c(),f(h,{span:6,key:l.id},{default:i(()=>[v(m,{label:l.label,name:l.field},{default:i(()=>[l.type=="input"?(c(),f(a,{key:0,allowClear:!0,value:n.value[l.field],"onUpdate:value":_=>n.value[l.field]=_},null,8,["value","onUpdate:value"])):l.type=="select"?(c(),f(t,{key:1,value:n.value[l.field],"onUpdate:value":_=>n.value[l.field]=_,options:l.dictType=="dict"?H.value[l.dict]:A.value[l.field],allowClear:!0},null,8,["value","onUpdate:value","options"])):(c(),f(p,{key:2,value:n.value[l.field],"onUpdate:value":_=>n.value[l.field]=_},null,8,["value","onUpdate:value"]))]),_:2},1032,["label","name"])]),_:2},1024))),128)),v(h,{span:6,style:{"text-align":"right"}},{default:i(()=>[v(s,{type:"primary","html-type":"submit"},{default:i(()=>[E("搜索")]),_:1}),v(s,{style:{margin:"0 8px"},onClick:ue},{default:i(()=>[E(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})):w("",!0),v(F,null,{default:i(()=>{var l,_,j;return[te.value?(c(),x("div",Te,[(c(!0),x(U,null,V((l=N.value)==null?void 0:l.filter(r=>r.position=="header"),r=>(c(),f(s,{key:r.id,onClick:T=>Q(r)},{default:i(()=>[E(B(r.name),1)]),_:2},1032,["onClick"]))),128))])):w("",!0),v(re,{loading:O.value,columns:R.value,"data-source":W.value,scroll:{y:500},onChange:ce,pagination:ee.value&&{current:n.value.pageNumber,total:q.value,showSizeChanger:!0,pageSize:n.value.pageSize},bordered:(_=D.value)==null?void 0:_.showBordered,size:(j=D.value)==null?void 0:j.size},{bodyCell:i(({column:r,record:T})=>{var G;return[r.type==="image"?(c(),f(X,{key:0,src:T[r.dataIndex]},null,8,["src"])):w("",!0),r.type==="link"?(c(),x("a",{key:1,href:T[r.dataIndex]},B(T[r.dataIndex]),9,we)):w("",!0),r.key=="_action_"?(c(!0),x(U,{key:2},V((G=N.value)==null?void 0:G.filter(k=>k.position=="row"),k=>(c(),f(s,{type:"link",key:k.id,onClick:Ee=>Q(k,T),danger:k.builtInEvents==="delete"},{default:i(()=>[E(B(k.name),1)]),_:2},1032,["onClick","danger"]))),128)):w("",!0)]}),_:1},8,["loading","columns","data-source","pagination","bordered","size"])]}),_:1})])}}}),Me=ze(Le,[["__scopeId","data-v-e9753fd9"]]);export{Me as L};
