const Ce=1024;let ge=0;class Z{constructor(e,t){this.from=e,this.to=t}}class k{constructor(e={}){this.id=ge++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=j.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}k.closedBy=new k({deserialize:l=>l.split(" ")});k.openedBy=new k({deserialize:l=>l.split(" ")});k.group=new k({deserialize:l=>l.split(" ")});k.isolate=new k({deserialize:l=>{if(l&&l!="rtl"&&l!="ltr"&&l!="auto")throw new RangeError("Invalid value for isolate: "+l);return l||"auto"}});k.contextHash=new k({perNode:!0});k.lookAhead=new k({perNode:!0});k.mounted=new k({perNode:!0});class X{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[k.mounted.id]}}const xe=Object.create(null);class j{constructor(e,t,r,i=0){this.name=e,this.props=t,this.id=r,this.flags=i}static define(e){let t=e.props&&e.props.length?Object.create(null):xe,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),i=new j(e.name||"",t,e.id,r);if(e.props){for(let n of e.props)if(Array.isArray(n)||(n=n(i)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[n[0].id]=n[1]}}return i}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(k.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let i of r.split(" "))t[i]=e[r];return r=>{for(let i=r.prop(k.group),n=-1;n<(i?i.length:0);n++){let s=t[n<0?r.name:i[n]];if(s)return s}}}}j.none=new j("",Object.create(null),0,8);class ae{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let i=null;for(let n of e){let s=n(r);s&&(i||(i=Object.assign({},r.props)),i[s[0].id]=s[1])}t.push(i?new j(r.name,i,r.id,r.flags):r)}return new ae(t)}}const K=new WeakMap,fe=new WeakMap;var N;(function(l){l[l.ExcludeBuffers=1]="ExcludeBuffers",l[l.IncludeAnonymous=2]="IncludeAnonymous",l[l.IgnoreMounts=4]="IgnoreMounts",l[l.IgnoreOverlays=8]="IgnoreOverlays"})(N||(N={}));class O{constructor(e,t,r,i,n){if(this.type=e,this.children=t,this.positions=r,this.length=i,this.props=null,n&&n.length){this.props=Object.create(null);for(let[s,h]of n)this.props[typeof s=="number"?s:s.id]=h}}toString(){let e=X.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let i=r.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new te(this.topNode,e)}cursorAt(e,t=0,r=0){let i=K.get(this)||this.topNode,n=new te(i);return n.moveTo(e,t),K.set(this,n._tree),n}get topNode(){return new B(this,0,0,null)}resolve(e,t=0){let r=V(K.get(this)||this.topNode,e,t,!1);return K.set(this,r),r}resolveInner(e,t=0){let r=V(fe.get(this)||this.topNode,e,t,!0);return fe.set(this,r),r}resolveStack(e,t=0){return me(this,e,t)}iterate(e){let{enter:t,leave:r,from:i=0,to:n=this.length}=e,s=e.mode||0,h=(s&N.IncludeAnonymous)>0;for(let o=this.cursor(s|N.IncludeAnonymous);;){let C=!1;if(o.from<=n&&o.to>=i&&(!h&&o.type.isAnonymous||t(o)!==!1)){if(o.firstChild())continue;C=!0}for(;C&&r&&(h||!o.type.isAnonymous)&&r(o),!o.nextSibling();){if(!o.parent())return;C=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:se(j.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,i)=>new O(this.type,t,r,i,this.propValues),e.makeTree||((t,r,i)=>new O(j.none,t,r,i)))}static build(e){return we(e)}}O.empty=new O(j.none,[],[],0);class ie{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ie(this.buffer,this.index)}}class W{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return j.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],i=this.set.types[t],n=i.name;if(/\W/.test(n)&&!i.isError&&(n=JSON.stringify(n)),e+=4,r==e)return n;let s=[];for(;e<r;)s.push(this.childString(e)),e=this.buffer[e+3];return n+"("+s.join(",")+")"}findChild(e,t,r,i,n){let{buffer:s}=this,h=-1;for(let o=e;o!=t&&!(pe(n,i,s[o+1],s[o+2])&&(h=o,r>0));o=s[o+3]);return h}slice(e,t,r){let i=this.buffer,n=new Uint16Array(t-e),s=0;for(let h=e,o=0;h<t;){n[o++]=i[h++],n[o++]=i[h++]-r;let C=n[o++]=i[h++]-r;n[o++]=i[h++]-e,s=Math.max(s,C)}return new W(n,s,this.set)}}function pe(l,e,t,r){switch(l){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function V(l,e,t,r){for(var i;l.from==l.to||(t<1?l.from>=e:l.from>e)||(t>-1?l.to<=e:l.to<e);){let s=!r&&l instanceof B&&l.index<0?null:l.parent;if(!s)return l;l=s}let n=r?0:N.IgnoreOverlays;if(r)for(let s=l,h=s.parent;h;s=h,h=s.parent)s instanceof B&&s.index<0&&((i=h.enter(e,t,n))===null||i===void 0?void 0:i.from)!=s.from&&(l=h);for(;;){let s=l.enter(e,t,n);if(!s)return l;l=s}}class de{cursor(e=0){return new te(this,e)}getChild(e,t=null,r=null){let i=ue(this,e,t,r);return i.length?i[0]:null}getChildren(e,t=null,r=null){return ue(this,e,t,r)}resolve(e,t=0){return V(this,e,t,!1)}resolveInner(e,t=0){return V(this,e,t,!0)}matchContext(e){return ee(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(r=t,t=i.prevSibling):t=i}return r}get node(){return this}get next(){return this.parent}}class B extends de{constructor(e,t,r,i){super(),this._tree=e,this.from=t,this.index=r,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,i,n=0){for(let s=this;;){for(let{children:h,positions:o}=s._tree,C=t>0?h.length:-1;e!=C;e+=t){let d=h[e],S=o[e]+s.from;if(pe(i,r,S,S+d.length)){if(d instanceof W){if(n&N.ExcludeBuffers)continue;let w=d.findChild(0,d.buffer.length,t,r-S,i);if(w>-1)return new E(new ye(s,d,e,S),null,w)}else if(n&N.IncludeAnonymous||!d.type.isAnonymous||ne(d)){let w;if(!(n&N.IgnoreMounts)&&(w=X.get(d))&&!w.overlay)return new B(w.tree,S,e,s);let I=new B(d,S,e,s);return n&N.IncludeAnonymous||!I.type.isAnonymous?I:I.nextChild(t<0?d.children.length-1:0,t,r,i)}}}if(n&N.IncludeAnonymous||!s.type.isAnonymous||(s.index>=0?e=s.index+t:e=t<0?-1:s._parent._tree.children.length,s=s._parent,!s))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let i;if(!(r&N.IgnoreOverlays)&&(i=X.get(this._tree))&&i.overlay){let n=e-this.from;for(let{from:s,to:h}of i.overlay)if((t>0?s<=n:s<n)&&(t<0?h>=n:h>n))return new B(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function ue(l,e,t,r){let i=l.cursor(),n=[];if(!i.firstChild())return n;if(t!=null){for(let s=!1;!s;)if(s=i.type.is(t),!i.nextSibling())return n}for(;;){if(r!=null&&i.type.is(r))return n;if(i.type.is(e)&&n.push(i.node),!i.nextSibling())return r==null?n:[]}}function ee(l,e,t=e.length-1){for(let r=l;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class ye{constructor(e,t,r,i){this.parent=e,this.buffer=t,this.index=r,this.start=i}}class E extends de{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:i}=this.context,n=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.context.start,r);return n<0?null:new E(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&N.ExcludeBuffers)return null;let{buffer:i}=this.context,n=i.findChild(this.index+4,i.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return n<0?null:new E(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new E(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new E(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,i=this.index+4,n=r.buffer[this.index+3];if(n>i){let s=r.buffer[this.index+1];e.push(r.slice(i,n,s)),t.push(0)}return new O(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function ce(l){if(!l.length)return null;let e=0,t=l[0];for(let n=1;n<l.length;n++){let s=l[n];(s.from>t.from||s.to<t.to)&&(t=s,e=n)}let r=t instanceof B&&t.index<0?null:t.parent,i=l.slice();return r?i[e]=r:i.splice(e,1),new be(i,t)}class be{constructor(e,t){this.heads=e,this.node=t}get next(){return ce(this.heads)}}function me(l,e,t){let r=l.resolveInner(e,t),i=null;for(let n=r instanceof B?r:r.context.parent;n;n=n.parent)if(n.index<0){let s=n.parent;(i||(i=[r])).push(s.resolve(e,t)),n=s}else{let s=X.get(n.tree);if(s&&s.overlay&&s.overlay[0].from<=e&&s.overlay[s.overlay.length-1].to>=e){let h=new B(s.tree,s.overlay[0].from+n.from,-1,n);(i||(i=[r])).push(V(h,e,t,!1))}}return i?ce(i):r}class te{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof B)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:i}=this.buffer;return this.type=t||i.set.types[i.buffer[e]],this.from=r+i.buffer[e+1],this.to=r+i.buffer[e+2],!0}yield(e){return e?e instanceof B?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:i}=this.buffer,n=i.findChild(this.index+4,i.buffer[this.index+3],e,t-this.buffer.start,r);return n<0?!1:(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&N.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&N.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&N.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let i=r<0?0:this.stack[r]+4;if(this.index!=i)return this.yieldBuf(t.findChild(i,this.index,-1,0,4))}else{let i=t.buffer[this.index+3];if(i<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:i}=this;if(i){if(e>0){if(this.index<i.buffer.buffer.length)return!1}else for(let n=0;n<this.index;n++)if(i.buffer.buffer[n+3]<this.index)return!1;({index:t,parent:r}=i)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let n=t+e,s=e<0?-1:r._tree.children.length;n!=s;n+=e){let h=r._tree.children[n];if(this.mode&N.IncludeAnonymous||h instanceof W||!h.type.isAnonymous||ne(h))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let i=this.index,n=this.stack.length;n>=0;){for(let s=e;s;s=s._parent)if(s.index==i){if(i==this.index)return s;t=s,r=n+1;break e}i=this.stack[--n]}for(let i=r;i<this.stack.length;i++)t=new E(this.buffer,t,this.stack[i]);return this.bufferNode=new E(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let i=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(i=!0)}for(;;){if(i&&t&&t(this),i=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,i=!0}}}matchContext(e){if(!this.buffer)return ee(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let i=e.length-1,n=this.stack.length-1;i>=0;n--){if(n<0)return ee(this._tree,e,i);let s=r[t.buffer[this.stack[n]]];if(!s.isAnonymous){if(e[i]&&e[i]!=s.name)return!1;i--}}return!0}}function ne(l){return l.children.some(e=>e instanceof W||!e.type.isAnonymous||ne(e))}function we(l){var e;let{buffer:t,nodeSet:r,maxBufferLength:i=1024,reused:n=[],minRepeatType:s=r.types.length}=l,h=Array.isArray(t)?new ie(t,t.length):t,o=r.types,C=0,d=0;function S(c,x,f,b,p,m){let{id:a,start:u,end:g,size:y}=h,A=d,L=C;for(;y<0;)if(h.next(),y==-1){let R=n[a];f.push(R),b.push(u-c);return}else if(y==-3){C=a;return}else if(y==-4){d=a;return}else throw new RangeError(`Unrecognized record size: ${y}`);let J=o[a],$,U,le=u-c;if(g-u<=i&&(U=Y(h.pos-x,p))){let R=new Uint16Array(U.size-U.skip),z=h.pos-U.size,P=R.length;for(;h.pos>z;)P=G(U.start,R,P);$=new W(R,g-U.start,r),le=U.start-c}else{let R=h.pos-y;h.next();let z=[],P=[],F=a>=s?a:-1,H=0,q=g;for(;h.pos>R;)F>=0&&h.id==F&&h.size>=0?(h.end<=q-i&&(_(z,P,u,H,h.end,q,F,A,L),H=z.length,q=h.end),h.next()):m>2500?w(u,R,z,P):S(u,R,z,P,F,m+1);if(F>=0&&H>0&&H<z.length&&_(z,P,u,H,u,q,F,A,L),z.reverse(),P.reverse(),F>-1&&H>0){let he=I(J,L);$=se(J,z,P,0,z.length,0,g-u,he,he)}else $=M(J,z,P,g-u,A-g,L)}f.push($),b.push(le)}function w(c,x,f,b){let p=[],m=0,a=-1;for(;h.pos>x;){let{id:u,start:g,end:y,size:A}=h;if(A>4)h.next();else{if(a>-1&&g<a)break;a<0&&(a=y-i),p.push(u,g,y),m++,h.next()}}if(m){let u=new Uint16Array(m*4),g=p[p.length-2];for(let y=p.length-3,A=0;y>=0;y-=3)u[A++]=p[y],u[A++]=p[y+1]-g,u[A++]=p[y+2]-g,u[A++]=A;f.push(new W(u,p[2]-g,r)),b.push(g-c)}}function I(c,x){return(f,b,p)=>{let m=0,a=f.length-1,u,g;if(a>=0&&(u=f[a])instanceof O){if(!a&&u.type==c&&u.length==p)return u;(g=u.prop(k.lookAhead))&&(m=b[a]+u.length+g)}return M(c,f,b,p,m,x)}}function _(c,x,f,b,p,m,a,u,g){let y=[],A=[];for(;c.length>b;)y.push(c.pop()),A.push(x.pop()+f-p);c.push(M(r.types[a],y,A,m-p,u-m,g)),x.push(p-f)}function M(c,x,f,b,p,m,a){if(m){let u=[k.contextHash,m];a=a?[u].concat(a):[u]}if(p>25){let u=[k.lookAhead,p];a=a?[u].concat(a):[u]}return new O(c,x,f,b,a)}function Y(c,x){let f=h.fork(),b=0,p=0,m=0,a=f.end-i,u={size:0,start:0,skip:0};e:for(let g=f.pos-c;f.pos>g;){let y=f.size;if(f.id==x&&y>=0){u.size=b,u.start=p,u.skip=m,m+=4,b+=4,f.next();continue}let A=f.pos-y;if(y<0||A<g||f.start<a)break;let L=f.id>=s?4:0,J=f.start;for(f.next();f.pos>A;){if(f.size<0)if(f.size==-3)L+=4;else break e;else f.id>=s&&(L+=4);f.next()}p=J,b+=y,m+=L}return(x<0||b==c)&&(u.size=b,u.start=p,u.skip=m),u.size>4?u:void 0}function G(c,x,f){let{id:b,start:p,end:m,size:a}=h;if(h.next(),a>=0&&b<s){let u=f;if(a>4){let g=h.pos-(a-4);for(;h.pos>g;)f=G(c,x,f)}x[--f]=u,x[--f]=m-c,x[--f]=p-c,x[--f]=b}else a==-3?C=b:a==-4&&(d=b);return f}let T=[],v=[];for(;h.pos>0;)S(l.start||0,l.bufferStart||0,T,v,-1,0);let D=(e=l.length)!==null&&e!==void 0?e:T.length?v[0]+T[0].length:0;return new O(o[l.topID],T.reverse(),v.reverse(),D)}const oe=new WeakMap;function Q(l,e){if(!l.isAnonymous||e instanceof W||e.type!=l)return 1;let t=oe.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=l||!(r instanceof O)){t=1;break}t+=Q(l,r)}oe.set(e,t)}return t}function se(l,e,t,r,i,n,s,h,o){let C=0;for(let _=r;_<i;_++)C+=Q(l,e[_]);let d=Math.ceil(C*1.5/8),S=[],w=[];function I(_,M,Y,G,T){for(let v=Y;v<G;){let D=v,c=M[v],x=Q(l,_[v]);for(v++;v<G;v++){let f=Q(l,_[v]);if(x+f>=d)break;x+=f}if(v==D+1){if(x>d){let f=_[D];I(f.children,f.positions,0,f.children.length,M[D]+T);continue}S.push(_[D])}else{let f=M[v-1]+_[v-1].length-c;S.push(se(l,_,M,D,v,c,f,null,o))}w.push(c+T-n)}}return I(e,t,r,i,0),(h||o)(S,w,s)}class Se{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let i=this.map.get(e);i||this.map.set(e,i=new Map),i.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof E?this.setBuffer(e.context.buffer,e.index,t):e instanceof B&&this.map.set(e.tree,t)}get(e){return e instanceof E?this.getBuffer(e.context.buffer,e.index):e instanceof B?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class re{constructor(e,t,r,i,n=!1,s=!1){this.from=e,this.to=t,this.tree=r,this.offset=i,this.open=(n?1:0)|(s?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let i=[new re(0,e.length,e,0,!1,r)];for(let n of t)n.to>e.length&&i.push(n);return i}static applyChanges(e,t,r=128){if(!t.length)return e;let i=[],n=1,s=e.length?e[0]:null;for(let h=0,o=0,C=0;;h++){let d=h<t.length?t[h]:null,S=d?d.fromA:1e9;if(S-o>=r)for(;s&&s.from<S;){let w=s;if(o>=w.from||S<=w.to||C){let I=Math.max(w.from,o)-C,_=Math.min(w.to,S)-C;w=I>=_?null:new re(I,_,w.tree,w.offset+C,h>0,!!d)}if(w&&i.push(w),s.to>S)break;s=n<e.length?e[n++]:null}if(!d)break;o=d.toA,C=d.toA-d.toB}return i}}class Ae{startParse(e,t,r){return typeof e=="string"&&(e=new ke(e)),r=r?r.length?r.map(i=>new Z(i.from,i.to)):[new Z(0,0)]:[new Z(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let i=this.startParse(e,t,r);for(;;){let n=i.advance();if(n)return n}}}class ke{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new k({perNode:!0});export{Ce as D,N as I,k as N,Ae as P,O as T,Se as a,re as b,j as c,ae as d};
