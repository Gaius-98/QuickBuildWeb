import{_ as oe}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-CNYusMji.js";import{g as S,r as u,v as M,Y as ne,bk as K,bl as le,bm as se,o as p,y as A,t as re,x as ue,D as Q,h as k,w as n,a3 as g,l as t,i as F,bn as W,bo as pe,B as v,n as de,L as Z,O as H,M as X,a6 as ie,V as ce,F as E,C as me,H as ve,K as _e,T as fe,a7 as ye,a8 as ge,ak as xe,a$ as Ae,a_ as be,aC as we,R as De}from"./.pnpm-C57POoKK.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as Ce}from"./index-zRnbBddX.js";import{F as ke}from"./FlowExecutor-BcCzMxzI.js";import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-Cn_lhMlM.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-Deox015t.js";const Ve=S({__name:"EventFlow",props:{dndList:{default:()=>[{type:"circle",text:"开始",label:"开始节点",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAAnBJREFUOBGdVL1rU1EcPfdGBddmaZLiEhdx1MHZQXApraCzQ7GKLgoRBxMfcRELuihWKcXFRcEWF8HBf0DdDCKYRZpnl7p0svLe9Zzbd29eQhTbC8nv+9zf130AT63jvooOGS8Vf9Nt5zxba7sXQwODfkWpkbjTQfCGUd9gIp3uuPP8bZ946g56dYQvnBg+b1HB8VIQmMFrazKcKSvFW2dQTxJnJdQ77urmXWOMBCmXM2Rke4S7UAW+/8ywwFoewmBps2tu7mbTdp8VMOkIRAkKfrVawalJTtIliclFbaOBqa0M2xImHeVIfd/nKAfVq/LGnPss5Kh00VEdSzfwnBXPUpmykNss4lUI9C1ga+8PNrBD5YeqRY2Zz8PhjooIbfJXjowvQJBqkmEkVnktWhwu2SM7SMx7Cj0N9IC0oQXRo8xwAGzQms+xrB/nNSUWVveI48ayrFGyC2+E2C+aWrZHXvOuz+CiV6iycWe1Rd1Q6+QUG07nb5SbPrL4426d+9E1axKjY3AoRrlEeSQo2Eu0T6BWAAr6COhTcWjRaYfKG5csnvytvUr/WY4rrPMB53Uo7jZRjXaG6/CFfNMaXEu75nG47X+oepU7PKJvvzGDY1YLSKHJrK7vFUwXKkaxwhCW3u+sDFMVrIju54RYYbFKpALZAo7sB6wcKyyrd+aBMryMT2gPyD6GsQoRFkGHr14TthZni9ck0z+Pnmee460mHXbRAypKNy3nuMdrWgVKj8YVV8E7PSzp1BZ9SJnJAsXdryw/h5ctboUVi4AFiCd+lQaYMw5z3LGTBKjLQOeUF35k89f58Vv/tGh+l+PE/wG0rgfIUbZK5AAAAABJRU5ErkJggg=="},{type:"rect",label:"用户任务",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAEFVwZaAAAABGdBTUEAALGPC/xhBQAAAqlJREFUOBF9VM9rE0EUfrMJNUKLihGbpLGtaCOIR8VjQMGDePCgCCIiCNqzCAp2MyYUCXhUtF5E0D+g1t48qAd7CCLqQUQKEWkStcEfVGlLdp/fm3aW2QQdyLzf33zz5m2IsAZ9XhDpyaaIZkTS4ASzK41TFao88GuJ3hsr2pAbipHxuSYyKRugagICGANkfFnNh3HeE2N0b3nN2cgnpcictw5veJIzxmDamSlxxQZicq/mflxhbaH8BLRbuRwNtZp0JAhoplVRUdzmCe/vO27wFuuA3S5qXruGdboy5/PRGFsbFGKo/haRtQHIrM83bVeTrOgNhZReWaYGnE4aUQgTJNvijJFF4jQ8BxJE5xfKatZWmZcTQ+BVgh7s8SgPlCkcec4mGTmieTP4xd7PcpIEg1TX6gdeLW8rTVMVLVvb7ctXoH0Cydl2QOPJBG21STE5OsnbweVYzAnD3A7PVILuY0yiiyDwSm2g441r6rMSgp6iK42yqroI2QoXeJVeA+YeZSa47gZdXaZWQKTrG93rukk/l2Al6Kzh5AZEl7dDQy+JjgFahQjRopSxPbrbvK7GRe9ePWBo1wcU7sYrFZtavXALwGw/7Dnc50urrHJuTPSoO2IMV3gUQGNg87IbSOIY9BpiT9HV7FCZ94nPXb3MSnwHn/FFFE1vG6DTby+r31KAkUktB3Qf6ikUPWxW1BkXSPQeMHHiW0+HAd2GelJsZz1OJegCxqzl+CLVHa/IibuHeJ1HAKzhuDR+ymNaRFM+4jU6UWKXorRmbyqkq/D76FffevwdCp+jN3UAN/C9JRVTDuOxC/oh+EdMnqIOrlYteKSfadVRGLJFJPSB/ti/6K8f0CNymg/iH2gO/f0DwE0yjAFO6l8JaR5j0VPwPwfaYHqOqrCI319WzwhwzNW/aQAAAABJRU5ErkJggg==",className:"important-node"}]},data:{}},emits:["onClickEle"],setup(b,{expose:x,emit:V}){const m=V,i=u(),_=u(),a=b,{dndList:f,data:w}=M(a),D=l=>{m("onClickEle",l)};return ne(()=>{K.use(le),K.use(se),i.value=new K({container:_.value,grid:!0}),i.value.extension.dndPanel.setPatternItems(f.value),i.value.render(w.value),i.value.on("element:click",D)}),x({getRawData:()=>{var l;return(l=i.value)==null?void 0:l.getGraphRawData()},updateNodeData:l=>{var s,y;(y=(s=i.value)==null?void 0:s.getNodeModelById(l.id))==null||y.setProperties({extraData:l.properties.extraData})}}),(l,s)=>(p(),A("div",{class:"flow-container",ref_key:"container",ref:_},null,512))}}),Ue=N(Ve,[["__scopeId","data-v-37396ba8"]]),Ie={key:2,style:{display:"flex"}},Be=S({__name:"EditTable",props:re({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const x=ue(b,"modelValue");let V=b;const{columns:m,action:i}=M(V),_=Q(()=>D("input")),a=Q(()=>D("select")),f=Q(()=>i.value?[...m.value,{title:"操作",dataIndex:"_action_"}]:m.value),w=l=>{var s;return((s=m.value.find(y=>y.dataIndex==l))==null?void 0:s.options)||[]},D=l=>m.value.filter(s=>s.type==l).map(s=>s.dataIndex),C=()=>{let l={};m.value.map(s=>{Reflect.set(l,s.dataIndex,"")}),x.value.push(l)},R=l=>{x.value.splice(l,1)};return(l,s)=>{const y=Z,U=H,I=X,O=ie;return p(),k(O,{columns:f.value,"data-source":x.value,pagination:!1,rowKey:(d,r)=>r,size:"small",scroll:{y:l.height}},{bodyCell:n(({column:d,record:r,index:e})=>[_.value.includes(d.dataIndex)?(p(),k(y,{key:0,value:r[d.dataIndex],"onUpdate:value":c=>r[d.dataIndex]=c},null,8,["value","onUpdate:value"])):g("",!0),a.value.includes(d.dataIndex)?(p(),k(U,{key:1,value:r[d.dataIndex],"onUpdate:value":c=>r[d.dataIndex]=c,options:w(d.dataIndex)},null,8,["value","onUpdate:value","options"])):g("",!0),d.dataIndex=="_action_"?(p(),A("div",Ie,[t(F(W),{class:"icon",onClick:s[0]||(s[0]=c=>C())}),t(F(pe),{class:"icon",onClick:c=>R(e)},null,8,["onClick"])])):g("",!0)]),emptyText:n(()=>[t(I,{type:"text",onClick:C,icon:de(F(W))},{default:n(()=>[v(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),P=N(Be,[["__scopeId","data-v-5b9e8dbe"]]),Te={key:0,style:{color:"red"}},Re=S({__name:"FlowView",props:{data:{default:()=>({nodes:[],edges:[]})}},setup(b,{expose:x}){const V=b,{data:m}=M(V),i=u([{type:"circle",text:"开始",label:"开始节点",icon:"/src/assets/images/flow/开始.png",properties:{nodeType:"start-node",extraData:{}}},{type:"circle",text:"结束",label:"结束节点",icon:"/src/assets/images/flow/结束.png",properties:{nodeType:"end-node",extraData:{}}},{type:"rect",text:"处理函数",label:"处理函数",icon:"/src/assets/images/flow/js函数.png",properties:{nodeType:"func-node",extraData:{code:""}}},{type:"rect",text:"打开弹窗",label:"弹窗",icon:"/src/assets/images/flow/弹窗.png",properties:{nodeType:"modal-node",extraData:{size:"small",formId:""}}},{type:"rect",text:"跳转外部链接",label:"链接",icon:"/src/assets/images/flow/链接.png",properties:{nodeType:"link-node",extraData:{url:"",openType:"_blank"}}},{type:"diamond",text:"请求数据",label:"请求数据",icon:"/src/assets/images/flow/发起请求.png",properties:{nodeType:"request-node",extraData:{url:"",method:"",params:[],headers:[],body:[]}}}]),_=u(!1),a=u({}),f=u(),w=u([]),D=u([{value:"get",label:"GET"},{value:"post",label:"POST"}]),C=u([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),R=u([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"}]),l=u(""),s=r=>{_.value=!0,a.value=r.data};Ce.getFormDict().then(r=>{const{code:e,data:c,msg:h}=r;e==200&&(w.value=c)});const y=()=>{f.value.updateNodeData(a.value)},U=u(!1),I=u("");x({getData:()=>f.value.getRawData()});const d=async()=>{U.value=!1,I.value="";try{const r=f.value.getRawData(),e=new ke(r);await e.run(),l.value=JSON.stringify(e.getState(),null,4)}catch(r){U.value=!0,I.value=r}};return(r,e)=>{const c=me,h=Ue,Y=X,J=oe,B=fe,T=ye,L=ge,z=H,j=xe,q=Z,G=Ae,$=be,ee=we,ae=De,te=ve;return p(),A(E,null,[t(c,null,{default:n(()=>[v("配置区")]),_:1}),t(h,{ref_key:"eventFlowRef",ref:f,data:F(m),dndList:i.value,style:{height:"450px"},onOnClickEle:s},null,8,["data","dndList"]),t(Y,{onClick:e[0]||(e[0]=o=>d()),type:"primary",style:{"margin-top":"10px"}},{default:n(()=>[v("执行")]),_:1}),t(c,null,{default:n(()=>[v("运行结果")]),_:1}),U.value?(p(),A("div",Te,"错误日志: "+ce(I.value),1)):(p(),k(J,{key:1,value:l.value,"onUpdate:value":e[1]||(e[1]=o=>l.value=o),height:"200",readOnly:""},null,8,["value"])),t(te,{open:_.value,"onUpdate:open":e[12]||(e[12]=o=>_.value=o),title:"节点配置",placement:"right",onClose:e[13]||(e[13]=o=>y()),width:"400px"},{default:n(()=>[t(ae,{model:a.value.properties.extraData},{default:n(()=>[a.value.properties.nodeType=="func-node"?(p(),k(B,{key:0,label:"函数"},{default:n(()=>[t(J,{value:a.value.properties.extraData.code,"onUpdate:value":e[2]||(e[2]=o=>a.value.properties.extraData.code=o),prepend:"()=>{",append:"}",theme:"light"},null,8,["value"])]),_:1})):g("",!0),a.value.properties.nodeType=="modal-node"?(p(),A(E,{key:1},[t(B,{label:"弹窗大小"},{default:n(()=>[t(L,{value:a.value.properties.extraData.size,"onUpdate:value":e[3]||(e[3]=o=>a.value.properties.extraData.size=o),"button-style":"solid"},{default:n(()=>[t(T,{value:"small"},{default:n(()=>[v("小")]),_:1}),t(T,{value:"middle"},{default:n(()=>[v("中")]),_:1}),t(T,{value:"large"},{default:n(()=>[v("大")]),_:1})]),_:1},8,["value"])]),_:1}),t(B,{label:"表单"},{default:n(()=>[t(z,{value:a.value.properties.extraData.formId,"onUpdate:value":e[4]||(e[4]=o=>a.value.properties.extraData.formId=o),options:w.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})],64)):g("",!0),a.value.properties.nodeType=="link-node"?(p(),A(E,{key:2},[t(B,{label:"链接地址"},{default:n(()=>[t(j,{value:a.value.properties.extraData.url,"onUpdate:value":e[5]||(e[5]=o=>a.value.properties.extraData.url=o)},null,8,["value"])]),_:1}),t(B,{label:"打开方式"},{default:n(()=>[t(L,{value:a.value.properties.extraData.openType,"onUpdate:value":e[6]||(e[6]=o=>a.value.properties.extraData.openType=o),"button-style":"solid"},{default:n(()=>[t(T,{value:"_selef"},{default:n(()=>[v("当前页")]),_:1}),t(T,{value:"_blank"},{default:n(()=>[v("新窗口")]),_:1})]),_:1},8,["value"])]),_:1})],64)):g("",!0),a.value.properties.nodeType=="request-node"?(p(),A(E,{key:3},[t(q,{value:a.value.properties.extraData.url,"onUpdate:value":e[8]||(e[8]=o=>a.value.properties.extraData.url=o)},{addonBefore:n(()=>[t(z,{value:a.value.properties.extraData.method,"onUpdate:value":e[7]||(e[7]=o=>a.value.properties.extraData.method=o),options:D.value},null,8,["value","options"])]),_:1},8,["value"]),_e("div",null,[t($,null,{default:n(()=>[t(G,{key:"params",tab:"params"},{default:n(()=>[t(P,{columns:C.value,modelValue:a.value.properties.extraData.params,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.properties.extraData.params=o)},null,8,["columns","modelValue"])]),_:1}),t(G,{key:"headers",tab:"headers"},{default:n(()=>[t(P,{columns:R.value,modelValue:a.value.properties.extraData.headers,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.properties.extraData.headers=o)},null,8,["columns","modelValue"])]),_:1}),t(G,{key:"body",tab:"body"},{default:n(()=>[t(P,{columns:C.value,modelValue:a.value.properties.extraData.body,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.properties.extraData.body=o)},null,8,["columns","modelValue"])]),_:1})]),_:1})])],64)):g("",!0),["start-node","end-node"].includes(a.value.properties.nodeType)?(p(),k(ee,{key:4,description:"起止节点暂无配置项"})):g("",!0)]),_:1},8,["model"])]),_:1},8,["open"])],64)}}}),Me=N(Re,[["__scopeId","data-v-da6c2fae"]]);export{Me as default};
