import{ba as he,f as ye,r as m,aV as Ce,g as T,s as U,v as H,o as d,B as x,l,i as e,aG as we,E as h,F as O,w as s,aJ as xe,I as Ie,aO as Z,a9 as ee,L as te,H as L,W,bb as ke,aj as j,J as N,bc as Se,bd as De,a3 as M,h as R,ah as $e,t as Y,x as Ne,be as Re,aE as Fe,P as Te,b4 as K,b7 as Oe,O as Pe,bf as X,bg as Be,bh as Ae,a4 as Le,Y as Ve,a5 as Ue,a6 as ze,b9 as Ee,a$ as Me,ab as We,ac as He,a7 as je}from"./.pnpm-DpKfdl5h.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as A}from"./index-DCYTyw5R.js";import{S as oe}from"./SchemaForm-CErdwB6l.js";const qe=new he,V=qe,P=ye("tableDesign",()=>{const I=m([]),_=m({name:"",description:"",status:1,columns:[],global:{bordered:!1},datasource:{tableName:"",sourceId:""},filter:{show:!0,widgetList:[]},action:[]}),a=m([]),o=m({}),f=()=>{const C=new Date().getTime().toString().slice(-4);_.value.columns,_.value.columns.push({id:Ce(),dataIndex:"field"+C,title:"列"+C,width:200})},p=(C,u)=>{const i=u.findIndex(g=>g.id===C);i!=-1&&(o.value=u[i])},c=(C,u)=>{const i=u.findIndex(g=>g.id===C);i!=-1&&u.splice(i,1)},b=async C=>{},k=m(!1);return{tableCfg:_,currentColumn:o,onSelectColumn:p,onRemoveColumn:c,onAddColumn:f,tableData:I,onRefreshData:b,saveLoading:k,onSave:async()=>{k.value=!0,k.value=!1},columnFields:a,onSetColumns:C=>{a.value=C}}}),Ge={class:"custom-header-label",style:{flex:"1"}},Je=T({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(I,{emit:_}){const a=P(),{currentColumn:o}=U(a),f=I,{params:p}=H(f),c=()=>{V.onPublish("removeEvent",p.value)};return(b,k)=>{const y=ee;return d(),x("div",{class:Ie(["custom-header-item",e(o).dataIndex==e(p).column.getColId()?"active":""]),style:Z([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:e(o).dataIndex==e(p).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[l(e(we),{class:"move",style:{width:"20px",cursor:"move"}}),h("div",Ge,O(e(p).displayName),1),l(y,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:k[0]||(k[0]=F=>c())},{default:s(()=>[l(e(xe),{class:"remove",style:{width:"20px"}})]),_:1})],6)}}}),Qe={class:"custom-opt-cell"},Ye=["onClick"],Ke=T({__name:"CustomOptCell",setup(I){const _=P(),{tableCfg:a}=U(_),o=te(()=>{var c;return(c=a.value.action)==null?void 0:c.filter(b=>b.position=="row")}),f=(c,b)=>{V.onPublish("action",{position:c,data:b})},p=c=>{V.onPublish("remove-btn",c)};return(c,b)=>{const k=ee;return d(),x("div",Qe,[(d(!0),x(L,null,W(o.value,y=>(d(),x("div",{class:"btn",key:y.id},[h("a",{onClick:F=>f("row",y)},O(y.name),9,Ye),l(k,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:F=>p(y)},{default:s(()=>[l(e(ke),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),l(e(j),{style:{cursor:"pointer"},onClick:b[0]||(b[0]=y=>f("row"))})])}}}),Xe={class:"custom-header-label",style:{flex:"1"}},Ze=T({__name:"CustomAddColumn",setup(I){const _=P(),{onAddColumn:a}=_;return(o,f)=>{const p=De;return d(),x("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:f[0]||(f[0]=c=>e(a)())},[h("div",Xe,[l(e(j)),N(" 新增列 "),l(p,null,{title:s(()=>[N("用于新增列配置")]),default:s(()=>[l(e(Se))]),_:1})])])}}}),et={class:"cell"},tt={key:0},lt=["href"],ot=T({__name:"CustomCellRender",props:{params:{}},setup(I){const _=I,{params:a}=H(_);return(o,f)=>{const p=$e;return d(),x("div",et,[e(a).colDef.cellRendererParams.type=="text"?(d(),x("span",tt,O(e(a).value),1)):M("",!0),e(a).colDef.cellRendererParams.type=="image"?(d(),R(p,{key:1,src:e(a).value},null,8,["src"])):M("",!0),e(a).colDef.cellRendererParams.type=="link"?(d(),x("a",{key:2,href:e(a).value},O(e(a).value),9,lt)):M("",!0)])}}}),nt=T({__name:"AgTable",props:Y({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:Y(["onRemove","onClick"],["update:columns"]),setup(I,{emit:_}){V.onSubscribe("removeEvent",u=>{let i=u.column.getColId(),g=a.value.find(D=>D.dataIndex==i);g&&F(g)});const a=Ne(I,"columns"),o=I,{columnId:f,tableData:p}=H(o),c=te(()=>{let u=a.value.map(i=>({field:i.dataIndex,colId:i.dataIndex,headerName:i.title,pinned:i.fixed=="none"?void 0:i.fixed,lockVisible:!0,headerComponent:Je,cellRenderer:ot,cellRendererParams:{type:i.type}}));return u.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:Ze}),u.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:Ke}),u}),b=u=>{if(!u.finished)return;let i=u.api.getColumnState().map(g=>a.value.find(D=>D.dataIndex==g.colId));a.value=i},k=u=>{if(!u.finished)return;let i=u.column.getColId(),g=a.value.findIndex(D=>D.dataIndex==i);g!=-1&&(a.value[g].width=u.column.getActualWidth())},y=_,F=u=>{y("onRemove",u)},C=u=>{let i=u.column.getId(),g=a.value.find(D=>D.dataIndex==i);y("onClick",g)};return(u,i)=>(d(),R(e(Re),{rowData:e(p),columnDefs:c.value,style:Z({height:u.height+"px"}),class:"ag-theme-quartz",onColumnMoved:b,onColumnResized:k,onColumnHeaderClicked:C},null,8,["rowData","columnDefs","style"]))}}),at=le(nt,[["__scopeId","data-v-8ecc2aa5"]]),st=T({__name:"TableCfg",setup(I){const _=P(),{tableCfg:a,columnFields:o,currentColumn:f}=U(_),p=m({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(b=>{setTimeout(()=>{b(o.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),c=m();return Fe(()=>f.value,()=>{c.value.refreshOption("dataIndex")}),(b,k)=>(d(),R(e(oe),{formData:e(f),schema:p.value,ref_key:"schemaRef",ref:c,size:"small"},null,8,["formData","schema"]))}}),ut={class:"table-design"},it={class:"table-design-container"},dt={class:"main-part"},ct={class:"filter-part"},rt={class:"filter-container"},mt=["onClick"],pt={class:"add widget-item"},vt={class:"tools-part"},_t={class:"tools-container"},ft=["onClick"],bt={class:"add button-item"},gt={class:"table-part"},ht={class:"right-part"},yt=T({__name:"TableDesign",setup(I){const _=m([]);Te(()=>{A.getDataSourceDict().then(r=>{const{code:t,data:w,msg:$}=r;t==200&&(_.value=w)})});const a=P(),{tableCfg:o,columnFields:f}=U(a),{onSelectColumn:p,onRemoveColumn:c,onAddColumn:b,onRefreshData:k,onSetColumns:y}=a;window.name="table-design",m([{label:"测试1",prop:"test1",type:"input"},{label:"测试2",prop:"test2",type:"select"},{label:"测试3",prop:"test3",type:"input"},{label:"测试4",prop:"test4",type:"select"},{label:"测试5",prop:"tes5",type:"input"},{label:"测试6",prop:"test6",type:"select"}]),m([{name:"新增",id:"add",position:"header",eventFlowId:""},{name:"批量编辑",id:"edit",position:"header",eventFlowId:""}]);const F=()=>{var r;(r=o.value.filter.widgetList)==null||r.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"}),o.value},C=()=>{},u=()=>{window.open("/lowcode/table","quick-build")},i=r=>{p(r.id,o.value.columns)},g=r=>{c(r.id,o.value.columns)};m([]);const D=m([]),ne=()=>{A.getSourceData(o.value.datasource.sourceId,o.value.datasource.tableName).then(r=>{const{code:t,data:w,msg:$}=r;t==200&&(D.value=w)})},q=m([]),ae=()=>{A.getTableInfo(o.value.datasource.sourceId).then(r=>{const{code:t,data:w,msg:$}=r;t==200&&(q.value=w)})},se=()=>{A.getColumnInfo(o.value.datasource.sourceId,o.value.datasource.tableName).then(r=>{const{code:t,data:w,msg:$}=r;t==200&&(o.value.columns=w.map(v=>({dataIndex:v.columnName,title:v.columnComment||v.columnName,id:v.columnName,width:200,type:"text",align:"left",fixed:"none"})),y(w.map(v=>({label:v.columnComment?`${v.columnComment}(${v.columnName})`:v.columnName,value:v.columnName}))))}),ne()},ue=()=>{o.value.action.push({id:new Date().getTime().toString(),name:"测试",position:"header",eventFlowId:""})},S=m({id:"",name:"",eventFlowId:"",position:"header"}),z=m(!1),ie=m([{label:"默认新增事件流",value:"add"},{label:"默认编辑事件流",value:"edit"},{label:"默认批量编辑事件流",value:"batchEdit"}]),de=r=>{S.value=r,z.value=!0},ce=()=>{},G=m({}),E=m(!1),re=m({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"string",label:"字段名称"},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",show:'"${formData.type}" == "select"'},defaultValue:{type:"string",label:"默认值"}}}),me=r=>{G.value=r,E.value=!0};return(r,t)=>{const w=Le,$=Ve,v=Ue,B=ze,pe=Ee,ve=Oe,_e=Me,J=We,fe=He,be=je,Q=Pe;return d(),x(L,null,[h("div",ut,[l(ve,{onBack:u,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:s(()=>[l(w,{value:e(o).name,"onUpdate:value":t[0]||(t[0]=n=>e(o).name=n),bordered:!1,class:"table-name"},null,8,["value"])]),extra:s(()=>[l(pe,{class:"extra"},{default:s(()=>[l(v,{label:"选择数据源"},{default:s(()=>[l($,{value:e(o).datasource.sourceId,"onUpdate:value":t[1]||(t[1]=n=>e(o).datasource.sourceId=n),options:_.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:t[2]||(t[2]=n=>ae())},null,8,["value","options"])]),_:1}),l(v,{label:"选择表名"},{default:s(()=>[l($,{value:e(o).datasource.tableName,"onUpdate:value":t[3]||(t[3]=n=>e(o).datasource.tableName=n),options:q.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:t[4]||(t[4]=n=>se())},null,8,["value","options"])]),_:1}),l(B,{onClick:t[5]||(t[5]=n=>C()),type:"primary",class:"save-btn"},{default:s(()=>[N(" 保存 ")]),_:1})]),_:1})]),_:1}),h("div",it,[h("div",dt,[h("div",ct,[h("div",rt,[l(e(K),{list:e(o).filter.widgetList,"onUpdate:list":t[7]||(t[7]=n=>e(o).filter.widgetList=n),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:s(()=>[(d(!0),x(L,null,W(e(o).filter.widgetList,n=>(d(),x("div",{class:"widget-item",key:n.id,onClick:ge=>me(n)},[l(e(X),{class:"move-handle",style:{cursor:"pointer"}}),l(v,{label:n.label,name:n.field},{default:s(()=>[n.type=="input"?(d(),R(w,{key:0})):n.type=="select"?(d(),R($,{key:1})):(d(),R(_e,{key:2}))]),_:2},1032,["label","name"])],8,mt))),128)),h("div",pt,[l(B,{type:"primary",onClick:t[6]||(t[6]=n=>F())},{default:s(()=>[N(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),h("div",vt,[h("div",_t,[l(e(K),{list:e(o).action,"onUpdate:list":t[9]||(t[9]=n=>e(o).action=n),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:s(()=>[(d(!0),x(L,null,W(e(o).action,n=>(d(),x("div",{class:"button-item",key:n.id,onClick:ge=>de(n)},[l(e(X),{class:"move-handle",style:{cursor:"pointer"}}),l(B,null,{default:s(()=>[N(O(n.name),1)]),_:2},1024)],8,ft))),128)),h("div",bt,[l(B,{type:"primary",onClick:t[8]||(t[8]=n=>ue())},{default:s(()=>[N(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),h("div",gt,[l(at,{columns:e(o).columns,"onUpdate:columns":t[10]||(t[10]=n=>e(o).columns=n),tableData:D.value,height:300,onOnRemove:g,onOnClick:i},null,8,["columns","tableData"])])]),h("div",ht,[l(st)])])]),l(Q,{title:"按钮配置",placement:"right",closable:!1,open:z.value,onClose:t[16]||(t[16]=n=>z.value=!1)},{default:s(()=>[l(be,{model:S.value},{default:s(()=>[l(v,{prop:"id",label:"按钮标识"},{default:s(()=>[l(w,{value:S.value.id,"onUpdate:value":t[11]||(t[11]=n=>S.value.id=n)},null,8,["value"])]),_:1}),l(v,{prop:"name",label:"按钮名称"},{default:s(()=>[l(w,{value:S.value.name,"onUpdate:value":t[12]||(t[12]=n=>S.value.name=n)},null,8,["value"])]),_:1}),l(v,{prop:"name",label:"按钮位置"},{default:s(()=>[l(fe,{value:S.value.position,"onUpdate:value":t[13]||(t[13]=n=>S.value.position=n),"button-style":"solid"},{default:s(()=>[l(J,{value:"header"},{default:s(()=>[N("表头")]),_:1}),l(J,{value:"row"},{default:s(()=>[N("行内")]),_:1})]),_:1},8,["value"])]),_:1}),l(v,{prop:"event",label:"事件流"},{default:s(()=>[l($,{value:S.value.eventFlowId,"onUpdate:value":t[15]||(t[15]=n=>S.value.eventFlowId=n),options:ie.value},{suffixIcon:s(()=>[l(e(Be),{style:{color:"#000"},title:"刷新"}),S.value.eventFlowId?(d(),R(e(Ae),{key:0,onClick:t[14]||(t[14]=n=>ce()),style:{color:"#000"},title:"编辑事件流"})):(d(),R(e(j),{key:1,style:{color:"#000"},title:"新增事件流"}))]),_:1},8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),l(Q,{title:"筛选控件配置",placement:"right",closable:!1,open:E.value,onClose:t[17]||(t[17]=n=>E.value=!1)},{default:s(()=>[l(e(oe),{formData:G.value,schema:re.value},null,8,["formData","schema"])]),_:1},8,["open"])],64)}}}),kt=le(yt,[["__scopeId","data-v-7a1e6ce8"]]);export{kt as default};
