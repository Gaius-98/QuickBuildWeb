import{d as N}from"./api-fCK5SsNL.js";import{T as ee}from"./nodemodule-vue-codemirror@6.1.1_codemirror@6.0.1_vue@3.4.21-DfBiUTlZ.js";import{v as Te}from"./nodemodule-@uiw_codemirror-theme-vscode@4.23.6_@codemirror_language@6.11.0_@codemirror_state@6.5.2_@codemirror_view@6.36.8-DmLrXduT.js";import{a as b}from"./api-B9-nR9rk.js";import{s as qe}from"./nodemodule-@codemirror_lang-sql@6.8.0-Dqi55pq6.js";import{f as De}from"./nodemodule-sql-formatter@15.4.6-BQk6nOTi.js";import"./nodemodule-gaius-utils@1.1.8_@types_node@20.11.28_typescript@5.4.2_vite@5.1.6-LqpbgJb2.js";/* empty css                   */import{W as ze,e as $e,_ as Oe,p as Ue,q as Ve,B as Le,U as Be,M as Me,Y as Pe,I as Ke,V as je,i as Ae,G as Re,T as Fe,j as Ge,D as Ee,v as He,a as te}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-D4V-KPiA.js";import{a6 as We,a7 as Ye,a8 as Je,V as Qe,g as Xe,P as Ze}from"./nodemodule-@ant-design_icons-vue@7.0.1_vue@3.4.21-CO80cFpd.js";import{v as et}from"./nodemodule-uuid@9.0.1-CtRu48qb.js";import{d as tt,q as at,b as ot,K as ae,c as a,M as c,aI as l,h as S,G as d,y as lt,z as nt,a2 as m,N as h,F as st,ar as it,aq as ut,L as r}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";import{r as i,x as dt,u as v}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";import{O as P}from"./nodemodule-@vue_shared@3.4.21-Ctf17_ps.js";import{_ as pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./iconfont-D1HCqb49.js";import"./nodemodule-axios@1.6.8-BZ84_VUH.js";import"./nodemodule-js-cookie@3.0.5-Cz0CWeBA.js";import"./nodemodule-vue-router@4.3.0_vue@3.4.21-BC_007Jj.js";import"./nodemodule-codemirror@6.0.1-hsW7U_mZ.js";import"./nodemodule-@codemirror_view@6.36.8-B6Z_C-qt.js";import"./nodemodule-@codemirror_state@6.5.2-CeTbMir1.js";import"./nodemodule-@marijn_find-cluster-break@1.0.2-DXwl3gUT.js";import"./nodemodule-style-mod@4.1.2-Bc2inJdb.js";import"./nodemodule-w3c-keyname@2.2.8-Vcq4gwWv.js";import"./nodemodule-@codemirror_language@6.11.0-B1CABpZA.js";import"./nodemodule-@lezer_common@1.2.3-DJDOv6L0.js";import"./nodemodule-@lezer_highlight@1.2.1-GwqidMBt.js";import"./nodemodule-@codemirror_commands@6.8.1-DuK1gsD8.js";import"./nodemodule-@codemirror_search@6.5.10-EmaDmQ3b.js";import"./nodemodule-crelt@1.0.6-C8TCjufn.js";import"./nodemodule-@codemirror_autocomplete@6.18.6-BkBYzrUm.js";import"./nodemodule-@codemirror_lint@6.8.5-DUOWSouu.js";import"./nodemodule-@babel_runtime@7.27.1-Bq4_u9L9.js";import"./nodemodule-@uiw_codemirror-themes@4.23.6_@codemirror_language@6.11.0_@codemirror_state@6.5.2_@codemirror_view@6.36.8-CCcrmnXF.js";import"./nodemodule-@lezer_lr@1.4.2-CXohaufN.js";import"./nodemodule-nearley@2.20.1-B3lrALPd.js";import"./nodemodule-classnames@2.5.1-BK5ccKcQ.js";import"./nodemodule-@vue_runtime-dom@3.4.21-CDjXREoQ.js";import"./nodemodule-lodash-es@4.17.21-DcfALcKD.js";import"./nodemodule-resize-observer-polyfill@1.5.1-B1PUzC5B.js";import"./nodemodule-dayjs@1.11.13-B6I98uus.js";import"./nodemodule-@ctrl_tinycolor@3.6.1-DOFZgDuz.js";import"./nodemodule-@ant-design_colors@6.0.0-CBJ--Aym.js";import"./nodemodule-throttle-debounce@5.0.2-CUWDS_la.js";import"./nodemodule-async-validator@4.2.5-9PlIezaS.js";import"./nodemodule-scroll-into-view-if-needed@2.2.31-CLVC0ehY.js";import"./nodemodule-compute-scroll-into-view@1.0.20-1gs_hJI2.js";import"./nodemodule-vue-types@3.0.2_vue@3.4.21-CF28atMM.js";import"./nodemodule-dom-align@1.12.4-CRCehRfe.js";import"./nodemodule-@emotion_hash@0.9.2-WldOFDRm.js";import"./nodemodule-@emotion_unitless@0.8.1-sScrWPmR.js";import"./nodemodule-stylis@4.3.6-D5iaQeiq.js";import"./nodemodule-@ant-design_icons-svg@4.4.2-C9VH68wD.js";const rt=y=>(it("data-v-b8b69966"),y=y(),ut(),y),ct={class:"dataset-design"},mt={class:"container"},vt={class:"left-part"},_t={class:"search-tree"},ft=["title"],yt={style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},gt=rt(()=>c("span",{class:"iconfont icon-table"},null,-1)),xt={style:{width:"36px"}},bt={class:"right-part"},ht={class:"tools-area"},kt={class:"sql-area"},Ct={class:"result"},It={style:{color:"red"}},wt=tt({__name:"index",props:{type:{default:"add"},id:{},datasourceId:{},tableName:{}},setup(y){const K=i([]),j=i({}),T=i([]),oe=()=>{n.value.execSql=De(n.value.execSql,{language:"mysql"})},n=i({datasetName:"",datasourceId:"",execSql:"",status:"1",paramsConfig:[]}),le=y,q=i(!1),{type:D,id:A,datasourceId:R,tableName:F}=dt(le),z=()=>{N.getTableInfo(n.value.datasourceId).then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(K.value=s)}),N.getSchema(n.value.datasourceId).then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(j.value=s,T.value=[qe({schema:j.value}),Te])})};n.value.datasetName=n.value.datasetName||"未命名",R.value&&(n.value.datasourceId=R.value,z(),F.value&&(n.value.execSql=`select * from ${F.value}`)),D.value==="edit"&&A.value&&b.getDetail(A.value).then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(n.value=s,z())});const ne=at(()=>K.value.filter(o=>o.tableName.includes($.value))),G=i([]),se=()=>{let o;D.value=="add"?o=b.add:D.value=="edit"&&(o=b.update),o(n.value).then(e=>{const{code:s,data:u,msg:f}=e;s==200&&te.success("保存成功")})},$=i("");ot(()=>{N.getList("").then(o=>{const{code:e,data:s}=o;e==200&&(G.value=s)})});const O=i(!1),E=i([]),U=i(!1),ie=i([{title:"字段名称",key:"columnName",dataIndex:"columnName",width:"200px"},{title:"字段类型",key:"columnType",dataIndex:"columnType",width:"200px"},{title:"字段注释",key:"columnComment",dataIndex:"columnComment",width:"200px"}]),H=i(""),ue=o=>{U.value=!0,H.value=o,N.getColumnInfo(n.value.datasourceId,o).then(e=>{const{code:s,data:u}=e;U.value=!1,s==200&&(E.value=u)}),O.value=!0},de=()=>{window.open("/data/dataset","quick-build")},pe=()=>{te.success("复制成功")},k=i([]),W=i([]),re=()=>{L.value="result",b.run(n.value).then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(k.value=s,W.value=Object.keys(s[0]).map(f=>({title:f,key:f,dataIndex:f,ellipsis:!0,width:200})))})},ce=o=>{const{current:e,pageSize:s}=o;_.value.pageNumber=e,_.value.pageSize=s,Q()},me=o=>{o==="history"&&Q()},_=i({keyword:n.value.datasourceId,pageSize:10,pageNumber:1}),Y=i([]),J=i(0),ve=i([{title:"执行sql",key:"execSql",dataIndex:"execSql",ellipsis:!0},{title:"耗时",key:"executionTime",dataIndex:"executionTime"},{title:"执行结果",key:"status",dataIndex:"status"},{title:"操作",key:"action",dataIndex:"action",wdith:"100px"}]);i({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"100px"}}},properties:{execSql:{type:"string",label:"执行语句",component:{name:"code-editor"}},status:{type:"select",label:"执行结果",component:{dataSource:[{label:"成功",value:"1"},{label:"失败",value:"0"}]}},errMsg:{type:"textarea",label:"错误日志"}}});const Q=()=>{_.value.keyword=n.value.datasourceId,b.getLogList(_.value).then(o=>{const{code:e,data:s,msg:u}=o;e==200&&(Y.value=s.data,J.value=s.total)})},V=i(!1),g=i({}),_e=o=>{V.value=!0,g.value=o},L=i("result"),fe=()=>{q.value=!0},ye=i([{title:"参数名",key:"paramsName",dataIndex:"paramsName"},{title:"参数类型",key:"paramsType",dataIndex:"paramsType"},{title:"参数默认值",key:"paramsDefaultValue",dataIndex:"paramsDefaultValue"},{title:"操作",key:"action",dataIndex:"action"}]),ge=()=>{let o=et();n.value.paramsConfig.push({id:o,paramsDefaultValue:"",paramsType:"string",paramsName:""})},xe=o=>{let e=n.value.paramsConfig.findIndex(s=>s.id==o.id);n.value.paramsConfig.splice(e,1)};return(o,e)=>{const s=Ke,u=Le,f=Pe,be=ze,X=$e,B=Oe,he=Ue,ke=Ve,C=Ae,Ce=Re,Z=je,I=Fe,Ie=Be,M=Me,we=Ge,w=He,Ne=Ee,Se=nt("copy");return r(),ae("div",ct,[a(be,{style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"},onBack:e[2]||(e[2]=t=>de())},{title:l(()=>[a(s,{value:n.value.datasetName,"onUpdate:value":e[0]||(e[0]=t=>n.value.datasetName=t),bordered:!1,class:"dataset-name"},null,8,["value"])]),extra:l(()=>[a(f,null,{default:l(()=>[a(u,{onClick:e[1]||(e[1]=t=>se()),type:"primary",class:"save-btn"},{default:l(()=>[d(" 保存 ")]),_:1})]),_:1})]),_:1}),c("div",mt,[c("div",vt,[c("div",_t,[a(X,{value:n.value.datasourceId,"onUpdate:value":e[3]||(e[3]=t=>n.value.datasourceId=t),options:G.value,fieldNames:{label:"datasourceName",value:"id"},style:{width:"100%"},onChange:e[4]||(e[4]=t=>z())},null,8,["value","options"]),a(B,{style:{margin:"8px 0"}}),a(he,{value:$.value,"onUpdate:value":e[5]||(e[5]=t=>$.value=t),style:{"margin-bottom":"8px"},placeholder:"请输入表名称",allowClear:""},null,8,["value"]),a(ke,{"tree-data":ne.value,selectable:"",fieldNames:{title:"tableName",key:"tableName",children:"children"},height:"740"},{title:l(t=>[c("div",{style:{width:"200px",display:"flex","justify-content":"space-between"},title:t.tableName},[c("span",yt,[gt,d(" "+P(t.tableName),1)]),c("span",xt,[lt(a(v(Qe),{title:"复制表名",style:{cursor:"pointer","margin-right":"5px"},onClick:e[6]||(e[6]=p=>pe())},null,512),[[Se,t.tableName]]),a(v(Xe),{title:"查看字段信息",style:{cursor:"pointer"},onClick:p=>ue(t.tableName)},null,8,["onClick"])])],8,ft)]),_:1},8,["tree-data"])])]),c("div",bt,[c("div",ht,[a(u,{onClick:e[7]||(e[7]=t=>re()),type:"text",icon:S(v(We))},{default:l(()=>[d("运行")]),_:1},8,["icon"]),a(B,{type:"vertical"}),a(u,{onClick:e[8]||(e[8]=t=>oe()),type:"text",icon:S(v(Ye))},{default:l(()=>[d("美化")]),_:1},8,["icon"]),a(B,{type:"vertical"}),a(u,{onClick:e[9]||(e[9]=t=>fe()),type:"text",icon:S(v(Je))},{default:l(()=>[d("参数")]),_:1},8,["icon"])]),c("div",kt,[a(v(ee),{style:{height:"350px"},"indent-with-tab":!0,"tab-size":2,extensions:T.value,modelValue:n.value.execSql,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.execSql=t)},null,8,["extensions","modelValue"])]),c("div",Ct,[a(Ie,{activeKey:L.value,"onUpdate:activeKey":e[11]||(e[11]=t=>L.value=t),onChange:me},{default:l(()=>[a(Z,{key:"result",tab:"执行结果"},{default:l(()=>[k.value&&k.value.length>0?(r(),m(C,{key:0,style:{width:"100%"},size:"small",scroll:{x:"max-content",y:"280px"},"data-source":k.value,columns:W.value},null,8,["data-source","columns"])):(r(),m(Ce,{key:1}))]),_:1}),a(Z,{key:"history",tab:"历史记录"},{default:l(()=>[a(C,{scroll:{y:"280px"},size:"small","data-source":Y.value,columns:ve.value,onChange:ce,pagination:{current:_.value.pageNumber,total:J.value,showSizeChanger:!1,pageSize:_.value.pageSize}},{bodyCell:l(({column:t,record:p})=>[t.key=="status"?(r(),ae(st,{key:0},[p.status=="1"?(r(),m(I,{key:0,color:"#87d068"},{default:l(()=>[d("成功")]),_:1})):(r(),m(I,{key:1,color:"#f50"},{default:l(()=>[d("失败")]),_:1}))],64)):h("",!0),t.key=="action"?(r(),m(u,{key:1,type:"link",onClick:x=>_e(p)},{default:l(()=>[d("查看")]),_:2},1032,["onClick"])):h("",!0)]),_:1},8,["data-source","columns","pagination"])]),_:1})]),_:1},8,["activeKey"])])])]),a(M,{width:"600px",title:`${H.value}字段明细`,footer:null,open:O.value,"onUpdate:open":e[12]||(e[12]=t=>O.value=t)},{default:l(()=>[a(C,{size:"small",class:"ant-table-striped","data-source":E.value,columns:ie.value,loading:U.value,"row-class-name":(t,p)=>p%2===1?"table-striped":null,pagination:!1,scroll:{x:"auto",y:"500px"}},null,8,["data-source","columns","loading","row-class-name"])]),_:1},8,["title","open"]),a(M,{title:"参数配置",open:q.value,"onUpdate:open":e[14]||(e[14]=t=>q.value=t),width:"800px",height:"400px",footer:null},{default:l(()=>[a(u,{type:"primary",style:{"margin-bottom":"5px"},onClick:e[13]||(e[13]=t=>ge()),icon:S(v(Ze))},{default:l(()=>[d("新增")]),_:1},8,["icon"]),a(C,{columns:ye.value,"data-source":n.value.paramsConfig,scroll:{y:"300px"},pagination:!1},{bodyCell:l(({column:t,record:p})=>[["paramsName","paramsDefaultValue"].includes(t.key)?(r(),m(s,{key:0,value:p[t.dataIndex],"onUpdate:value":x=>p[t.dataIndex]=x},null,8,["value","onUpdate:value"])):h("",!0),t.key=="paramsType"?(r(),m(X,{key:1,style:{width:"100%"},value:p[t.dataIndex],"onUpdate:value":x=>p[t.dataIndex]=x,options:[{label:"字符串",value:"string"}]},null,8,["value","onUpdate:value"])):h("",!0),t.key=="action"?(r(),m(we,{key:2,title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:x=>xe(p)},{default:l(()=>[a(u,{type:"link",danger:""},{default:l(()=>[d("删除")]),_:1})]),_:2},1032,["onConfirm"])):h("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open"]),a(M,{title:"日志明细",open:V.value,"onUpdate:open":e[15]||(e[15]=t=>V.value=t),width:"900px",footer:null},{default:l(()=>[a(Ne,{size:"small",column:2,style:{width:"800px"}},{default:l(()=>[a(w,{label:"执行结果",span:1},{default:l(()=>[g.value.status=="1"?(r(),m(I,{key:0,color:"#87d068"},{default:l(()=>[d("成功")]),_:1})):(r(),m(I,{key:1,color:"#f50"},{default:l(()=>[d("失败")]),_:1}))]),_:1}),a(w,{label:"执行耗时",span:1},{default:l(()=>[d(P(g.value.executionTime),1)]),_:1}),a(w,{label:"执行语句",span:2},{default:l(()=>[a(v(ee),{style:{height:"200px",width:"100%"},"indent-with-tab":!0,"tab-size":2,extensions:T.value,"model-value":g.value.execSql,disabled:!0},null,8,["extensions","model-value"])]),_:1}),a(w,{label:"错误日志",span:2},{default:l(()=>[c("span",It,P(g.value.errMsg),1)]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Na=pt(wt,[["__scopeId","data-v-b8b69966"]]);export{Na as default};
