import{g as c,s as g}from"./main-Ch5DcOKu.js";import{d as $}from"./nodemodule-gaius-utils@1.1.8_@types_node@20.11.28_typescript@5.4.2_vite@5.1.6-LqpbgJb2.js";/* empty css                   */import{F as L,h as N,I as P,_ as V,Q as q,k as K,o as R,m as Q,K as T,n as U,e as A,u as B}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-D4V-KPiA.js";import{h,i as G,q as H,a8 as J}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";import{c as M}from"./nodemodule-lodash-es@4.17.21-DcfALcKD.js";import{x as F,r as E}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";const W=s=>{const e=/\$\{([^}]+)\}/g,o=s.match(e);return o?o.map(a=>{const r=a.trim().replace(/formData./g,"");return r.substring(2,r.length-1)}):[]},X=(s,e)=>{const o=/\$\{([^}]+)\}/g;return s.replace(o,(r,u)=>{const n=u.trim();return c({formData:e},n)})},O=(s,e)=>{const o=X(s,e);return new Function(`return ${o}`)()},Y=(s,e,o,a,r)=>{let u;switch(o){case"string":u=h(P,{size:a.size,...r,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break;case"textarea":u=h(B,{size:a.size,...r,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break;case"select":u=h(A,{size:a.size,...r,options:a.options[e]||[],value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"number":u=h(U,{size:a.size,...r,value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"date":u=h(T,{size:a.size,...r,value:c(s,e),onChange:n=>{g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"tree":u=h(Q,{size:a.size,...r,options:a.options[e]||[],value:c(s,e),onChange:n=>{g(s,e,n),a.onChange({formData:s,field:e,value:n})}});break;case"radio":u=h(K,{size:a.size,...r,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}},{default:()=>(a.options[e]||[]).map(n=>h(R,{value:n.value,key:n.value},{default:()=>n.label}))});break;case"switch":u=h(q,{size:a.size,checked:c(s,e),onChange(n){g(s,e,n),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n})}});break;case"divider":u=h(V,{...r},{default:()=>r==null?void 0:r.title});break;default:u=h(P,{size:a.size,...r,value:c(s,e),onChange:n=>{g(s,e,n.target.value),a.pubSub.onPublish(e),a.onChange({formData:s,field:e,value:n.target.value})}});break}return u},Z=(s,e,o,a)=>{const{type:r,label:u,component:n,rules:v,tooltip:m,formLayout:C=!0}=o;let d;if(n!=null&&n.name){const{name:b}=n,S=M(n);if(Reflect.deleteProperty(S,"onChange"),!a.sfProvideEL[b])throw new Error(`${b} is not registered,provide('sfProvideEL','${b}',Component)`);d=h(a.sfProvideEL[b],{size:a.size,...S,formData:s,value:c(s,e),onChange:f=>{if(s[e]=f,g(s,e,f),n.onChange)try{n.onChange(f,s,e)}catch(w){throw new Error(w)}}})}else d=Y(s,e,r,a,n);return C?a.visibleInfo[e]&&h(N,{label:u,name:e,rules:v,tooltip:m},{default:()=>[d]}):d},ne={name:"SchemaForm",props:{schema:{type:Object},formData:{type:Object,required:!0},size:{type:String,default:"middle"}},setup(s){const{schema:e,formData:o,size:a}=F(s),{layout:r,properties:u}=F(e.value),n=G("sfProvideEL"),v=E({}),m=Object.entries(u.value).filter(([,i])=>{var l,t;return((l=i==null?void 0:i.component)==null?void 0:l.dataSource)||((t=i==null?void 0:i.component)==null?void 0:t.asyncData)}),C=async(i,l)=>{const{dataSource:t,asyncData:p}=l.component;t?v.value[i]=t:v.value[i]=await p(o.value,i)};m.map(async([i,l])=>{await C(i,l)});const d=i=>{const[l,t]=Object.entries(u.value).find(([p])=>i==p);t&&C(l,t)},b=new $,S=i=>{var p,z;const{field:l}=i,t=(z=(p=u.value[l])==null?void 0:p.component)==null?void 0:z.onChange;t&&t(i)},f=J(),w=()=>{Object.entries(u.value).map(([i,l])=>{if(typeof l.show>"u")_.value[i]=!0;else if(typeof l.show=="boolean")_.value[i]=l.show;else if(typeof l.show=="string"){const t=l.show;_.value[i]=O(t,o.value),W(t).map(z=>{b.onSubscribe(z,()=>{_.value[i]=O(t,o.value)})})}})},_=E({});w();const j=H(()=>{const i={"--schema-gap":"","--schema-height":""};switch(a.value){case"middle":i["--schema-gap"]="24px",i["--schema-height"]="32px";break;case"large":i["--schema-gap"]="36px",i["--schema-height"]="40px";break;case"small":i["--schema-gap"]="4px",i["--schema-height"]="25px";break}return i});return{layout:r,properties:u,refreshOption:d,formData:o,options:v,visibleInfo:_,pubSub:b,sfProvideEL:n,onChange:S,expose:f,size:a,formSize:j}},render:s=>h(L,{...s.layout,style:{...s.formSize},class:["schema-form"]},{default:()=>[...Object.entries(s.properties).map(([e,o])=>Z(s.formData,e,o,s))]})};export{ne as S};
