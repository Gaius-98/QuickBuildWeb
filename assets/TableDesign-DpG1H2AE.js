import{b6 as ct,f as pt,r as c,aT as mt,g as O,s as he,E as z,o as m,y as R,l as e,i as l,aD as vt,F as r,I as W,w as a,aG as ft,A as Ne,G as Ve,H as $e,a8 as De,O as j,M as Q,T as ye,b7 as xe,ai as Pe,L as p,b8 as _t,b9 as Oe,a3 as N,h as U,ag as bt,J as Ce,K as Me,ba as gt,x as we,bb as de,bc as yt,bd as xt,be as Ct,bf as Ee,bg as wt,n as ht,a4 as Ie,W as ke,R as Ae,a9 as Dt,N as It,a5 as Ge,aa as Ke,ab as Qe,ap as kt,b2 as At,b1 as St,aH as Rt,a6 as ze,Q as Le,ay as Tt,a2 as Bt,b0 as Fe,b3 as Et,a0 as Ft,b4 as Ut,a1 as Nt,bh as Ue,bi as Vt,e as $t,b5 as Pt,aK as Ot,aX as Mt,an as Gt,ao as Kt}from"./.pnpm-BfHkGPSW.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as K}from"./main-CedeBi-P.js";import{S as _e}from"./SchemaForm-CsBlOpJr.js";import{F as Qt,a as be}from"./FlowExecutor-DsuFloce.js";import{_ as zt}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-Bg36fRXy.js";import{u as Lt}from"./useReminder-DItrKSBV.js";import"./iconfont-RswF9Ywb.js";/* empty css                   */import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-ChRKcTMB.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-DLNNU6tb.js";const Wt=new ct,re=Wt,ie=pt("tableDesign",()=>{const w=c([]),b=c({name:"",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),v=c([]),h=c({});return{tableCfg:b,setTableCfg:o=>{b.value=o},currentColumn:h,onSelectColumn:(o,f)=>{const x=f.findIndex(V=>V.id===o);x!=-1&&(h.value=f[x])},onRemoveColumn:(o,f)=>{const x=f.findIndex(V=>V.id===o);x!=-1&&f.splice(x,1)},onAddColumn:()=>{const o=new Date().getTime().toString().slice(-4);b.value.columns.push({id:mt(),dataIndex:"field"+o,title:"列"+o,width:200})},tableData:w,onRefreshData:async o=>{},columnFields:v,onSetColumns:o=>{v.value=o},onAddBtn:o=>{b.value.action.push({id:new Date().getTime().toString(),name:"测试",position:o,eventFlow:{nodes:[],edges:[]},customEvent:!1,builtInEvents:"add",formId:""})},onRemoveBtn:o=>{const f=b.value.action.findIndex(x=>x.id==o);f!=-1&&b.value.action.splice(f,1)},onRemoveWidget:o=>{const f=b.value.filter.findIndex(x=>x.id==o);f!=-1&&b.value.filter.splice(f,1)}}}),Jt={class:"custom-header-label",style:{flex:"1"}},Ht=O({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(w,{emit:b}){const v=ie(),{currentColumn:h}=he(v),y=w,{params:C}=z(y),d=()=>{re.onPublish("removeEvent",C.value)};return(T,k)=>{const u=De;return m(),R("div",{class:Ve(["custom-header-item",l(h).dataIndex==l(C).column.getColId()?"active":""]),style:$e([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:l(h).dataIndex==l(C).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[e(l(vt),{class:"move",style:{width:"20px",cursor:"move"}}),r("div",Jt,W(l(C).displayName),1),e(u,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:k[0]||(k[0]=F=>d())},{default:a(()=>[e(l(ft),{class:"remove",style:{width:"20px"},onClick:Ne(()=>{},["stop"])})]),_:1})],6)}}}),qt={class:"custom-opt-cell"},Xt=["onClick"],Zt=O({__name:"CustomOptCell",setup(w){const b=ie(),{tableCfg:v}=he(b),h=j(()=>{var k;return(k=v.value.action)==null?void 0:k.filter(u=>u.position=="row")}),{onAddBtn:y,onRemoveBtn:C}=b,d=k=>{re.onPublish("open-btn-modal",k)},T=()=>{y("row")};return(k,u)=>{const F=De;return m(),R("div",qt,[(m(!0),R(Q,null,ye(h.value,E=>(m(),R("div",{class:"btn",key:E.id},[r("a",{onClick:s=>d(E)},W(E.name),9,Xt),e(F,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:s=>l(C)(E.id)},{default:a(()=>[e(l(xe),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),e(l(Pe),{style:{cursor:"pointer"},onClick:u[0]||(u[0]=E=>T())})])}}}),jt={class:"custom-header-label",style:{flex:"1"}},Yt=O({__name:"CustomAddColumn",setup(w){const b=ie(),{onAddColumn:v}=b;return(h,y)=>{const C=Oe;return m(),R("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:y[0]||(y[0]=d=>l(v)())},[r("div",jt,[e(l(Pe)),p(" 新增列 "),e(C,null,{title:a(()=>[p("用于新增列配置")]),default:a(()=>[e(l(_t))]),_:1})])])}}}),ea={class:"cell"},ta={key:0},aa=["href"],la=O({__name:"CustomCellRender",props:{params:{}},setup(w){const b=w,{params:v}=z(b);return(h,y)=>{const C=bt;return m(),R("div",ea,[l(v).colDef.cellRendererParams.type=="text"?(m(),R("span",ta,W(l(v).value),1)):N("",!0),l(v).colDef.cellRendererParams.type=="image"?(m(),U(C,{key:1,src:l(v).value},null,8,["src"])):N("",!0),l(v).colDef.cellRendererParams.type=="link"?(m(),R("a",{key:2,href:l(v).value},W(l(v).value),9,aa)):N("",!0)])}}}),oa=O({__name:"AgTable",props:Ce({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:Ce(["onRemove","onClick"],["update:columns"]),setup(w,{emit:b}){re.onSubscribe("removeEvent",s=>{let o=s.column.getColId(),f=v.value.find(x=>x.dataIndex==o);f&&F(f)});const v=Me(w,"columns"),h=w,{columnId:y,tableData:C}=z(h),d=j(()=>{let s=v.value.map(o=>({field:o.dataIndex,colId:o.dataIndex,headerName:o.title,pinned:o.fixed=="none"?void 0:o.fixed,lockVisible:!0,headerComponent:Ht,cellRenderer:la,cellRendererParams:{type:o.type}}));return s.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:Yt}),s.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:Zt}),s}),T=s=>{if(!s.finished)return;let o=[];s.api.getColumnState().forEach(f=>{let x=v.value.find(V=>V.dataIndex==f.colId);x&&o.push(x)}),v.value=o},k=s=>{if(!s.finished)return;let o=s.column.getColId(),f=v.value.findIndex(x=>x.dataIndex==o);f!=-1&&(v.value[f].width=s.column.getActualWidth())},u=b,F=s=>{u("onRemove",s)},E=s=>{let o=s.column.getId(),f=v.value.find(x=>x.dataIndex==o);u("onClick",f)};return(s,o)=>(m(),U(l(gt),{rowData:l(C),columnDefs:d.value,style:$e({height:s.height+"px"}),class:"ag-theme-quartz",onColumnMoved:T,onColumnResized:k,onColumnHeaderClicked:E},null,8,["rowData","columnDefs","style"]))}}),na=Y(oa,[["__scopeId","data-v-5dd2184c"]]),sa=O({__name:"EventFlow",props:{dndList:{default:()=>[{type:"circle",text:"开始",label:"开始节点",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAAH6ji2bAAAABGdBTUEAALGPC/xhBQAAAnBJREFUOBGdVL1rU1EcPfdGBddmaZLiEhdx1MHZQXApraCzQ7GKLgoRBxMfcRELuihWKcXFRcEWF8HBf0DdDCKYRZpnl7p0svLe9Zzbd29eQhTbC8nv+9zf130AT63jvooOGS8Vf9Nt5zxba7sXQwODfkWpkbjTQfCGUd9gIp3uuPP8bZ946g56dYQvnBg+b1HB8VIQmMFrazKcKSvFW2dQTxJnJdQ77urmXWOMBCmXM2Rke4S7UAW+/8ywwFoewmBps2tu7mbTdp8VMOkIRAkKfrVawalJTtIliclFbaOBqa0M2xImHeVIfd/nKAfVq/LGnPss5Kh00VEdSzfwnBXPUpmykNss4lUI9C1ga+8PNrBD5YeqRY2Zz8PhjooIbfJXjowvQJBqkmEkVnktWhwu2SM7SMx7Cj0N9IC0oQXRo8xwAGzQms+xrB/nNSUWVveI48ayrFGyC2+E2C+aWrZHXvOuz+CiV6iycWe1Rd1Q6+QUG07nb5SbPrL4426d+9E1axKjY3AoRrlEeSQo2Eu0T6BWAAr6COhTcWjRaYfKG5csnvytvUr/WY4rrPMB53Uo7jZRjXaG6/CFfNMaXEu75nG47X+oepU7PKJvvzGDY1YLSKHJrK7vFUwXKkaxwhCW3u+sDFMVrIju54RYYbFKpALZAo7sB6wcKyyrd+aBMryMT2gPyD6GsQoRFkGHr14TthZni9ck0z+Pnmee460mHXbRAypKNy3nuMdrWgVKj8YVV8E7PSzp1BZ9SJnJAsXdryw/h5ctboUVi4AFiCd+lQaYMw5z3LGTBKjLQOeUF35k89f58Vv/tGh+l+PE/wG0rgfIUbZK5AAAAABJRU5ErkJggg=="},{type:"rect",label:"用户任务",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAEFVwZaAAAABGdBTUEAALGPC/xhBQAAAqlJREFUOBF9VM9rE0EUfrMJNUKLihGbpLGtaCOIR8VjQMGDePCgCCIiCNqzCAp2MyYUCXhUtF5E0D+g1t48qAd7CCLqQUQKEWkStcEfVGlLdp/fm3aW2QQdyLzf33zz5m2IsAZ9XhDpyaaIZkTS4ASzK41TFao88GuJ3hsr2pAbipHxuSYyKRugagICGANkfFnNh3HeE2N0b3nN2cgnpcictw5veJIzxmDamSlxxQZicq/mflxhbaH8BLRbuRwNtZp0JAhoplVRUdzmCe/vO27wFuuA3S5qXruGdboy5/PRGFsbFGKo/haRtQHIrM83bVeTrOgNhZReWaYGnE4aUQgTJNvijJFF4jQ8BxJE5xfKatZWmZcTQ+BVgh7s8SgPlCkcec4mGTmieTP4xd7PcpIEg1TX6gdeLW8rTVMVLVvb7ctXoH0Cydl2QOPJBG21STE5OsnbweVYzAnD3A7PVILuY0yiiyDwSm2g441r6rMSgp6iK42yqroI2QoXeJVeA+YeZSa47gZdXaZWQKTrG93rukk/l2Al6Kzh5AZEl7dDQy+JjgFahQjRopSxPbrbvK7GRe9ePWBo1wcU7sYrFZtavXALwGw/7Dnc50urrHJuTPSoO2IMV3gUQGNg87IbSOIY9BpiT9HV7FCZ94nPXb3MSnwHn/FFFE1vG6DTby+r31KAkUktB3Qf6ikUPWxW1BkXSPQeMHHiW0+HAd2GelJsZz1OJegCxqzl+CLVHa/IibuHeJ1HAKzhuDR+ymNaRFM+4jU6UWKXorRmbyqkq/D76FffevwdCp+jN3UAN/C9JRVTDuOxC/oh+EdMnqIOrlYteKSfadVRGLJFJPSB/ti/6K8f0CNymg/iH2gO/f0DwE0yjAFO6l8JaR5j0VPwPwfaYHqOqrCI319WzwhwzNW/aQAAAABJRU5ErkJggg==",className:"important-node"}]},data:{}},emits:["onClickEle"],setup(w,{expose:b,emit:v}){const h=v,y=c(),C=c(),d=w,{dndList:T,data:k}=z(d),u=s=>{h("onClickEle",s)};return we(()=>{de.use(yt),de.use(xt),de.use(Ct),y.value=new de({container:C.value,grid:!0}),y.value.extension.dndPanel.setPatternItems(T.value),y.value.extension.menu.setMenuConfig({nodeMenu:[{text:"删除",callback(s){y.value.deleteNode(s.id)}}],edgeMenu:[{text:"删除",callback(s){y.value.deleteEdge(s.id)}}],graphMenu:!1}),y.value.render(k.value),y.value.on("node:click",u)}),b({getRawData:()=>{var s;return(s=y.value)==null?void 0:s.getGraphRawData()},updateNodeData:s=>{var o,f;(f=(o=y.value)==null?void 0:o.getNodeModelById(s.id))==null||f.setProperties({extraData:s.properties.extraData})}}),(s,o)=>(m(),R("div",{class:"flow-container",ref_key:"container",ref:C},null,512))}}),ua=Y(sa,[["__scopeId","data-v-e2280916"]]),da={key:2,style:{display:"flex"}},ra=O({__name:"EditTable",props:Ce({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(w){const b=Me(w,"modelValue");let v=w;const{columns:h,action:y}=z(v),C=j(()=>u("input")),d=j(()=>u("select")),T=j(()=>y.value?[...h.value,{title:"操作",dataIndex:"_action_"}]:h.value),k=s=>{var o;return((o=h.value.find(f=>f.dataIndex==s))==null?void 0:o.options)||[]},u=s=>h.value.filter(o=>o.type==s).map(o=>o.dataIndex),F=()=>{let s={};h.value.map(o=>{Reflect.set(s,o.dataIndex,"")}),b.value.push(s)},E=s=>{b.value.splice(s,1)};return(s,o)=>{const f=Ie,x=ke,V=Ae,J=Dt;return m(),U(J,{columns:T.value,"data-source":b.value,pagination:!1,rowKey:($,B)=>B,size:"small",scroll:{y:s.height}},{bodyCell:a(({column:$,record:B,index:i})=>[C.value.includes($.dataIndex)?(m(),U(f,{key:0,value:B[$.dataIndex],"onUpdate:value":P=>B[$.dataIndex]=P},null,8,["value","onUpdate:value"])):N("",!0),d.value.includes($.dataIndex)?(m(),U(x,{key:1,value:B[$.dataIndex],"onUpdate:value":P=>B[$.dataIndex]=P,options:k($.dataIndex)},null,8,["value","onUpdate:value","options"])):N("",!0),$.dataIndex=="_action_"?(m(),R("div",da,[e(l(Ee),{class:"icon",onClick:o[0]||(o[0]=P=>F())}),e(l(wt),{class:"icon",onClick:P=>E(i)},null,8,["onClick"])])):N("",!0)]),emptyText:a(()=>[e(V,{type:"text",onClick:F,icon:ht(l(Ee))},{default:a(()=>[p(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),ge=Y(ra,[["__scopeId","data-v-5b9e8dbe"]]),ia={key:0,style:{color:"red"}},ca=O({__name:"FlowView",props:{data:{default:()=>({nodes:[],edges:[]})}},setup(w,{expose:b}){const v=w,{data:h}=z(v),y=c([{type:"circle",text:"开始",label:"开始节点",icon:"/src/assets/images/flow/开始.png",properties:{nodeType:"start-node",extraData:{}}},{type:"circle",text:"结束",label:"结束节点",icon:"/src/assets/images/flow/结束.png",properties:{nodeType:"end-node",extraData:{}}},{type:"rect",text:"处理函数",label:"处理函数",icon:"/src/assets/images/flow/js函数.png",properties:{nodeType:"func-node",extraData:{code:""}}},{type:"rect",text:"打开弹窗",label:"弹窗",icon:"/src/assets/images/flow/弹窗.png",properties:{nodeType:"modal-node",extraData:{size:"small",formId:""}}},{type:"rect",text:"跳转外部链接",label:"链接",icon:"/src/assets/images/flow/链接.png",properties:{nodeType:"link-node",extraData:{url:"",openType:"_blank"}}},{type:"diamond",text:"请求数据",label:"请求数据",icon:"/src/assets/images/flow/发起请求.png",properties:{nodeType:"request-node",extraData:{url:"",method:"get",params:[],headers:[],body:[]}}}]),C=c(!1),d=c({}),T=c(),k=c([]),u=c([{value:"get",label:"GET"},{value:"post",label:"POST"}]),F=c([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),E=c([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),s=c(""),o=B=>{C.value=!0,d.value=B.data};K.getFormDict().then(B=>{const{code:i,data:P,msg:ee}=B;i==200&&(k.value=P)});const f=()=>{T.value.updateNodeData(d.value)},x=c(!1),V=c("");b({getData:()=>T.value.getRawData()});const $=async()=>{x.value=!1,V.value="";try{const B=T.value.getRawData(),i=new Qt(B);await i.run(),s.value=JSON.stringify(i.getState(),null,4)}catch(B){x.value=!0,V.value=B}};return(B,i)=>{const P=It,ee=ua,te=Ae,H=zt,M=Ge,G=Ke,q=Qe,ae=ke,ce=kt,le=Ie,X=At,D=St,Z=Rt,oe=ze,ne=Le;return m(),R(Q,null,[e(P,null,{default:a(()=>[p("配置区")]),_:1}),e(ee,{ref_key:"eventFlowRef",ref:T,data:l(h),dndList:y.value,style:{height:"450px"},onOnClickEle:o},null,8,["data","dndList"]),e(te,{onClick:i[0]||(i[0]=g=>$()),type:"primary",style:{"margin-top":"10px"}},{default:a(()=>[p("执行")]),_:1}),e(P,null,{default:a(()=>[p("运行结果")]),_:1}),x.value?(m(),R("div",ia,"错误日志: "+W(V.value),1)):(m(),U(H,{key:1,value:s.value,"onUpdate:value":i[1]||(i[1]=g=>s.value=g),height:"200",readOnly:""},null,8,["value"])),e(ne,{open:C.value,"onUpdate:open":i[12]||(i[12]=g=>C.value=g),title:"节点配置",placement:"right",onClose:i[13]||(i[13]=g=>f()),width:"400px"},{default:a(()=>[e(oe,{model:d.value.properties.extraData},{default:a(()=>[d.value.properties.nodeType=="func-node"?(m(),U(M,{key:0,label:"函数"},{default:a(()=>[e(H,{value:d.value.properties.extraData.code,"onUpdate:value":i[2]||(i[2]=g=>d.value.properties.extraData.code=g),prepend:"()=>{",append:"}",theme:"light"},null,8,["value"])]),_:1})):N("",!0),d.value.properties.nodeType=="modal-node"?(m(),R(Q,{key:1},[e(M,{label:"弹窗大小"},{default:a(()=>[e(q,{value:d.value.properties.extraData.size,"onUpdate:value":i[3]||(i[3]=g=>d.value.properties.extraData.size=g),"button-style":"solid"},{default:a(()=>[e(G,{value:"small"},{default:a(()=>[p("小")]),_:1}),e(G,{value:"middle"},{default:a(()=>[p("中")]),_:1}),e(G,{value:"large"},{default:a(()=>[p("大")]),_:1})]),_:1},8,["value"])]),_:1}),e(M,{label:"表单"},{default:a(()=>[e(ae,{value:d.value.properties.extraData.formId,"onUpdate:value":i[4]||(i[4]=g=>d.value.properties.extraData.formId=g),options:k.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})],64)):N("",!0),d.value.properties.nodeType=="link-node"?(m(),R(Q,{key:2},[e(M,{label:"链接地址"},{default:a(()=>[e(ce,{value:d.value.properties.extraData.url,"onUpdate:value":i[5]||(i[5]=g=>d.value.properties.extraData.url=g)},null,8,["value"])]),_:1}),e(M,{label:"打开方式"},{default:a(()=>[e(q,{value:d.value.properties.extraData.openType,"onUpdate:value":i[6]||(i[6]=g=>d.value.properties.extraData.openType=g),"button-style":"solid"},{default:a(()=>[e(G,{value:"_selef"},{default:a(()=>[p("当前页")]),_:1}),e(G,{value:"_blank"},{default:a(()=>[p("新窗口")]),_:1})]),_:1},8,["value"])]),_:1})],64)):N("",!0),d.value.properties.nodeType=="request-node"?(m(),R(Q,{key:3},[e(le,{value:d.value.properties.extraData.url,"onUpdate:value":i[8]||(i[8]=g=>d.value.properties.extraData.url=g)},{addonBefore:a(()=>[e(ae,{value:d.value.properties.extraData.method,"onUpdate:value":i[7]||(i[7]=g=>d.value.properties.extraData.method=g),options:u.value},null,8,["value","options"])]),_:1},8,["value"]),r("div",null,[e(D,null,{default:a(()=>[e(X,{key:"params",tab:"params"},{default:a(()=>[e(ge,{columns:F.value,modelValue:d.value.properties.extraData.params,"onUpdate:modelValue":i[9]||(i[9]=g=>d.value.properties.extraData.params=g)},null,8,["columns","modelValue"])]),_:1}),e(X,{key:"headers",tab:"headers"},{default:a(()=>[e(ge,{columns:E.value,modelValue:d.value.properties.extraData.headers,"onUpdate:modelValue":i[10]||(i[10]=g=>d.value.properties.extraData.headers=g)},null,8,["columns","modelValue"])]),_:1}),e(X,{key:"body",tab:"body"},{default:a(()=>[e(ge,{columns:F.value,modelValue:d.value.properties.extraData.body,"onUpdate:modelValue":i[11]||(i[11]=g=>d.value.properties.extraData.body=g)},null,8,["columns","modelValue"])]),_:1})]),_:1})])],64)):N("",!0),["start-node","end-node"].includes(d.value.properties.nodeType)?(m(),U(Z,{key:4,description:"起止节点暂无配置项"})):N("",!0)]),_:1},8,["model"])]),_:1},8,["open"])],64)}}}),pa=Y(ca,[["__scopeId","data-v-c53bf77f"]]),We=w=>(Gt("data-v-6ed8f220"),w=w(),Kt(),w),ma={class:"table-design"},va={class:"table-design-container"},fa={class:"main-part"},_a={class:"filter-container"},ba=["onClick"],ga={class:"add widget-item"},ya={class:"tools-part"},xa={class:"tools-container"},Ca={class:"add button-item"},wa={class:"table-part"},ha=We(()=>r("h3",null,[p(" 工作流配置注意事项"),r("strong",{style:{color:"red"}},"(目前只支持线性工作流,没有条件判断或并行执行的能力)")],-1)),Da=We(()=>r("ul",null,[r("li",null,[r("strong",null,"工作流节点不能为空："),p(" 每个工作流"),r("strong",null,"必须"),p("包含有效的节点配置。 ")]),r("li",null,[r("strong",null,"包含开始与结束节点："),p(" 每个工作流"),r("strong",null,"必须"),p("包含一个“开始节点”和一个“结束节点”。 ")]),r("li",null,[r("strong",{style:{color:"red"}},"重要参数："),r("code",null,"this.state.modalFormData"),p("为弹窗表单数据， "),r("code",null,"this.state.requestData"),p("为请求数据， 两者既可以作为输入也可以作为输出，搭配"),r("strong",null,"处理函数"),p("节点使用，可以实现数据的填充或者数据的保存。 ")]),r("li",null,[r("strong",null,"节点内变量引用："),p(" 在"),r("strong",null,"处理函数"),p("节点中，可以通过 "),r("code",null,"this.state.xxx"),p(" 的方式引用当前工作流中的变量。 在"),r("strong",null,"请求配置"),p("节点中，在"),r("strong",null,"引用变量"),p("列中可以通过"),r("code",null,"state.xxx"),p("引用变量数据，也可以配置"),r("strong",null,"Value"),p("列使用静态数据。 ")]),r("li",null,[r("strong",null,"预览结果："),p(" 执行后，预览结果仅显示当前工作流的 "),r("code",null,"state"),p(" 属性，其他信息不可见。 ")])],-1)),Ia=O({__name:"TableDesign",props:{id:{}},setup(w){Tt();const{shouldShowReminder:b}=Lt("low-code-table-design"),v=c(0),h=[{title:"数据源",description:"选择你在系统内已配置好的数据源",target:()=>document.querySelector(".extra"),placement:"bottom"},{title:"列配置区域",description:"对已配置数据源的表格的列进行配置，可以拖拽调整列的顺序，点击列进行详细配置",target:()=>document.querySelector(".table-part"),placement:"top"},{title:"筛选条件区域",description:"添加当前表格的筛选条件，可以拖拽调整筛选条件的顺序，点击筛选条件进行详细配置",target:()=>document.querySelector(".filter-container"),placement:"bottom"},{title:"按钮操作配置区域",description:"添加当前表格的操作按钮，可以拖拽调整按钮的顺序，点击按钮进行详细配置",target:()=>document.querySelector(".tools-container"),placement:"bottom"},{title:"最后",description:"保存您刚刚的配置",target:()=>document.querySelector(".save-btn"),placement:"left"}];re.onSubscribe("open-btn-modal",_=>{oe(_)});const y=c([]);we(()=>{K.getDataSourceDict().then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(y.value=A)})});const C=w,{id:d}=z(C),T=c(!1),k=ie(),{tableCfg:u,currentColumn:F}=he(k),{onSelectColumn:E,onRemoveBtn:s,onRemoveColumn:o,onSetColumns:f,onRemoveWidget:x,onAddBtn:V,setTableCfg:J}=k;d.value?(T.value=!0,be.getDetail(d.value).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(J(A),G(),H(),T.value=!1)})):J({name:"未命名列表",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),window.name="table-design";const $=c([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),B=()=>{var _;(_=u.value.filter)==null||_.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},i=()=>{window.open("/lowcode/table","quick-build")},P=_=>{E(_.id,u.value.columns),pe.value=!0},ee=_=>{o(_.id,u.value.columns)};c([]);const te=c([]),H=()=>{K.getSourceData(u.value.dataSource.sourceId,u.value.dataSource.tableName).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(te.value=A)})},M=c([]),G=()=>{K.getTableInfo(u.value.dataSource.sourceId).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(M.value=A)})},q=async()=>{if(!u.value.dataSource.sourceId||!u.value.dataSource.tableName)return[];const{code:_,data:t,msg:A}=await K.getColumnInfo(u.value.dataSource.sourceId,u.value.dataSource.tableName);return _==200?t.map(S=>({label:S.columnComment?`${S.columnComment}(${S.columnName})`:S.columnName,value:S.columnName})):[]},ae=()=>{K.getColumnInfo(u.value.dataSource.sourceId,u.value.dataSource.tableName).then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(u.value.columns=A.map(I=>({dataIndex:I.columnName,title:I.columnComment||I.columnName,id:I.columnName,width:200,type:"text",align:"left",fixed:"none"})),f(A.map(I=>({label:I.columnComment?`${I.columnComment}(${I.columnName})`:I.columnName,value:I.columnName}))))}),H()},ce=()=>{V("header")},le=c([]),X=()=>{K.getFormDict().then(_=>{const{code:t,data:A,msg:S}=_;t==200&&(le.value=A)})};we(()=>{X()});const D=c({id:"",name:"",eventFlow:{nodes:[],edges:[]},position:"header",customEvent:!1,builtInEvents:"add",formId:""}),Z=c(!1),oe=_=>{D.value=_,Z.value=!0},ne=c({}),g=c(!1),Je=c({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"select",label:"字段名称",component:{asyncData:q}},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dictType:{type:"radio",label:"字典类型",show:'"${formData.type}" == "select"',tooltip:"字典为系统的字典配置数据，列数据为当前配置字段的列数据",component:{dataSource:[{label:"字典",value:"dict"},{label:"列数据",value:"col"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",tooltip:"可以在系统配置自定义字典",show:'"${formData.type}" == "select" && "${formData.dictType}" == "dict"',component:{asyncData:async()=>{const{code:_,data:t,msg:A}=await K.getDictTypeList();return _==200?t.map(S=>({label:S.dictTypeDesc,value:S.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),He=c({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:q}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),qe=_=>{ne.value=_,g.value=!0},pe=c(!1),me=c(!1),Xe=c({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"120px"}}},properties:{showFilter:{type:"switch",label:"显示筛选面板"},showPagination:{type:"switch",label:"显示分页器"},showBordered:{type:"switch",label:"显示边框"},size:{type:"radio",label:"表格尺寸",component:{dataSource:[{label:"紧凑",value:"small"},{label:"默认",value:"middle"},{label:"宽松",value:"large"}],buttonStyle:"solid"}}}}),Ze=()=>{me.value=!0},je=()=>{T.value=!0,(d.value?be.update:be.add)(u.value).then(t=>{const{code:A,data:S,msg:I}=t;A==200&&$t.success("保存成功"),T.value=!1})},se=c(!1),ve=c({nodes:[],edges:[]}),Ye=_=>{ve.value=_.eventFlow,se.value=!0},Se=c(),et=()=>{D.value.eventFlow=Se.value.getData(),Re()},Re=()=>{ve.value={nodes:[],edges:[]},se.value=!1};return(_,t)=>{const A=Ie,S=ke,I=Ge,L=Ae,tt=Pt,at=Et,lt=Ot,Te=De,Be=Ke,ot=Qe,nt=Mt,st=ze,ue=Le,ut=Oe,dt=Ft,rt=Ut,it=Nt("loading");return m(),R(Q,null,[Bt((m(),R("div",ma,[e(at,{onBack:i,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[e(A,{value:l(u).name,"onUpdate:value":t[0]||(t[0]=n=>l(u).name=n),bordered:!1,class:"table-name"},null,8,["value"])]),extra:a(()=>[e(tt,{class:"extra"},{default:a(()=>[e(I,{label:"选择数据源"},{default:a(()=>[e(S,{value:l(u).dataSource.sourceId,"onUpdate:value":t[1]||(t[1]=n=>l(u).dataSource.sourceId=n),options:y.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:t[2]||(t[2]=n=>G())},null,8,["value","options"])]),_:1}),e(I,{label:"选择表名"},{default:a(()=>[e(S,{value:l(u).dataSource.tableName,"onUpdate:value":t[3]||(t[3]=n=>l(u).dataSource.tableName=n),options:M.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:t[4]||(t[4]=n=>ae())},null,8,["value","options"])]),_:1}),e(L,{type:"primary",onClick:Ze,class:"global-btn"},{default:a(()=>[p("全局配置")]),_:1}),e(L,{onClick:t[5]||(t[5]=n=>je()),type:"primary",class:"save-btn"},{default:a(()=>[p(" 保存 ")]),_:1})]),_:1})]),_:1}),r("div",va,[r("div",fa,[r("div",{class:Ve(["filter-part",{disabled:!l(u).global.showFilter}])},[r("div",_a,[e(l(Fe),{list:l(u).filter,"onUpdate:list":t[7]||(t[7]=n=>l(u).filter=n),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(m(!0),R(Q,null,ye(l(u).filter,n=>(m(),R("div",{class:"widget-item",key:n.id,onClick:fe=>qe(n)},[e(l(Ue),{class:"move-handle",style:{cursor:"pointer"}}),e(I,{label:n.label,name:n.field},{default:a(()=>[n.type=="input"?(m(),U(A,{key:0})):n.type=="select"?(m(),U(S,{key:1})):(m(),U(lt,{key:2}))]),_:2},1032,["label","name"]),e(Te,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:fe=>l(x)(n.id)},{default:a(()=>[e(l(xe),{class:"remove-btn",onClick:Ne(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,ba))),128)),r("div",ga,[e(L,{type:"primary",onClick:t[6]||(t[6]=n=>B())},{default:a(()=>[p(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])],2),r("div",ya,[r("div",xa,[e(l(Fe),{list:l(u).action,"onUpdate:list":t[9]||(t[9]=n=>l(u).action=n),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(m(!0),R(Q,null,ye(l(u).action.filter(n=>n.position=="header"),n=>(m(),R("div",{class:"button-item",key:n.id},[e(l(Ue),{class:"move-handle",style:{cursor:"pointer"}}),e(L,{onClick:fe=>oe(n)},{default:a(()=>[p(W(n.name),1)]),_:2},1032,["onClick"]),e(Te,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:fe=>l(s)(n.id)},{default:a(()=>[e(l(xe),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),r("div",Ca,[e(L,{type:"primary",onClick:t[8]||(t[8]=n=>ce())},{default:a(()=>[p(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),r("div",wa,[e(na,{columns:l(u).columns,"onUpdate:columns":t[10]||(t[10]=n=>l(u).columns=n),tableData:te.value,height:550,onOnRemove:ee,onOnClick:P},null,8,["columns","tableData"])])])])])),[[it,T.value,void 0,{fullscreen:!0}]]),e(ue,{title:"按钮配置",placement:"right",closable:!1,open:Z.value,onClose:t[18]||(t[18]=n=>Z.value=!1)},{default:a(()=>[e(st,{model:D.value},{default:a(()=>[e(I,{prop:"id",label:"按钮标识"},{default:a(()=>[e(A,{value:D.value.id,"onUpdate:value":t[11]||(t[11]=n=>D.value.id=n)},null,8,["value"])]),_:1}),e(I,{prop:"name",label:"按钮名称"},{default:a(()=>[e(A,{value:D.value.name,"onUpdate:value":t[12]||(t[12]=n=>D.value.name=n)},null,8,["value"])]),_:1}),e(I,{prop:"name",label:"按钮位置"},{default:a(()=>[e(ot,{value:D.value.position,"onUpdate:value":t[13]||(t[13]=n=>D.value.position=n),"button-style":"solid"},{default:a(()=>[e(Be,{value:"header"},{default:a(()=>[p("表头")]),_:1}),e(Be,{value:"row"},{default:a(()=>[p("行内")]),_:1})]),_:1},8,["value"])]),_:1}),e(I,{prop:"customEvent",label:"是否启用自定义"},{default:a(()=>[e(nt,{checked:D.value.customEvent,"onUpdate:checked":t[14]||(t[14]=n=>D.value.customEvent=n)},null,8,["checked"])]),_:1}),D.value.customEvent?N("",!0):(m(),U(I,{key:0,prop:"builtInEvents",label:"内置事件"},{default:a(()=>[e(S,{value:D.value.builtInEvents,"onUpdate:value":t[15]||(t[15]=n=>D.value.builtInEvents=n),options:$.value,allowClear:""},null,8,["value","options"])]),_:1})),["add","edit"].includes(D.value.builtInEvents)&&!D.value.customEvent?(m(),U(I,{key:1,prop:"formId",label:"关联表单"},{default:a(()=>[e(S,{value:D.value.formId,"onUpdate:value":t[16]||(t[16]=n=>D.value.formId=n),options:le.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})):N("",!0),D.value.customEvent?(m(),U(I,{key:2,prop:"event",label:"自定义事件流"},{default:a(()=>[e(L,{onClick:t[17]||(t[17]=n=>Ye(D.value))},{default:a(()=>[p(" 自定义事件流 ")]),_:1})]),_:1})):N("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),e(ue,{title:"筛选控件配置",placement:"right",closable:!1,open:g.value,onClose:t[19]||(t[19]=n=>g.value=!1)},{default:a(()=>[e(l(_e),{formData:ne.value,schema:Je.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(ue,{title:"列配置",placement:"right",closable:!1,open:pe.value,onClose:t[20]||(t[20]=n=>pe.value=!1)},{default:a(()=>[e(l(_e),{formData:l(F),schema:He.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(ue,{title:"全局配置",placement:"right",closable:!1,open:me.value,onClose:t[21]||(t[21]=n=>me.value=!1)},{default:a(()=>[e(l(_e),{formData:l(u).global,schema:Xe.value},null,8,["formData","schema"])]),_:1},8,["open"]),e(dt,{width:"100%","wrap-class-name":"full-modal",open:se.value,"onUpdate:open":t[22]||(t[22]=n=>se.value=n),onOk:et,onCancel:Re},{title:a(()=>[p(" 事件流配置 "),e(ut,{overlayInnerStyle:{width:"600px",color:"#000"},color:"#ffffff",arrow:!1,placement:"rightBottom"},{title:a(()=>[ha,Da]),default:a(()=>[e(l(Vt))]),_:1})]),default:a(()=>[e(pa,{data:ve.value,ref_key:"flowRef",ref:Se},null,8,["data"])]),_:1},8,["open"]),e(rt,{current:v.value,"onUpdate:current":t[23]||(t[23]=n=>v.value=n),open:l(b),steps:h,onClose:t[24]||(t[24]=n=>b.value=!1)},null,8,["current","open"])],64)}}}),$a=Y(Ia,[["__scopeId","data-v-6ed8f220"]]);export{$a as default};
