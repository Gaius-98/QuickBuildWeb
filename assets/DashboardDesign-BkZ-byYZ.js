import{_ as Q}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-DuD6YwsR.js";import{c as X}from"./componentsSchema-gFhwa5FU.js";import{g as q,r as h,x as J,o as p,y as _,G as s,N as D,U as I,H as Y,J as P,l as e,i as N,aj as U,M as b,w as l,t as Z,v as F,a1 as ee,ao as V,ap as W,bg as j,a5 as A,a6 as ae,T as M,b5 as L,a7 as te,h as le,F as oe,P as ne,b3 as se}from"./.pnpm-CQCJb2bg.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ce,D as re}from"./ConfigForm.vue_vue_type_script_setup_true_lang-BplcICa5.js";const R=u=>(V("data-v-b0ff9776"),u=u(),W(),u),ue={class:"material-area"},ie={class:"material-layout-area"},de=R(()=>s("div",{class:"title"},"内置组件",-1)),pe={class:"content"},me=["data-material"],_e={class:"material-label"},ve={class:"material-data-area"},fe=R(()=>s("div",{class:"title"},"自定义组件",-1)),ge={class:"content"},he=["data-material"],be={style:{height:"650px"}},ye={style:{height:"80px","overflow-y":"auto"}},xe={style:{height:"200px","overflow-y":"auto"}},Ce=q({__name:"MaterialArea",setup(u){const i=h({internalComp:X,customComp:[]}),c=v=>{var n,r;const o=v.target;(n=v.dataTransfer)==null||n.setData("material",o.dataset.material),(r=v.dataTransfer)==null||r.setData("material-type",o.dataset.materialType)},m=h(!1),y=()=>{m.value=!0,t.value=Z(x.value)},x=h({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElButton",exportName:"ElButton",id:"1",schema:`{
    "type": {
        "type": "input",
        "label": "按钮类型"
    }
}`}]}),t=h({}),C=()=>{m.value=!1},d=()=>{const v=t.value.children.map(n=>({label:n.componentName,value:n.exportName}));i.value.customComp=i.value.customComp.concat(v);const o=localStorage.getItem("qb-custom-data")?JSON.parse(localStorage.getItem("qb-custom-data")):{};t.value.children.forEach(n=>{o[n.componentName]=n.schema}),localStorage.setItem("qb-custom-data",JSON.stringify(o)),w==null||w.postMessage({type:"add-custom-comp",data:F(t.value)}),C()},g=()=>{t.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},S=v=>{const o=t.value.children.findIndex(n=>n.id==v.id);o!=-1&&t.value.children.splice(o,1)},T=()=>{t.value.urls.push("")},z=v=>{const o=t.value.urls.findIndex(n=>n==v);o!=-1&&t.value.urls.splice(o,1)};let w=null;return J(()=>{w=document.querySelector(".standalone-iframe").contentWindow}),(v,o)=>{const n=A,r=ae,B=M,E=L,G=Q,H=te,K=ee;return p(),_("div",ue,[s("div",ie,[de,s("div",pe,[(p(!0),_(D,null,I(i.value.internalComp,a=>(p(),_("div",{key:a.name,draggable:"true",onDragstart:c,"data-material":a.name,"data-material-type":"internal",class:"material-item"},[s("span",{class:Y(["iconfont material-icon",a.icon])},null,2),s("span",_e,P(a.label),1)],40,me))),128))])]),s("div",ve,[fe,s("div",ge,[(p(!0),_(D,null,I(i.value.customComp,a=>(p(),_("div",{type:"dashed",key:a.value,draggable:"true",onDragstart:c,"data-material":a.value,"data-material-type":"custom",class:"material-item"},P(a.label),41,he))),128)),s("div",{type:"dashed",onClick:y,class:"material-item"},[s("span",null,[e(N(U)),b(" 添加组件 ")])])])]),e(K,{title:"添加自定义组件",width:"800px",open:m.value,"onUpdate:open":o[4]||(o[4]=a=>m.value=a),onOk:d,onCancel:C},{default:l(()=>[s("div",be,[e(H,{model:t.value,"label-col":{style:{width:"150px"}}},{default:l(()=>[e(r,{label:"名称"},{default:l(()=>[e(n,{value:t.value.title,"onUpdate:value":o[0]||(o[0]=a=>t.value.title=a)},null,8,["value"])]),_:1}),e(r,{label:"组件库名称"},{default:l(()=>[e(n,{value:t.value.package,"onUpdate:value":o[1]||(o[1]=a=>t.value.package=a)},null,8,["value"])]),_:1}),e(r,{label:"版本"},{default:l(()=>[e(n,{value:t.value.version,"onUpdate:value":o[2]||(o[2]=a=>t.value.version=a)},null,8,["value"])]),_:1}),e(r,{label:"导出名称"},{default:l(()=>[e(n,{value:t.value.exportName,"onUpdate:value":o[3]||(o[3]=a=>t.value.exportName=a)},null,8,["value"])]),_:1}),e(r,{label:"CDN地址"},{default:l(()=>[s("div",ye,[(p(!0),_(D,null,I(t.value.urls,(a,k)=>(p(),_("div",{key:a,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(n,{value:t.value.urls[k],"onUpdate:value":f=>t.value.urls[k]=f},null,8,["value","onUpdate:value"]),e(N(j),{onClick:f=>z(a),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(r,null,{default:l(()=>[e(B,{type:"dashed",block:"",onClick:T},{default:l(()=>[e(N(U)),b(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(r,{label:"子组件"},{default:l(()=>[s("div",xe,[(p(!0),_(D,null,I(t.value.children,(a,k)=>(p(),_("div",{key:a.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(E,null,{default:l(()=>[s("div",null,[e(E,null,{default:l(()=>[e(r,{label:"组件名",rules:{required:!0}},{default:l(()=>[e(n,{value:a.componentName,"onUpdate:value":f=>a.componentName=f},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{label:"导出名称",name:["sights",k,"price"],rules:{required:!0}},{default:l(()=>[e(n,{value:a.exportName,"onUpdate:value":f=>a.exportName=f},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),_:2},1024),e(r,{label:"配置Schema",rules:{required:!0}},{default:l(()=>[e(G,{value:a.schema,"onUpdate:value":f=>a.schema=f,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(N(j),{onClick:f=>S(a)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(r,null,{default:l(()=>[e(B,{type:"dashed",block:"",onClick:g},{default:l(()=>[e(N(U)),b(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),Se=O(Ce,[["__scopeId","data-v-b0ff9776"]]),Ne={text:{type:"input",label:"文本内容"}},we={src:{type:"input",label:"图片地址"}},ke={src:{type:"input",label:"页面地址"}},De=u=>({dataset:{type:"select",label:"数据集",options:u},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),$={"qb-text":Ne,"qb-image":we,"qb-iframe":ke,"qb-chart":De},Ie={class:"material-cfg"},Ue={class:"material-cfg-btn"},$e=q({__name:"MaterialCfg",setup(u){const i=h({}),c=h({}),m=h({}),y=new re;window.addEventListener("message",d=>{if(d.data.type==="select"){if(c.value=d.data.data,c.value.type==="custom"){if(localStorage.getItem("qb-custom-data")){const g=JSON.parse(localStorage.getItem("qb-custom-data"));m.value=JSON.parse(g[c.value.component])}}else typeof $[c.value.component]=="function"?m.value=$[c.value.component]([]):m.value=$[c.value.component];i.value=d.data.data.props}});let x=null;const t=d=>{if(x)x.postMessage({type:"refresh",data:d});else throw new Error("contentWindow is null")},C=()=>{c.value.props=y.processObject(i.value),localStorage.setItem(`dg-raw-config-${c.value.id}`,JSON.stringify(i.value)),c.value.props=y.processObject(i.value),t(F(c.value))};return J(()=>{x=document.querySelector(".standalone-iframe").contentWindow}),(d,g)=>{const S=M;return p(),_("div",Ie,[(p(),le(ce,{class:"material-cfg-contain",key:c.value.id,data:i.value,schema:m.value},null,8,["data","schema"])),s("div",Ue,[e(S,{onClick:C},{default:l(()=>[b("刷新")]),_:1})])])}}}),qe=O($e,[["__scopeId","data-v-4d9cc781"]]),Me=u=>(V("data-v-a0127664"),u=u(),W(),u),Oe={class:"dg-design"},Te={class:"dg-design-container"},Be=Me(()=>s("div",{class:"middle-part"},[s("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),Ee=q({__name:"DashboardDesign",props:{id:{}},setup(u){window.name="dg-design";const i=u,{id:c}=oe(i),m=ne(()=>c.value),y=()=>{};return(x,t)=>{const C=A,d=L,g=M,S=se;return p(),_("div",Oe,[e(S,{subTitle:m.value,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:l(()=>[e(C,{bordered:!1,class:"form-name"})]),extra:l(()=>[e(d),e(d),e(d,null,{default:l(()=>[e(g,{type:"primary"},{default:l(()=>[b("变量池")]),_:1}),e(g,{class:"preview-btn"},{default:l(()=>[b(" 预览 ")]),_:1}),e(g,{onClick:t[0]||(t[0]=T=>y()),type:"primary",class:"save-btn"},{default:l(()=>[b(" 保存 ")]),_:1})]),_:1})]),_:1},8,["subTitle"]),s("div",Te,[e(Se,{class:"left-part"}),Be,e(qe,{class:"right-part"})])])}}}),We=O(Ee,[["__scopeId","data-v-a0127664"]]);export{We as default};
