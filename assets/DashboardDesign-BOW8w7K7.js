import{_ as ce}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-Dd6wsA-g.js";import{c as ve}from"./componentsSchema-LhIlCAWr.js";import{u as G}from"./dashboardDesign-BB5Du9ph.js";import{d as H,s as K,r as g,P as le,p as F,q as b,v as r,f as e,J as B,K as T,$ as I,u as y,w as t,B as _e,M as te,bd as oe,ba as ne,o as u,t as Q,c as A,e as W,I as fe,ck as be,G as ge,H as ye,bj as he,a as xe,cj as Ce}from"./iconfont-DlnTACa0.js";import{P as j}from"./PlusOutlined-boFLuxir.js";import{M as se}from"./index-rRoPRs5X.js";import{c as ke}from"./cloneDeep-eMWwQ7HD.js";import{F as X,_ as Y}from"./index-3zxQoAaC.js";import{I as ie}from"./index-DstlK8U5.js";import{M as J}from"./MinusCircleOutlined-BjVCnnBI.js";import{B as Z}from"./EyeOutlined-MSEk9XoR.js";import{S as re,_ as we}from"./index-BbmK55ey.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Se}from"./ConfigForm.vue_vue_type_script_setup_true_lang-DklhTUDt.js";import{S as De}from"./SchemaForm-D-gPt8Z_.js";import{T as Ue,_ as Ne}from"./index-DFAyz8EE.js";import{S as pe}from"./RadioButton-CjVxn_Oc.js";import"./dark-CYikDsl4.js";import"./dashboard-CDn7Cw0e.js";import"./index-Df99mV5f.js";import"./CheckOutlined-DhghRCOv.js";import"./useFlexGapSupport-CiVQ43IU.js";import"./_getPrototype-CreJcRG-.js";import"./initDefaultProps-CCuNUPvT.js";import"./pickAttrs-C_Pg0-pd.js";import"./ActionButton-GOh5bmF9.js";import"./Col-7N7sU2gK.js";import"./index-Cj_T3PZy.js";import"./dropdown-CS9IU7I3.js";import"./RightOutlined-DiQ8sQL1.js";import"./shallowequal-CYaRVoeZ.js";import"./index-CkgH7Yyy.js";import"./index-BKuSEOK0.js";import"./useBreakpoint-BBubvWxm.js";import"./index-C6qv0Jk3.js";import"./index-BJM6GpkM.js";import"./index-ib-wLQfr.js";import"./v4-CtRu48qb.js";import"./index-DB-FIVCb.js";import"./tools-BCD5ohFr.js";import"./utils-B6a3RfBT.js";/* empty css                   */import"./index-5aalWurl.js";import"./index-DAYOQQPc.js";import"./dayjs-78fL9Suk.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-CcL4KyIF.js";import"./index-8jXZgUEG.js";const ue=f=>(oe("data-v-88293ef5"),f=f(),ne(),f),$e={class:"material-area"},Ie={class:"material-layout-area"},qe=ue(()=>r("div",{class:"title"},"内置组件",-1)),Me={class:"content"},Le=["data-material"],Pe={class:"material-label"},Ve={class:"material-data-area"},Be=ue(()=>r("div",{class:"title"},"自定义组件",-1)),Ee={class:"content"},Oe=["data-material"],Re={style:{height:"650px"}},Te={style:{height:"80px","overflow-y":"auto"}},We={style:{height:"200px","overflow-y":"auto"}},je=H({__name:"MaterialArea",setup(f){const D=G(),{customModules:h,customComps:U}=K(D),{onAddModules:m}=D,i=g({internalComp:ve,customComp:[]}),N=p=>{var s,a;const n=p.target;(s=p.dataTransfer)==null||s.setData("material",n.dataset.material),(a=p.dataTransfer)==null||a.setData("material-type",n.dataset.materialType)},w=g(!1),q=()=>{w.value=!0,o.value=ke(L.value)},L=g({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElEmpty",exportName:"ElEmpty",id:"1",schema:`{
    "description": {
        "type": "input",
        "label": "描述"
    }

      }`}]}),o=g({}),$=()=>{w.value=!1},M=()=>{m(o.value),$()};le(()=>h.value,()=>{i.value.customComp=i.value.customComp.concat(U.value),v==null||v.postMessage({type:"add-custom-comp",data:Q(o.value)})},{deep:!0});const E=()=>{o.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},O=p=>{const n=o.value.children.findIndex(s=>s.id==p.id);n!=-1&&o.value.children.splice(n,1)},c=()=>{o.value.urls.push("")},d=p=>{const n=o.value.urls.findIndex(s=>s==p);n!=-1&&o.value.urls.splice(n,1)};let v=null;return F(()=>{v=document.querySelector(".standalone-iframe").contentWindow}),(p,n)=>{const s=ie,a=Y,C=Z,S=re,k=ce,z=X,P=se;return u(),b("div",$e,[r("div",Ie,[qe,r("div",Me,[(u(!0),b(B,null,T(i.value.internalComp,l=>(u(),b("div",{key:l.name,draggable:"true",onDragstart:N,"data-material":l.name,"data-material-type":"internal",class:"material-item"},[r("span",{class:_e(["iconfont material-icon",l.icon])},null,2),r("span",Pe,te(l.label),1)],40,Le))),128))])]),r("div",Ve,[Be,r("div",Ee,[(u(!0),b(B,null,T(i.value.customComp,l=>(u(),b("div",{type:"dashed",key:l.value,draggable:"true",onDragstart:N,"data-material":l.value,"data-material-type":"custom",class:"material-item"},te(l.label),41,Oe))),128)),r("div",{type:"dashed",onClick:q,class:"material-item"},[r("span",null,[e(y(j)),I(" 添加组件 ")])])])]),e(P,{title:"添加自定义组件",width:"800px",open:w.value,"onUpdate:open":n[4]||(n[4]=l=>w.value=l),onOk:M,onCancel:$},{default:t(()=>[r("div",Re,[e(z,{model:o.value,"label-col":{style:{width:"150px"}}},{default:t(()=>[e(a,{label:"名称"},{default:t(()=>[e(s,{value:o.value.title,"onUpdate:value":n[0]||(n[0]=l=>o.value.title=l)},null,8,["value"])]),_:1}),e(a,{label:"组件库名称"},{default:t(()=>[e(s,{value:o.value.package,"onUpdate:value":n[1]||(n[1]=l=>o.value.package=l)},null,8,["value"])]),_:1}),e(a,{label:"版本"},{default:t(()=>[e(s,{value:o.value.version,"onUpdate:value":n[2]||(n[2]=l=>o.value.version=l)},null,8,["value"])]),_:1}),e(a,{label:"导出名称"},{default:t(()=>[e(s,{value:o.value.exportName,"onUpdate:value":n[3]||(n[3]=l=>o.value.exportName=l)},null,8,["value"])]),_:1}),e(a,{label:"CDN地址"},{default:t(()=>[r("div",Te,[(u(!0),b(B,null,T(o.value.urls,(l,R)=>(u(),b("div",{key:l,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(s,{value:o.value.urls[R],"onUpdate:value":x=>o.value.urls[R]=x},null,8,["value","onUpdate:value"]),e(y(J),{onClick:x=>d(l),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(a,null,{default:t(()=>[e(C,{type:"dashed",block:"",onClick:c},{default:t(()=>[e(y(j)),I(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(a,{label:"子组件"},{default:t(()=>[r("div",We,[(u(!0),b(B,null,T(o.value.children,(l,R)=>(u(),b("div",{key:l.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(S,null,{default:t(()=>[r("div",null,[e(S,null,{default:t(()=>[e(a,{label:"组件名",rules:{required:!0}},{default:t(()=>[e(s,{value:l.componentName,"onUpdate:value":x=>l.componentName=x},null,8,["value","onUpdate:value"])]),_:2},1024),e(a,{label:"导出名称",rules:{required:!0}},{default:t(()=>[e(s,{value:l.exportName,"onUpdate:value":x=>l.exportName=x},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(a,{label:"配置Schema",rules:{required:!0}},{default:t(()=>[e(k,{value:l.schema,"onUpdate:value":x=>l.schema=x,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(y(J),{onClick:x=>O(l)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(a,null,{default:t(()=>[e(C,{type:"dashed",block:"",onClick:E},{default:t(()=>[e(y(j)),I(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),Fe=ee(je,[["__scopeId","data-v-88293ef5"]]),ze={text:{type:"input",label:"文本内容"}},Ae={src:{type:"input",label:"图片地址"}},Je={src:{type:"input",label:"页面地址"}},Ge=f=>({dataset:{type:"select",label:"数据集",options:f},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),He={"qb-text":ze,"qb-image":Ae,"qb-iframe":Je,"qb-chart":Ge},Ke={title1:{type:"divider",label:"标题",component:{title:"标题"},formLayout:!1},"option.title.show":{type:"switch",label:"显示标题"},"option.title.text":{type:"string",label:"标题文本"},"option.title.link":{type:"string",label:"文本超链接"},title2:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},"option.grid.left":{type:"string",label:"左边距"},"option.grid.right":{type:"string",label:"右边距"},"option.grid.top":{type:"string",label:"上边距"},"option.grid.bottom":{type:"string",label:"下边距"},title3:{type:"divider",label:"图例",component:{title:"图例"},formLayout:!1},"option.legend.show":{type:"switch",label:"显示图例"},"option.legend.type":{type:"select",label:"图例类型",component:{dataSource:[{label:"普通图例",value:"plain"},{label:"翻页图例",value:"scroll"}]}},"option.legend.orient":{type:"select",label:"图例朝向",component:{dataSource:[{value:"horizontal",label:"横向"},{value:"vertical",label:"纵向"}]}},title4:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},ae={title1:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},paddingLeft:{type:"string",label:"左边距",tooltip:"请注明单位，一般为：px"},paddingTop:{type:"string",label:"上边距",tooltip:"请注明单位，一般为：px"},paddingRight:{type:"string",label:"右边距",tooltip:"请注明单位，一般为：px"},paddingBottom:{type:"string",label:"下边距",tooltip:"请注明单位，一般为：px"},title2:{type:"divider",label:"背景",component:{title:"背景"},formLayout:!1},backgroundColor:{type:"string",label:"背景色",component:{name:"color-picker"}},title3:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},Qe={class:"material-cfg"},Xe={class:"material-cfg-btn"},Ye=H({__name:"MaterialCfg",setup(f){const D=G(),{customCompSchema:h}=K(D),{getContentWindow:U}=D,m=g({}),i=g({}),N=g({}),w=g({}),q=g({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"100px"}}},properties:ae}),L=g([]);A.getDatasetDict().then(c=>{const{code:d,data:v,msg:p}=c;d==200&&(L.value=v)});const o=g([]),$=()=>{m.value.dimension=[],m.value.target=[],A.getFieldByDatasetId(m.value.dataset).then(c=>{const{code:d,data:v,msg:p}=c;d==200&&(o.value=v.map(n=>({value:n,label:n})))})};window.addEventListener("message",c=>{var d;(c.data.type==="select"||c.data.type==="update-item")&&(q.value.properties=ae,i.value=c.data.data,((d=i.value)==null?void 0:d.type)==="custom"?h.value&&(N.value=JSON.parse(h.value[i.value.component])):i.value.component=="qb-chart"?q.value.properties=Ke:N.value=He[i.value.component],m.value=i.value.props,i.value.component=="qb-chart"&&A.getFieldByDatasetId(m.value.dataset).then(v=>{const{code:p,data:n,msg:s}=v;p==200&&(o.value=n.map(a=>({value:a,label:a})))}),w.value=i.value.style)});let M=null;const E=c=>{if(M)M.postMessage({type:"refresh",data:c});else throw new Error("contentWindow is null")},O=()=>{E(Q(i.value))};return F(()=>{U().then(c=>{M=c})}),(c,d)=>{const v=be,p=pe,n=Y,s=X,a=Ne,C=Ue,S=Z;return u(),b("div",Qe,[e(C,{size:"small"},{default:t(()=>[e(a,{key:"prop",tab:"属性"},{default:t(()=>[i.value.id?i.value.component!="qb-chart"?(u(),W(Se,{class:"material-cfg-contain",key:i.value.id,data:m.value,schema:N.value},null,8,["data","schema"])):i.value.component=="qb-chart"?(u(),W(s,{key:2},{default:t(()=>[e(n,{label:"数据集"},{default:t(()=>[e(p,{value:m.value.dataset,"onUpdate:value":d[0]||(d[0]=k=>m.value.dataset=k),options:L.value,onChange:$},null,8,["value","options"])]),_:1}),e(n,{label:"维度"},{default:t(()=>[e(p,{value:m.value.dimension,"onUpdate:value":d[1]||(d[1]=k=>m.value.dimension=k),options:o.value,mode:"tags"},null,8,["value","options"])]),_:1}),e(n,{label:"指标"},{default:t(()=>[e(p,{value:m.value.target,"onUpdate:value":d[2]||(d[2]=k=>m.value.target=k),options:o.value,mode:"tags"},null,8,["value","options"])]),_:1})]),_:1})):fe("",!0):(u(),W(v,{key:0}))]),_:1}),e(a,{key:"style",tab:"样式"},{default:t(()=>[(u(),W(y(De),{schema:q.value,size:"small",formData:w.value,key:i.value.id},null,8,["schema","formData"]))]),_:1})]),_:1}),r("div",Xe,[e(S,{onClick:O,disabled:!i.value.id},{default:t(()=>[I("刷新")]),_:1},8,["disabled"])])])}}}),Ze=ee(Ye,[["__scopeId","data-v-c3e45bd1"]]),et=f=>(oe("data-v-715b8aa8"),f=f(),ne(),f),tt={class:"dg-design"},at={class:"dg-design-container"},lt=et(()=>r("div",{class:"middle-part"},[r("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),ot={style:{height:"300px","overflow-y":"auto"}},nt=H({__name:"DashboardDesign",props:{id:{}},setup(f){const D=G(),{varPools:h,dgInfo:U,loading:m}=K(D);let i;const{getContentWindow:N,onSave:w,getDetail:q}=D;window.name="dg-design";const L=f,{id:o}=ge(L);F(()=>{o.value&&q(o.value)});const $=g(!1),M=()=>{$.value=!0},E=()=>{i.postMessage({type:"get-dg"})};F(()=>{N().then(s=>{i=s})});const O=()=>{i.postMessage({type:"refresh-var",data:Q(h.value)})};le(()=>h.value,()=>{O()},{deep:!0});const c=()=>{h.value.vars.push({name:"",type:"",defaultValue:""})},d=g([{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔",value:"boolean"},{label:"数组",value:"array"},{label:"对象",value:"object"}]),v=s=>{const a=h.value.vars.findIndex(C=>C.name===s.name);a!=-1&&h.value.vars.splice(a,1)},p=Ce(),n=()=>{U.value.id||xe.warning("请保存后再预览");const s=p.resolve({path:"/preview-dashboard",query:{id:U.value.id}});window.open(s.href,"_blank")};return window.addEventListener("message",s=>{s.data.type==="save"&&w(s.data.data)}),(s,a)=>{const C=ie,S=Z,k=re,z=we,P=Y,l=pe,R=X,x=se,de=he("loading");return u(),b(B,null,[ye((u(),b("div",tt,[e(z,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:t(()=>[e(C,{bordered:!1,class:"form-name",value:y(U).name,"onUpdate:value":a[0]||(a[0]=_=>y(U).name=_)},null,8,["value"])]),extra:t(()=>[e(k,null,{default:t(()=>[e(S,{type:"primary",onClick:a[1]||(a[1]=_=>M())},{default:t(()=>[I("变量池")]),_:1}),e(S,{class:"preview-btn",onClick:a[2]||(a[2]=_=>n())},{default:t(()=>[I(" 预览 ")]),_:1}),e(S,{onClick:a[3]||(a[3]=_=>E()),type:"primary",class:"save-btn"},{default:t(()=>[I(" 保存 ")]),_:1})]),_:1})]),_:1}),r("div",at,[e(Fe,{class:"left-part"}),lt,e(Ze,{class:"right-part"})])])),[[de,y(m),void 0,{fullscreen:!0}]]),e(x,{title:"变量池",open:$.value,"onUpdate:open":a[4]||(a[4]=_=>$.value=_),width:"800px",footer:null},{default:t(()=>[e(R,null,{default:t(()=>[r("div",ot,[(u(!0),b(B,null,T(y(h).vars,(_,me)=>(u(),W(k,{key:me,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[e(P,{label:"变量名",required:!0},{default:t(()=>[e(C,{value:_.name,"onUpdate:value":V=>_.name=V},null,8,["value","onUpdate:value"])]),_:2},1024),e(P,{label:"变量类型",required:!0},{default:t(()=>[e(l,{style:{width:"150px"},value:_.type,"onUpdate:value":V=>_.type=V,options:d.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(P,{label:"默认值",required:!0},{default:t(()=>[e(C,{value:_.defaultValue,"onUpdate:value":V=>_.defaultValue=V},null,8,["value","onUpdate:value"])]),_:2},1024),e(y(J),{onClick:V=>v(_)},null,8,["onClick"])]),_:2},1024))),128))]),e(P,null,{default:t(()=>[e(S,{type:"dashed",block:"",onClick:c},{default:t(()=>[e(y(j)),I(" 添加变量 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),ea=ee(nt,[["__scopeId","data-v-715b8aa8"]]);export{ea as default};
