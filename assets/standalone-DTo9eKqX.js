import"./iconfont-RswF9Ywb.js";import{f as $,r as l,t as q,v as x,g as D,s as M,x as E,o as h,y as I,l as V,w as R,i as f,A as T,k as z,h as O,B as N,C as k,D as j,E as Q,F as B,G as A,H as G,I as L,J as H,m as W,p as J,$ as F}from"./.pnpm-CEdUQ-90.js";import{c as P}from"./componentsSchema-gFhwa5FU.js";import{D as U,a as K}from"./DynamicLoader-Cm7fcES0.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X=$("dgDesign",()=>{const n=l({}),s=l([]),c=l({}),d=t=>{s.value.push(t)},g=t=>{const{id:e}=t,a=s.value.findIndex(i=>i.id===e);a!==-1&&s.value.splice(a,1)},p=t=>{const e=P.findIndex(i=>i.name===t);if(e===-1)throw new Error("组件不存在");const a=q(P[e]);return a.id=new Date().getTime().toString(),a},r=t=>{c.value=t,window.parent.postMessage({type:"select",data:x(t)},window.location.origin)},_=t=>{const{id:e}=t,a=s.value.findIndex(i=>i.id===e);a!==-1&&s.value.splice(a,1,t)},w=t=>new U(m.value).processObject(t),v=l({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),b=t=>{v.value=t,o()},m=l({}),y=t=>{const e={},a=(i,u)=>{switch(i){case"string":return u;case"number":return Number(u);case"boolean":return!!u;case"array":case"object":return JSON.parse(u);default:return u}};return t.reduce((i,u)=>(i[u.name]=a(u.type,u.defaultValue),i),e),e},o=()=>{m.value=y(v.value.vars)};return{dashboardData:n,add:d,remove:g,dgList:s,initDgItem:p,selectItem:r,curComp:c,updateItem:_,transformProps:w,updateVariables:o,setVarPools:b}}),Y=12,Z=8,tt=D({__name:"StandalonePage",setup(n){const s=X(),{dgList:c}=M(s),{initDgItem:d,add:g,selectItem:p,updateItem:r,transformProps:_,setVarPools:w}=s,v=l(),b=l(0),m=o=>{const t=o.dataTransfer.getData("material-type");let e;t=="custom"?e={name:o.dataTransfer.getData("material"),id:new Date().getTime().toString(),label:"自定义组件",icon:"",type:"custom",component:o.dataTransfer.getData("material"),props:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2}:e=d(o.dataTransfer.getData("material"));const a=o.x/(b.value/Y),i=o.y/Z;e.colStart=Math.floor(a),e.rowStart=Math.floor(i),g(e)},y=l({});return window.addEventListener("message",o=>{o.data.type==="refresh"?r(o.data.data):o.data.type==="add-custom-comp"?new K([o.data.data]).load().then(e=>{Object.keys(e).forEach(a=>{y.value[a]=e[a]})}):o.data.type==="refresh-var"&&w(o.data.data)}),E(()=>{b.value=v.value.clientWidth}),(o,t)=>{const e=z("grid-layout");return h(),I("div",{class:"container",ref_key:"container",ref:v,onDragover:t[0]||(t[0]=T(()=>{},["prevent","stop"])),onDrop:T(m,["stop"])},[V(e,{list:f(c),class:"layout","onItem:click":f(p)},{"layout-item":R(({item:a})=>[a.type&&a.type==="custom"?(h(),O(k(y.value[a.component]),N({key:0},f(_)(a.props),{style:a.style}),null,16,["style"])):(h(),O(k(a.component),{key:1,attrs:f(_)(a.props),"style-config":a.style},null,8,["attrs","style-config"]))]),_:1},8,["list","onItem:click"])],544)}}}),et=C(tt,[["__scopeId","data-v-652727a2"]]),at=D({__name:"QBChart",props:{attrs:{default:()=>({dataset:"",dimension:[],target:[]})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:c,styleConfig:d}=s,g=l(!0),p=l();let r;const _=l(0),w=l(""),v=l(),b=async()=>{w.value=c.dataset,v.value=[{title:"title1",value:100},{title:"title2",value:200},{title:"title3",value:300}]},m=()=>{const{dimension:t,target:e}=c,a=x(d.option),i=x(d.series),u=[];return e.forEach(ft=>{u.push(q(i))}),a.series=u,{...a,dataset:{source:x(v.value),dimensions:[...t,...e]}}},y=()=>{w.value!=c.dataset?b().then(()=>{r?(r.clear(),r.setOption(m())):p.value&&(r=Q(p.value),r.setOption(m()))}):r?(r.clear(),r.setOption(m())):p.value&&(r=Q(p.value),r.setOption(m())),g.value=!1},o=new ResizeObserver(t=>{_.value&&clearTimeout(_.value),_.value=window.setTimeout(()=>{try{r.resize()}catch(e){console.warn(`chart重新设置大小失败,失败原因：${e}`)}},50)});return E(()=>{y(),o.observe(p.value)}),j(()=>[s.attrs,s.styleConfig],()=>{y()},{deep:!0}),(t,e)=>(h(),I("div",{ref_key:"QBChart",ref:p,class:"qb-chart"},null,512))}}),st=C(at,[["__scopeId","data-v-996b3f25"]]),ot={class:"qb-iframe"},nt=["src"],rt=D({__name:"QBIframe",props:{attrs:{default:()=>({src:""})},preview:{type:Boolean,default:!1}},setup(n){const s=n,{attrs:c,preview:d}=B(s);return(g,p)=>(h(),I("div",ot,[A("iframe",{class:G(f(d)?"":"no-effect"),src:f(c).src,style:{width:"100%",height:"100%",border:"none"}},null,10,nt)]))}}),ct=C(rt,[["__scopeId","data-v-67323949"]]),it=["src"],lt=D({__name:"QBImage",props:{attrs:{default:()=>({src:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:c,styleConfig:d}=B(s);return(g,p)=>(h(),I("img",{class:"qb-image",style:L([{width:"100%",height:"100%"},f(d)]),src:f(c).src},null,12,it))}}),dt=C(lt,[["__scopeId","data-v-3b56b274"]]),pt=D({__name:"QBText",props:{attrs:{default:()=>({text:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:c}=B(s);return(d,g)=>(h(),I("div",{class:"qb-text",style:L(d.styleConfig)},H(f(c).text),5))}}),ut=C(pt,[["__scopeId","data-v-ad3a33fa"]]),mt=n=>{n.component("qb-chart",st),n.component("qb-iframe",ct),n.component("qb-image",dt),n.component("qb-text",ut)},S=W(et);S.use(J());S.use(mt);S.component("GridLayout",F);S.mount("#standalone-app");
