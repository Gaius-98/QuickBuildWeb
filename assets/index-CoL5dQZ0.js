import{d as k}from"./api--1jdstam.js";import{g as we,r as s,v as Ne,D as Se,W as Te,aw as $e,o as p,y as Y,l as o,w as u,J as c,n as C,i as v,b8 as qe,b9 as De,ba as Ue,T as Oe,bb as Ve,bc as ze,bd as Le,a3 as Be,b2 as Pe,U as Me,C as Ke,ac as Re,ad as je,b0 as Ae,Y as Ee,$ as G,B as r,O as Fe,M as X,ao as He,be as Je,h as m,F as Qe,a0 as I,ag as We,e as Z,aQ as Ye,a1 as Ge,b4 as Xe,a7 as Ze,aE as ea,b1 as aa,a5 as ta,a6 as oa,al as na,am as la}from"./.pnpm-BOQ5c3CP.js";import{a as y}from"./api-DbA2W66x.js";import{_ as sa}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ByGYGM65.js";const ua=f=>(na("data-v-a01996f5"),f=f(),la(),f),ia={class:"dataset-design"},da={class:"container"},ca={class:"left-part"},pa={class:"search-tree"},ra=["title"],ma={style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},va=ua(()=>c("span",{class:"iconfont icon-table"},null,-1)),_a={style:{width:"36px"}},ga={class:"right-part"},fa={class:"tools-area"},ya={class:"sql-area"},xa={class:"result"},ba=we({__name:"index",props:{type:{default:"add"},id:{},datasourceId:{},tableName:{}},setup(f){const O=s([]),V=s({}),z=s([]),ee=()=>{n.value.execSql=Ve(n.value.execSql,{language:"mysql"})},n=s({datasetName:"",datasourceId:"",execSql:"",status:"1",paramsConfig:[]}),ae=f,w=s(!1),{type:N,id:L,datasourceId:B,tableName:P}=Ne(ae),S=()=>{k.getTableInfo(n.value.datasourceId).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(O.value=l)}),k.getSchema(n.value.datasourceId).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(V.value=l,z.value=[ze({schema:V.value}),Le])})};n.value.datasetName=n.value.datasetName||"未命名",B.value&&(n.value.datasourceId=B.value,S(),P.value&&(n.value.execSql=`select * from ${P.value}`)),N.value==="edit"&&L.value&&y.getDetail(L.value).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(n.value=l,S())});const te=Se(()=>O.value.filter(t=>t.tableName.includes(T.value))),M=s([]),oe=()=>{let t;N.value=="add"?t=y.add:N.value=="edit"&&(t=y.update),t(n.value).then(e=>{const{code:l,data:i,msg:g}=e;l==200&&Z.success("保存成功")})},T=s("");Te(()=>{k.getList("").then(t=>{const{code:e,data:l}=t;e==200&&(M.value=l.data)})});const $=s(!1),K=s([]),q=s(!1),ne=s([{title:"字段名称",key:"columnName",dataIndex:"columnName",width:"200px"},{title:"字段类型",key:"columnType",dataIndex:"columnType",width:"200px"},{title:"字段注释",key:"columnComment",dataIndex:"columnComment",width:"200px"}]),R=s(""),le=t=>{q.value=!0,R.value=t,k.getColumnInfo(n.value.datasourceId,t).then(e=>{const{code:l,data:i}=e;q.value=!1,l==200&&(K.value=i)}),$.value=!0},se=$e(),ue=()=>{se.go(-1)},ie=()=>{Z.success("复制成功")},x=s([]),j=s([]),de=()=>{D.value="result",y.run(n.value).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(x.value=l,j.value=Object.keys(l[0]).map(g=>({title:g,key:g,dataIndex:g,ellipsis:!0,width:200})))})},ce=t=>{const{current:e,pageSize:l}=t;_.value.pageNumber=e,_.value.pageSize=l,F()},pe=t=>{t==="history"&&F()},_=s({keyword:n.value.datasourceId,pageSize:10,pageNumber:1}),A=s([]),E=s(0),re=s([{title:"执行sql",key:"execSql",dataIndex:"execSql",ellipsis:!0},{title:"耗时",key:"executionTime",dataIndex:"executionTime"},{title:"执行结果",key:"status",dataIndex:"status"}]),F=()=>{_.value.keyword=n.value.datasourceId,y.getLogList(_.value).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(A.value=l.data,E.value=l.total)})},D=s("result"),me=()=>{w.value=!0},ve=s([{title:"参数名",key:"paramsName",dataIndex:"paramsName"},{title:"参数类型",key:"paramsType",dataIndex:"paramsType"},{title:"参数默认值",key:"paramsDefaultValue",dataIndex:"paramsDefaultValue"},{title:"操作",key:"action",dataIndex:"action"}]),_e=()=>{let t=Ye();n.value.paramsConfig.push({id:t,paramsDefaultValue:"",paramsType:"string",paramsName:""})},ge=t=>{let e=n.value.paramsConfig.findIndex(l=>l.id==t.id);n.value.paramsConfig.splice(e,1)};return(t,e)=>{const l=Ge,i=Be,g=Xe,fe=Pe,H=Me,U=Ke,ye=Re,xe=je,b=Ze,be=ea,J=aa,Q=ta,he=Ae,W=Ee,ke=oa,Ce=G("copy"),Ie=G("has-perm");return p(),Y("div",ia,[o(fe,{style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"},onBack:e[2]||(e[2]=a=>ue())},{title:u(()=>[o(l,{value:n.value.datasetName,"onUpdate:value":e[0]||(e[0]=a=>n.value.datasetName=a),bordered:!1,class:"dataset-name"},null,8,["value"])]),extra:u(()=>[o(g,null,{default:u(()=>[o(i,{onClick:e[1]||(e[1]=a=>oe()),type:"primary",class:"save-btn"},{default:u(()=>[r(" 保存 ")]),_:1})]),_:1})]),_:1}),c("div",da,[c("div",ca,[c("div",pa,[o(H,{value:n.value.datasourceId,"onUpdate:value":e[3]||(e[3]=a=>n.value.datasourceId=a),options:M.value,fieldNames:{label:"datasourceName",value:"id"},style:{width:"100%"},onChange:e[4]||(e[4]=a=>S())},null,8,["value","options"]),o(U,{style:{margin:"8px 0"}}),o(ye,{value:T.value,"onUpdate:value":e[5]||(e[5]=a=>T.value=a),style:{"margin-bottom":"8px"},placeholder:"请输入表名称",allowClear:""},null,8,["value"]),o(xe,{"tree-data":te.value,selectable:"",fieldNames:{title:"tableName",key:"tableName",children:"children"},style:{height:"calc(100%)","overflow-y":"auto"}},{title:u(a=>[c("div",{style:{width:"200px",display:"flex","justify-content":"space-between"},title:a.tableName},[c("span",ma,[va,r(" "+Fe(a.tableName),1)]),c("span",_a,[X(o(v(He),{title:"复制表名",style:{cursor:"pointer","margin-right":"5px"},onClick:e[6]||(e[6]=d=>ie())},null,512),[[Ce,a.tableName]]),o(v(Je),{title:"查看字段信息",style:{cursor:"pointer"},onClick:d=>le(a.tableName)},null,8,["onClick"])])],8,ra)]),_:1},8,["tree-data"])])]),c("div",ga,[c("div",fa,[o(i,{onClick:e[7]||(e[7]=a=>de()),type:"text",icon:C(v(qe))},{default:u(()=>[r("运行")]),_:1},8,["icon"]),o(U,{type:"vertical"}),o(i,{onClick:e[8]||(e[8]=a=>ee()),type:"text",icon:C(v(De))},{default:u(()=>[r("美化")]),_:1},8,["icon"]),o(U,{type:"vertical"}),o(i,{onClick:e[9]||(e[9]=a=>me()),type:"text",icon:C(v(Ue))},{default:u(()=>[r("参数")]),_:1},8,["icon"])]),c("div",ya,[o(v(Oe),{style:{height:"350px"},"indent-with-tab":!0,"tab-size":2,extensions:z.value,modelValue:n.value.execSql,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.execSql=a)},null,8,["extensions","modelValue"])]),c("div",xa,[o(he,{activeKey:D.value,"onUpdate:activeKey":e[11]||(e[11]=a=>D.value=a),onChange:pe},{default:u(()=>[o(J,{key:"result",tab:"执行结果"},{default:u(()=>[x.value&&x.value.length>0?(p(),m(b,{key:0,style:{width:"100%"},size:"small",scroll:{x:"max-content",y:"280px"},"data-source":x.value,columns:j.value},null,8,["data-source","columns"])):(p(),m(be,{key:1}))]),_:1}),o(J,{key:"history",tab:"历史记录"},{default:u(()=>[o(b,{scroll:{y:"280px"},size:"small","data-source":A.value,columns:re.value,onChange:ce,pagination:{current:_.value.pageNumber,total:E.value,showSizeChanger:!1,pageSize:_.value.pageSize}},{bodyCell:u(({column:a,record:d})=>[a.key=="status"?(p(),Y(Qe,{key:0},[d.status=="1"?(p(),m(Q,{key:0,color:"#87d068"},{default:u(()=>[r("成功")]),_:1})):(p(),m(Q,{key:1,color:"#f50"},{default:u(()=>[r("失败")]),_:1}))],64)):I("",!0)]),_:1},8,["data-source","columns","pagination"])]),_:1})]),_:1},8,["activeKey"])])])]),o(W,{width:"600px",title:`${R.value}字段明细`,footer:null,open:$.value,"onUpdate:open":e[12]||(e[12]=a=>$.value=a)},{default:u(()=>[o(b,{size:"small",class:"ant-table-striped","data-source":K.value,columns:ne.value,loading:q.value,"row-class-name":(a,d)=>d%2===1?"table-striped":null,pagination:!1,scroll:{x:"auto",y:"500px"}},null,8,["data-source","columns","loading","row-class-name"])]),_:1},8,["title","open"]),o(W,{title:"参数配置",open:w.value,"onUpdate:open":e[14]||(e[14]=a=>w.value=a),width:"800px",height:"400px",footer:null},{default:u(()=>[o(i,{type:"primary",style:{"margin-bottom":"5px"},onClick:e[13]||(e[13]=a=>_e()),icon:C(v(We))},{default:u(()=>[r("新增")]),_:1},8,["icon"]),o(b,{columns:ve.value,"data-source":n.value.paramsConfig,scroll:{y:"300px"},pagination:!1},{bodyCell:u(({column:a,record:d})=>[["paramsName","paramsDefaultValue"].includes(a.key)?(p(),m(l,{key:0,value:d[a.dataIndex],"onUpdate:value":h=>d[a.dataIndex]=h},null,8,["value","onUpdate:value"])):I("",!0),a.key=="paramsType"?(p(),m(H,{key:1,style:{width:"100%"},value:d[a.dataIndex],"onUpdate:value":h=>d[a.dataIndex]=h,options:[{label:"字符串",value:"string"}]},null,8,["value","onUpdate:value"])):I("",!0),a.key=="action"?(p(),m(ke,{key:2,title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:h=>ge(d)},{default:u(()=>[X((p(),m(i,{type:"link",danger:""},{default:u(()=>[r("删除")]),_:1})),[[Ie,"system:user:remove"]])]),_:2},1032,["onConfirm"])):I("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open"])])}}}),Na=sa(ba,[["__scopeId","data-v-a01996f5"]]);export{Na as default};
