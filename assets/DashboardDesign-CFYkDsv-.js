import{_ as pe}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-BCThQXKz.js";import{c as ce}from"./componentsSchema-LhIlCAWr.js";import{k as me,r as g,Q as ee,a as te,d as j,s as G,p as H,q as x,v as p,e,P as V,X as O,O as I,u as k,ak as B,a2 as oe,w as a,m as ve,t as J,G as _e,H as ae,a3 as Q,a4 as X,a5 as ne,bh as F,U as K,b5 as se,ap as ie,aq as ue,o as f,b1 as fe,b2 as be,c as W,a8 as ge,aG as ye,W as de,D as he,b3 as Ce}from"./.pnpm-CfU0UuIO.js";import{d as A}from"./dashboard-BYoCnmZ2.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as xe}from"./ConfigForm.vue_vue_type_script_setup_true_lang-DqGk-l79.js";import{S as Se}from"./SchemaForm-DDOsGbfj.js";import{c as z}from"./iconfont-BqmojAhN.js";import"./tools-BCD5ohFr.js";/* empty css                   */const Z=me("dashboardDesign",()=>{const c=g([]),w=r=>{c.value.push(r)},S=ee(()=>{const r={};return c.value.map(l=>{l.children.forEach(y=>{r[y.componentName]=y.schema})}),r}),q=ee(()=>{let r=[];return c.value.forEach(l=>{const y=l.children.map(h=>({label:h.componentName,value:h.exportName}));r=r.concat(y)}),r}),d=g({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),i=()=>document.querySelector(".standalone-iframe").contentWindow,v=g({list:[],customModules:[],varPools:{datasets:[],vars:[]},img:"",name:"未命名仪表板",id:""});return{customModules:c,customCompSchema:S,onAddModules:w,customComps:q,varPools:d,getContentWindow:i,onSave:r=>{v.value.list=r.list,v.value.img=r.img,v.value.customModules=c.value,v.value.varPools=d.value,(v.value.id?A.update:A.add)(v.value).then(y=>{const{code:h,data:$,msg:L}=y;h==200?te.success("保存成功"):te.error("保存失败")})},dgInfo:v,getDetail:r=>{A.getDetail(r).then(l=>{const{code:y,data:h,msg:$}=l;y==200&&(v.value=h)})}}}),re=c=>(ie("data-v-63b2d937"),c=c(),ue(),c),ke={class:"material-area"},we={class:"material-layout-area"},De=re(()=>p("div",{class:"title"},"内置组件",-1)),Ue={class:"content"},Ne=["data-material"],qe={class:"material-label"},Me={class:"material-data-area"},Ie=re(()=>p("div",{class:"title"},"自定义组件",-1)),$e={class:"content"},Le=["data-material"],Pe={style:{height:"650px"}},Ve={style:{height:"80px","overflow-y":"auto"}},Ee={style:{height:"200px","overflow-y":"auto"}},Oe=j({__name:"MaterialArea",setup(c){const w=Z(),{customModules:S,customComps:q}=G(w),{onAddModules:d}=w,i=g({internalComp:ce,customComp:[]}),v=n=>{var u,s;const o=n.target;(u=n.dataTransfer)==null||u.setData("material",o.dataset.material),(s=n.dataTransfer)==null||s.setData("material-type",o.dataset.materialType)},D=g(!1),M=()=>{D.value=!0,l.value=ve(r.value)},r=g({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElEmpty",exportName:"ElEmpty",id:"1",schema:`{
    "description": {
        "type": "input",
        "label": "描述"
    }

      }`}]}),l=g({}),y=()=>{D.value=!1},h=()=>{d(l.value),i.value.customComp=i.value.customComp.concat(q.value),m==null||m.postMessage({type:"add-custom-comp",data:J(l.value)}),y()},$=()=>{l.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},L=n=>{const o=l.value.children.findIndex(u=>u.id==n.id);o!=-1&&l.value.children.splice(o,1)},C=()=>{l.value.urls.push("")},_=n=>{const o=l.value.urls.findIndex(u=>u==n);o!=-1&&l.value.urls.splice(o,1)};let m=null;return H(()=>{m=document.querySelector(".standalone-iframe").contentWindow}),(n,o)=>{const u=ne,s=X,P=K,U=se,N=pe,R=Q,T=oe;return f(),x("div",ke,[p("div",we,[De,p("div",Ue,[(f(!0),x(V,null,O(i.value.internalComp,t=>(f(),x("div",{key:t.name,draggable:"true",onDragstart:v,"data-material":t.name,"data-material-type":"internal",class:"material-item"},[p("span",{class:_e(["iconfont material-icon",t.icon])},null,2),p("span",qe,ae(t.label),1)],40,Ne))),128))])]),p("div",Me,[Ie,p("div",$e,[(f(!0),x(V,null,O(i.value.customComp,t=>(f(),x("div",{type:"dashed",key:t.value,draggable:"true",onDragstart:v,"data-material":t.value,"data-material-type":"custom",class:"material-item"},ae(t.label),41,Le))),128)),p("div",{type:"dashed",onClick:M,class:"material-item"},[p("span",null,[e(k(B)),I(" 添加组件 ")])])])]),e(T,{title:"添加自定义组件",width:"800px",open:D.value,"onUpdate:open":o[4]||(o[4]=t=>D.value=t),onOk:h,onCancel:y},{default:a(()=>[p("div",Pe,[e(R,{model:l.value,"label-col":{style:{width:"150px"}}},{default:a(()=>[e(s,{label:"名称"},{default:a(()=>[e(u,{value:l.value.title,"onUpdate:value":o[0]||(o[0]=t=>l.value.title=t)},null,8,["value"])]),_:1}),e(s,{label:"组件库名称"},{default:a(()=>[e(u,{value:l.value.package,"onUpdate:value":o[1]||(o[1]=t=>l.value.package=t)},null,8,["value"])]),_:1}),e(s,{label:"版本"},{default:a(()=>[e(u,{value:l.value.version,"onUpdate:value":o[2]||(o[2]=t=>l.value.version=t)},null,8,["value"])]),_:1}),e(s,{label:"导出名称"},{default:a(()=>[e(u,{value:l.value.exportName,"onUpdate:value":o[3]||(o[3]=t=>l.value.exportName=t)},null,8,["value"])]),_:1}),e(s,{label:"CDN地址"},{default:a(()=>[p("div",Ve,[(f(!0),x(V,null,O(l.value.urls,(t,E)=>(f(),x("div",{key:t,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(u,{value:l.value.urls[E],"onUpdate:value":b=>l.value.urls[E]=b},null,8,["value","onUpdate:value"]),e(k(F),{onClick:b=>_(t),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(s,null,{default:a(()=>[e(P,{type:"dashed",block:"",onClick:C},{default:a(()=>[e(k(B)),I(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(s,{label:"子组件"},{default:a(()=>[p("div",Ee,[(f(!0),x(V,null,O(l.value.children,(t,E)=>(f(),x("div",{key:t.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(U,null,{default:a(()=>[p("div",null,[e(U,null,{default:a(()=>[e(s,{label:"组件名",rules:{required:!0}},{default:a(()=>[e(u,{value:t.componentName,"onUpdate:value":b=>t.componentName=b},null,8,["value","onUpdate:value"])]),_:2},1024),e(s,{label:"导出名称",rules:{required:!0}},{default:a(()=>[e(u,{value:t.exportName,"onUpdate:value":b=>t.exportName=b},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(s,{label:"配置Schema",rules:{required:!0}},{default:a(()=>[e(N,{value:t.schema,"onUpdate:value":b=>t.schema=b,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(k(F),{onClick:b=>L(t)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(s,null,{default:a(()=>[e(P,{type:"dashed",block:"",onClick:$},{default:a(()=>[e(k(B)),I(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),We=Y(Oe,[["__scopeId","data-v-63b2d937"]]),Be={text:{type:"input",label:"文本内容"}},Re={src:{type:"input",label:"图片地址"}},Te={src:{type:"input",label:"页面地址"}},Ae=c=>({dataset:{type:"select",label:"数据集",options:c},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),ze={"qb-text":Be,"qb-image":Re,"qb-iframe":Te,"qb-chart":Ae},Fe={title1:{type:"divider",label:"标题",component:{title:"标题"},formLayout:!1},"option.title.show":{type:"switch",label:"显示标题"},"option.title.text":{type:"string",label:"标题文本"},"option.title.link":{type:"string",label:"文本超链接"},title2:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},"option.grid.left":{type:"string",label:"左边距"},"option.grid.right":{type:"string",label:"右边距"},"option.grid.top":{type:"string",label:"上边距"},"option.grid.bottom":{type:"string",label:"下边距"},title3:{type:"divider",label:"图例",component:{title:"图例"},formLayout:!1},"option.legend.show":{type:"switch",label:"显示图例"},"option.legend.type":{type:"select",label:"图例类型",component:{dataSource:[{label:"普通图例",value:"plain"},{label:"翻页图例",value:"scroll"}]}},"option.legend.orient":{type:"select",label:"图例朝向",component:{dataSource:[{value:"horizontal",label:"横向"},{value:"vertical",label:"纵向"}]}},title4:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},le={title1:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},paddingLeft:{type:"string",label:"左边距",tooltip:"请注明单位，一般为：px"},paddingTop:{type:"string",label:"上边距",tooltip:"请注明单位，一般为：px"},paddingRight:{type:"string",label:"右边距",tooltip:"请注明单位，一般为：px"},paddingBottom:{type:"string",label:"下边距",tooltip:"请注明单位，一般为：px"},title2:{type:"divider",label:"背景",component:{title:"背景"},formLayout:!1},backgroundColor:{type:"string",label:"背景色",component:{name:"color-picker"}},title3:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},je={class:"material-cfg"},Ge={class:"material-cfg-btn"},He=j({__name:"MaterialCfg",setup(c){const w=Z(),{customCompSchema:S}=G(w),{getContentWindow:q}=w,d=g({}),i=g({}),v=g({}),D=g({}),M=g({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"100px"}}},properties:le}),r=g([]);z.getDatasetDict().then(C=>{const{code:_,data:m,msg:n}=C;_==200&&(r.value=m)});const l=g([]),y=()=>{d.value.dimension=[],d.value.target=[],z.getFieldByDatasetId(d.value.dataset).then(C=>{const{code:_,data:m,msg:n}=C;_==200&&(l.value=m.map(o=>({value:o,label:o})))})};window.addEventListener("message",C=>{var _;(C.data.type==="select"||C.data.type==="update-item")&&(M.value.properties=le,i.value=C.data.data,((_=i.value)==null?void 0:_.type)==="custom"?S.value&&(v.value=JSON.parse(S.value[i.value.component])):i.value.component=="qb-chart"?M.value.properties=Fe:v.value=ze[i.value.component],d.value=i.value.props,i.value.component=="qb-chart"&&z.getFieldByDatasetId(d.value.dataset).then(m=>{const{code:n,data:o,msg:u}=m;n==200&&(l.value=o.map(s=>({value:s,label:s})))}),D.value=i.value.style)});let h=null;const $=C=>{if(h)h.postMessage({type:"refresh",data:C});else throw new Error("contentWindow is null")},L=()=>{$(J(i.value))};return H(()=>{h=q()}),(C,_)=>{const m=ye,n=de,o=X,u=Q,s=be,P=fe,U=K;return f(),x("div",je,[e(P,{size:"small"},{default:a(()=>[e(s,{key:"prop",tab:"属性"},{default:a(()=>[i.value.id?i.value.component!="qb-chart"?(f(),W(xe,{class:"material-cfg-contain",key:i.value.id,data:d.value,schema:v.value},null,8,["data","schema"])):i.value.component=="qb-chart"?(f(),W(u,{key:2},{default:a(()=>[e(o,{label:"数据集"},{default:a(()=>[e(n,{value:d.value.dataset,"onUpdate:value":_[0]||(_[0]=N=>d.value.dataset=N),options:r.value,onChange:y},null,8,["value","options"])]),_:1}),e(o,{label:"维度"},{default:a(()=>[e(n,{value:d.value.dimension,"onUpdate:value":_[1]||(_[1]=N=>d.value.dimension=N),options:l.value,mode:"tags"},null,8,["value","options"])]),_:1}),e(o,{label:"指标"},{default:a(()=>[e(n,{value:d.value.target,"onUpdate:value":_[2]||(_[2]=N=>d.value.target=N),options:l.value,mode:"tags"},null,8,["value","options"])]),_:1})]),_:1})):ge("",!0):(f(),W(m,{key:0}))]),_:1}),e(s,{key:"style",tab:"样式"},{default:a(()=>[(f(),W(k(Se),{schema:M.value,size:"small",formData:D.value,key:i.value.id},null,8,["schema","formData"]))]),_:1})]),_:1}),p("div",Ge,[e(U,{onClick:L,disabled:!i.value.id},{default:a(()=>[I("刷新")]),_:1},8,["disabled"])])])}}}),Je=Y(He,[["__scopeId","data-v-62cb8f46"]]),Qe=c=>(ie("data-v-69fb2488"),c=c(),ue(),c),Xe={class:"dg-design"},Ke={class:"dg-design-container"},Ye=Qe(()=>p("div",{class:"middle-part"},[p("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),Ze={style:{height:"300px","overflow-y":"auto"}},et=j({__name:"DashboardDesign",props:{id:{}},setup(c){const w=Z(),{varPools:S,dgInfo:q}=G(w);let d;const{getContentWindow:i,onSave:v,getDetail:D}=w;window.name="dg-design";const M=c,{id:r}=he(M);r.value&&D(r.value);const l=g(!1),y=()=>{l.value=!0},h=()=>{d.postMessage({type:"get-dg"})};H(()=>{d=i()});const $=()=>{d.postMessage({type:"refresh-var",data:J(S.value)})},L=()=>{S.value.vars.push({name:"",type:"",defaultValue:""})},C=g([{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔",value:"boolean"},{label:"数组",value:"array"},{label:"对象",value:"object"}]),_=m=>{const n=S.value.vars.findIndex(o=>o.name===m.name);n!=-1&&S.value.vars.splice(n,1)};return window.addEventListener("message",m=>{m.data.type==="save"&&v(m.data.data)}),(m,n)=>{const o=ne,u=se,s=K,P=Ce,U=X,N=de,R=Q,T=oe;return f(),x(V,null,[p("div",Xe,[e(P,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[e(o,{bordered:!1,class:"form-name",value:k(q).name,"onUpdate:value":n[0]||(n[0]=t=>k(q).name=t)},null,8,["value"])]),extra:a(()=>[e(u),e(u),e(u,null,{default:a(()=>[e(s,{type:"primary",onClick:n[1]||(n[1]=t=>y())},{default:a(()=>[I("变量池")]),_:1}),e(s,{class:"preview-btn"},{default:a(()=>[I(" 预览 ")]),_:1}),e(s,{onClick:n[2]||(n[2]=t=>h()),type:"primary",class:"save-btn"},{default:a(()=>[I(" 保存 ")]),_:1})]),_:1})]),_:1}),p("div",Ke,[e(We,{class:"left-part"}),Ye,e(Je,{class:"right-part"})])]),e(T,{title:"变量池",open:l.value,"onUpdate:open":n[3]||(n[3]=t=>l.value=t),width:"800px",footer:null,onCancel:$},{default:a(()=>[e(R,null,{default:a(()=>[p("div",Ze,[(f(!0),x(V,null,O(k(S).vars,(t,E)=>(f(),W(u,{key:E,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:a(()=>[e(U,{label:"变量名",required:!0},{default:a(()=>[e(o,{value:t.name,"onUpdate:value":b=>t.name=b},null,8,["value","onUpdate:value"])]),_:2},1024),e(U,{label:"变量类型",required:!0},{default:a(()=>[e(N,{style:{width:"150px"},value:t.type,"onUpdate:value":b=>t.type=b,options:C.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(U,{label:"默认值",required:!0},{default:a(()=>[e(o,{value:t.defaultValue,"onUpdate:value":b=>t.defaultValue=b},null,8,["value","onUpdate:value"])]),_:2},1024),e(k(F),{onClick:b=>_(t)},null,8,["onClick"])]),_:2},1024))),128))]),e(U,null,{default:a(()=>[e(s,{type:"dashed",block:"",onClick:L},{default:a(()=>[e(k(B)),I(" 添加变量 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),pt=Y(et,[["__scopeId","data-v-69fb2488"]]);export{pt as default};
