import{ba as Se,f as De,r as _,aV as $e,g as A,s as E,v as Y,o as r,B as C,l as t,i as e,aG as Re,E as S,F as O,w as a,aJ as Ne,b1 as ie,I as Be,aO as ue,a9 as K,L as de,H as U,W as J,bb as Q,aj as X,J as B,bc as Te,bd as Ae,a3 as G,h as T,ah as Fe,t as le,x as Oe,be as Le,aE as Pe,P as Ve,C as Ue,b4 as ae,b7 as Ee,O as ze,a2 as Me,bf as se,bg as We,bh as He,a4 as je,Y as qe,a5 as Ge,a6 as Je,b9 as Qe,a$ as Ye,ab as Ke,ac as Xe,a7 as Ze}from"./.pnpm-Dxr3w8Wl.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as V}from"./index-CqFB-q-G.js";import{S as re}from"./SchemaForm-D0X6zbl5.js";/* empty css                   */const et=new Se,z=et,L=De("tableDesign",()=>{const I=_([]),u=_({name:"",description:"",status:1,columns:[],global:{bordered:!1},datasource:{tableName:"",sourceId:""},filter:{show:!0,widgetList:[]},action:[]}),s=_([]),l=_({}),g=()=>{const i=new Date().getTime().toString().slice(-4);u.value.columns,u.value.columns.push({id:$e(),dataIndex:"field"+i,title:"列"+i,width:200})},v=(i,c)=>{const w=c.findIndex(F=>F.id===i);w!=-1&&(l.value=c[w])},h=(i,c)=>{const w=c.findIndex(F=>F.id===i);w!=-1&&c.splice(w,1)},D=i=>{u.value.action.push({id:new Date().getTime().toString(),name:"测试",position:i,eventFlowId:""})},b=i=>{const c=u.value.action.findIndex(w=>w.id==i);c!=-1&&u.value.action.splice(c,1)},y=i=>{const c=u.value.filter.widgetList.findIndex(w=>w.id==i);c!=-1&&u.value.filter.widgetList.splice(c,1)},R=async i=>{},x=_(!1);return{tableCfg:u,currentColumn:l,onSelectColumn:v,onRemoveColumn:h,onAddColumn:g,tableData:I,onRefreshData:R,saveLoading:x,onSave:async()=>{x.value=!0,setTimeout(()=>{u.value,x.value=!1},2e3)},columnFields:s,onSetColumns:i=>{s.value=i},onAddBtn:D,onRemoveBtn:b,onRemoveWidget:y}}),tt={class:"custom-header-label",style:{flex:"1"}},ot=A({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(I,{emit:u}){const s=L(),{currentColumn:l}=E(s),g=I,{params:v}=Y(g),h=()=>{z.onPublish("removeEvent",v.value)};return(D,b)=>{const y=K;return r(),C("div",{class:Be(["custom-header-item",e(l).dataIndex==e(v).column.getColId()?"active":""]),style:ue([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:e(l).dataIndex==e(v).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[t(e(Re),{class:"move",style:{width:"20px",cursor:"move"}}),S("div",tt,O(e(v).displayName),1),t(y,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:b[0]||(b[0]=R=>h())},{default:a(()=>[t(e(Ne),{class:"remove",style:{width:"20px"},onClick:ie(()=>{},["stop"])})]),_:1})],6)}}}),nt={class:"custom-opt-cell"},lt=["onClick"],at=A({__name:"CustomOptCell",setup(I){const u=L(),{tableCfg:s}=E(u),l=de(()=>{var b;return(b=s.value.action)==null?void 0:b.filter(y=>y.position=="row")}),{onAddBtn:g,onRemoveBtn:v}=u,h=b=>{z.onPublish("open-btn-modal",b)},D=()=>{g("row")};return(b,y)=>{const R=K;return r(),C("div",nt,[(r(!0),C(U,null,J(l.value,x=>(r(),C("div",{class:"btn",key:x.id},[S("a",{onClick:d=>h(x)},O(x.name),9,lt),t(R,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:d=>e(v)(x.id)},{default:a(()=>[t(e(Q),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),t(e(X),{style:{cursor:"pointer"},onClick:y[0]||(y[0]=x=>D())})])}}}),st={class:"custom-header-label",style:{flex:"1"}},it=A({__name:"CustomAddColumn",setup(I){const u=L(),{onAddColumn:s}=u;return(l,g)=>{const v=Ae;return r(),C("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:g[0]||(g[0]=h=>e(s)())},[S("div",st,[t(e(X)),B(" 新增列 "),t(v,null,{title:a(()=>[B("用于新增列配置")]),default:a(()=>[t(e(Te))]),_:1})])])}}}),ut={class:"cell"},dt={key:0},ct=["href"],rt=A({__name:"CustomCellRender",props:{params:{}},setup(I){const u=I,{params:s}=Y(u);return(l,g)=>{const v=Fe;return r(),C("div",ut,[e(s).colDef.cellRendererParams.type=="text"?(r(),C("span",dt,O(e(s).value),1)):G("",!0),e(s).colDef.cellRendererParams.type=="image"?(r(),T(v,{key:1,src:e(s).value},null,8,["src"])):G("",!0),e(s).colDef.cellRendererParams.type=="link"?(r(),C("a",{key:2,href:e(s).value},O(e(s).value),9,ct)):G("",!0)])}}}),mt=A({__name:"AgTable",props:le({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:le(["onRemove","onClick"],["update:columns"]),setup(I,{emit:u}){z.onSubscribe("removeEvent",d=>{let p=d.column.getColId(),i=s.value.find(c=>c.dataIndex==p);i&&R(i)});const s=Oe(I,"columns"),l=I,{columnId:g,tableData:v}=Y(l),h=de(()=>{let d=s.value.map(p=>({field:p.dataIndex,colId:p.dataIndex,headerName:p.title,pinned:p.fixed=="none"?void 0:p.fixed,lockVisible:!0,headerComponent:ot,cellRenderer:rt,cellRendererParams:{type:p.type}}));return d.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:it}),d.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:at}),d}),D=d=>{if(!d.finished)return;let p=[];d.api.getColumnState().forEach(i=>{let c=s.value.find(w=>w.dataIndex==i.colId);c&&p.push(c)}),s.value=p},b=d=>{if(!d.finished)return;let p=d.column.getColId(),i=s.value.findIndex(c=>c.dataIndex==p);i!=-1&&(s.value[i].width=d.column.getActualWidth())},y=u,R=d=>{y("onRemove",d)},x=d=>{let p=d.column.getId(),i=s.value.find(c=>c.dataIndex==p);y("onClick",i)};return(d,p)=>(r(),T(e(Le),{rowData:e(v),columnDefs:h.value,style:ue({height:d.height+"px"}),class:"ag-theme-quartz",onColumnMoved:D,onColumnResized:b,onColumnHeaderClicked:x},null,8,["rowData","columnDefs","style"]))}}),pt=ce(mt,[["__scopeId","data-v-5dd2184c"]]),vt=A({__name:"TableCfg",setup(I){const u=L(),{tableCfg:s,columnFields:l,currentColumn:g}=E(u),v=_({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:async()=>await new Promise(D=>{setTimeout(()=>{D(l.value)},100)})}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),h=_();return Pe(()=>g.value,()=>{h.value.refreshOption("dataIndex")}),(D,b)=>(r(),T(e(re),{formData:e(g),schema:v.value,ref_key:"schemaRef",ref:h,size:"small"},null,8,["formData","schema"]))}}),ft={class:"table-design"},_t={class:"table-design-container"},bt={class:"main-part"},gt={class:"filter-part"},Ct={class:"filter-container"},ht=["onClick"],yt={class:"add widget-item"},xt={class:"tools-part"},wt={class:"tools-container"},kt={class:"add button-item"},It={class:"table-part"},St=A({__name:"TableDesign",setup(I){z.onSubscribe("open-btn-modal",m=>{ee(m)});const u=_([]);Ve(()=>{V.getDataSourceDict().then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(u.value=k)})});const s=L(),{tableCfg:l,columnFields:g,saveLoading:v}=E(s),{onSelectColumn:h,onRemoveBtn:D,onRemoveColumn:b,onSetColumns:y,onRemoveWidget:R,onAddBtn:x,onSave:d}=s;window.name="table-design";const p=()=>{var m;(m=l.value.filter.widgetList)==null||m.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},i=()=>{window.open("/lowcode/table","quick-build")},c=m=>{h(m.id,l.value.columns),H.value=!0},w=m=>{b(m.id,l.value.columns)};_([]);const F=_([]),me=()=>{V.getSourceData(l.value.datasource.sourceId,l.value.datasource.tableName).then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(F.value=k)})},Z=_([]),pe=()=>{V.getTableInfo(l.value.datasource.sourceId).then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(Z.value=k)})},ve=()=>{V.getColumnInfo(l.value.datasource.sourceId,l.value.datasource.tableName).then(m=>{const{code:o,data:k,msg:N}=m;o==200&&(l.value.columns=k.map(f=>({dataIndex:f.columnName,title:f.columnComment||f.columnName,id:f.columnName,width:200,type:"text",align:"left",fixed:"none"})),y(k.map(f=>({label:f.columnComment?`${f.columnComment}(${f.columnName})`:f.columnName,value:f.columnName}))))}),me()},fe=()=>{x("header")},$=_({id:"",name:"",eventFlowId:"",position:"header"}),M=_(!1),_e=_([{label:"默认新增事件流",value:"add"},{label:"默认编辑事件流",value:"edit"},{label:"默认批量编辑事件流",value:"batchEdit"}]),ee=m=>{$.value=m,M.value=!0},be=()=>{},te=_({}),W=_(!1),ge=_({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"string",label:"字段名称"},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",show:'"${formData.type}" == "select"'},defaultValue:{type:"string",label:"默认值"}}}),Ce=m=>{te.value=m,W.value=!0},H=_(!1);return(m,o)=>{const k=je,N=qe,f=Ge,P=Je,he=Qe,ye=Ee,xe=Ye,oe=K,ne=Ke,we=Xe,ke=Ze,j=ze,Ie=Me("loading");return r(),C(U,null,[Ue((r(),C("div",ft,[t(ye,{onBack:i,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:a(()=>[t(k,{value:e(l).name,"onUpdate:value":o[0]||(o[0]=n=>e(l).name=n),bordered:!1,class:"table-name"},null,8,["value"])]),extra:a(()=>[t(he,{class:"extra"},{default:a(()=>[t(f,{label:"选择数据源"},{default:a(()=>[t(N,{value:e(l).datasource.sourceId,"onUpdate:value":o[1]||(o[1]=n=>e(l).datasource.sourceId=n),options:u.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:o[2]||(o[2]=n=>pe())},null,8,["value","options"])]),_:1}),t(f,{label:"选择表名"},{default:a(()=>[t(N,{value:e(l).datasource.tableName,"onUpdate:value":o[3]||(o[3]=n=>e(l).datasource.tableName=n),options:Z.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:o[4]||(o[4]=n=>ve())},null,8,["value","options"])]),_:1}),t(P,{onClick:o[5]||(o[5]=n=>e(d)()),type:"primary",class:"save-btn"},{default:a(()=>[B(" 保存 ")]),_:1})]),_:1})]),_:1}),S("div",_t,[S("div",bt,[S("div",gt,[S("div",Ct,[t(e(ae),{list:e(l).filter.widgetList,"onUpdate:list":o[7]||(o[7]=n=>e(l).filter.widgetList=n),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(r(!0),C(U,null,J(e(l).filter.widgetList,n=>(r(),C("div",{class:"widget-item",key:n.id,onClick:q=>Ce(n)},[t(e(se),{class:"move-handle",style:{cursor:"pointer"}}),t(f,{label:n.label,name:n.field},{default:a(()=>[n.type=="input"?(r(),T(k,{key:0})):n.type=="select"?(r(),T(N,{key:1})):(r(),T(xe,{key:2}))]),_:2},1032,["label","name"]),t(oe,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:q=>e(R)(n.id)},{default:a(()=>[t(e(Q),{class:"remove-btn",onClick:ie(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,ht))),128)),S("div",yt,[t(P,{type:"primary",onClick:o[6]||(o[6]=n=>p())},{default:a(()=>[B(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),S("div",xt,[S("div",wt,[t(e(ae),{list:e(l).action,"onUpdate:list":o[9]||(o[9]=n=>e(l).action=n),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:a(()=>[(r(!0),C(U,null,J(e(l).action.filter(n=>n.position=="header"),n=>(r(),C("div",{class:"button-item",key:n.id},[t(e(se),{class:"move-handle",style:{cursor:"pointer"}}),t(P,{onClick:q=>ee(n)},{default:a(()=>[B(O(n.name),1)]),_:2},1032,["onClick"]),t(oe,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:q=>e(D)(n.id)},{default:a(()=>[t(e(Q),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),S("div",kt,[t(P,{type:"primary",onClick:o[8]||(o[8]=n=>fe())},{default:a(()=>[B(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),S("div",It,[t(pt,{columns:e(l).columns,"onUpdate:columns":o[10]||(o[10]=n=>e(l).columns=n),tableData:F.value,height:550,onOnRemove:w,onOnClick:c},null,8,["columns","tableData"])])])])])),[[Ie,e(v),void 0,{fullscreen:!0}]]),t(j,{title:"按钮配置",placement:"right",closable:!1,open:M.value,onClose:o[16]||(o[16]=n=>M.value=!1)},{default:a(()=>[t(ke,{model:$.value},{default:a(()=>[t(f,{prop:"id",label:"按钮标识"},{default:a(()=>[t(k,{value:$.value.id,"onUpdate:value":o[11]||(o[11]=n=>$.value.id=n)},null,8,["value"])]),_:1}),t(f,{prop:"name",label:"按钮名称"},{default:a(()=>[t(k,{value:$.value.name,"onUpdate:value":o[12]||(o[12]=n=>$.value.name=n)},null,8,["value"])]),_:1}),t(f,{prop:"name",label:"按钮位置"},{default:a(()=>[t(we,{value:$.value.position,"onUpdate:value":o[13]||(o[13]=n=>$.value.position=n),"button-style":"solid"},{default:a(()=>[t(ne,{value:"header"},{default:a(()=>[B("表头")]),_:1}),t(ne,{value:"row"},{default:a(()=>[B("行内")]),_:1})]),_:1},8,["value"])]),_:1}),t(f,{prop:"event",label:"事件流"},{default:a(()=>[t(N,{value:$.value.eventFlowId,"onUpdate:value":o[15]||(o[15]=n=>$.value.eventFlowId=n),options:_e.value},{suffixIcon:a(()=>[t(e(We),{style:{color:"#000"},title:"刷新"}),$.value.eventFlowId?(r(),T(e(He),{key:0,onClick:o[14]||(o[14]=n=>be()),style:{color:"#000"},title:"编辑事件流"})):(r(),T(e(X),{key:1,style:{color:"#000"},title:"新增事件流"}))]),_:1},8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),t(j,{title:"筛选控件配置",placement:"right",closable:!1,open:W.value,onClose:o[17]||(o[17]=n=>W.value=!1)},{default:a(()=>[t(e(re),{formData:te.value,schema:ge.value},null,8,["formData","schema"])]),_:1},8,["open"]),t(j,{title:"列配置",placement:"right",closable:!1,open:H.value,onClose:o[18]||(o[18]=n=>H.value=!1)},{default:a(()=>[t(vt)]),_:1},8,["open"])],64)}}}),Tt=ce(St,[["__scopeId","data-v-77f28132"]]);export{Tt as default};
