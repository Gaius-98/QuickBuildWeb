import{c as V}from"./iconfont-DbxD-LdR.js";import{k as N,r as c,m as $,t as C,n as j,d as x,s as A,p as z,b as G,q as B,o as I,e as H,w as W,v as R,x as k,c as L,y as q,z as U,A as F,u as g,B as Q,D as O,E as J,F as E,G as K,H as X,g as Y,i as Z,$ as tt}from"./.pnpm-CfU0UuIO.js";import{c as M}from"./componentsSchema-LhIlCAWr.js";import{D as et,a as at}from"./DynamicLoader-Cyfdo3j3.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st=N("dgDesign",()=>{const n=c({}),s=c([]),o=c({});c("");const l=t=>{s.value.push(t)},y=t=>{const{id:e}=t,i=s.value.findIndex(f=>f.id===e);i!==-1&&s.value.splice(i,1)},d=t=>{const e=M.findIndex(f=>f.name===t);if(e===-1)throw new Error("组件不存在");const i=$(M[e]);return i.id=new Date().getTime().toString(),i},r=t=>{o.value.id!==t.id&&(o.value=t,window.parent.postMessage({type:"select",data:C(t)},window.location.origin))},_=t=>{const{id:e}=t,i=s.value.findIndex(f=>f.id===e);i!==-1&&s.value.splice(i,1,t)},h=t=>{window.parent.postMessage({type:"update-item",data:C(t)},window.location.origin)},w=t=>new et(b.value).processObject(t),S=()=>{u().then(t=>{window.parent.postMessage({type:"save",data:{list:C(s.value),img:t}},window.location.origin)})},p=c({datasets:[],vars:[{name:"test",type:"string",defaultValue:"这是一段测试文本"}]}),D=t=>{p.value=t,a()},b=c({}),m=t=>{const e={},i=(f,v)=>{switch(f){case"string":return v;case"number":return Number(v);case"boolean":return!!v;case"array":case"object":return JSON.parse(v);default:return v}};return t.reduce((f,v)=>(f[v.name]=i(v.type,v.defaultValue),f),e),e},a=()=>{b.value=m(p.value.vars)},u=async()=>{const t=document.querySelector(".dg-design-container");return(await j(t)).toDataURL("image/png")};return{dashboardData:n,add:l,remove:y,dgList:s,initDgItem:d,selectItem:r,curComp:o,updateItem:_,transformProps:w,updateVariables:a,setVarPools:D,updateDgItem:h,sendDgList:S,createPreviewImg:u}}),ot=12,nt=8,rt=x({__name:"StandalonePage",setup(n){const s=st(),{dgList:o}=A(s),{initDgItem:l,add:y,selectItem:d,updateItem:r,transformProps:_,setVarPools:h,updateDgItem:w,sendDgList:S}=s,p=c(),D=c(0),b=a=>{const u=a.dataTransfer.getData("material-type");let t;u=="custom"?t={name:a.dataTransfer.getData("material"),id:new Date().getTime().toString(),label:"自定义组件",icon:"",type:"custom",component:a.dataTransfer.getData("material"),props:{},style:{},rowStart:1,colStart:1,rowSpan:5,colSpan:2}:t=l(a.dataTransfer.getData("material"));const e=a.x/(D.value/ot),i=a.y/nt;t.colStart=Math.floor(e),t.rowStart=Math.floor(i),y(t)},m=c({});return window.addEventListener("message",a=>{a.data.type==="refresh"?r(a.data.data):a.data.type==="add-custom-comp"?new at([a.data.data]).load().then(t=>{Object.keys(t).forEach(e=>{m.value[e]=t[e]})}):a.data.type==="refresh-var"?h(a.data.data):a.data.type==="get-dg"&&S()}),z(()=>{D.value=p.value.clientWidth}),(a,u)=>{const t=G("grid-layout");return I(),B("div",{class:"container dg-design-container",ref_key:"container",ref:p,onDragover:u[0]||(u[0]=Q(()=>{},["prevent","stop"])),onDrop:Q(b,["stop"])},[H(t,{list:g(o),class:"layout","onItem:click":g(d),"onItem:change":g(w)},{"layout-item":W(({item:e})=>[R("div",{class:"comp-container",style:k(e.style)},[e.type&&e.type==="custom"?(I(),L(q(m.value[e.component]),U(F({key:0},g(_)(e.props))),null,16)):(I(),L(q(e.component),{key:1,"style-config":e.style,attrs:g(_)(e.props)},null,8,["style-config","attrs"]))],4)]),_:1},8,["list","onItem:click","onItem:change"])],544)}}}),ct=T(rt,[["__scopeId","data-v-7937fab0"]]),it=x({__name:"QBChart",props:{attrs:{default:()=>({dataset:"",dimension:[],target:[]})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:o,styleConfig:l}=O(s),y=c(!0),d=c();let r;const _=c(0),h=c(""),w=c([{title:"title1",value:100},{title:"title2",value:200},{title:"title3",value:300}]),S=async()=>{h.value=o.value.dataset;const{data:m,code:a,msg:u}=await V.getPreviewByDatasetId(h.value);a==200?w.value=m:w.value=[]},p=()=>{const{dimension:m,target:a}=o.value,u=C(l.value.option),t=C(l.value.series),e=[];return a.forEach(i=>{e.push($(t))}),u.series=e,{...u,dataset:{source:C(w.value)||[],dimensions:[...m,...a]}}},D=()=>{o.value.dataset&&h.value!=o.value.dataset?S().then(()=>{r?(r.clear(),r.setOption(p())):d.value&&(r=E(d.value),r.setOption(p()))}):r?(r.clear(),r.setOption(p())):d.value&&(r=E(d.value),r.setOption(p())),y.value=!1},b=new ResizeObserver(m=>{_.value&&clearTimeout(_.value),_.value=window.setTimeout(()=>{try{r.resize()}catch(a){console.warn(`chart重新设置大小失败,失败原因：${a}`)}},100)});return z(()=>{D(),setTimeout(()=>{b.observe(d.value)},100)}),J(()=>[s.styleConfig],()=>{D()},{deep:!0}),(m,a)=>(I(),B("div",{ref_key:"QBChart",ref:d,class:"qb-chart"},null,512))}}),lt=T(it,[["__scopeId","data-v-dd5ee5c9"]]),dt={class:"qb-iframe"},ut=["src"],pt=x({__name:"QBIframe",props:{attrs:{default:()=>({src:""})},preview:{type:Boolean,default:!1}},setup(n){const s=n,{attrs:o,preview:l}=O(s);return(y,d)=>(I(),B("div",dt,[R("iframe",{class:K(g(l)?"":"no-effect"),src:g(o).src,style:{width:"100%",height:"100%",border:"none"}},null,10,ut)]))}}),mt=T(pt,[["__scopeId","data-v-67323949"]]),ft=["src"],gt=x({__name:"QBImage",props:{attrs:{default:()=>({src:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:o,styleConfig:l}=O(s);return(y,d)=>(I(),B("img",{class:"qb-image",style:k([{width:"100%",height:"100%"},g(l)]),src:g(o).src},null,12,ft))}}),vt=T(gt,[["__scopeId","data-v-3b56b274"]]),yt=x({__name:"QBText",props:{attrs:{default:()=>({text:""})},styleConfig:{default:()=>({})}},setup(n){const s=n,{attrs:o}=O(s);return(l,y)=>(I(),B("div",{class:"qb-text",style:k(l.styleConfig)},X(g(o).text),5))}}),_t=T(yt,[["__scopeId","data-v-ad3a33fa"]]),ht=n=>{n.component("qb-chart",lt),n.component("qb-iframe",mt),n.component("qb-image",vt),n.component("qb-text",_t)},P=Y(ct);P.use(Z());P.use(ht);P.component("GridLayout",tt);P.mount("#standalone-app");
