import{b3 as Ge,f as Ke,r as m,aP as Ye,g as O,s as ee,v as z,o as v,y as S,l as t,i as o,ay as Ze,K as c,V as P,w as n,aB as Je,aW as ge,A as Xe,aI as he,a5 as te,D as Ce,F as V,U as J,b4 as X,af as ye,B as C,b5 as et,b6 as we,a3 as E,h as R,ad as tt,t as ve,x as lt,b7 as ot,at as nt,Y as fe,a2 as at,aZ as _e,b0 as st,H as ut,a0 as it,a1 as dt,b8 as be,b9 as ct,e as rt,L as mt,O as pt,T as vt,M as ft,b2 as _t,aF as bt,a7 as gt,a8 as ht,aT as Ct,R as yt,P as wt,Q as xt}from"./.pnpm-C57POoKK.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as F}from"./index-zRnbBddX.js";import{S as Y}from"./SchemaForm-CeBSevR8.js";import{a as Z}from"./table-CvAKatyv.js";import It from"./FlowView-DfFgnB-e.js";/* empty css                   */import"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-CNYusMji.js";import"./FlowExecutor-BcCzMxzI.js";import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-Cn_lhMlM.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-Deox015t.js";const St=new Ge,L=St,W=Ke("tableDesign",()=>{const y=m([]),f=m({name:"",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),i=m([]),x=m({});return{tableCfg:f,setTableCfg:a=>{f.value=a},currentColumn:x,onSelectColumn:(a,d)=>{const g=d.findIndex(T=>T.id===a);g!=-1&&(x.value=d[g])},onRemoveColumn:(a,d)=>{const g=d.findIndex(T=>T.id===a);g!=-1&&d.splice(g,1)},onAddColumn:()=>{const a=new Date().getTime().toString().slice(-4);f.value.columns.push({id:Ye(),dataIndex:"field"+a,title:"列"+a,width:200})},tableData:y,onRefreshData:async a=>{},columnFields:i,onSetColumns:a=>{i.value=a},onAddBtn:a=>{f.value.action.push({id:new Date().getTime().toString(),name:"测试",position:a,eventFlow:{nodes:[],edges:[]},customEvent:!1,builtInEvents:"add",formId:""})},onRemoveBtn:a=>{const d=f.value.action.findIndex(g=>g.id==a);d!=-1&&f.value.action.splice(d,1)},onRemoveWidget:a=>{const d=f.value.filter.findIndex(g=>g.id==a);d!=-1&&f.value.filter.splice(d,1)}}}),kt={class:"custom-header-label",style:{flex:"1"}},Dt=O({__name:"CustomColumnHeader",props:{params:{}},emits:["onRemove"],setup(y,{emit:f}){const i=W(),{currentColumn:x}=ee(i),I=y,{params:w}=z(I),s=()=>{L.onPublish("removeEvent",w.value)};return(N,k)=>{const D=te;return v(),S("div",{class:Xe(["custom-header-item",o(x).dataIndex==o(w).column.getColId()?"active":""]),style:he([{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},{border:o(x).dataIndex==o(w).column.getColId()?"1px dashed #1677ff":"1px solid transparent"}])},[t(o(Ze),{class:"move",style:{width:"20px",cursor:"move"}}),c("div",kt,P(o(w).displayName),1),t(D,{title:"确定要删除此列配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:k[0]||(k[0]=B=>s())},{default:n(()=>[t(o(Je),{class:"remove",style:{width:"20px"},onClick:ge(()=>{},["stop"])})]),_:1})],6)}}}),$t={class:"custom-opt-cell"},Rt=["onClick"],Nt=O({__name:"CustomOptCell",setup(y){const f=W(),{tableCfg:i}=ee(f),x=Ce(()=>{var k;return(k=i.value.action)==null?void 0:k.filter(D=>D.position=="row")}),{onAddBtn:I,onRemoveBtn:w}=f,s=k=>{L.onPublish("open-btn-modal",k)},N=()=>{I("row")};return(k,D)=>{const B=te;return v(),S("div",$t,[(v(!0),S(V,null,J(x.value,$=>(v(),S("div",{class:"btn",key:$.id},[c("a",{onClick:r=>s($)},P($.name),9,Rt),t(B,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:r=>o(w)($.id)},{default:n(()=>[t(o(X),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),t(o(ye),{style:{cursor:"pointer"},onClick:D[0]||(D[0]=$=>N())})])}}}),Bt={class:"custom-header-label",style:{flex:"1"}},Tt=O({__name:"CustomAddColumn",setup(y){const f=W(),{onAddColumn:i}=f;return(x,I)=>{const w=we;return v(),S("div",{class:"custom-header-item add-column",style:{width:"100%",height:"100%",display:"flex","justify-content":"space-between","align-items":"center",cursor:"pointer"},onClick:I[0]||(I[0]=s=>o(i)())},[c("div",Bt,[t(o(ye)),C(" 新增列 "),t(w,null,{title:n(()=>[C("用于新增列配置")]),default:n(()=>[t(o(et))]),_:1})])])}}}),Ft={class:"cell"},At={key:0},Et=["href"],Ot=O({__name:"CustomCellRender",props:{params:{}},setup(y){const f=y,{params:i}=z(f);return(x,I)=>{const w=tt;return v(),S("div",Ft,[o(i).colDef.cellRendererParams.type=="text"?(v(),S("span",At,P(o(i).value),1)):E("",!0),o(i).colDef.cellRendererParams.type=="image"?(v(),R(w,{key:1,src:o(i).value},null,8,["src"])):E("",!0),o(i).colDef.cellRendererParams.type=="link"?(v(),S("a",{key:2,href:o(i).value},P(o(i).value),9,Et)):E("",!0)])}}}),Pt=O({__name:"AgTable",props:ve({columnId:{default:"id"},tableData:{},height:{default:400}},{columns:{required:!0},columnsModifiers:{}}),emits:ve(["onRemove","onClick"],["update:columns"]),setup(y,{emit:f}){L.onSubscribe("removeEvent",r=>{let a=r.column.getColId(),d=i.value.find(g=>g.dataIndex==a);d&&B(d)});const i=lt(y,"columns"),x=y,{columnId:I,tableData:w}=z(x),s=Ce(()=>{let r=i.value.map(a=>({field:a.dataIndex,colId:a.dataIndex,headerName:a.title,pinned:a.fixed=="none"?void 0:a.fixed,lockVisible:!0,headerComponent:Dt,cellRenderer:Ot,cellRendererParams:{type:a.type}}));return r.push({field:"_plus_",colId:"_plus",headerName:"新增列",lockVisible:!0,headerComponent:Tt}),r.push({field:"_opt_",colId:"_opt_",headerName:"操作",pinned:"right",lockVisible:!0,cellRenderer:Nt}),r}),N=r=>{if(!r.finished)return;let a=[];r.api.getColumnState().forEach(d=>{let g=i.value.find(T=>T.dataIndex==d.colId);g&&a.push(g)}),i.value=a},k=r=>{if(!r.finished)return;let a=r.column.getColId(),d=i.value.findIndex(g=>g.dataIndex==a);d!=-1&&(i.value[d].width=r.column.getActualWidth())},D=f,B=r=>{D("onRemove",r)},$=r=>{let a=r.column.getId(),d=i.value.find(g=>g.dataIndex==a);D("onClick",d)};return(r,a)=>(v(),R(o(ot),{rowData:o(w),columnDefs:s.value,style:he({height:r.height+"px"}),class:"ag-theme-quartz",onColumnMoved:N,onColumnResized:k,onColumnHeaderClicked:$},null,8,["rowData","columnDefs","style"]))}}),Ut=xe(Pt,[["__scopeId","data-v-5dd2184c"]]),Ie=y=>(wt("data-v-61ad6d6d"),y=y(),xt(),y),Mt={class:"table-design"},Vt={class:"table-design-container"},zt={class:"main-part"},Lt={class:"filter-part"},Wt={class:"filter-container"},Ht=["onClick"],qt={class:"add widget-item"},Qt={class:"tools-part"},jt={class:"tools-container"},Gt={class:"add button-item"},Kt={class:"table-part"},Yt=Ie(()=>c("h2",null,"工作流配置注意事项",-1)),Zt=Ie(()=>c("ul",null,[c("li",null,[c("strong",null,"工作流节点不能为空："),C(" 每个工作流必须包含有效的节点配置。")]),c("li",null,[c("strong",null,"包含开始与结束节点："),C(" 每个工作流必须至少包含一个“开始节点”和一个“结束节点”。 ")]),c("li",null,[c("strong",null,"节点内变量引用："),C(" 在节点配置中，可以通过 "),c("code",null,"this.state.xxx"),C(" 的方式引用当前工作流中的变量。 ")]),c("li",null,[c("strong",null,"预览结果："),C(" 执行后，预览结果仅显示当前工作流的 "),c("code",null,"state"),C(" 属性，其他信息不可见。 ")])],-1)),Jt=O({__name:"TableDesign",props:{id:{}},setup(y){nt(),L.onSubscribe("open-btn-modal",u=>{ie(u)});const f=m([]);fe(()=>{F.getDataSourceDict().then(u=>{const{code:e,data:_,msg:b}=u;e==200&&(f.value=_)})});const i=y,{id:x}=z(i),I=m(!1),w=W(),{tableCfg:s,currentColumn:N}=ee(w),{onSelectColumn:k,onRemoveBtn:D,onRemoveColumn:B,onSetColumns:$,onRemoveWidget:r,onAddBtn:a,setTableCfg:d}=w;x.value?(I.value=!0,Z.getDetail(x.value).then(u=>{const{code:e,data:_,msg:b}=u;e==200&&(d(_),ae(),oe(),I.value=!1)})):d({name:"未命名列表",description:"",status:1,columns:[],global:{showFilter:!0,showPagination:!0,showBordered:!1,size:"middle"},dataSource:{tableName:"",sourceId:""},filter:[],action:[]}),window.name="table-design";const g=m([{label:"新增",value:"add"},{label:"编辑",value:"edit"},{label:"删除",value:"delete"}]),T=()=>{var u;(u=s.value.filter)==null||u.push({id:new Date().getTime().toString(),type:"input",label:"文本",field:"field"})},Se=()=>{window.open("/lowcode/table","quick-build")},ke=u=>{k(u.id,s.value.columns),Q.value=!0},De=u=>{B(u.id,s.value.columns)};m([]);const le=m([]),oe=()=>{F.getSourceData(s.value.dataSource.sourceId,s.value.dataSource.tableName).then(u=>{const{code:e,data:_,msg:b}=u;e==200&&(le.value=_)})},ne=m([]),ae=()=>{F.getTableInfo(s.value.dataSource.sourceId).then(u=>{const{code:e,data:_,msg:b}=u;e==200&&(ne.value=_)})},se=async()=>{const{code:u,data:e,msg:_}=await F.getColumnInfo(s.value.dataSource.sourceId,s.value.dataSource.tableName);return u==200?e.map(b=>({label:b.columnComment?`${b.columnComment}(${b.columnName})`:b.columnName,value:b.columnName})):[]},$e=()=>{F.getColumnInfo(s.value.dataSource.sourceId,s.value.dataSource.tableName).then(u=>{const{code:e,data:_,msg:b}=u;e==200&&(s.value.columns=_.map(p=>({dataIndex:p.columnName,title:p.columnComment||p.columnName,id:p.columnName,width:200,type:"text",align:"left",fixed:"none"})),$(_.map(p=>({label:p.columnComment?`${p.columnComment}(${p.columnName})`:p.columnName,value:p.columnName}))))}),oe()},Re=()=>{a("header")},ue=m([]),Ne=()=>{F.getFormDict().then(u=>{const{code:e,data:_,msg:b}=u;e==200&&(ue.value=_)})};fe(()=>{Ne()});const h=m({id:"",name:"",eventFlow:{nodes:[],edges:[]},position:"header",customEvent:!1,builtInEvents:"add",formId:""}),H=m(!1),ie=u=>{h.value=u,H.value=!0},de=m({}),q=m(!1),Be=m({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"80px"}}},properties:{id:{type:"string",label:"控件标识",component:{disabled:!0}},field:{type:"select",label:"字段名称",component:{asyncData:se}},label:{type:"string",label:"文本标签"},type:{type:"radio",label:"控件类型",component:{dataSource:[{label:"输入框",value:"input"},{label:"选择框",value:"select"},{label:"日期框",value:"date"}],buttonStyle:"solid"}},dictType:{type:"radio",label:"字典类型",show:'"${formData.type}" == "select"',tooltip:"字典为系统的字典配置数据，列数据为当前配置字段的列数据",component:{dataSource:[{label:"字典",value:"dict"},{label:"列数据",value:"col"}],buttonStyle:"solid"}},dict:{type:"select",label:"字典",tooltip:"可以在系统配置自定义字典",show:'"${formData.type}" == "select" && "${formData.dictType}" == "dict"',component:{asyncData:async()=>{const{code:u,data:e,msg:_}=await F.getDictTypeList();return u==200?e.map(b=>({label:b.dictTypeDesc,value:b.dictType})):[]}}},defaultValue:{type:"string",label:"默认值"}}}),Te=m({layout:{layout:"horizontal",labelAlign:"right",labelCol:{style:{width:"80px"}}},properties:{dataIndex:{type:"select",label:"字段名",component:{asyncData:se}},title:{type:"string",label:"列名"},width:{type:"number",label:"列宽"},align:{type:"radio",label:"对齐方式",component:{dataSource:[{value:"left",label:"左"},{value:"center",label:"居中"},{value:"right",label:"右"}],buttonStyle:"solid"}},fixed:{type:"radio",label:"固定列",component:{dataSource:[{value:"left",label:"左"},{value:"right",label:"右"},{value:"none",label:"不固定"}],buttonStyle:"solid"}},type:{type:"select",label:"列类型",component:{dataSource:[{value:"link",label:"链接"},{value:"image",label:"图片"},{value:"text",label:"文本"}]}}}}),Fe=u=>{de.value=u,q.value=!0},Q=m(!1),j=m(!1),Ae=m({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"120px"}}},properties:{showFilter:{type:"switch",label:"显示筛选面板"},showPagination:{type:"switch",label:"显示分页器"},showBordered:{type:"switch",label:"显示边框"},size:{type:"radio",label:"表格尺寸",component:{dataSource:[{label:"紧凑",value:"small"},{label:"默认",value:"middle"},{label:"宽松",value:"large"}],buttonStyle:"solid"}}}}),Ee=()=>{j.value=!0},Oe=()=>{I.value=!0,(x.value?Z.update:Z.add)(s.value).then(e=>{const{code:_,data:b,msg:p}=e;_==200&&rt.success("保存成功"),I.value=!1})},U=m(!1),G=m({nodes:[],edges:[]}),Pe=u=>{G.value=u.eventFlow,U.value=!0},ce=m(),Ue=()=>{h.value.eventFlow=ce.value.getData(),re()},re=()=>{G.value={nodes:[],edges:[]},U.value=!1};return(u,e)=>{const _=mt,b=pt,p=vt,A=ft,Me=_t,Ve=st,ze=bt,me=te,pe=gt,Le=ht,We=Ct,He=yt,M=ut,qe=we,Qe=it,je=dt("loading");return v(),S(V,null,[at((v(),S("div",Mt,[t(Ve,{onBack:Se,ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:n(()=>[t(_,{value:o(s).name,"onUpdate:value":e[0]||(e[0]=l=>o(s).name=l),bordered:!1,class:"table-name"},null,8,["value"])]),extra:n(()=>[t(Me,{class:"extra"},{default:n(()=>[t(p,{label:"选择数据源"},{default:n(()=>[t(b,{value:o(s).dataSource.sourceId,"onUpdate:value":e[1]||(e[1]=l=>o(s).dataSource.sourceId=l),options:f.value,style:{width:"180px"},fieldNames:{label:"datasourceName",value:"id"},onChange:e[2]||(e[2]=l=>ae())},null,8,["value","options"])]),_:1}),t(p,{label:"选择表名"},{default:n(()=>[t(b,{value:o(s).dataSource.tableName,"onUpdate:value":e[3]||(e[3]=l=>o(s).dataSource.tableName=l),options:ne.value,style:{width:"180px"},fieldNames:{label:"tableName",value:"tableName"},onChange:e[4]||(e[4]=l=>$e())},null,8,["value","options"])]),_:1}),t(A,{type:"primary",onClick:Ee},{default:n(()=>[C("全局配置")]),_:1}),t(A,{onClick:e[5]||(e[5]=l=>Oe()),type:"primary",class:"save-btn"},{default:n(()=>[C(" 保存 ")]),_:1})]),_:1})]),_:1}),c("div",Vt,[c("div",zt,[c("div",Lt,[c("div",Wt,[t(o(_e),{list:o(s).filter,"onUpdate:list":e[7]||(e[7]=l=>o(s).filter=l),class:"widget-container",animation:"300",group:{name:"widget",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:n(()=>[(v(!0),S(V,null,J(o(s).filter,l=>(v(),S("div",{class:"widget-item",key:l.id,onClick:K=>Fe(l)},[t(o(be),{class:"move-handle",style:{cursor:"pointer"}}),t(p,{label:l.label,name:l.field},{default:n(()=>[l.type=="input"?(v(),R(_,{key:0})):l.type=="select"?(v(),R(b,{key:1})):(v(),R(ze,{key:2}))]),_:2},1032,["label","name"]),t(me,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:K=>o(r)(l.id)},{default:n(()=>[t(o(X),{class:"remove-btn",onClick:ge(()=>{},["stop"])})]),_:2},1032,["onConfirm"])],8,Ht))),128)),c("div",qt,[t(A,{type:"primary",onClick:e[6]||(e[6]=l=>T())},{default:n(()=>[C(" 添加控件 ")]),_:1})])]),_:1},8,["list"])])]),c("div",Qt,[c("div",jt,[t(o(_e),{list:o(s).action,"onUpdate:list":e[9]||(e[9]=l=>o(s).action=l),class:"button-container",animation:"300",group:{name:"button",pull:!0,put:!0},"ghost-class":"ghost",filter:".add",handle:".move-handle"},{default:n(()=>[(v(!0),S(V,null,J(o(s).action.filter(l=>l.position=="header"),l=>(v(),S("div",{class:"button-item",key:l.id},[t(o(be),{class:"move-handle",style:{cursor:"pointer"}}),t(A,{onClick:K=>ie(l)},{default:n(()=>[C(P(l.name),1)]),_:2},1032,["onClick"]),t(me,{title:"确定要删除此按钮的配置吗?","ok-text":"确定","cancel-text":"取消",onConfirm:K=>o(D)(l.id)},{default:n(()=>[t(o(X),{class:"remove-btn"})]),_:2},1032,["onConfirm"])]))),128)),c("div",Gt,[t(A,{type:"primary",onClick:e[8]||(e[8]=l=>Re())},{default:n(()=>[C(" 添加按钮 ")]),_:1})])]),_:1},8,["list"])])]),c("div",Kt,[t(Ut,{columns:o(s).columns,"onUpdate:columns":e[10]||(e[10]=l=>o(s).columns=l),tableData:le.value,height:550,onOnRemove:De,onOnClick:ke},null,8,["columns","tableData"])])])])])),[[je,I.value,void 0,{fullscreen:!0}]]),t(M,{title:"按钮配置",placement:"right",closable:!1,open:H.value,onClose:e[18]||(e[18]=l=>H.value=!1)},{default:n(()=>[t(He,{model:h.value},{default:n(()=>[t(p,{prop:"id",label:"按钮标识"},{default:n(()=>[t(_,{value:h.value.id,"onUpdate:value":e[11]||(e[11]=l=>h.value.id=l)},null,8,["value"])]),_:1}),t(p,{prop:"name",label:"按钮名称"},{default:n(()=>[t(_,{value:h.value.name,"onUpdate:value":e[12]||(e[12]=l=>h.value.name=l)},null,8,["value"])]),_:1}),t(p,{prop:"name",label:"按钮位置"},{default:n(()=>[t(Le,{value:h.value.position,"onUpdate:value":e[13]||(e[13]=l=>h.value.position=l),"button-style":"solid"},{default:n(()=>[t(pe,{value:"header"},{default:n(()=>[C("表头")]),_:1}),t(pe,{value:"row"},{default:n(()=>[C("行内")]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{prop:"customEvent",label:"是否启用自定义"},{default:n(()=>[t(We,{checked:h.value.customEvent,"onUpdate:checked":e[14]||(e[14]=l=>h.value.customEvent=l)},null,8,["checked"])]),_:1}),h.value.customEvent?E("",!0):(v(),R(p,{key:0,prop:"builtInEvents",label:"内置事件"},{default:n(()=>[t(b,{value:h.value.builtInEvents,"onUpdate:value":e[15]||(e[15]=l=>h.value.builtInEvents=l),options:g.value,allowClear:""},null,8,["value","options"])]),_:1})),["add","edit"].includes(h.value.builtInEvents)&&!h.value.customEvent?(v(),R(p,{key:1,prop:"formId",label:"关联表单"},{default:n(()=>[t(b,{value:h.value.formId,"onUpdate:value":e[16]||(e[16]=l=>h.value.formId=l),options:ue.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})):E("",!0),h.value.customEvent?(v(),R(p,{key:2,prop:"event",label:"自定义事件流"},{default:n(()=>[t(A,{onClick:e[17]||(e[17]=l=>Pe(h.value))},{default:n(()=>[C(" 自定义事件流 ")]),_:1})]),_:1})):E("",!0)]),_:1},8,["model"])]),_:1},8,["open"]),t(M,{title:"筛选控件配置",placement:"right",closable:!1,open:q.value,onClose:e[19]||(e[19]=l=>q.value=!1)},{default:n(()=>[t(o(Y),{formData:de.value,schema:Be.value},null,8,["formData","schema"])]),_:1},8,["open"]),t(M,{title:"列配置",placement:"right",closable:!1,open:Q.value,onClose:e[20]||(e[20]=l=>Q.value=!1)},{default:n(()=>[t(o(Y),{formData:o(N),schema:Te.value},null,8,["formData","schema"])]),_:1},8,["open"]),t(M,{title:"全局配置",placement:"right",closable:!1,open:j.value,onClose:e[21]||(e[21]=l=>j.value=!1)},{default:n(()=>[t(o(Y),{formData:o(s).global,schema:Ae.value},null,8,["formData","schema"])]),_:1},8,["open"]),t(Qe,{width:"100%","wrap-class-name":"full-modal",open:U.value,"onUpdate:open":e[22]||(e[22]=l=>U.value=l),onOk:Ue,onCancel:re},{title:n(()=>[C(" 事件流配置 "),t(qe,{overlayInnerStyle:{width:"600px"}},{title:n(()=>[Yt,Zt]),default:n(()=>[t(o(ct))]),_:1})]),default:n(()=>[t(It,{data:G.value,ref_key:"flowRef",ref:ce},null,8,["data"])]),_:1},8,["open"])],64)}}}),cl=xe(Jt,[["__scopeId","data-v-61ad6d6d"]]);export{cl as default};
