import{_ as me}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-Ba4J-Z54.js";import{c as ve}from"./componentsSchema-LhIlCAWr.js";import{u as H}from"./dashboardDesign-p7nhfwLI.js";import{d as J,s as Q,r as g,F as le,p as F,q as b,v as u,e,Q as P,Y as T,P as $,u as y,ak as A,a2 as oe,w as t,m as _e,B as fe,H as te,a3 as X,a4 as Y,a5 as ne,bh as G,V as K,b5 as se,ap as ie,aq as ue,o as r,t as Z,b1 as be,b2 as ge,c as W,a8 as ye,aG as he,X as de,E as xe,a6 as Ce,ae as ke,b3 as we,a as Se,aA as De}from"./.pnpm-DVFE1QU-.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ue}from"./ConfigForm.vue_vue_type_script_setup_true_lang-ClhTaTW4.js";import{S as Ne}from"./SchemaForm-nUqgV6vW.js";import{c as j}from"./iconfont-fCxWMeQn.js";import"./dashboard-BefUS5vO.js";import"./tools-BCD5ohFr.js";/* empty css                   */const re=f=>(ie("data-v-88293ef5"),f=f(),ue(),f),qe={class:"material-area"},$e={class:"material-layout-area"},Ie=re(()=>u("div",{class:"title"},"内置组件",-1)),Me={class:"content"},Le=["data-material"],Ve={class:"material-label"},Ee={class:"material-data-area"},Pe=re(()=>u("div",{class:"title"},"自定义组件",-1)),Be={class:"content"},Oe=["data-material"],Re={style:{height:"650px"}},Te={style:{height:"80px","overflow-y":"auto"}},We={style:{height:"200px","overflow-y":"auto"}},Ae=J({__name:"MaterialArea",setup(f){const D=H(),{customModules:h,customComps:U}=Q(D),{onAddModules:c}=D,i=g({internalComp:ve,customComp:[]}),N=d=>{var s,a;const n=d.target;(s=d.dataTransfer)==null||s.setData("material",n.dataset.material),(a=d.dataTransfer)==null||a.setData("material-type",n.dataset.materialType)},w=g(!1),I=()=>{w.value=!0,o.value=_e(L.value)},L=g({title:"element",package:"element-plus",version:"2.9.2",exportName:"ElementPlus",urls:["https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.full.min.js","https://cdn.jsdelivr.net/npm/element-plus@2.9.2/dist/index.min.css"],children:[{componentName:"ElEmpty",exportName:"ElEmpty",id:"1",schema:`{
    "description": {
        "type": "input",
        "label": "描述"
    }

      }`}]}),o=g({}),q=()=>{w.value=!1},M=()=>{c(o.value),q()};le(()=>h.value,()=>{i.value.customComp=i.value.customComp.concat(U.value),v==null||v.postMessage({type:"add-custom-comp",data:Z(o.value)})},{deep:!0});const B=()=>{o.value.children.push({componentName:"",exportName:"",id:new Date().getTime().toString()})},O=d=>{const n=o.value.children.findIndex(s=>s.id==d.id);n!=-1&&o.value.children.splice(n,1)},m=()=>{o.value.urls.push("")},p=d=>{const n=o.value.urls.findIndex(s=>s==d);n!=-1&&o.value.urls.splice(n,1)};let v=null;return F(()=>{v=document.querySelector(".standalone-iframe").contentWindow}),(d,n)=>{const s=ne,a=Y,C=K,S=se,k=me,z=X,V=oe;return r(),b("div",qe,[u("div",$e,[Ie,u("div",Me,[(r(!0),b(P,null,T(i.value.internalComp,l=>(r(),b("div",{key:l.name,draggable:"true",onDragstart:N,"data-material":l.name,"data-material-type":"internal",class:"material-item"},[u("span",{class:fe(["iconfont material-icon",l.icon])},null,2),u("span",Ve,te(l.label),1)],40,Le))),128))])]),u("div",Ee,[Pe,u("div",Be,[(r(!0),b(P,null,T(i.value.customComp,l=>(r(),b("div",{type:"dashed",key:l.value,draggable:"true",onDragstart:N,"data-material":l.value,"data-material-type":"custom",class:"material-item"},te(l.label),41,Oe))),128)),u("div",{type:"dashed",onClick:I,class:"material-item"},[u("span",null,[e(y(A)),$(" 添加组件 ")])])])]),e(V,{title:"添加自定义组件",width:"800px",open:w.value,"onUpdate:open":n[4]||(n[4]=l=>w.value=l),onOk:M,onCancel:q},{default:t(()=>[u("div",Re,[e(z,{model:o.value,"label-col":{style:{width:"150px"}}},{default:t(()=>[e(a,{label:"名称"},{default:t(()=>[e(s,{value:o.value.title,"onUpdate:value":n[0]||(n[0]=l=>o.value.title=l)},null,8,["value"])]),_:1}),e(a,{label:"组件库名称"},{default:t(()=>[e(s,{value:o.value.package,"onUpdate:value":n[1]||(n[1]=l=>o.value.package=l)},null,8,["value"])]),_:1}),e(a,{label:"版本"},{default:t(()=>[e(s,{value:o.value.version,"onUpdate:value":n[2]||(n[2]=l=>o.value.version=l)},null,8,["value"])]),_:1}),e(a,{label:"导出名称"},{default:t(()=>[e(s,{value:o.value.exportName,"onUpdate:value":n[3]||(n[3]=l=>o.value.exportName=l)},null,8,["value"])]),_:1}),e(a,{label:"CDN地址"},{default:t(()=>[u("div",Te,[(r(!0),b(P,null,T(o.value.urls,(l,R)=>(r(),b("div",{key:l,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},[e(s,{value:o.value.urls[R],"onUpdate:value":x=>o.value.urls[R]=x},null,8,["value","onUpdate:value"]),e(y(G),{onClick:x=>p(l),style:{padding:"0 10px"}},null,8,["onClick"])]))),128))]),e(a,null,{default:t(()=>[e(C,{type:"dashed",block:"",onClick:m},{default:t(()=>[e(y(A)),$(" 增加CDN地址 ")]),_:1})]),_:1})]),_:1}),e(a,{label:"子组件"},{default:t(()=>[u("div",We,[(r(!0),b(P,null,T(o.value.children,(l,R)=>(r(),b("div",{key:l.id,style:{display:"flex","margin-bottom":"8px","border-bottom":"1px solid #ccc"},align:"baseline"},[e(S,null,{default:t(()=>[u("div",null,[e(S,null,{default:t(()=>[e(a,{label:"组件名",rules:{required:!0}},{default:t(()=>[e(s,{value:l.componentName,"onUpdate:value":x=>l.componentName=x},null,8,["value","onUpdate:value"])]),_:2},1024),e(a,{label:"导出名称",rules:{required:!0}},{default:t(()=>[e(s,{value:l.exportName,"onUpdate:value":x=>l.exportName=x},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(a,{label:"配置Schema",rules:{required:!0}},{default:t(()=>[e(k,{value:l.schema,"onUpdate:value":x=>l.schema=x,theme:"light",height:"110"},null,8,["value","onUpdate:value"])]),_:2},1024)]),e(y(G),{onClick:x=>O(l)},null,8,["onClick"])]),_:2},1024)]))),128))]),e(a,null,{default:t(()=>[e(C,{type:"dashed",block:"",onClick:B},{default:t(()=>[e(y(A)),$(" 增加子组件 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["open"])])}}}),Fe=ee(Ae,[["__scopeId","data-v-88293ef5"]]),ze={text:{type:"input",label:"文本内容"}},je={src:{type:"input",label:"图片地址"}},Ge={src:{type:"input",label:"页面地址"}},He=f=>({dataset:{type:"select",label:"数据集",options:f},dimension:{type:"select",label:"维度",options:[],mode:"multiple"},target:{type:"select",label:"指标",options:[],mode:"multiple"}}),Je={"qb-text":ze,"qb-image":je,"qb-iframe":Ge,"qb-chart":He},Qe={title1:{type:"divider",label:"标题",component:{title:"标题"},formLayout:!1},"option.title.show":{type:"switch",label:"显示标题"},"option.title.text":{type:"string",label:"标题文本"},"option.title.link":{type:"string",label:"文本超链接"},title2:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},"option.grid.left":{type:"string",label:"左边距"},"option.grid.right":{type:"string",label:"右边距"},"option.grid.top":{type:"string",label:"上边距"},"option.grid.bottom":{type:"string",label:"下边距"},title3:{type:"divider",label:"图例",component:{title:"图例"},formLayout:!1},"option.legend.show":{type:"switch",label:"显示图例"},"option.legend.type":{type:"select",label:"图例类型",component:{dataSource:[{label:"普通图例",value:"plain"},{label:"翻页图例",value:"scroll"}]}},"option.legend.orient":{type:"select",label:"图例朝向",component:{dataSource:[{value:"horizontal",label:"横向"},{value:"vertical",label:"纵向"}]}},title4:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},ae={title1:{type:"divider",label:"布局",component:{title:"布局"},formLayout:!1},paddingLeft:{type:"string",label:"左边距",tooltip:"请注明单位，一般为：px"},paddingTop:{type:"string",label:"上边距",tooltip:"请注明单位，一般为：px"},paddingRight:{type:"string",label:"右边距",tooltip:"请注明单位，一般为：px"},paddingBottom:{type:"string",label:"下边距",tooltip:"请注明单位，一般为：px"},title2:{type:"divider",label:"背景",component:{title:"背景"},formLayout:!1},backgroundColor:{type:"string",label:"背景色",component:{name:"color-picker"}},title3:{type:"divider",label:"边框",component:{title:"边框"},formLayout:!1},borderWidth:{type:"string",label:"边框宽度",tooltip:"请注明单位，一般为：px"},borderColor:{type:"string",label:"边框颜色",component:{name:"color-picker"}},borderStyle:{type:"radio",label:"边框样式",component:{dataSource:[{label:"无边框",value:"none"},{label:"虚线",value:"dashed"},{label:"实线",value:"solid"}],buttonStyle:"solid"}},borderRadius:{type:"string",label:"边框圆角",tooltip:"请注明单位，可以为%或者px"}},Xe={class:"material-cfg"},Ye={class:"material-cfg-btn"},Ke=J({__name:"MaterialCfg",setup(f){const D=H(),{customCompSchema:h}=Q(D),{getContentWindow:U}=D,c=g({}),i=g({}),N=g({}),w=g({}),I=g({layout:{labelAlign:"left",layout:"horizontal",labelCol:{style:{width:"100px"}}},properties:ae}),L=g([]);j.getDatasetDict().then(m=>{const{code:p,data:v,msg:d}=m;p==200&&(L.value=v)});const o=g([]),q=()=>{c.value.dimension=[],c.value.target=[],j.getFieldByDatasetId(c.value.dataset).then(m=>{const{code:p,data:v,msg:d}=m;p==200&&(o.value=v.map(n=>({value:n,label:n})))})};window.addEventListener("message",m=>{var p;(m.data.type==="select"||m.data.type==="update-item")&&(I.value.properties=ae,i.value=m.data.data,((p=i.value)==null?void 0:p.type)==="custom"?h.value&&(N.value=JSON.parse(h.value[i.value.component])):i.value.component=="qb-chart"?I.value.properties=Qe:N.value=Je[i.value.component],c.value=i.value.props,i.value.component=="qb-chart"&&j.getFieldByDatasetId(c.value.dataset).then(v=>{const{code:d,data:n,msg:s}=v;d==200&&(o.value=n.map(a=>({value:a,label:a})))}),w.value=i.value.style)});let M=null;const B=m=>{if(M)M.postMessage({type:"refresh",data:m});else throw new Error("contentWindow is null")},O=()=>{B(Z(i.value))};return F(()=>{U().then(m=>{M=m})}),(m,p)=>{const v=he,d=de,n=Y,s=X,a=ge,C=be,S=K;return r(),b("div",Xe,[e(C,{size:"small"},{default:t(()=>[e(a,{key:"prop",tab:"属性"},{default:t(()=>[i.value.id?i.value.component!="qb-chart"?(r(),W(Ue,{class:"material-cfg-contain",key:i.value.id,data:c.value,schema:N.value},null,8,["data","schema"])):i.value.component=="qb-chart"?(r(),W(s,{key:2},{default:t(()=>[e(n,{label:"数据集"},{default:t(()=>[e(d,{value:c.value.dataset,"onUpdate:value":p[0]||(p[0]=k=>c.value.dataset=k),options:L.value,onChange:q},null,8,["value","options"])]),_:1}),e(n,{label:"维度"},{default:t(()=>[e(d,{value:c.value.dimension,"onUpdate:value":p[1]||(p[1]=k=>c.value.dimension=k),options:o.value,mode:"tags"},null,8,["value","options"])]),_:1}),e(n,{label:"指标"},{default:t(()=>[e(d,{value:c.value.target,"onUpdate:value":p[2]||(p[2]=k=>c.value.target=k),options:o.value,mode:"tags"},null,8,["value","options"])]),_:1})]),_:1})):ye("",!0):(r(),W(v,{key:0}))]),_:1}),e(a,{key:"style",tab:"样式"},{default:t(()=>[(r(),W(y(Ne),{schema:I.value,size:"small",formData:w.value,key:i.value.id},null,8,["schema","formData"]))]),_:1})]),_:1}),u("div",Ye,[e(S,{onClick:O,disabled:!i.value.id},{default:t(()=>[$("刷新")]),_:1},8,["disabled"])])])}}}),Ze=ee(Ke,[["__scopeId","data-v-c3e45bd1"]]),et=f=>(ie("data-v-715b8aa8"),f=f(),ue(),f),tt={class:"dg-design"},at={class:"dg-design-container"},lt=et(()=>u("div",{class:"middle-part"},[u("iframe",{width:"100%",height:"100%",src:"/standalone/standalone.html",style:{border:"0"},class:"standalone-iframe"})],-1)),ot={style:{height:"300px","overflow-y":"auto"}},nt=J({__name:"DashboardDesign",props:{id:{}},setup(f){const D=H(),{varPools:h,dgInfo:U,loading:c}=Q(D);let i;const{getContentWindow:N,onSave:w,getDetail:I}=D;window.name="dg-design";const L=f,{id:o}=xe(L);F(()=>{o.value&&I(o.value)});const q=g(!1),M=()=>{q.value=!0},B=()=>{i.postMessage({type:"get-dg"})};F(()=>{N().then(s=>{i=s})});const O=()=>{i.postMessage({type:"refresh-var",data:Z(h.value)})};le(()=>h.value,()=>{O()},{deep:!0});const m=()=>{h.value.vars.push({name:"",type:"",defaultValue:""})},p=g([{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔",value:"boolean"},{label:"数组",value:"array"},{label:"对象",value:"object"}]),v=s=>{const a=h.value.vars.findIndex(C=>C.name===s.name);a!=-1&&h.value.vars.splice(a,1)},d=De(),n=()=>{U.value.id||Se.warning("请保存后再预览");const s=d.resolve({path:"/preview-dashboard",query:{id:U.value.id}});window.open(s.href,"_blank")};return window.addEventListener("message",s=>{s.data.type==="save"&&w(s.data.data)}),(s,a)=>{const C=ne,S=K,k=se,z=we,V=Y,l=de,R=X,x=oe,pe=ke("loading");return r(),b(P,null,[Ce((r(),b("div",tt,[e(z,{ghost:!1,style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"}},{title:t(()=>[e(C,{bordered:!1,class:"form-name",value:y(U).name,"onUpdate:value":a[0]||(a[0]=_=>y(U).name=_)},null,8,["value"])]),extra:t(()=>[e(k,null,{default:t(()=>[e(S,{type:"primary",onClick:a[1]||(a[1]=_=>M())},{default:t(()=>[$("变量池")]),_:1}),e(S,{class:"preview-btn",onClick:a[2]||(a[2]=_=>n())},{default:t(()=>[$(" 预览 ")]),_:1}),e(S,{onClick:a[3]||(a[3]=_=>B()),type:"primary",class:"save-btn"},{default:t(()=>[$(" 保存 ")]),_:1})]),_:1})]),_:1}),u("div",at,[e(Fe,{class:"left-part"}),lt,e(Ze,{class:"right-part"})])])),[[pe,y(c),void 0,{fullscreen:!0}]]),e(x,{title:"变量池",open:q.value,"onUpdate:open":a[4]||(a[4]=_=>q.value=_),width:"800px",footer:null},{default:t(()=>[e(R,null,{default:t(()=>[u("div",ot,[(r(!0),b(P,null,T(y(h).vars,(_,ce)=>(r(),W(k,{key:ce,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:t(()=>[e(V,{label:"变量名",required:!0},{default:t(()=>[e(C,{value:_.name,"onUpdate:value":E=>_.name=E},null,8,["value","onUpdate:value"])]),_:2},1024),e(V,{label:"变量类型",required:!0},{default:t(()=>[e(l,{style:{width:"150px"},value:_.type,"onUpdate:value":E=>_.type=E,options:p.value},null,8,["value","onUpdate:value","options"])]),_:2},1024),e(V,{label:"默认值",required:!0},{default:t(()=>[e(C,{value:_.defaultValue,"onUpdate:value":E=>_.defaultValue=E},null,8,["value","onUpdate:value"])]),_:2},1024),e(y(G),{onClick:E=>v(_)},null,8,["onClick"])]),_:2},1024))),128))]),e(V,null,{default:t(()=>[e(S,{type:"dashed",block:"",onClick:m},{default:t(()=>[e(y(A)),$(" 添加变量 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),bt=ee(nt,[["__scopeId","data-v-715b8aa8"]]);export{bt as default};
