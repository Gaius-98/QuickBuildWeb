var h=Object.defineProperty;var l=(a,t,e)=>t in a?h(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>(l(a,typeof t!="symbol"?t+"":t,e),e);import{a as i,c}from"./iconfont-BCn86eVw.js";import{_ as u}from"./LowCodeFormId.vue_vue_type_script_setup_true_lang-BwF7fNrp.js";import{M as p}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-DQ6gDd-0.js";import{h as f}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";const L={getList:a=>i({method:"get",url:"table/list",params:a}),getDetail:a=>i({method:"get",url:"table/detail",params:{id:a}}),remove:a=>i({method:"get",url:"table/remove",params:{id:a}}),add:a=>i({method:"post",url:"table/add",data:a}),update:a=>i({method:"post",url:"table/update",data:a})};class x{constructor(t){n(this,"state",{});n(this,"InternalMapping",new Map);n(this,"rawData");n(this,"flowNodeList");this.rawData=t,this.flowNodeList=[],this.handleData(),this.InternalMapping=new Map([["func-node",this.executeFunction],["request-node",this.requestData],["link-node",this.onOpenLink],["modal-node",this.onOpenModal]])}setModalFormData(t){this.state.modalFormData=t}handleData(){var e;const t=this.findFirstNode();return this.findLastNode(),(e=this.flowNodeList)==null||e.push(t),this.recPushNode(),this.flowNodeList}getFlowList(){return this.flowNodeList}getState(){return this.state}recPushNode(){var e,o;const t=(e=this.flowNodeList)==null?void 0:e.at(-1);if(!this.isLast(t)){const r=this.findNextNode(t);return(o=this.flowNodeList)==null||o.push(r),this.recPushNode()}}findFirstNode(){if(!this.rawData)throw"The workflow has no data";const t=this.rawData.nodes.find(e=>this.isFirst(e));if(!t)throw"The workflow does not have a start node";return t}findNextNode(t){const e=this.rawData.edges.find(s=>s.sourceNodeId==t.id);if(!e)throw"The next edge was not found in the workflow data, please check the data!";const o=e.targetNodeId,r=this.rawData.nodes.find(s=>s.id==o);if(!r)throw"The next node was not found in the workflow data, please check the data!";return r}findLastNode(){var e;if(!((e=this.rawData)==null?void 0:e.nodes.some(o=>this.isLast(o))))throw"The workflow does not have a last node"}isFirst(t){return t.properties.nodeType=="start-node"}isLast(t){return t.properties.nodeType=="end-node"}onOpenModal(t){const{size:e,formId:o}=t.properties.extraData;this.state.modalFormData=this.state.modalFormData?this.state.modalFormData:{};const r={small:"600px",middle:"1200px",large:"1800px"};return new Promise((s,d)=>{p.confirm({content:f(u,{id:o,formData:this.state.modalFormData}),icon:null,title:"表单",width:r[e],onCancel:()=>{d()},onOk:()=>{s(this.state.modalFormData)}})})}onOpenLink(t){const{url:e,openType:o}=t.properties.extraData;window.open(e,o)}async requestData(t){const e=new Promise((r,s)=>{c.getProxyData({...t.properties.extraData,state:this.state}).then(d=>{r(d.data)})});let o;try{o=await e}catch(r){console.error(r)}this.state.requestData=o}executeFunction(t){const{code:e}=t.properties.extraData,o=new Function(`return  ()=>{${e}}`),r=this;try{return o.call(r)()}catch(s){console.error(s)}}async run(){var t;if(this.flowNodeList)try{for(let e=1;e<this.flowNodeList.length-1;e++){const o=this.flowNodeList[e],r=o.properties.nodeType;this.InternalMapping.get(r)&&await((t=this.InternalMapping.get(r))==null?void 0:t.call(this,o))}}catch(e){return e}}}export{x as F,L as a};
