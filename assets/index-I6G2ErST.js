import{d as k}from"./api-B01CyZYM.js";import{g as Ie,r as s,v as we,D as Ne,W as Se,o as p,y as Y,l as n,w as u,J as c,n as C,i as v,b8 as Te,b9 as qe,ba as $e,T as De,bb as Ue,bc as Oe,bd as Ve,a3 as ze,b2 as Le,U as Be,C as Pe,ac as Me,ad as Ke,b0 as Re,Y as je,$ as G,B as r,O as Ae,M as X,ao as Ee,be as Fe,h as m,F as He,a0 as I,ag as Je,e as Z,aQ as Qe,a1 as We,b4 as Ye,a7 as Ge,aE as Xe,b1 as Ze,a5 as ea,a6 as aa,al as ta,am as na}from"./.pnpm-BOQ5c3CP.js";import{a as y}from"./api-FBwzjvoY.js";import{_ as oa}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CFcf1xz-.js";const la=f=>(ta("data-v-237e9118"),f=f(),na(),f),sa={class:"dataset-design"},ua={class:"container"},ia={class:"left-part"},da={class:"search-tree"},ca=["title"],pa={style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},ra=la(()=>c("span",{class:"iconfont icon-table"},null,-1)),ma={style:{width:"36px"}},va={class:"right-part"},_a={class:"tools-area"},ga={class:"sql-area"},fa={class:"result"},ya=Ie({__name:"index",props:{type:{default:"add"},id:{},datasourceId:{},tableName:{}},setup(f){const O=s([]),V=s({}),z=s([]),ee=()=>{o.value.execSql=Ue(o.value.execSql,{language:"mysql"})},o=s({datasetName:"",datasourceId:"",execSql:"",status:"1",paramsConfig:[]}),ae=f,w=s(!1),{type:N,id:L,datasourceId:B,tableName:P}=we(ae),S=()=>{k.getTableInfo(o.value.datasourceId).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(O.value=l)}),k.getSchema(o.value.datasourceId).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(V.value=l,z.value=[Oe({schema:V.value}),Ve])})};o.value.datasetName=o.value.datasetName||"未命名",B.value&&(o.value.datasourceId=B.value,S(),P.value&&(o.value.execSql=`select * from ${P.value}`)),N.value==="edit"&&L.value&&y.getDetail(L.value).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(o.value=l,S())});const te=Ne(()=>O.value.filter(t=>t.tableName.includes(T.value))),M=s([]),ne=()=>{let t;N.value=="add"?t=y.add:N.value=="edit"&&(t=y.update),t(o.value).then(e=>{const{code:l,data:i,msg:g}=e;l==200&&Z.success("保存成功")})},T=s("");Se(()=>{k.getList("").then(t=>{const{code:e,data:l}=t;e==200&&(M.value=l.data)})});const q=s(!1),K=s([]),$=s(!1),oe=s([{title:"字段名称",key:"columnName",dataIndex:"columnName",width:"200px"},{title:"字段类型",key:"columnType",dataIndex:"columnType",width:"200px"},{title:"字段注释",key:"columnComment",dataIndex:"columnComment",width:"200px"}]),R=s(""),le=t=>{$.value=!0,R.value=t,k.getColumnInfo(o.value.datasourceId,t).then(e=>{const{code:l,data:i}=e;$.value=!1,l==200&&(K.value=i)}),q.value=!0},se=()=>{window.open("/data/dataset","quick-build")},ue=()=>{Z.success("复制成功")},x=s([]),j=s([]),ie=()=>{D.value="result",y.run(o.value).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(x.value=l,j.value=Object.keys(l[0]).map(g=>({title:g,key:g,dataIndex:g,ellipsis:!0,width:200})))})},de=t=>{const{current:e,pageSize:l}=t;_.value.pageNumber=e,_.value.pageSize=l,F()},ce=t=>{t==="history"&&F()},_=s({keyword:o.value.datasourceId,pageSize:10,pageNumber:1}),A=s([]),E=s(0),pe=s([{title:"执行sql",key:"execSql",dataIndex:"execSql",ellipsis:!0},{title:"耗时",key:"executionTime",dataIndex:"executionTime"},{title:"执行结果",key:"status",dataIndex:"status"}]),F=()=>{_.value.keyword=o.value.datasourceId,y.getLogList(_.value).then(t=>{const{code:e,data:l,msg:i}=t;e==200&&(A.value=l.data,E.value=l.total)})},D=s("result"),re=()=>{w.value=!0},me=s([{title:"参数名",key:"paramsName",dataIndex:"paramsName"},{title:"参数类型",key:"paramsType",dataIndex:"paramsType"},{title:"参数默认值",key:"paramsDefaultValue",dataIndex:"paramsDefaultValue"},{title:"操作",key:"action",dataIndex:"action"}]),ve=()=>{let t=Qe();o.value.paramsConfig.push({id:t,paramsDefaultValue:"",paramsType:"string",paramsName:""})},_e=t=>{let e=o.value.paramsConfig.findIndex(l=>l.id==t.id);o.value.paramsConfig.splice(e,1)};return(t,e)=>{const l=We,i=ze,g=Ye,ge=Le,H=Be,U=Pe,fe=Me,ye=Ke,b=Ge,xe=Xe,J=Ze,Q=ea,be=Re,W=je,he=aa,ke=G("copy"),Ce=G("has-perm");return p(),Y("div",sa,[n(ge,{style:{border:"1px solid rgb(235, 237, 240)",padding:"10px 24px"},onBack:e[2]||(e[2]=a=>se())},{title:u(()=>[n(l,{value:o.value.datasetName,"onUpdate:value":e[0]||(e[0]=a=>o.value.datasetName=a),bordered:!1,class:"dataset-name"},null,8,["value"])]),extra:u(()=>[n(g,null,{default:u(()=>[n(i,{onClick:e[1]||(e[1]=a=>ne()),type:"primary",class:"save-btn"},{default:u(()=>[r(" 保存 ")]),_:1})]),_:1})]),_:1}),c("div",ua,[c("div",ia,[c("div",da,[n(H,{value:o.value.datasourceId,"onUpdate:value":e[3]||(e[3]=a=>o.value.datasourceId=a),options:M.value,fieldNames:{label:"datasourceName",value:"id"},style:{width:"100%"},onChange:e[4]||(e[4]=a=>S())},null,8,["value","options"]),n(U,{style:{margin:"8px 0"}}),n(fe,{value:T.value,"onUpdate:value":e[5]||(e[5]=a=>T.value=a),style:{"margin-bottom":"8px"},placeholder:"请输入表名称",allowClear:""},null,8,["value"]),n(ye,{"tree-data":te.value,selectable:"",fieldNames:{title:"tableName",key:"tableName",children:"children"},style:{height:"calc(100%)","overflow-y":"auto"}},{title:u(a=>[c("div",{style:{width:"200px",display:"flex","justify-content":"space-between"},title:a.tableName},[c("span",pa,[ra,r(" "+Ae(a.tableName),1)]),c("span",ma,[X(n(v(Ee),{title:"复制表名",style:{cursor:"pointer","margin-right":"5px"},onClick:e[6]||(e[6]=d=>ue())},null,512),[[ke,a.tableName]]),n(v(Fe),{title:"查看字段信息",style:{cursor:"pointer"},onClick:d=>le(a.tableName)},null,8,["onClick"])])],8,ca)]),_:1},8,["tree-data"])])]),c("div",va,[c("div",_a,[n(i,{onClick:e[7]||(e[7]=a=>ie()),type:"text",icon:C(v(Te))},{default:u(()=>[r("运行")]),_:1},8,["icon"]),n(U,{type:"vertical"}),n(i,{onClick:e[8]||(e[8]=a=>ee()),type:"text",icon:C(v(qe))},{default:u(()=>[r("美化")]),_:1},8,["icon"]),n(U,{type:"vertical"}),n(i,{onClick:e[9]||(e[9]=a=>re()),type:"text",icon:C(v($e))},{default:u(()=>[r("参数")]),_:1},8,["icon"])]),c("div",ga,[n(v(De),{style:{height:"350px"},"indent-with-tab":!0,"tab-size":2,extensions:z.value,modelValue:o.value.execSql,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.execSql=a)},null,8,["extensions","modelValue"])]),c("div",fa,[n(be,{activeKey:D.value,"onUpdate:activeKey":e[11]||(e[11]=a=>D.value=a),onChange:ce},{default:u(()=>[n(J,{key:"result",tab:"执行结果"},{default:u(()=>[x.value&&x.value.length>0?(p(),m(b,{key:0,style:{width:"100%"},size:"small",scroll:{x:"max-content",y:"280px"},"data-source":x.value,columns:j.value},null,8,["data-source","columns"])):(p(),m(xe,{key:1}))]),_:1}),n(J,{key:"history",tab:"历史记录"},{default:u(()=>[n(b,{scroll:{y:"280px"},size:"small","data-source":A.value,columns:pe.value,onChange:de,pagination:{current:_.value.pageNumber,total:E.value,showSizeChanger:!1,pageSize:_.value.pageSize}},{bodyCell:u(({column:a,record:d})=>[a.key=="status"?(p(),Y(He,{key:0},[d.status=="1"?(p(),m(Q,{key:0,color:"#87d068"},{default:u(()=>[r("成功")]),_:1})):(p(),m(Q,{key:1,color:"#f50"},{default:u(()=>[r("失败")]),_:1}))],64)):I("",!0)]),_:1},8,["data-source","columns","pagination"])]),_:1})]),_:1},8,["activeKey"])])])]),n(W,{width:"600px",title:`${R.value}字段明细`,footer:null,open:q.value,"onUpdate:open":e[12]||(e[12]=a=>q.value=a)},{default:u(()=>[n(b,{size:"small",class:"ant-table-striped","data-source":K.value,columns:oe.value,loading:$.value,"row-class-name":(a,d)=>d%2===1?"table-striped":null,pagination:!1,scroll:{x:"auto",y:"500px"}},null,8,["data-source","columns","loading","row-class-name"])]),_:1},8,["title","open"]),n(W,{title:"参数配置",open:w.value,"onUpdate:open":e[14]||(e[14]=a=>w.value=a),width:"800px",height:"400px",footer:null},{default:u(()=>[n(i,{type:"primary",style:{"margin-bottom":"5px"},onClick:e[13]||(e[13]=a=>ve()),icon:C(v(Je))},{default:u(()=>[r("新增")]),_:1},8,["icon"]),n(b,{columns:me.value,"data-source":o.value.paramsConfig,scroll:{y:"300px"},pagination:!1},{bodyCell:u(({column:a,record:d})=>[["paramsName","paramsDefaultValue"].includes(a.key)?(p(),m(l,{key:0,value:d[a.dataIndex],"onUpdate:value":h=>d[a.dataIndex]=h},null,8,["value","onUpdate:value"])):I("",!0),a.key=="paramsType"?(p(),m(H,{key:1,style:{width:"100%"},value:d[a.dataIndex],"onUpdate:value":h=>d[a.dataIndex]=h,options:[{label:"字符串",value:"string"}]},null,8,["value","onUpdate:value"])):I("",!0),a.key=="action"?(p(),m(he,{key:2,title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:h=>_e(d)},{default:u(()=>[X((p(),m(i,{type:"link",danger:""},{default:u(()=>[r("删除")]),_:1})),[[Ce,"system:user:remove"]])]),_:2},1032,["onConfirm"])):I("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open"])])}}}),Ia=oa(ya,[["__scopeId","data-v-237e9118"]]);export{Ia as default};
