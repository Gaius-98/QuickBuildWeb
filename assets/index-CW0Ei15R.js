import{d as p}from"./api-fCK5SsNL.js";import{u as te}from"./nodemodule-vue-router@4.3.0_vue@3.4.21-BC_007Jj.js";import{P as oe,E as le}from"./nodemodule-@ant-design_icons-vue@7.0.1_vue@3.4.21-CO80cFpd.js";import{p as ne,B as se,q as de,g as ue,M as R,z as ie,A as re,E as ce,i as pe,F as me,h as ve,e as _e,I as fe,s as be,a as T}from"./nodemodule-ant-design-vue@4.1.2_vue@3.4.21-D4V-KPiA.js";import{d as ye,q as ge,b as ke,K as P,M as b,c as o,y as x,h as we,aI as l,F as xe,N as D,G as m,a2 as y,z as Ce,L as r}from"./nodemodule-@vue_runtime-core@3.4.21-Cnn673wu.js";import{r as u,u as V}from"./nodemodule-@vue_reactivity@3.4.21-DbkE7Gi6.js";import{O as Ne}from"./nodemodule-@vue_shared@3.4.21-Ctf17_ps.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./iconfont-D1HCqb49.js";import"./nodemodule-axios@1.6.8-BZ84_VUH.js";import"./nodemodule-js-cookie@3.0.5-Cz0CWeBA.js";import"./nodemodule-@ant-design_icons-svg@4.4.2-C9VH68wD.js";import"./nodemodule-@ant-design_colors@6.0.0-CBJ--Aym.js";import"./nodemodule-@ctrl_tinycolor@3.6.1-DOFZgDuz.js";import"./nodemodule-@babel_runtime@7.27.1-Bq4_u9L9.js";import"./nodemodule-@vue_runtime-dom@3.4.21-CDjXREoQ.js";import"./nodemodule-lodash-es@4.17.21-DcfALcKD.js";import"./nodemodule-resize-observer-polyfill@1.5.1-B1PUzC5B.js";import"./nodemodule-dayjs@1.11.13-B6I98uus.js";import"./nodemodule-classnames@2.5.1-BK5ccKcQ.js";import"./nodemodule-throttle-debounce@5.0.2-CUWDS_la.js";import"./nodemodule-async-validator@4.2.5-9PlIezaS.js";import"./nodemodule-scroll-into-view-if-needed@2.2.31-CLVC0ehY.js";import"./nodemodule-compute-scroll-into-view@1.0.20-1gs_hJI2.js";import"./nodemodule-vue-types@3.0.2_vue@3.4.21-CF28atMM.js";import"./nodemodule-dom-align@1.12.4-CRCehRfe.js";import"./nodemodule-@emotion_hash@0.9.2-WldOFDRm.js";import"./nodemodule-@emotion_unitless@0.8.1-sScrWPmR.js";import"./nodemodule-stylis@4.3.6-D5iaQeiq.js";const Te={class:"container"},qe={class:"search-tree"},Ue={class:"tree-top"},Ie={style:{width:"160px",display:"flex","justify-content":"space-between"}},Pe={key:0,class:"iconfont icon-Mysql"},De={class:"datasource"},Fe={key:0},Me=ye({__name:"index",setup(Oe){const A=te(),F=u([]),M=u([]),$=u([{title:"表名称",key:"tableName",dataIndex:"tableName",width:"300px"},{title:"表注释",key:"tableComment",dataIndex:"tableComment",width:"300px"},{title:"操作",key:"action",dataIndex:"action",width:"250px"}]),g=u(!1),q=u(""),C=()=>{p.getList(q.value).then(t=>{const{code:e,data:s}=t;g.value=!1,e==200&&(F.value=s)})},O=()=>{g.value=!0,p.getTableInfo(v.value[0]).then(t=>{g.value=!1;const{code:e,data:s,msg:d}=t;e==200&&(M.value=s)})},v=u([]),z=(t,e)=>{e=="view"||e=="edit"?U(e,t):e=="remove"&&R.confirm({title:"删除数据源",content:"确定要删除吗?",okText:"确认",cancelText:"取消",onOk:()=>{p.remove(t).then(s=>{const{code:d,data:i,msg:I}=s;d==200&&(T.success("删除成功"),O())})}})},f=u("add"),j=ge(()=>{let t="新增数据源";switch(f.value){case"add":t="新增数据源";break;case"edit":t="编辑数据源";break;case"view":t="查看数据源";break}return t}),_=u(!1),N=u(),n=u({datasourceName:"",dbHost:"",dbName:"",dbPort:3306,dbPwd:"",dbType:"mysql",dbUsername:"",sourceType:"db",status:"",remark:""}),S=()=>{var t;(t=N.value)==null||t.validate().then(()=>{f.value=="add"?p.add(n.value).then(e=>{const{code:s,data:d,msg:i}=e;s==200&&T.success("新增成功"),C(),_.value=!1}):f.value=="edit"?p.update(n.value).then(e=>{const{code:s,data:d,msg:i}=e;s==200&&T.success("编辑成功"),C(),_.value=!1}):_.value=!1})},B=()=>{var t;(t=N.value)==null||t.resetFields()},U=(t,e)=>{f.value=t,t==="add"?(n.value={datasourceName:"",dbHost:"",dbName:"",dbPort:3306,dbPwd:"",dbType:"mysql",dbUsername:"",sourceType:"db",status:"",remark:""},_.value=!0):p.getDetail(e).then(s=>{const{code:d,data:i}=s;d==200&&(n.value=i,_.value=!0)})},G=()=>{var t;(t=N.value)==null||t.validate().then(()=>{p.connect(n.value).then(e=>{const{code:s,msg:d}=e;s==200&&T.success("连接成功")})})},J=u([{title:"字段名称",key:"columnName",dataIndex:"columnName",width:"300px"},{title:"字段类型",key:"columnType",dataIndex:"columnType",width:"300px"},{title:"字段注释",key:"columnComment",dataIndex:"columnComment",width:"300px"}]),Q=(t,e)=>{t&&(e.loading=!0,p.getColumnInfo(v.value[0],e.tableName).then(s=>{e.loading=!1;const{code:d,data:i,msg:I}=s;d==200&&(e.fieldList=i)}))};ke(()=>{C()});const W=t=>{const e=A.resolve({path:"/design/dataset",query:{type:"add",datasourceId:v.value[0],tableName:t}});window.open(e.href,"_blank")};return(t,e)=>{const s=ne,d=se,i=ce,I=re,X=ie,Y=de,E=pe,H=ue,K=_e,c=ve,k=fe,Z=be,ee=me,ae=R,w=Ce("has-perm");return r(),P(xe,null,[b("div",Te,[b("div",qe,[b("div",Ue,[o(s,{value:q.value,"onUpdate:value":e[0]||(e[0]=a=>q.value=a),style:{"margin-bottom":"8px",width:"170px"},placeholder:"请输入数据源名称",onSearch:C},null,8,["value"]),x(o(d,{icon:we(V(oe)),onClick:e[1]||(e[1]=a=>U("add"))},null,8,["icon"]),[[w,"lowcode:datasource:add"]])]),o(Y,{selectedKeys:v.value,"onUpdate:selectedKeys":e[2]||(e[2]=a=>v.value=a),"tree-data":F.value,selectable:"",fieldNames:{title:"datasourceName",key:"id",children:"children"},style:{height:"calc(100% - 30px)","overflow-y":"auto"},onSelect:O},{title:l(a=>[b("div",Ie,[b("span",null,[a.dbType==="mysql"?(r(),P("span",Pe)):D("",!0),m(" "+Ne(a.datasourceName),1)]),o(X,{trigger:["click"]},{overlay:l(()=>[o(I,{onClick:({key:h})=>z(a.id,h)},{default:l(()=>[x((r(),y(i,{key:"view"},{default:l(()=>[m("查看")]),_:1})),[[w,"lowcode:datasource:detail"]]),x((r(),y(i,{key:"edit"},{default:l(()=>[m("编辑")]),_:1})),[[w,"lowcode:datasource:update"]]),x((r(),y(i,{key:"remove"},{default:l(()=>[m("删除")]),_:1})),[[w,"lowcode:datasource:remove"]])]),_:2},1032,["onClick"])]),default:l(()=>[o(V(le),{style:{transform:"rotate(90deg)"}})]),_:2},1024)])]),_:1},8,["selectedKeys","tree-data"])]),b("div",De,[o(H,null,{default:l(()=>[(r(),y(E,{loading:g.value,columns:$.value,"data-source":M.value,scroll:{y:740},pagination:!1,rowKey:a=>v.value[0]+a.tableName,class:"ant-table-striped",onExpand:Q,key:v.value[0]},{bodyCell:l(({column:a,record:h})=>[a.key=="action"?(r(),y(d,{key:0,type:"link",onClick:L=>W(h.tableName)},{default:l(()=>[m("创建数据集")]),_:2},1032,["onClick"])):D("",!0)]),expandedRowRender:l(({record:a})=>[o(H,null,{default:l(()=>[o(E,{loading:a.loading,class:"ant-table-striped",columns:J.value,pagination:!1,"data-source":a.fieldList,"row-class-name":(h,L)=>L%2===1?"table-striped":null,style:{margin:"5px"}},null,8,["loading","columns","data-source","row-class-name"])]),_:2},1024)]),_:1},8,["loading","columns","data-source","rowKey"]))]),_:1})])]),o(ae,{title:j.value,open:_.value,"onUpdate:open":e[11]||(e[11]=a=>_.value=a),onOk:S,onCancel:B},{footer:l(()=>[f.value!="view"?(r(),P("div",Fe,[x((r(),y(d,{onClick:G},{default:l(()=>[m("测试连接")]),_:1})),[[w,"lowcode:datasource:connection"]]),o(d,{onClick:B},{default:l(()=>[m("取消")]),_:1}),o(d,{type:"primary",loading:g.value,onClick:S},{default:l(()=>[m("确定")]),_:1},8,["loading"])])):D("",!0)]),default:l(()=>[o(ee,{model:n.value,"label-col":{span:8},ref_key:"modalFormRef",ref:N,disabled:f.value==="view"},{default:l(()=>[o(c,{label:"创建源类型",required:"",prop:"sourceType"},{default:l(()=>[o(K,{disabled:"",value:n.value.sourceType,"onUpdate:value":e[3]||(e[3]=a=>n.value.sourceType=a),options:[{label:"数据库",value:"db"}]},null,8,["value"])]),_:1}),o(c,{label:"数据库类型",required:"",prop:"dbType"},{default:l(()=>[o(K,{value:n.value.dbType,"onUpdate:value":e[4]||(e[4]=a=>n.value.dbType=a),options:[{label:"mysql",value:"mysql"}]},null,8,["value"])]),_:1}),o(c,{label:"数据源名称",required:"",prop:"datasourceName"},{default:l(()=>[o(k,{value:n.value.datasourceName,"onUpdate:value":e[5]||(e[5]=a=>n.value.datasourceName=a)},null,8,["value"])]),_:1}),o(c,{label:"数据库地址",required:"",prop:"dbHost"},{default:l(()=>[o(k,{value:n.value.dbHost,"onUpdate:value":e[6]||(e[6]=a=>n.value.dbHost=a)},null,8,["value"])]),_:1}),o(c,{label:"端口",required:"",prop:"dbPort"},{default:l(()=>[o(k,{value:n.value.dbPort,"onUpdate:value":e[7]||(e[7]=a=>n.value.dbPort=a)},null,8,["value"])]),_:1}),o(c,{label:"数据库名称",required:"",prop:"dbName"},{default:l(()=>[o(k,{value:n.value.dbName,"onUpdate:value":e[8]||(e[8]=a=>n.value.dbName=a)},null,8,["value"])]),_:1}),o(c,{label:"用户名",required:"",prop:"dbUsername"},{default:l(()=>[o(k,{value:n.value.dbUsername,"onUpdate:value":e[9]||(e[9]=a=>n.value.dbUsername=a)},null,8,["value"])]),_:1}),o(c,{label:"密码",required:"",prop:"dbPwd"},{default:l(()=>[o(Z,{value:n.value.dbPwd,"onUpdate:value":e[10]||(e[10]=a=>n.value.dbPwd=a)},null,8,["value"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["title","open"])],64)}}}),ra=he(Me,[["__scopeId","data-v-d65bc844"]]);export{ra as default};
