import{_ as ae}from"./CodeEditor.vue_vue_type_script_setup_true_name_EvCode_lang-B7eK84Yi.js";import{_ as oe}from"./EventFlow-C04MQ-mx.js";import{c as le}from"./index-CF0l1GTJ.js";import{g as j,t as ne,x as se,v as q,D as N,o as r,h as y,w as l,V as m,y as f,l as t,i as $,bk as h,bl as ue,B as _,n as re,W as J,N as P,Y as G,a2 as pe,r as d,L as de,F,C as ie,H as _e,J as me,X as ve,a3 as ce,a4 as fe,ai as ye,a$ as xe,a_ as ge,aA as be,$ as De}from"./.pnpm-BowExx5l.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{F as ke}from"./FlowExecutor-2WvtH4zx.js";import"./LowCodeFormId.vue_vue_type_script_setup_true_lang-Bv8lnjPX.js";import"./LowCodeForm.vue_vue_type_script_setup_true_lang-bBjVr7rH.js";const we={key:2,style:{display:"flex"}},Ie=j({__name:"EditTable",props:ne({columns:{},action:{type:Boolean,default:!0},height:{default:150}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(T){const x=se(T,"modelValue");let B=T;const{columns:v,action:E}=q(B),g=N(()=>U("input")),a=N(()=>U("select")),c=N(()=>E.value?[...v.value,{title:"操作",dataIndex:"_action_"}]:v.value),V=s=>{var u;return((u=v.value.find(D=>D.dataIndex==s))==null?void 0:u.options)||[]},U=s=>v.value.filter(u=>u.type==s).map(u=>u.dataIndex),b=()=>{let s={};v.value.map(u=>{Reflect.set(s,u.dataIndex,"")}),x.value.push(s)},O=s=>{x.value.splice(s,1)};return(s,u)=>{const D=J,k=P,w=G,M=pe;return r(),y(M,{columns:c.value,"data-source":x.value,pagination:!1,rowKey:(p,n)=>n,size:"small",scroll:{y:s.height}},{bodyCell:l(({column:p,record:n,index:e})=>[g.value.includes(p.dataIndex)?(r(),y(D,{key:0,value:n[p.dataIndex],"onUpdate:value":i=>n[p.dataIndex]=i},null,8,["value","onUpdate:value"])):m("",!0),a.value.includes(p.dataIndex)?(r(),y(k,{key:1,value:n[p.dataIndex],"onUpdate:value":i=>n[p.dataIndex]=i,options:V(p.dataIndex)},null,8,["value","onUpdate:value","options"])):m("",!0),p.dataIndex=="_action_"?(r(),f("div",we,[t($(h),{class:"icon",onClick:u[0]||(u[0]=i=>b())}),t($(ue),{class:"icon",onClick:i=>O(e)},null,8,["onClick"])])):m("",!0)]),emptyText:l(()=>[t(w,{type:"text",onClick:b,icon:re($(h))},{default:l(()=>[_(" 新增数据")]),_:1},8,["icon"])]),_:1},8,["columns","data-source","rowKey","scroll"])}}}),L=H(Ie,[["__scopeId","data-v-5b9e8dbe"]]),Ce={key:0,style:{color:"red"}},Te=j({__name:"FlowView",props:{data:{default:()=>({nodes:[],edges:[]})}},setup(T,{expose:x}){const B=T,{data:v}=q(B),E=d([{type:"circle",text:"开始",label:"开始节点",icon:"/src/assets/images/flow/开始.png",properties:{nodeType:"start-node",extraData:{}}},{type:"circle",text:"结束",label:"结束节点",icon:"/src/assets/images/flow/结束.png",properties:{nodeType:"end-node",extraData:{}}},{type:"rect",text:"处理函数",label:"处理函数",icon:"/src/assets/images/flow/js函数.png",properties:{nodeType:"func-node",extraData:{code:""}}},{type:"rect",text:"打开弹窗",label:"弹窗",icon:"/src/assets/images/flow/弹窗.png",properties:{nodeType:"modal-node",extraData:{size:"small",formId:""}}},{type:"rect",text:"跳转外部链接",label:"链接",icon:"/src/assets/images/flow/链接.png",properties:{nodeType:"link-node",extraData:{url:"",openType:"_blank"}}},{type:"diamond",text:"请求数据",label:"请求数据",icon:"/src/assets/images/flow/发起请求.png",properties:{nodeType:"request-node",extraData:{url:"",method:"",params:[],headers:[],body:[]}}}]),g=d(!1),a=d({}),c=d(),V=d([]),U=d([{value:"get",label:"GET"},{value:"post",label:"POST"}]),b=d([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"},{title:"引用变量",dataIndex:"var",type:"input"}]),O=d([{title:"Key",dataIndex:"key",type:"input"},{title:"Value",dataIndex:"value",type:"input"}]),s=d(""),u=n=>{g.value=!0,a.value=n.data};le.getFormDict().then(n=>{const{code:e,data:i,msg:z}=n;e==200&&(V.value=i)});const D=()=>{c.value.updateNodeData(a.value)},k=d(!1),w=d("");x({getData:()=>c.value.getRawData()});const p=async()=>{k.value=!1,w.value="";try{const n=c.value.getRawData(),e=new ke(n);await e.run(),s.value=JSON.stringify(e.getState(),null,4)}catch(n){k.value=!0,w.value=n}};return(n,e)=>{const i=ie,z=oe,W=G,K=ae,I=ve,C=ce,S=fe,A=P,X=ye,Y=J,R=xe,Q=ge,Z=be,ee=De,te=_e;return r(),f(F,null,[t(i,null,{default:l(()=>[_("配置区")]),_:1}),t(z,{ref_key:"eventFlowRef",ref:c,data:$(v),dndList:E.value,style:{height:"450px"},onOnClickEle:u},null,8,["data","dndList"]),t(W,{onClick:e[0]||(e[0]=o=>p()),type:"primary",style:{"margin-top":"10px"}},{default:l(()=>[_("执行")]),_:1}),t(i,null,{default:l(()=>[_("运行结果")]),_:1}),k.value?(r(),f("div",Ce,"错误日志: "+de(w.value),1)):(r(),y(K,{key:1,value:s.value,"onUpdate:value":e[1]||(e[1]=o=>s.value=o),height:"200",readOnly:""},null,8,["value"])),t(te,{open:g.value,"onUpdate:open":e[12]||(e[12]=o=>g.value=o),title:"节点配置",placement:"right",onClose:e[13]||(e[13]=o=>D()),width:"400px"},{default:l(()=>[t(ee,{model:a.value.properties.extraData},{default:l(()=>[a.value.properties.nodeType=="func-node"?(r(),y(I,{key:0,label:"函数"},{default:l(()=>[t(K,{value:a.value.properties.extraData.code,"onUpdate:value":e[2]||(e[2]=o=>a.value.properties.extraData.code=o),prepend:"()=>{",append:"}",theme:"light"},null,8,["value"])]),_:1})):m("",!0),a.value.properties.nodeType=="modal-node"?(r(),f(F,{key:1},[t(I,{label:"弹窗大小"},{default:l(()=>[t(S,{value:a.value.properties.extraData.size,"onUpdate:value":e[3]||(e[3]=o=>a.value.properties.extraData.size=o),"button-style":"solid"},{default:l(()=>[t(C,{value:"small"},{default:l(()=>[_("小")]),_:1}),t(C,{value:"middle"},{default:l(()=>[_("中")]),_:1}),t(C,{value:"large"},{default:l(()=>[_("大")]),_:1})]),_:1},8,["value"])]),_:1}),t(I,{label:"表单"},{default:l(()=>[t(A,{value:a.value.properties.extraData.formId,"onUpdate:value":e[4]||(e[4]=o=>a.value.properties.extraData.formId=o),options:V.value,fieldNames:{label:"name",value:"id"}},null,8,["value","options"])]),_:1})],64)):m("",!0),a.value.properties.nodeType=="link-node"?(r(),f(F,{key:2},[t(I,{label:"链接地址"},{default:l(()=>[t(X,{value:a.value.properties.extraData.url,"onUpdate:value":e[5]||(e[5]=o=>a.value.properties.extraData.url=o)},null,8,["value"])]),_:1}),t(I,{label:"打开方式"},{default:l(()=>[t(S,{value:a.value.properties.extraData.openType,"onUpdate:value":e[6]||(e[6]=o=>a.value.properties.extraData.openType=o),"button-style":"solid"},{default:l(()=>[t(C,{value:"_selef"},{default:l(()=>[_("当前页")]),_:1}),t(C,{value:"_blank"},{default:l(()=>[_("新窗口")]),_:1})]),_:1},8,["value"])]),_:1})],64)):m("",!0),a.value.properties.nodeType=="request-node"?(r(),f(F,{key:3},[t(Y,{value:a.value.properties.extraData.url,"onUpdate:value":e[8]||(e[8]=o=>a.value.properties.extraData.url=o)},{addonBefore:l(()=>[t(A,{value:a.value.properties.extraData.method,"onUpdate:value":e[7]||(e[7]=o=>a.value.properties.extraData.method=o),options:U.value},null,8,["value","options"])]),_:1},8,["value"]),me("div",null,[t(Q,null,{default:l(()=>[t(R,{key:"params",tab:"params"},{default:l(()=>[t(L,{columns:b.value,modelValue:a.value.properties.extraData.params,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.properties.extraData.params=o)},null,8,["columns","modelValue"])]),_:1}),t(R,{key:"headers",tab:"headers"},{default:l(()=>[t(L,{columns:O.value,modelValue:a.value.properties.extraData.headers,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.properties.extraData.headers=o)},null,8,["columns","modelValue"])]),_:1}),t(R,{key:"body",tab:"body"},{default:l(()=>[t(L,{columns:b.value,modelValue:a.value.properties.extraData.body,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.properties.extraData.body=o)},null,8,["columns","modelValue"])]),_:1})]),_:1})])],64)):m("",!0),["start-node","end-node"].includes(a.value.properties.nodeType)?(r(),y(Z,{key:4,description:"起止节点暂无配置项"})):m("",!0)]),_:1},8,["model"])]),_:1},8,["open"])],64)}}}),Ne=H(Te,[["__scopeId","data-v-da6c2fae"]]);export{Ne as default};
